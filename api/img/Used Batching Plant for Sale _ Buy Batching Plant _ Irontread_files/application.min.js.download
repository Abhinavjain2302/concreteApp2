"use strict";var ApplicationConfiguration=function(){var applicationModuleName="mean",applicationModuleVendorDependencies=["ngResource","ngStorage","ipCookie","ngAnimate","ngSanitize","ui.router","ui.bootstrap","ui.utils","ngFileUpload","ncy-angular-breadcrumb","ngBootstrap","ngTagsInput","ui.select","ngRoute","checklist-model","ui.date","ui-notification","gm","infinite-scroll","angular-flexslider","oitozero.ngSweetAlert","ui.bootstrap.datetimepicker","pdf","ngTasty","ngScrollbars","bootstrapLightbox"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(moduleName).run(["$rootScope","$location","$window",function($rootScope,$location,$window){}]),angular.module(moduleName).factory("authInterceptor"+moduleName,function($rootScope,$q,$window,$localStorage,ipCookie){return $localStorage.isrunning=!1,{request:function(config){return config.headers=config.headers||{},$localStorage.authToken&&(config.headers.Authorization="Bearer "+$localStorage.authToken),config},response:function(response){return $localStorage.expiresin,!response||response.status&&401===response.status?void 0:response||$q.when(response)},responseError:function(rejection){if(401===rejection.status){ipCookie.remove("userCId"),ipCookie.remove("userCName"),ipCookie.remove("userCompanyName"),ipCookie.remove("userDesignation"),ipCookie.remove("roleC"),ipCookie.remove("authenticatedC"),ipCookie.remove("tempsession"),ipCookie.remove("dp"),ipCookie.remove("verified");try{ipCookie.remove("userCId",{path:"/"}),ipCookie.remove("userCName",{path:"/"}),ipCookie.remove("userCompanyName",{path:"/"}),ipCookie.remove("userDesignation",{path:"/"}),ipCookie.remove("roleC",{path:"/"}),ipCookie.remove("dp",{path:"/"}),ipCookie.remove("verified",{path:"/"}),ipCookie.remove("authenticatedC",{path:"/"}),ipCookie.remove("tempsession",{path:"/"}),$localStorage.authToken=null,$localStorage.isrunning=!1,$localStorage.expiresin=null}catch(e){}}403===rejection.status}}}),angular.module(moduleName).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("authInterceptor"+moduleName)}]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0).hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","AuthenticationService","$state","$timeout","$location","stateList","$window",function($rootScope,AuthenticationService,$state,$timeout,$location,stateList,$window){$window.ga("create","UA-78701081-1","auto"),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.stateIsLoading=!0,$rootScope.location=toState.name}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){if(stateList.indexOf(toState.name.match().input)>-1){var isLoggedIn=AuthenticationService.isLogged();isLoggedIn||(isLoggedIn?$state.go(toState):(AuthenticationService.login(function(){$state.go(toState)}),AuthenticationService.isLogged()?$state.go(toState):$state.go("home")))}$timeout(function(){$rootScope.stateIsLoading=!1},500)}),$rootScope.$on("$locationChangeSuccess",function(){var strAbsUrl=$location.absUrl();angular.element(document).find(".canonical").attr("href",strAbsUrl),strAbsUrl=strAbsUrl.replace("http://www.irontread.com/",""),-1===strAbsUrl.indexOf("localhost:")&&$window.ga("send","pageview",strAbsUrl)})}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("chat",["core"]),ApplicationConfiguration.registerModule("cms",["core"]),ApplicationConfiguration.registerModule("core",["ui.router"]),ApplicationConfiguration.registerModule("dealer",["core"]),ApplicationConfiguration.registerModule("equipment",["core"]),ApplicationConfiguration.registerModule("payment",["core"]),ApplicationConfiguration.registerModule("transporter",["core"]),ApplicationConfiguration.registerModule("user",["core"]),angular.module("chat").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("chat",{url:"/chat",templateUrl:"modules/chat/views/chat.client.view.html",controller:"chatCtrl"})}]),angular.module("chat").controller("chatCtrl",["$scope","$timeout","$state","$stateParams","chatWs","Socket","AuthenticationService","$rootScope","contextPathimageurl","ipCookie",function($scope,$timeout,$state,$stateParams,chatWs,Socket,AuthenticationService,$rootScope,contextPathimageurl,ipCookie){var _errorHandler=function(e){console.error("Error 10001")};$scope.contextPathimageurl=contextPathimageurl,$scope.newChatCount=0,$scope.messageList=[],$scope.init=function(){$scope.userIdL="",$scope.msg="",$scope.userlist=[],$scope.messageList=[],$scope.getActiveUser(),$scope.getChat(),$(".intercom-sheet-content").scrollTop($(".intercom-sheet-content-container").height())},$scope.formatDate=function(d){return moment(d,"DD/MM/YYYY HH:mm:ss a").format("HH:mm A")+""},$scope.sendMsg=function(){"undefined"!=typeof $scope.msg&&""!==$scope.msg&&chatWs.sendMessage({chmessage:$scope.msg},function(res){200===res.status.statusCode&&($scope.msg="")},_errorHandler)},$scope.getActiveUser=function(){ipCookie("userCName")&&chatWs.getUserActiveList({},function(res){200===res.status.statusCode&&($scope.userlist=res.data)},_errorHandler)},$scope.getChat=function(){ipCookie("userCName")&&chatWs.getChatMessage({},function(res){200===res.status.statusCode&&($scope.messageList=res.data,$scope.userIdL=res.userId)},_errorHandler)},$scope.chatShow=!1;var intIndex=0;$scope.hideDiv=function(){AuthenticationService.login(function(){$scope.chatShow===!1&&$scope.init(),$scope.chatShow=intIndex%2===0,intIndex++,$scope.newChatCount=0})},$rootScope.$on("validateLogin",function(event,message){(message.isLoggedIn===!0||"true"===message.isLoggedIn)&&$scope.init()}),$scope.getImagePath=function(){},$scope.messages=[],Socket.socket||Socket.connect(),Socket.on("chatMessage",function(message){$scope.messages.unshift(message)}),$scope.sendMessage=function(userId,sender,time,strMessage){var message={userId:userId,sender:sender,time:time,message:strMessage};Socket.emit("chatMessage",message),this.messageText=""},Socket.on("chatMessage",function(message){$scope.messageList.push(message),$scope.newChatCount=$scope.newChatCount+1,setTimeout(function(){$(".intercom-sheet-content").scrollTop($(".intercom-sheet-content-container").height()+100)},50),$scope.messages.unshift(message)}),$scope.$on("$destroy",function(){Socket.removeListener("chatMessage")})}]),angular.module("chat").factory("chatWs",["$resource","contextPathprivate",function($resource,contextPathprivate){return $resource(contextPathprivate,{},{getUserActiveList:{url:contextPathprivate+"userchat/getuseractivelist",method:"GET"},sendMessage:{url:contextPathprivate+"userchat/sendmessage",method:"POST"},getChatMessage:{url:contextPathprivate+"userchat/getchatmessage",method:"GET"}})}]),angular.module("cms").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("search.cms1",{url:"/cn/:cms",views:{"main@search":{templateUrl:"modules/cms/views/cms.client.view.html",controller:"cmsCtrl"}}}),$stateProvider.state("search.cms",{url:"/section/:cms",views:{"main@search":{templateUrl:"modules/cms/views/cms.client.view.html",controller:"cmsCtrl"}}})}]),angular.module("cms").controller("cmsCtrl",["$scope","$state","$stateParams","cmsWS","title","description","$sce","$uibModal",function($scope,$state,$stateParams,ws,title,description,$sce,$uibModal){var seoName=$stateParams.cms;$scope.pageTitle=!1,$scope.seoHtml="",$scope.isMap=!0,$scope.isfaq=!0;var init=function(){ws.seoHtml({seoName:seoName},function(res){200===res.status.statusCode&&($scope.seoHtml=$sce.trustAsHtml(res.data.description),$scope.seoTitle=res.data.title,title(res.data.title),"contact"===res.data.seoTitle&&($scope.pageTitle=!0),description(res.data.keyword))},function(e){console.error("Error 10002	"+e)}),$scope.mapLocation=function(pageTitle){if($scope.isMap&&pageTitle){$scope.isMap=!1;var myLatLng={lat:28.575423,lng:77.238122},contentString='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">IronTread</h1><div id="bodyContent"><p>IronTread, India\'s first online contractor-to-contractorequipment rental and sale marketplace for the construction and infrastructure industry  which partnering with leading infrastructure companies in the region to create  the largest virtual equipment bank in Asia, Where participants can  Rent, Sell and Buy from each other via a robust auction-led process.</p><p>IronTread, <a href="http://www.irontread.com/" rel="publisher">http://www.irontread.com</a> </div></div>',infowindow=new google.maps.InfoWindow({content:contentString}),map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:myLatLng}),marker=new google.maps.Marker({position:myLatLng,map:map,title:"Block D-13, Defence Colony Flyover, Shiniwas Puri, New Delhi, Delhi 110024, India"});marker.addListener("click",function(){infowindow.open(map,marker)})}},"faq"===$state.params.cms&&$scope.isfaq&&($scope.isfaq=!1,$(document).on("click",".refund-popup",function(){$scope.refundPopup()}),$scope.refundPopup=function(){$uibModal.open({templateUrl:"scheduledRefundPopup.html",controller:"scheduledRefundCtrl",size:"lg"})})};init()}]).controller("scheduledRefundCtrl",["$scope","$state","$stateParams","cmsWS","title","description","$sce","$modalInstance",function($scope,$state,$stateParams,ws,title,description,$sce,$modalInstance){$scope.close=function(){$modalInstance.close()}}]),angular.module("cms").factory("cmsWS",["$resource","contextPathpublic",function($resource,contextPathpublic){return $resource(contextPathpublic,{},{seoHtml:{url:contextPathpublic+"cms/seo",method:"GET"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$sceDelegateProvider",function($stateProvider,$urlRouterProvider,$urlMatcherFactoryProvider,$sceDelegateProvider){function valToString(val){return null!==val?val.toString():val}$sceDelegateProvider.resourceUrlWhitelist(["self","http://*.irontread.com/**"]),$urlMatcherFactoryProvider.type("nonURIEncoded",{encode:valToString,decode:valToString,is:function(){return!0}}),window.location.hostname.indexOf("irontread")>-1&&$urlRouterProvider.otherwise("not-found"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html",controller:"HomeController",params:{categoryId:"",categoryName:"",seoname:"",type:""}}).state("contractorsDetails",{url:"/contractorsdetails",templateUrl:"modules/core/views/contractor.client.view.html",controller:"HeaderController"}).state("suppliersDetails",{url:"/suppliersdetails",templateUrl:"modules/core/views/supplier.client.view.html",controller:"HeaderController"}).state("siteInformation",{url:"/information",templateUrl:"modules/core/views/siteinfo.client.view.html",controller:"HeaderController"}).state("benefitsDetail",{url:"/benefits/:title",templateUrl:"modules/core/views/benifits.client.view.html",controller:"BenefitsController",params:{title:""}}).state("termsandcondition",{url:"/terms-condition/:flow",templateUrl:"modules/core/views/termsandcondition.client.view.html",controller:"BenefitsController",params:{flow:""}}).state("auctionlist",{url:"/auction/list",templateUrl:"modules/core/views/auctionlist.client.view.html",controller:"auctionlistCtrl"}).state("featuredlist",{url:"/featured/list",templateUrl:"modules/core/views/featuredlist.client.view.html",controller:"featuredlistCtrl"}).state("howitworks",{url:"/howitworks/:type",templateUrl:"modules/core/views/howitworks.client.view.html",controller:"HowItWorksController",params:{type:""}}).state("logo",{"abstract":!0,templateUrl:"modules/core/views/logo.client.view.html"}).state("search",{"abstract":!0,templateUrl:"modules/core/views/main.client.view.html",controller:"SearchController"}).state("finance",{url:"/finance",templateUrl:"modules/core/views/finance.client.view.html",controller:"SearchController"}).state("forgetPassword",{url:"/forgetPassword/:token",templateUrl:"modules/core/views/forgetPassword.client.view.html",controller:"HeaderController"}).state("search.category",{url:"/category/{seoname:nonURIEncoded}/:categoryId?:type=",views:{"main@search":{templateUrl:"modules/core/views/category.client.view.html",controller:"CategoryController"}},params:{categoryId:"",categoryName:"",seoname:"",type:""},ncyBreadcrumb:{label:"Category",parent:"home"}}).state("not-found",{url:"/not-found",templateUrl:"modules/core/views/404.client.view.html"}).state("activation",{url:"/activation/:token",templateUrl:"modules/core/views/activation.client.view.html",controller:"activationCtrl",params:{token:null}})}]),angular.module("core").controller("activationCtrl",["$scope","$state","$stateParams","activationService","contextPathimageurl","Notification",function($scope,$state,$stateParams,activationService,contextPathimageurl,Notification){activationService.activation($stateParams,function(res){200===res.status.statusCode&&Notification.success(res.data)})}]),angular.module("core").controller("auctionlistCtrl",["$scope","$uibModal","coreWS","contextPathimageurl",function($scope,$uibModal,coreWS,contextPathimageurl){$scope.contextPathimageurl=contextPathimageurl,$scope.upcomingAuction=[],$scope.allAuction=[],$scope.noToday=!0,$scope.isUpcoming=!1,$scope.init=function(){$scope.getUpcomingAuction()},$scope.getUpcomingAuction=function(){coreWS.getUpcomingAuction({},function(res){200===res.status.statusCode&&($scope.allAuction=res.grpData,$scope.upcomingAuction=res.data,$scope.isUpcoming=res.data.length>0,angular.forEach($scope.upcomingAuction,function(value,key){return value.today?($scope.noToday=!1,!1):void 0}))})},$scope.init()}]),angular.module("core").controller("BenefitsController",["$scope","$state","$stateParams","coreWS","contextPathimageurl","title","description",function($scope,$state,$stateParams,coreWS,contextPathimageurl,title,description){$scope.contextPathimageurl=contextPathimageurl;title(null!==$state.params.title||void 0!==$state.params.title?"Online Equipment Rental, Buying and Finance : Benefits : irontread.com":"Online Equipment Rental, Buying and Finance : Terms & Condition : irontread.com"),$scope.benefits=$state.params.title,$scope.termCondition=$state.params.flow}]).controller("HowItWorksController",["$scope","$state","$stateParams","coreWS","contextPathimageurl","title","description","$rootScope","$sce","$timeout","Notification",function($scope,$state,$stateParams,coreWS,contextPathimageurl,title,description,$rootScope,$sce,$timeout,Notification){$scope.contextPathimageurl=contextPathimageurl;$rootScope.$on("$locationChangeSuccess",function(){$scope.titleFun()}),$scope.titleFun=function(){title("How it Works IronTread : irontread.com"),description("How it Works IronTread : irontread.com")},$scope.titleFun(),$scope.hiwpage=function(value){$scope.heading=value,"buy"===value?$scope.slideshiw=[{image:contextPathimageurl+"img/direct buy1.png"}]:"rent"===value?$scope.slideshiw=[{image:contextPathimageurl+"img/direct rent1.png"}]:"finance"===value?$scope.slideshiw=[{image:contextPathimageurl+"img/FINANCE1.png"}]:"sAuction"===value?$scope.slideshiw=[{image:contextPathimageurl+"img/Straight auction 1.png"}]:"rARent"===value?$scope.slideshiw=[{image:contextPathimageurl+"img/reverse auction RENT1.png"}]:"rABuy"===value?$scope.slideshiw=[{image:contextPathimageurl+"img/reverse-auction-buy1.png"}]:($scope.heading="buy",$scope.slideshiw=[{image:contextPathimageurl+"img/direct buy1.png"}])},$scope.hiwpage($state.params.type),$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/ZiifQf6VWKA?autoplay=1&loop=1&rel=0"),$scope.videoUrlFun=function(_process){$state.go($state.current,{type:_process},{reload:!1}),$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/ZiifQf6VWKA?autoplay=1&loop=1&rel=0")},$scope.videoUrlFun($state.params.type),$scope.process=!1,$scope.processVideo=function(_heading){$scope.videoUrl="",$scope.process=!0,"rent"===_heading||"rARent"===_heading?$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/FMqa17ol7EE?autoplay=1&loop=1&rel=0"):"buy"===_heading||"rABuy"===_heading?$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/Iq3Hni6cV5Y?autoplay=1&loop=1&rel=0"):($scope.process=!1,Notification.error("No video available."))},$scope.processVideoClose=function(){$scope.process=!1,$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/ZiifQf6VWKA?autoplay=1&loop=1&rel=0")}}]),angular.module("core").controller("CategoryController",["$scope","$state","$stateParams","coreWS","contextPathimageurl","title","description","$filter",function($scope,$state,$stateParams,coreWS,contextPathimageurl,title,description,$filter){$scope.contextPathimageurl=contextPathimageurl;var temp="",_errorHandler=function(e){console.error("Error 10003	"+e)};$scope.childlist=[],$scope.breadCrumb=[],$scope.type=$stateParams.type,$stateParams.type&&"undefined"!=typeof $stateParams.type&&null!==$stateParams.type&&(temp=$scope.type.toUpperCase()),$scope.seoName=$stateParams.seoname,$scope.titleName=[],$scope.descriptionList=[],$scope.catDec="",$scope.getCatDec=function(){coreWS.getCategeoryDec({catId:$stateParams.categoryId},function(res){if(200===res.status.statusCode){var catDescription=res.data;catDescription&&""!==catDescription&&(catDescription=catDescription.replace(/\s\s+/g," "),$scope.catDec=catDescription)}},_errorHandler)},$scope.getCatDec(),coreWS.getcategory({parentId:"0",seoName:$stateParams.seoname,type:$stateParams.type},function(res){200===res.status.statusCode&&($scope.childlist=res.data,description(res.parentDec))},_errorHandler),coreWS.breadCrumb({catid:$stateParams.categoryId},function(res){200===res.status.statusCode&&($scope.breadCrumb=res.data,angular.forEach($scope.breadCrumb,function(data){$scope.titleName.push(data.name),title(temp+" "+$scope.titleName.join(" ")+" online - Irontread.com")}))},_errorHandler),$scope.getCategoriesCount=function(searchCatId){return"rent"!==$scope.type||""===$scope.type?$filter("filter")(itcategorieslists2016,{id:searchCatId},!0)[0].buyCount:$filter("filter")(itcategorieslists2016,{id:searchCatId},!0)[0].rentCount},$scope.filterSeo=function(seo,type){return seo=seo.split(" ").join("-"),seo=seo.replace(/_/g,"-"),seo+="rent"===type?"-rental":"buy"===type?"-sale":"new"===type?"-new":"-sale",seo.replace(/--/g,"-").replace(/ & /g,"and").replace(/&/g," and ").toLowerCase()}}]),angular.module("core").controller("featuredlistCtrl",["$scope","$uibModal","coreWS","contextPathimageurl",function($scope,$uibModal,coreWS,contextPathimageurl){$scope.contextPathimageurl=contextPathimageurl,$scope.getFeatured=[],$scope.init=function(){$scope.getFeaturedEquip()},$scope.getFeaturedEquip=function(){coreWS.getFeaturedEquip({},function(res){200===res.status.statusCode&&($scope.getFeatured=res.data)})},$scope.init()}]),angular.module("core").controller("homeFinanceCtrl",["$scope","$state","coreWS","$location","$rootScope","Notification","contextPathimageurl","financeHomeService","focus","$timeout","AuthenticationService",function($scope,$state,coreWS,$location,$rootScope,Notification,contextPathimageurl,financeHomeService,focus,$timeout,AuthenticationService){var _errorHandler=function(e){console.error("Error 10004	"+e)};$scope.tenureMonth=[6,12,18,24,36,42,48,54],$scope.isItCode=!1,$scope.loanData={state:"",country:"India",contactPhone:null},$scope.localLoanData={categoryshow:!0,manufacturershow:!1,modelshow:!1,country:"India"},$scope.dataEqmt={categoryId:"",makeList:[],model:[],equipmentsList:[],allStates:[]},$scope.functions={getState:function(name){financeHomeService.getState({},function(res){200===res.status.statusCode&&($scope.dataEqmt.states=res.data,angular.forEach(res.data,function(val){$scope.dataEqmt.allStates.push(val.stateName),name&&name===val.stateName&&($scope.localLoanData.state=val,$scope.loanData.state=val.stateName)}))},_errorHandler)},getCat:function(){financeHomeService.getCat({},function(res){200===res.status.statusCode&&($scope.catsList=res.data),$timeout(function(){$scope.localLoanData.categoryshow=!1},500)},_errorHandler)},getEquipment:function(data){$scope.localLoanData.model=[],$scope.dataEqmt.manufacturer=[],$scope.dataEqmt.makeList=[],$scope.localLoanData.manufacturershow=!0,$scope.loanData.categoryid=$scope.dataEqmt.categoryId.id,$scope.loanData.catName=$scope.dataEqmt.categoryId.catName,financeHomeService.getEquipment({cat_id:$scope.dataEqmt.categoryId.id},function(res){200===res.status.statusCode&&($scope.dataEqmt.equipmentsList=res.data,angular.forEach(res.data,function(val){-1===$scope.dataEqmt.makeList.indexOf(val.make)&&($scope.dataEqmt.makeList.push(val.make),$scope.dataEqmt.makeList=$scope.dataEqmt.makeList.sort()),"Other"===val.make&&($scope.otherId=val.id)}),$timeout(function(){$scope.localLoanData.manufacturershow=!1},500))},_errorHandler)},funEquipments:function(){$scope.localLoanData.modelshow=!0,$scope.localLoanData.model=[],$scope.dataEqmt.model=[];try{angular.forEach($scope.dataEqmt.equipmentsList,function(val){val.make===$scope.dataEqmt.manufacturer&&$scope.dataEqmt.model.push(val)}),"Other"!==$scope.dataEqmt.manufacturer&&$scope.dataEqmt.model.push({equipName:"Other",id:$scope.otherId,make:$scope.dataEqmt.manufacturer})}catch(e){console.error("Error 10005	"+e)}$timeout(function(){$scope.localLoanData.modelshow=!1},500)},checkITCode:function(itcode){itcode.length>10&&financeHomeService.checkITCode({eid:itcode},function(res){if(200!==res.status.statusCode&&res.data!==!0)Notification.error("Invalid Irontread Code: '"+itcode+"'"),$scope.loanData.itcode="",$scope.isItCode=!1,$scope.loanData.sellerName="",$scope.loanData.contactName="",$scope.loanData.contactPhone="",$scope.loanData.contactEmail="";else{$scope.isItCode=!0,""!==res.data.othManu&&""!==res.data.othModel&&($scope.loanData.manufacturertext=res.data.othManu,$scope.loanData.modeltext=res.data.othModel),$scope.loanData.sellerName="********",$scope.loanData.contactName="********",$scope.loanData.contactPhone=9999999999,$scope.loanData.contactEmail="example@gmail.com",$scope.loanData.eqmpId=res.data._id,$scope.loanData.equipYear=parseInt(res.data.eue_equipment_model_year),$scope.loanData.city=res.data.eue_city,$scope.geteqmp=function(id){return{}},$scope.getcat=function(){return{cat:function(id){angular.forEach($scope.catsList,function(value,key){value.id===id&&($scope.dataEqmt.categoryId=value,clouser.manu(value.id))})},manu:function(id){var manuId=res.data.eue_equipment_id;financeHomeService.getEquipment({cat_id:id},function(res){200===res.status.statusCode&&($scope.dataEqmt.equipmentsList=res.data,angular.forEach(res.data,function(val){val.id===manuId&&($scope.dataEqmt.manufacturer=val.make,$scope.localLoanData.model=val)}))},_errorHandler)},state:function(state){angular.forEach($scope.dataEqmt.states,function(value,key){value.stateName===state&&($scope.localLoanData.state=value)})}}};var clouser=$scope.getcat();clouser.cat(res.data.eue_category_id),clouser.state(res.data.eue_state),$scope.localLoanData.country=res.data.eue_country}},_errorHandler)}},$scope.stateUpdate=function(stateData){$scope.loanData.state=stateData.stateName},$scope.localData=function(str){"country"===str&&($scope.loanData.country=$scope.localLoanData.country),"state"===str&&($scope.loanData.state=$scope.localLoanData.state.stateName),"model"===str&&($scope.loanData.model=$scope.localLoanData.model.equipName,$scope.loanData.equipMake=$scope.localLoanData.model.make,$scope.loanData.masterid=$scope.localLoanData.model.id)},$scope.applyForLoan=function(loanData){console.error("Info 10006	"+JSON.stringify(loanData))},$scope.submit=function(){AuthenticationService.login(function(){"undefined"==typeof $scope.loanData.itcode?parseInt($scope.loanData.loanAmount)>parseInt($scope.loanData.salePrice)?Notification.error("Loan amount must be less than equipment's sale price( Rs. "+$scope.loanData.salePrice+" )"):parseInt($scope.loanData.salePrice)>9999999999?Notification.error("Sale price is not acceptable"):"undefined"==typeof $scope.loanData.state?Notification.error("Please fill state name"):"undefined"==typeof $scope.loanData.catName?Notification.error("Please select a Category"):"undefined"==typeof $scope.loanData.equipMake?Notification.error("Please select a Manufacturer"):"undefined"==typeof $scope.loanData.model?Notification.error("Please select a Model"):"undefined"==typeof $scope.loanData.equipYear?Notification.error("Please fill year of manufacture"):"undefined"==typeof $scope.loanData.city?Notification.error("Please fill City"):"undefined"==typeof $scope.loanData.country?Notification.error("Please fill Country"):"undefined"==typeof $scope.loanData.salePrice?Notification.error("Please fill sale price"):"undefined"==typeof $scope.loanData.loanAmount?Notification.error("Please fill loan amount"):"undefined"==typeof $scope.loanData.loan_tenure?Notification.error("Please fill loan tenure"):"undefined"==typeof $scope.loanData.sellerName?Notification.error("Please fill seller name"):"undefined"==typeof $scope.loanData.contactName?Notification.error("Please fill contact person's name"):"undefined"==typeof $scope.loanData.contactPhone?Notification.error("Please fill contact person's phone"):"undefined"==typeof $scope.loanData.contactEmail?Notification.error("Please fill the valid email address"):financeHomeService.applyForFinance($scope.loanData,function(res){200!==res.status.statusCode?Notification.error(res.data):(Notification.success(res.data),$state.go("search.dash.financeMain.finance"))},_errorHandler):$scope.loanData.loanAmount>$scope.loanData.salePrice?Notification.error("Loan amount must be less than equipment's sale price( Rs. "+$scope.loanData.salePrice+" )"):$scope.loanData.salePrice>9999999999?Notification.error("Sale price is not acceptable"):"undefined"==typeof $scope.loanData.salePrice?Notification.error("Please fill Sale price"):"undefined"==typeof $scope.loanData.loanAmount?Notification.error("Please fill Loan Amount"):"undefined"==typeof $scope.loanData.loan_tenure?Notification.error("Please fill Loan Tenure"):financeHomeService.applyForFinance($scope.loanData,function(res){200!==res.status.statusCode?Notification.error(res.data):(Notification.success(res.data),$state.go("search.dash.financeMain.finance"))},_errorHandler)})},$scope.reset=function(){$scope.dataEqmt.categoryId="",$scope.dataEqmt.manufacturer="",$scope.localLoanData.model="",$scope.localLoanData.state="",$scope.loanData={}};var init=function(){$scope.functions.getCat(),$scope.functions.getState()};init(),$scope.autoCompleteOptions={types:"(cities)",country:"in",place_changed:function(data){data.geometry.location;angular.forEach(data.address_components,function(item,index){"locality"===item.types[0]&&($scope.loanData.city=item.long_name),"administrative_area_level_1"===item.types[0]&&$scope.functions.getState(item.long_name)})}}}]),angular.module("core").config(["ScrollBarsProvider",function(ScrollBarsProvider){ScrollBarsProvider.defaults={autoHideScrollbar:!1,setHeight:500,scrollInertia:100,theme:"light",axis:"xy",advanced:{updateOnContentResize:!0},scrollButtons:{scrollAmount:"auto",enable:!0}}}]),angular.module("core").controller("HeaderController",["$scope","$state","$stateParams","$rootScope","coreWS","ipCookie","$localStorage","$uibModal","AuthenticationService","$location","Notification","$window","Socket","contextPathimageurl","contextPath","$timeout",function($scope,$state,$stateParams,$rootScope,coreWS,ipCookie,$localStorage,$uibModal,AuthenticationService,$location,Notification,$window,Socket,contextPathimageurl,contextPath,$timeout){$scope.contextPathimageurl=contextPathimageurl,$scope.auctionImage=$location.path(),$scope.currentDate=moment().format("DD-MM-YYYY"),$scope.upcomingAuction=[],$scope.getFeatured=[],$scope.noToday=!0,$scope.isUpcoming=!1,$scope.headerDetails={},$scope.auctionLink=function(date){$state.go("search.equipment4",{sa:!0,sadate:date,type:"buy"},{reload:!0})},$scope.scrollbarConfig={setHeight:500,theme:"dark",axis:"y",scrollInertia:200},$scope.dataValidater=function(inParam){var status=!1;return"undefined"!=typeof inParam&&""!==inParam&&null!==inParam&&"null"!==inParam&&(status=!0),status},$scope.getUpcomingAuction=function(){coreWS.getUpcomingAuction({},function(res){200===res.status.statusCode&&($scope.upcomingAuction=res.data,$scope.isUpcoming=res.data.length>0,angular.forEach($scope.upcomingAuction,function(value,key){return value.today?($scope.noToday=!1,!1):void 0}))})},$scope.getFeaturedEquip=function(){coreWS.getFeaturedEquip({},function(res){200===res.status.statusCode&&($scope.getFeatured=res.data)})},$scope.getUpcomingAuction(),$scope.getFeaturedEquip(),$scope.notifyCount=0,document.addEventListener("DOMContentLoaded",function(){"granted"!==window.Notification.permission&&window.Notification.requestPermission()}),$scope.notifyMe=function(data){if(data.img="undefined"==typeof data.img?"http://irontread.com/img/logo.png":data.img,!window.Notification)return void alert("Desktop notifications not available in your browser. Try Chromium.");if("granted"!==window.Notification.permission)window.Notification.requestPermission();else{$scope.notifyCount=$scope.notifyCount-1;var notification=new window.Notification(data.title,{icon:data.img,body:data.body,requireInteraction:!0});""!==data.link&&(notification.onclick=function(){window.open(data.link)})}},Socket.socket||Socket.connect();try{Socket.on("usermessage",function(message){try{console.info($scope.notifyCount+"\n"+JSON.stringify(message,null,2));var msg={};msg.title="IronTread",msg.body="undefined"!=typeof message.notificationMessage?message.notificationMessage:message.msg,msg.link="","undefined"!=typeof message.notificationMessage&&Notification.success(message.notificationMessage),setTimeout(function(){$scope.notifyMe(msg)},2e3*$scope.notifyCount),$scope.notifyCount=$scope.notifyCount+1}catch(e){console.error("Error 10007	"+e)}$rootScope.$emit("counter",message)})}catch(e){console.error("Error 10008	"+e)}$scope.init=function(){ipCookie("userCName")&&($scope.userCNameHeader=ipCookie("userCName"),$scope.userName=ipCookie("userCName")),"undefined"==typeof ipCookie("tempsession")&&$scope.generateSession()},$scope.userIdentity=$location.path().split("/")[2],$scope.urlType=function(type){$location.search().type=type,"rent"===type?$location.search().type="rent":"new"===type?$location.search().type="new":$location.search().type="buy"},$scope.classHeader="top-static",$scope.menuBg="",$scope.logobg="","/"!==$location.path()?($scope.classHeader="top-fixed",$scope.menuBg="",$scope.logobg=""):($scope.classHeader="top-static",$scope.menuBg="bg-black",$scope.logobg="bg-logo"),$rootScope.$on("$locationChangeSuccess",function(){"/"!==$location.path()?($scope.classHeader="top-fixed",$scope.menuBg="",$scope.logobg=""):($scope.classHeader="top-static",$scope.menuBg="bg-black",$scope.logobg="bg-logo"),$scope.auctionImage=$location.path(),$scope.userIdentity=$location.path().split("/")[2]}),$scope.token=$stateParams.token,$scope.isLoggedIn=!1,$scope.callOnes=0,$rootScope.$on("ProfileUpdate",function(){$scope.userCNameHeader=ipCookie("userCName"),$scope.userName=ipCookie("userCName")}),$rootScope.$on("validateLogin",function(event,data){$scope.userName=data.userCName,$scope.isLoggedIn=data.isLoggedIn}),$rootScope.$on("validateLogout",function(event,data){
$scope.isLoggedIn=data.isLoggedIn}),$scope.$watch("AuthenticationService.isLoggedIn",function(){$scope.isLoggedIn=AuthenticationService.isLoggedIn});var linkValidation=function(strToken){coreWS.forgotpassword({token:strToken,action:"validation"},function(res){200!==res.status.statusCode&&"/"!==$location.path()&&(window.location.href="/")})};void 0!==$stateParams.token&&linkValidation($stateParams.token),$scope.resetPassword=function(newpass,confirmpass){coreWS.forgotpassword({token:$stateParams.token,newPassowrd:newpass,conPassword:confirmpass},function(res){200===res.status.statusCode?Notification.success("Password has been set."):Notification.error("Check your Password.")})},$scope.generateSession=function(){coreWS.getSession(function(res){200===res.status.statusCode&&ipCookie("tempsession",res.session,{expires:21})},function(e){console.error("Error 10009	"+e)})},$scope.init(),$scope.openSignupLoginPopup=function(fromSignup){var modalInstance=$uibModal.open({animation:!0,templateUrl:"signup.login.popup.html",controller:"SignupLoginPopupCtrl",size:"lg",resolve:{fromSignup:function(){return fromSignup}}});modalInstance.result.then(function(data){try{data.flogin!==!0?(ipCookie("userCId",data.id,{path:"/"}),ipCookie("userCName",data.name,{path:"/"}),ipCookie("userCompanyName",data.companyName,{path:"/"}),ipCookie("userDesignation",data.designation,{path:"/"}),$scope.userName=data.name,ipCookie("authenticatedC",data.authenticated,{path:"/"}),ipCookie("roleC",data.role,{path:"/"}),ipCookie("dp",data.dp,{path:"/"}),ipCookie("verified",data.verified,{path:"/"}),$scope.isLoggedIn=!0,$rootScope.$emit("loginData",$scope.isLoggedIn)):Notification.success(data)}catch(e){}},function(){})},$scope.logout=function(){Socket.socket||Socket.connect(),Socket.emit("logout",{userid:ipCookie("userCId")}),ipCookie.remove("userCId"),ipCookie.remove("userCName"),ipCookie.remove("userCompanyName"),ipCookie.remove("userDesignation"),ipCookie.remove("roleC"),ipCookie.remove("authenticatedC"),ipCookie.remove("tempsession"),ipCookie.remove("dp"),ipCookie.remove("verified");try{ipCookie.remove("userCId",{path:"/"}),ipCookie.remove("userCName",{path:"/"}),ipCookie.remove("userCompanyName",{path:"/"}),ipCookie.remove("userDesignation",{path:"/"}),ipCookie.remove("roleC",{path:"/"}),ipCookie.remove("dp",{path:"/"}),ipCookie.remove("verified",{path:"/"}),ipCookie.remove("authenticatedC",{path:"/"}),ipCookie.remove("tempsession",{path:"/"}),$scope.isLoggedIn=!1,$localStorage.authToken=null,$localStorage.isrunning=!1,$localStorage.expiresin=null,$window.location="/"}catch(e){}$('<iframe id="itIframe" src="'+contextPath+'/cn/about" style="height: 0;width: 0;left: -9999px;position: absolute;" />').appendTo("body"),setTimeout(function(){$(document).find("#itIframe").remove()},1e4)};var updateTKD=function(uid,absUrl){$(document).find("title").html($scope.headerDetails.title),$(document).find("meta[property='og\\:title']").attr("content",$scope.headerDetails.title),$(document).find("meta[property='twitter\\:title']").attr("content",$scope.headerDetails.title),$(document).find("meta[name='description']").attr("content",$scope.headerDetails.description),$(document).find("meta[property='og\\:description']").attr("content",$scope.headerDetails.description),$(document).find("meta[property='twitter\\:description']").attr("content",$scope.headerDetails.description),$(document).find("meta[name='keywords']").attr("content",$scope.headerDetails.keywords),$(document).find("meta[property='og\\:keywords']").attr("content",$scope.headerDetails.keywords),$(document).find("meta[property='twitter\\:keywords']").attr("content",$scope.headerDetails.keywords),$(document).find("meta[property='og\\:url']").attr("content",absUrl),$(document).find("meta[property='twitter\\:url']").attr("content",absUrl),"home"!==uid&&(($scope.headerDetails.H1||$scope.headerDetails.H2)&&$scope.headerDetails.pageDescription&&$(document).find("section#sContent").css({display:"inline-block"}),$scope.headerDetails.H1&&$(document).find("section#sContent H1.header").html($scope.headerDetails.H1).css({display:"block"}),$scope.headerDetails.H2&&$(document).find("section#sContent H2.header").html($scope.headerDetails.H2).css({display:"block"}),$scope.headerDetails.pageDescription&&$(document).find("section#sContent p.content").html($scope.headerDetails.pageDescription).css({display:"block"}),$scope.headerDetails.H1||$(document).find("section#sContent H1.header").html($scope.headerDetails.H1).css({display:"none"}),$scope.headerDetails.H2||$(document).find("section#sContent H2.header").html($scope.headerDetails.H2).css({display:"none"}),$scope.headerDetails.pageDescription||$(document).find("section#sContent p.content").html($scope.headerDetails.pageDescription).css({display:"none"}))},seoReady=!0,conditionCheck=function(obj,str){return obj&&str?obj.indexOf(str)>-1:!1},getSeoInfo=function(){seoReady=!1;var absUrl=$location.absUrl(),path=($location.url(),$location.path()),uid=null,pathArray=[],type=conditionCheck(absUrl,"rent")?"rent":conditionCheck(absUrl,"buy")?"buy":conditionCheck(absUrl,"new")?"new":"";path.indexOf("equipmentdetail")>-1?(pathArray=path.replace("/equipmentdetail/").split("/"),uid=pathArray[pathArray.length-1]):path.indexOf("search")>-1?uid=$location.search().categoryId:path.indexOf("category")>-1?(pathArray=path.replace("/category/").split("/"),uid=pathArray[pathArray.length-1]):"/"===path&&(uid="home"),uid&&coreWS.getSeo({uid:uid,type:type},function(res){if(200===res.status.statusCode){$scope.headerDetails=res.data,res.data.pageDescription||$(document).find("section#sContent").css({display:"none"}),seoReady=!0;for(var k=0;4>=k;k++)$timeout(function(){updateTKD(uid,absUrl)},Math.pow(10,k))}})};$rootScope.$on("$stateChangeSuccess",function(){angular.element(document).ready(function(){seoReady&&getSeoInfo()})}),$rootScope.$on("$locationChangeSuccess",function(){angular.element(document).ready(function(){seoReady&&getSeoInfo()})})}]),angular.module("core").controller("SignupLoginPopupCtrl",["$scope","$rootScope","$window","ipCookie","$uibModal","$modalInstance","fromSignup","$localStorage","coreWS","$state","$location","Notification","Socket","Captcha","contextPath",function($scope,$rootScope,$window,ipCookie,$uibModal,$modalInstance,fromSignup,$localStorage,coreWS,$state,$location,Notification,Socket,Captcha,contextPath){$scope.user=[],$scope.user.countryCode="+91",$scope.captchaKey=Captcha,$scope.companyOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"administrative_area_level_1"===item.types[0]&&($scope.user.company_address.state=item.long_name),"locality"===item.types[0]&&($scope.user.company_address.city=item.long_name),"country"===item.types[0]&&($scope.user.company_address.country=item.long_name)})}};var addIframe=function(){$('<iframe id="itIframe" src="'+contextPath+'/cn/about" style="height: 0;width: 0;left: -9999px;position: absolute;" />').appendTo("body"),setTimeout(function(){$(document).find("#itIframe").remove()},1e4)};fromSignup?$scope.currentView="signup":($localStorage.chkbx&&""!==$localStorage.chkbx&&($scope.user.emailAddress=$localStorage.usrname,$scope.user.pass=$localStorage.pass,$scope.user.isChecked=$localStorage.chkbx),$scope.currentView="login"),$scope.openLogin=function(){$scope.currentView="login"},$scope.openSignup=function(){$scope.currentView="signup"},$scope.openMain=function(){$scope.currentView="main"},$scope.openForget=function(){$scope.currentView="forgotPassword"},$scope.cancel=function(){$state.go("home",{},{reload:!1}),$modalInstance.dismiss("cancel")},$scope.creditAgencyArray=[],$scope.getCreditAgencyList=function(){coreWS.getCreditAgency({},function(res){200===res.status.statusCode&&($scope.creditAgencyArray=res.data),$scope.close=function(){$modalInstance.close()}},function(e){console.error("Error 10010	"+e)})},$scope.getCreditAgencyList(),$scope.refreshCaptcha=function(){$rootScope.$broadcast("reCaptcha",{})},$scope.user.type="Individual",$scope.submitForm=function(isValid,user){user.token=ipCookie("captcha"),user.isTransporter=!1,isValid&&coreWS.register({captcha:"undefined"==typeof user.captcha?"":user.captcha,token:"undefined"==typeof user.token?"":user.token,companyContactNo:"undefined"==typeof user.companyContactNo?"":user.companyContactNo,companyDescription:"undefined"==typeof user.companyDescription?"":user.companyDescription,companyName:"undefined"==typeof user.companyName?"":user.companyName,address:user.company_address,confirmPassword:"undefined"==typeof user.confirmPassword?"":user.confirmPassword,contactNo:"undefined"==typeof user.contactNo?"":user.contactNo,countryCode:"undefined"==typeof user.countryCode?"":user.countryCode,creditAgency:"undefined"==typeof user.creditAgency?"":user.creditAgency,creditRating:"undefined"==typeof user.creditRating?"":user.creditRating,email:"undefined"==typeof user.email?"":user.email,firstname:"undefined"==typeof user.firstname?"":user.firstname,isTransporter:"undefined"==typeof user.isTransporter?"":user.isTransporter,lastname:"undefined"==typeof user.lastname?"":user.lastname,password:"undefined"==typeof user.password?"":user.password,stdcode:"undefined"==typeof user.stdcode?"":user.stdcode,type:"undefined"==typeof user.type?"":user.type,dealer:"undefined"==typeof user.dealer?"":user.dealer,registerFrom:"website"},function(res){200===res.status.statusCode&&res.authenticated===!0?(Notification.success(res.data.msg),$modalInstance.close(res.data)):200===res.status.statusCode&&res.authenticated===!1&&"undefined"!=typeof res.message?Notification.error({message:'<span class="glyphicon glyphicon-warning-sign"></span> '+res.message,delay:1e4,positionY:"bottom"}):res.error&&Notification.error({message:'<span class="glyphicon glyphicon-warning-sign"></span> '+res.error}),$scope.close=function(){$modalInstance.close()}},function(e){console.error("Error 10011	"+e)})},$scope.submit=function(isValid,user){isValid&&coreWS.login({email:user.emailAddress,password:user.pass,captcha:"undefined"==typeof user.captcha?"":user.captcha,token:ipCookie("captcha")},function(res){if(200===res.status.statusCode)if(res.authenticated===!0){try{Socket.socket||Socket.connect(),Socket.emit("login",{userid:res.data[0].id})}catch(e){console.error("Error 10012	"+e)}$scope.rememberMe(user),$localStorage.authToken=res.token,$localStorage.expiresin=res.expires,$modalInstance.close(res.data[0]),addIframe()}else Notification.error("Login Failed! Check your email & password");else 201===res.status.statusCode?Notification.warning(res.status.statusMessage):Notification.error(res.status.statusMessage);$scope.close=function(){$modalInstance.close()}},function(e){Notification.error("Please enter valid email & password.")})},$scope.rememberMe=function(user){try{$localStorage.usrname="",$localStorage.pass="",$localStorage.chkbx=""}catch(e){}user.isChecked&&($localStorage.usrname=user.emailAddress,$localStorage.pass=user.pass,$localStorage.chkbx=!0)},$scope.funForgetPassword=function(obj){coreWS.forgotpassword({email:obj.email,captcha:"undefined"==typeof obj.captcha?"":obj.captcha,capToken:ipCookie("captcha")},function(res){200===res.status.statusCode?Notification.success(res.status.statusMessage):201===res.status.statusCode?Notification.warning(res.status.statusMessage):Notification.error(res.status.statusMessage)}),$modalInstance.close()}}]),angular.module("core").controller("HomeController",["$scope","coreWS","coreLS","$state","$stateParams","contextPath","contextPathimageurl","$rootScope","$location","title","description","$timeout","$filter","$document","$uibModal","chatuser","AuthenticationService","serverType",function($scope,coreWS,coreLS,$state,$stateParams,contextPath,contextPathimageurl,$rootScope,$location,title,description,$timeout,$filter,$document,$uibModal,chatuser,AuthenticationService,serverType){$scope.isBeta="live"!==serverType,$scope.titleFun=function(){"home"===$state.current.name?(title("Online Construction Equipment Marketplace : Rent, Buy, Sell & Finance"),description("IronTread, India's first online contractor-to-contractor equipment rental and sale marketplace for the construction and infrastructure industry which partnering with leading infrastructure companies in the region to create the largest virtual equipment bank in Asia, Where participants can Rent, Sell and Buy from each other via a robust auction-led process.")):"search.finance"===$state.current.name?(title("IronTread Finance Option for Equipments - Irontread.com"),description("")):"howitworks"===$state.current.name&&(title("How it Works IronTread - Irontread.com"),description(""))},$scope.contextPath=contextPath,$scope.titleFun(),$scope.category=[],$scope.type=$location.search().type?$location.search().type:"buy",$scope.csItems=[],$scope.csGroupTotal=0,$scope.categorylists=[],$scope.csItems=[],$scope.coomingSoonItems=[],$scope.showRent=!1,$scope.showBuy=!0,$scope.showNew=!1;var _errorHandler=function(e){};$scope.benefitsLink=function(title){$state.go("benefitsDetail",{title:title},{reload:!0})},$scope.filterSeo=function(seo,type,hyphen){return seo=seo.split(" ").join("-"),seo=seo.replace(/_/g,"-"),seo+=$scope.rentC?"-rental":$scope.buyC?"-sale":$scope.newC?"-new":"",seo=seo.replace(/--/g,"-").replace(/ & /g,"and").replace(/&/g," and ").toLowerCase(),hyphen?seo.replace(/-/g,hyphen):seo},$scope.filterSeo2=function(seo,type,hyphen){return seo=seo.split(" ").join("-"),seo=seo.replace(/_/g,"-"),seo+=$scope.rentC?"-rental":$scope.buyC?"-for-sale":$scope.newC?"-new":"",seo=seo.replace(/--/g,"-").replace(/ & /g,"and").replace(/&/g," and ").toLowerCase(),hyphen?seo.replace(/-/g,hyphen):seo},$scope.chatpopup=function(){},$scope.playVideo=function(_video){$uibModal.open({templateUrl:"video.popup.html",controller:"videoCtrl",size:"vg",resolve:{video:function(){return _video}}})},$scope.getCategoriesCount=function(searchCatId){var temp1=$filter("filter")(itcategorieslists2016,{id:searchCatId},!0);return"rent"===$location.search().type?temp1&&temp1.length>0&&temp1[0].rentCount?temp1[0].rentCount:0:"new"===$location.search().type?temp1&&temp1.length>0&&temp1[0].newCount?temp1[0].newCount:0:temp1&&temp1.length>0&&temp1[0].buyCount?temp1[0].buyCount:0},coreWS.getcategory({seoname:null},function(res){200===res.status.statusCode&&($scope.category=res.data)},_errorHandler),$scope.contextPathimageurl=contextPathimageurl,coreWS.coomingSoon({},function(res){200===res.status.statusCode&&($scope.coomingSoonItems=res.data)},_errorHandler),$scope.getNumber=function(num){return new Array(num)},$scope.getCSItems=function(x){var y=6*(x+1)>$scope.coomingSoonItems.length?$scope.coomingSoonItems.length:6*(x+1);return $scope.coomingSoonItems.slice(6*x,y)},$scope.onSelect=function(type){"rent"===type?($scope.type="rent",$scope.showRent=!0,$scope.showBuy=!1,$scope.showNew=!1,$scope.showRentbtn="active",$scope.showBuybtn=""):"new"===type?($scope.type="new",$scope.showRent=!1,$scope.showBuy=!1,$scope.showNew=!0,$scope.showRentbtn="",$scope.showBuybtn=""):($scope.type="buy",$scope.showRent=!1,$scope.showBuy=!0,$scope.showNew=!1,$scope.showRentbtn="",$scope.showBuybtn="active")},$scope.onSelect("buy"),$rootScope.$on("$locationChangeSuccess",function(){$scope.onSelect($location.search().type),$scope.hiwhomepage($location.search().type),$scope.titleFun()}),$scope.all=!0,$scope.rotateImg="",$scope.link="",$scope.allCategory=function(click){$scope.all=!$scope.all,$scope.all?($scope.rotateImg="",$scope.link="#buyRentSection"):($scope.rotateImg="rotateImg",$scope.link="#innerSection")},$scope.hiwhomepage=function(value){$scope.type=value,value=value?value:$location.search().type?$location.search().type:"buy","buy"===value?($scope.buyC="hwitemactive",$scope.rentC="",$scope.newC=""):"rent"===value?($scope.rentC="hwitemactive",$scope.buyC="",$scope.newC=""):"new"===value?($scope.newC="hwitemactive",$scope.buyC="",$scope.rentC=""):($scope.rentC="",$scope.buyC="hwitemactive")},$scope.hiwhomepage(),$scope.hiwCarousel=function(value){$scope.heading=value,"buy"===value?$scope.slides=[{image:contextPathimageurl+"img/direct-buy_line-art.png"}]:"rent"===value?$scope.slides=[{image:contextPathimageurl+"img/direct-rent_line-art.png"}]:"finance"===value?$scope.slides=[{image:contextPathimageurl+"img/finance line art1.png"},{image:contextPathimageurl+"img/finance line art2.png"}]:"sAuction"===value?$scope.slides=[{image:contextPathimageurl+"img/Straight-auction_1.png"},{image:contextPathimageurl+"img/Straight-auction_2.png"}]:"rARent"===value?$scope.slides=[{image:contextPathimageurl+"img/Reverse-auction-rent_1.png"},{image:contextPathimageurl+"img/Reverse-auction-rent_2.png"}]:"rABuy"===value?$scope.slides=[{image:contextPathimageurl+"img/Reverse-auction-buy_1.png"},{image:contextPathimageurl+"img/Reverse-auction-buy_2.png"}]:($scope.heading="buy",$scope.slides=[{image:contextPathimageurl+"img/direct-buy_line-art.png"}])},$scope.hiwCarousel(),$scope.myInterval=5e3,$scope.noWrapSlides=!1,$scope.active=0;var slides=$scope.slides,currIndex=0;$scope.addSlide=function(){var newWidth=600+slides.length+1;slides.push({image:"$scope.slides"+newWidth+"/300",text:[""][slides.length%2]+" "+[""][slides.length%2],id:currIndex++})},$scope.noWrapSlides=!1;var slideshiw=$scope.slideshiw;$scope.addSlideHIW=function(){var newWidth=600+slideshiw.length+1;slideshiw.push({image:"$scope.slideshiw"+newWidth+"/300",text:[""][slideshiw.length%2]+" "+[""][slideshiw.length%2]})},$scope.banner=[{images:contextPathimageurl+"img/banner1.png"},{images:contextPathimageurl+"img/banner2.png"}],(new WOW).init();var direction="down",expanded=!1,preSrollVale=0;$(window).scroll(function(){direction=$(window).scrollTop()>preSrollVale?"down":"up",preSrollVale=$(window).scrollTop(),"down"===direction&&expanded===!1&&($(".scroll-down-visible").css("display","inline-block"),$(".top-login"),expanded=!0),"up"===direction&&33>=preSrollVale&&expanded===!0&&($(".scroll-down-visible").css("display","none"),expanded=!1)})}]),angular.module("core").controller("videoCtrl",["$scope","$state","$stateParams","contextPathimageurl","$modalInstance","video","$sce",function($scope,$state,$stateParams,contextPathimageurl,$modalInstance,video,$sce){$scope.height=angular.element(window).height(),$scope.videoUrl="","promo"===video?$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/ZiifQf6VWKA?autoplay=1&loop=1&rel=0&controls=0&modestbranding=1&showinfo=0&fs=0"):"rent"===video||"rARent"===video?$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/FMqa17ol7EE?autoplay=1&loop=1&rel=0&controls=0&modestbranding=1&showinfo=0&fs=0"):"buy"===video||"rABuy"===video?$scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/Iq3Hni6cV5Y?autoplay=1&loop=1&rel=0&controls=0&modestbranding=1&showinfo=0&fs=0"):"sAuction"===video&&($scope.videoUrl=$sce.trustAsResourceUrl("https://www.youtube.com/embed/SSXgnnEdFSc?autoplay=1&loop=1&rel=0&controls=0&modestbranding=1&showinfo=0&fs=0")),$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("core").controller("SearchController",["$scope","coreWS","coreLS","$location","$rootScope","filterFilter","Notification","contextPathimageurl","$q","$state","AuthenticationService","serverType","$stateParams",function($scope,coreWS,coreLS,$location,$rootScope,filterFilter,Notification,contextPathimageurl,$q,$state,AuthenticationService,serverType,$stateParams){function compare(a,b){return a.group<b.group?-1:a.group>b.group?1:0}var urlArray=$location.search();JSON.parse(JSON.stringify(urlArray));$scope.fenvType="live"!==serverType,$scope.contextPathimageurl=contextPathimageurl,$scope.storeSearchValue="",$scope.activeImg="buy",$scope.duration={startDate:"undefined"==typeof urlArray["duration-start"]?"":urlArray["duration-start"],endDate:"undefined"==typeof urlArray["duration-end"]?"":urlArray["duration-end"]},$scope.isHidenSearch=!1;var _disableState=["home","search.thankyouSA","logo.payment.paymentauction","search.thankyou","logo.payment","logo.payment.paymentbid","logo.payment.paymentsolo","logo.payment.paymentnonsolo","logo.payment.listingFeePayment","logo.payment.paymentFinance"];$scope.isSearchBox=function(){return _disableState.indexOf($state.current.name)>-1?($scope.isHidenSearch=!1,$scope.isHidenSearch):($scope.isHidenSearch=!0,$scope.isHidenSearch)},$scope.auctionLinkup=function(date){var newDate=moment(date).format("DD-MM-YYYY");$state.go("search.equipment4",{sa:!0,sadate:newDate,type:"buy"},{reload:!0})},$rootScope.$on("$locationChangeSuccess",function(){$scope.type="undefined"==typeof $location.search().type?"buy":$location.search().type,$scope.isSearchBox(),$scope.searchName()}),$scope.myFormat=[],$scope.yourchoice="",$scope.searchlist=[];var slist=[];$scope.getVal=function(searchValueText){return"undefined"==typeof searchValueText||searchValueText.length<1?!1:($scope.storeSearchValue=searchValueText,$scope.myFormat=[],$scope.searchlist=[],searchValueText.length>1?void coreWS.suggestionSearch({q:searchValueText,type:$scope.type},function(res){if(200===res.status.statusCode)try{slist=[];var manageDup=[],dupSearch=[],dupSeeAllCat=[],counter=0;0===res.data.length&&($scope.searchlist=[]),angular.forEach(res.data,function(newData,idx){for(var value=newData,ancestors="undefined"==typeof newData.ancestors?[]:newData.ancestors,strAncestors="in",strAncestorsWithCat="",strCatWithEquipName=value.equipment_name,strImage=value.equipment_img,k=0;k<ancestors.length;k++)"in"===strAncestors?strAncestors=" "+ancestors[k].name:strAncestors+=" > "+ancestors[k].name;ancestors.length<1&&(strAncestors=""),$scope.myFormat.push(value.equipment_name);var isCatName=""!==value.category_name.trim();strAncestorsWithCat=isCatName?" $$ "+value.category_name.trim()+" ## ":"";var strMakeWithEquipName=value.make.trim()+" "+strCatWithEquipName;isCatName&&(strCatWithEquipName=value.category_name.trim()+" "+strCatWithEquipName),strImage=""!==strImage?contextPathimageurl+strImage:contextPathimageurl+"files/equipments/no_image_small.png",value.make=value.make.trim(),0===counter?(counter++,"cat"===value.type&&(dupSeeAllCat.push(value.category_id),slist.push({cid:value.category_id,seo:value.category_seo_name,img:"na",cname:value.category_name,name:" ~~ "+strAncestorsWithCat,group:"0seeAll",firstInGroup:!0})),dupSearch.push(value.make),slist.push({img:"na",cname:value.make,name:value.make+" @@ ",group:"1Search",firstInGroup:!0}),manageDup.push(value.make+strAncestorsWithCat),slist.push({cid:value.category_id,seo:value.category_seo_name,img:"na",make:value.make,name:value.make+strAncestorsWithCat,group:"2Brand",firstInGroup:!0,header:"Brand"}),slist.push({eid:value.equipment_id,name:strMakeWithEquipName,img:strImage,group:"3Equipment",firstInGroup:!0,header:"Equipment"})):(-1===dupSeeAllCat.indexOf(value.category_id)&&"cat"===value.type&&(dupSeeAllCat.push(value.category_id),slist.push({cid:value.category_id,seo:value.category_seo_name,img:"na",cname:value.category_name,name:" ~~ "+strAncestorsWithCat,group:"0seeAll",firstInGroup:!1})),-1===dupSearch.indexOf(value.make)&&(dupSearch.push(value.make),slist.push({img:"na",cname:value.make,name:value.make+" @@",group:"1Search",firstInGroup:!1})),-1===manageDup.indexOf(value.make+strAncestorsWithCat)&&(manageDup.push(value.make+strAncestorsWithCat),slist.push({cid:value.category_id,seo:value.category_seo_name,img:"na",make:value.make,name:value.make+strAncestorsWithCat,group:"2Brand",firstInGroup:!1})),slist.push({eid:value.equipment_id,make:value.make,name:strMakeWithEquipName,img:strImage,group:"3Equipment",firstInGroup:!1})),idx===res.data.length-1&&(counter=0)}),slist.sort(compare),$scope.searchlist=slist}catch(e){console.error("Error 10013	"+e)}else slist=[],$scope.searchlist=slist},_errorHandler):(console.info("More than 1 character"),!1))},$scope.searchName=function(){"undefined"!=typeof $location.search().q&&""!==$location.search().q?$scope.searchItems=$location.search().q:$scope.searchItems=""},$scope.searchName(),$scope.categorylists=[],$scope.childlist=[],$scope.childlist1=[],$scope.childlist2=[];var _errorHandler=function(e){};$scope.dateFrom={minDate:1,dateFormat:"dd/mm/yy"},$scope.dateTo={minDate:2,dateFormat:"dd/mm/yy"},$scope.updateToDate=function(date){var _newMin=new Date(date);_newMin.setDate(_newMin.getDate()+2),$scope.dateTo.minDate=_newMin};var disableState=["search.thankyouSA","logo.payment.paymentauction"],checkUrl=function(){return-1===disableState.indexOf($state.current.name)};$scope.type=$location.search().type,$scope.selectType=function(type){var tempType="-sale";checkUrl()&&($stateParams.eqmtName?($scope.type=type,tempType="new"===type?"-new":"buy"===type?"-for-sale":"rent"===type?"-rental":"-for-sale",$stateParams.eqmtName=$stateParams.eqmtName.replace("-new","").replace("-for-sale","").replace("-rental","")+tempType,$state.go($state.current,{eqmtName:$stateParams.eqmtName,type:$scope.type},{reloadOnSearch:!1})):$stateParams.seoname&&($scope.type=type,tempType="new"===type?"-new":"buy"===type?"-sale":"rent"===type?"-rental":"-sale",$stateParams.seoname=$stateParams.seoname.replace("-new","").replace("-sale","").replace("-rental","")+tempType,$state.go($state.current,{seoname:$stateParams.seoname,type:$scope.type},{reloadOnSearch:!1})))},"undefined"!=typeof $scope.type?$scope.selectType($scope.type):$scope.selectType("buy"),$scope.sellAuction=function(){AuthenticationService.login(function(){$state.go("search.dash.auctionEquipList",{tabName:"create"},{reload:!0})})},$scope.urlType=function(type){checkUrl()&&($scope.activeImg=type,"rent"===type?(urlArray.type="rent",urlArray.categoryId=$location.search().categoryId,urlArray.layout=$location.search().layout,$location.search(urlArray)):"new"===type?(urlArray.type="new",urlArray.categoryId=$location.search().categoryId,urlArray.layout=$location.search().layout,$location.search(urlArray)):(urlArray.type="buy",urlArray.categoryId=$location.search().categoryId,urlArray.layout=$location.search().layout,$location.search(urlArray)))},$scope.addr={city:"",state:""},$scope.latlong="",$scope.autoCompleteOptions={types:"(cities)",country:"in",place_changed:function(data){var _location=data.geometry.location;$scope.latlong=_location.lat()+"~"+_location.lng(),angular.forEach(data.address_components,function(item){"locality"===item.types[0]&&($scope.addr.city=item.long_name),"administrative_area_level_1"===item.types[0]&&($scope.addr.state=item.long_name)})}},$scope.globalVal="",$scope.$on("eventName",function(event,args){$scope.globalVal=args.message}),$scope.clickMe=function(){var suggestion=$scope.globalVal,durationStart="",durationEnd="";$scope.type=$scope.type?$scope.type:"buy","rent"===$scope.type&&""!==$scope.duration.startDate&&""!==$scope.duration.endDate&&(durationStart=moment($scope.duration.startDate).format("DD/MM/YYYY"),durationEnd=moment($scope.duration.endDate).format("DD/MM/YYYY"));var _location="";if("rent"===$scope.type&&$scope.addr.city&&(_location=$scope.addr.city+"~"+$scope.addr.state),_location="~"===_location.trim()?"":_location.trim(),"2Brand"===suggestion.group&&($scope.searchParam=suggestion.make,$scope.searchFilter=suggestion.make,$state.go("search.equipment3",{categoryId:suggestion.cid,catname:suggestion.seo,q:suggestion.make,type:$scope.type,location:_location,latlong:$scope.latlong,"duration-start":durationStart,"duration-end":durationEnd},{reload:!0})),"0seeAll"===suggestion.group)$scope.searchParam="",$scope.searchFilter="",$state.go("search.equipment3",{categoryId:suggestion.cid,catname:suggestion.seo,type:$scope.type,location:_location,latlong:$scope.latlong,"duration-start":durationStart,"duration-end":durationEnd},{reload:!0});else if("1Search"===suggestion.group)$scope.searchParam=suggestion.cname,$scope.searchFilter=suggestion.cname,$state.go("search.equipment3",{categoryId:suggestion.cid,catname:suggestion.seo,q:suggestion.cname,type:$scope.type,location:_location,latlong:$scope.latlong,"duration-start":durationStart,"duration-end":durationEnd},{reload:!0});else{var url="";"buy"===($scope.type+"").toLowerCase()?(url="/search/?type="+$scope.type+"&q="+$scope.storeSearchValue,window.location.href=url):""!==durationStart&&""!==durationEnd?$state.go("search.equipment3",{categoryId:"",catname:"",q:$scope.storeSearchValue,type:$scope.type,location:_location,latlong:$scope.latlong,"duration-start":durationStart,"duration-end":durationEnd},{reload:!0}):(url="/search/?type="+$scope.type+"&q="+$scope.storeSearchValue,window.location.href=url)}},$scope.categorylists=itcategorieslists2016,$scope.onMouseEnter=function(id){$scope.childlist=[],angular.forEach($scope.categorylists,function(items){id===items.parentId&&$scope.childlist.push(items)})},$scope.onMouseEnter1=function(id){$scope.childlist1=[],angular.forEach($scope.categorylists,function(items){id===items.parentId&&$scope.childlist1.push(items)})},$scope.onMouseEnter2=function(id){$scope.childlist2=[],angular.forEach($scope.categorylists,function(items){id===items.parentId&&$scope.childlist2.push(items)})},$scope.filterSeo=function(seo,type){return seo=seo.split(" ").join("-"),seo=seo.replace(/_/g,"-"),seo+="rent"===type?"-rental":"buy"===type?"-sale":"new"===type?"-new":"-sale",seo.replace(/--/g,"-").replace(/ & /g,"and").replace(/&/g," and ").toLowerCase()}}]),angular.module("core").controller("pdftestingController",["$scope","$state","$stateParams","coreWS","contextPathimageurl","title",function($scope,$state,$stateParams,coreWS,contextPathimageurl,title){$scope.upload=null,$scope.submit=function(files){}}]),angular.module("core").controller("global",["$scope","$sce",function($scope,$sce){$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)}}]),angular.module("core").directive("compareTo",function(){return{scope:{targetModel:"=compareTo"},require:"ngModel",link:function(scope,element,attrs,ctrl){var compare=function(){var e1=element.val(),e2=scope.targetModel;return null!==e2?e1===e2:!1};scope.$watch(compare,function(newValue){ctrl.$setValidity("errorCompareTo",newValue)})}}}).directive("numbersOnly",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(inputValue){if(void 0===inputValue)return"";var transformedInput=inputValue.replace(/[^0-9]/g,"");return transformedInput!==inputValue&&(modelCtrl.$setViewValue(transformedInput),modelCtrl.$render()),transformedInput})}}}).directive("validNumber",function(){return{require:"?ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl&&(ngModelCtrl.$parsers.push(function(val){angular.isUndefined(val)&&(val="");var clean=val.replace(/[^0-9\.]/g,""),negativeCheck=clean.split("-"),decimalCheck=clean.split(".");return decimalCheck[0]<100?(angular.isUndefined(negativeCheck[1])||(negativeCheck[1]=negativeCheck[1].slice(0,negativeCheck[1].length),clean=negativeCheck[0]+"-"+negativeCheck[1],negativeCheck[0].length>0&&(clean=negativeCheck[0])),angular.isUndefined(decimalCheck[1])||(decimalCheck[1]=decimalCheck[1].slice(0,2),clean=decimalCheck[0]+"."+decimalCheck[1]),val!==clean&&(ngModelCtrl.$setViewValue(clean),ngModelCtrl.$render()),clean):(decimalCheck[0]=decimalCheck[0].slice(0,2),clean=decimalCheck[0],val!==clean&&(ngModelCtrl.$setViewValue(clean),ngModelCtrl.$render()),clean)}),element.bind("keypress",function(event){32===event.keyCode&&event.preventDefault()}))}}}).directive("validNumberDot",function(){return{require:"?ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl&&(ngModelCtrl.$parsers.push(function(val){angular.isUndefined(val)&&(val="");var clean=val.replace(/[^0-9\.]/g,""),negativeCheck=clean.split("-"),decimalCheck=clean.split(".");return decimalCheck[0]<1e7?(angular.isUndefined(negativeCheck[1])||(negativeCheck[1]=negativeCheck[1].slice(0,negativeCheck[1].length),clean=negativeCheck[0]+"-"+negativeCheck[1],negativeCheck[0].length>0&&(clean=negativeCheck[0])),angular.isUndefined(decimalCheck[1])||(decimalCheck[1]=decimalCheck[1].slice(0,2),clean=decimalCheck[0]+"."+decimalCheck[1]),
val!==clean&&(ngModelCtrl.$setViewValue(clean),ngModelCtrl.$render()),clean):(decimalCheck[0]=decimalCheck[0].slice(0,2),clean=decimalCheck[0],val!==clean&&(ngModelCtrl.$setViewValue(clean),ngModelCtrl.$render()),clean)}),element.bind("keypress",function(event){32===event.keyCode&&event.preventDefault()}))}}}).directive("file",function(){return{restrict:"E",template:'<input type="file" />',replace:!0,require:"ngModel",link:function(scope,element,attr,ctrl){var listener=function(){scope.$apply(function(){attr.multiple?ctrl.$setViewValue(element[0].files):ctrl.$setViewValue(element[0].files[0])})};element.bind("change",listener)}}}).directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]).directive("dateOnly",function(){function link(scope,element,attrs,ngModel){function validator(modelValue,viewValue){var value=modelValue||viewValue,date=new Date,year=date.getFullYear(),regex=/^[0-9]{4}$/;return regex.test(value)&&value>year&&year+10>value?!0:!1}ngModel.$validators.academicyearvalidation=validator}return{restrict:"A",require:"ngModel",link:link}}).directive("pagination",["$templateCache","$rootScope","$location",function($templateCache,$rootScope,$location){function link(scope,element,attrs){function search_to_hash(){var h={};if(void 0===window.location.search||window.location.search.length<1)return h;for(var q=window.location.search.slice(1).split("&"),i=0;i<q.length;i++){var key_val=q[i].split("="),hkey=decodeURIComponent(key_val[0]).replace(/\+/g," "),hval=decodeURIComponent(key_val[1]).replace(/\+/g," ");void 0===h[hkey]&&(h[hkey]=[]),h[hkey].push(hval)}return h}function hash_to_search(h){var search="?";for(var k in h)for(var i=0;i<h[k].length;i++)search+="?"===search?"":"&",search+=encodeURIComponent(k)+"="+encodeURIComponent(h[k][i]);return search}function search_remove(name){var new_search_hash=search_to_hash();return delete new_search_hash[name],hash_to_search(new_search_hash)}$rootScope.createPagingLink=function(pageNumber){return 0===pageNumber&&(pageNumber=1),$location.path()+search_remove("page")+"&page="+pageNumber},$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a  ng-href="{{$root.createPagingLink(1)}}">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a ng-href="{{$root.createPagingLink(page - 1)}}">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}" ><a ng-href="{{$root.createPagingLink(page.number)}}">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a ng-href="{{$root.createPagingLink(page + 1)}}">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a ng-href="{{$root.createPagingLink(totalPages)}}">{{getText(\'last\')}}</a></li>\n</ul>')}return{restrict:"E",link:link}}]).directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function($filter,$document,$compile,$parse){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@"},template:function(element,attrs){var checkboxes=attrs.checkboxes?!0:!1,groups=attrs.groupBy?!0:!1,template='<div class="multiselect-parent btn-group dropdown-multiselect">';template+='<button type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}&nbsp;<span class="caret"></span></button>',template+="<ul class=\"dropdown-menu dropdown-menu-form\" ng-style=\"{display: open ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto' }\" style=\"overflow: scroll\" >",template+='<li ng-hide="!settings.showCheckAll || settings.selectionLimit > 0"><a data-ng-click="selectAll()"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>',template+='<li ng-show="settings.showUncheckAll"><a data-ng-click="deselectAll();"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>',template+='<li ng-hide="(!settings.showCheckAll || settings.selectionLimit > 0) && !settings.showUncheckAll" class="divider"></li>',template+='<li ng-show="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control" style="width: 100%;" ng-model="searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>',template+='<li ng-show="settings.enableSearch" class="divider"></li>',groups?(template+='<li ng-repeat-start="option in orderedItems | filter: searchFilter" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupTitle(getPropertyForObject(option, settings.groupBy)) }}</li>',template+='<li ng-repeat-end role="presentation">'):template+='<li role="presentation" ng-repeat="option in options | filter: searchFilter">',template+='<a role="menuitem" tabindex="-1" ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))">',template+=checkboxes?'<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> {{getPropertyForObject(option, settings.displayProp)}}</label></div></a>':"<span data-ng-class=\"{'glyphicon glyphicon-ok': isChecked(getPropertyForObject(option,settings.idProp))}\"></span> {{getPropertyForObject(option, settings.displayProp)}}</a>",template+="</li>",template+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>',template+='<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',template+="</ul>",template+="</div>",element.html(template)},link:function($scope,$element,$attrs){function getFindObj(id){var findObj={};return""===$scope.settings.externalIdProp?findObj[$scope.settings.idProp]=id:findObj[$scope.settings.externalIdProp]=id,findObj}function clearObject(object){for(var prop in object)delete object[prop]}var $dropdownTrigger=$element.children()[0];$scope.toggleDropdown=function(){$scope.open=!$scope.open},$scope.checkboxClick=function($event,id){$scope.setSelectedItem(id),$event.stopImmediatePropagation()},$scope.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop},$scope.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"key",idProp:"doc_count",externalIdProp:"doc_count",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:$attrs.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop},$scope.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked"},angular.isDefined($scope.settings.groupBy)&&$scope.$watch("options",function(newValue){angular.isDefined(newValue)&&($scope.orderedItems=$filter("orderBy")(newValue,$scope.settings.groupBy))}),angular.extend($scope.settings,$scope.extraSettings||[]),angular.extend($scope.externalEvents,$scope.events||[]),angular.extend($scope.texts,$scope.translationTexts),$scope.singleSelection=1===$scope.settings.selectionLimit,$scope.singleSelection&&angular.isArray($scope.selectedModel)&&0===$scope.selectedModel.length&&clearObject($scope.selectedModel),$scope.settings.closeOnBlur&&$document.on("click",function(e){for(var target=e.target.parentElement,parentFound=!1;angular.isDefined(target)&&null!==target&&!parentFound;)_.contains(target.className.split(" "),"multiselect-parent")&&!parentFound&&target===$dropdownTrigger&&(parentFound=!0),target=target.parentElement;parentFound||$scope.$apply(function(){$scope.open=!1})}),$scope.getGroupTitle=function(groupValue){return null!==$scope.settings.groupByTextProvider?$scope.settings.groupByTextProvider(groupValue):groupValue},$scope.getButtonText=function(){if($scope.settings.dynamicTitle&&($scope.selectedModel.length>0||angular.isObject($scope.selectedModel)&&_.keys($scope.selectedModel).length>0)){if($scope.settings.smartButtonMaxItems>0){var itemsText=[];return angular.forEach($scope.options,function(optionItem){if($scope.isChecked($scope.getPropertyForObject(optionItem,$scope.settings.idProp))){var displayText=$scope.getPropertyForObject(optionItem,$scope.settings.displayProp),converterResponse=$scope.settings.smartButtonTextConverter(displayText,optionItem);itemsText.push(converterResponse?converterResponse:displayText)}}),$scope.selectedModel.length>$scope.settings.smartButtonMaxItems&&(itemsText=itemsText.slice(0,$scope.settings.smartButtonMaxItems),itemsText.push("...")),itemsText.join(", ")}var totalSelected;return totalSelected=$scope.singleSelection?null!==$scope.selectedModel&&angular.isDefined($scope.selectedModel[$scope.settings.idProp])?1:0:angular.isDefined($scope.selectedModel)?$scope.selectedModel.length:0,0===totalSelected?$scope.texts.buttonDefaultText:totalSelected+" "+$scope.texts.dynamicButtonTextSuffix}return $scope.texts.buttonDefaultText},$scope.getPropertyForObject=function(object,property){return angular.isDefined(object)&&object.hasOwnProperty(property)?object[property]:""},$scope.selectAll=function(){$scope.deselectAll(!1),$scope.externalEvents.onSelectAll(),angular.forEach($scope.options,function(value){$scope.setSelectedItem(value[$scope.settings.idProp],!0)})},$scope.deselectAll=function(sendEvent){sendEvent=sendEvent||!0,sendEvent&&$scope.externalEvents.onDeselectAll(),$scope.singleSelection?clearObject($scope.selectedModel):$scope.selectedModel.splice(0,$scope.selectedModel.length)},$scope.setSelectedItem=function(id,dontRemove){var findObj=getFindObj(id),finalObj=null;if(finalObj=""===$scope.settings.externalIdProp?_.find($scope.options,findObj):findObj,$scope.singleSelection)return clearObject($scope.selectedModel),angular.extend($scope.selectedModel,finalObj),$scope.externalEvents.onItemSelect(finalObj),void($scope.settings.closeOnSelect&&($scope.open=!1));dontRemove=dontRemove||!1;var exists=-1!==_.findIndex($scope.selectedModel,findObj);!dontRemove&&exists?($scope.selectedModel.splice(_.findIndex($scope.selectedModel,findObj),1),$scope.externalEvents.onItemDeselect(findObj)):!exists&&(0===$scope.settings.selectionLimit||$scope.selectedModel.length<$scope.settings.selectionLimit)&&($scope.selectedModel.push(finalObj),$scope.externalEvents.onItemSelect(finalObj)),$scope.settings.closeOnSelect&&($scope.open=!1)},$scope.isChecked=function(id){return $scope.singleSelection?null!==$scope.selectedModel&&angular.isDefined($scope.selectedModel[$scope.settings.idProp])&&$scope.selectedModel[$scope.settings.idProp]===getFindObj(id)[$scope.settings.idProp]:-1!==_.findIndex($scope.selectedModel,getFindObj(id))},$scope.externalEvents.onInitDone()}}}]).directive("bnLazySrc",["$window","$document",function($window,$document){function LazyImage(element){function isVisible(topFoldOffset,bottomFoldOffset){if(!element.is(":visible"))return!1;null===height&&(height=element.height());var top=element.offset().top,bottom=top+height;return bottomFoldOffset>=top&&top>=topFoldOffset||bottomFoldOffset>=bottom&&bottom>=topFoldOffset||topFoldOffset>=top&&bottom>=bottomFoldOffset}function render(){isRendered=!0,renderSource()}function setSource(newSource){source=newSource,isRendered&&renderSource()}function renderSource(){element[0].src=source}var source=null,isRendered=!1,height=null;return{isVisible:isVisible,render:render,setSource:setSource}}function link($scope,element,attributes){var lazyImage=new LazyImage(element);lazyLoader.addImage(lazyImage),attributes.$observe("bnLazySrc",function(newSource){lazyImage.setSource(newSource)}),$scope.$on("$destroy",function(){lazyLoader.removeImage(lazyImage)})}var lazyLoader=function(){function addImage(image){images.push(image),renderTimer||startRenderTimer(),isWatchingWindow||startWatchingWindow()}function removeImage(image){for(var i=0;i<images.length;i++)if(images[i]===image){images.splice(i,1);break}images.length||(clearRenderTimer(),stopWatchingWindow())}function checkDocumentHeight(){if(!renderTimer){var currentDocumentHeight=doc.height();currentDocumentHeight!==documentHeight&&(documentHeight=currentDocumentHeight,startRenderTimer())}}function checkImages(){console.error("Checking for visible images...");for(var visible=[],hidden=[],windowHeight=win.height(),scrollTop=win.scrollTop(),topFoldOffset=scrollTop,bottomFoldOffset=topFoldOffset+windowHeight,i=0;i<images.length;i++){var image=images[i];image.isVisible(topFoldOffset,bottomFoldOffset)?visible.push(image):hidden.push(image)}for(var k=0;k<visible.length;k++)visible[k].render();images=hidden,clearRenderTimer(),images.length||stopWatchingWindow()}function clearRenderTimer(){clearTimeout(renderTimer),renderTimer=null}function startRenderTimer(){renderTimer=setTimeout(checkImages,renderDelay)}function startWatchingWindow(){isWatchingWindow=!0,win.on("resize.bnLazySrc",windowChanged),win.on("scroll.bnLazySrc",windowChanged),documentTimer=setInterval(checkDocumentHeight,documentDelay)}function stopWatchingWindow(){isWatchingWindow=!1,win.off("resize.bnLazySrc"),win.off("scroll.bnLazySrc"),clearInterval(documentTimer)}function windowChanged(){renderTimer||startRenderTimer()}var images=[],renderTimer=null,renderDelay=100,win=angular.element(window),doc=$document,documentHeight=doc.height(),documentTimer=null,documentDelay=2e3,isWatchingWindow=!1;return{addImage:addImage,removeImage:removeImage}}();return{link:link,restrict:"A"}}]).directive("autocomplete",function(){var index=-1;return{restrict:"E",scope:{searchParam:"=ngModel",suggestions:"=data",onType:"=onType",onSelect:"=onSelect",autocompleteRequired:"="},controller:["$scope","$state","$location",function($scope,$state,$location){$scope.selectedIndex=-1,$scope.suggestionviaEnter={},$scope.globalVal={},$scope.initLock=!0,$scope.setIndex=function(i){$scope.selectedIndex=parseInt(i)},this.setIndex=function(i){$scope.setIndex(i),$scope.$apply()},$scope.getIndex=function(i){return $scope.selectedIndex};var watching=!0;$scope.completing=!1,$scope.$watch("searchParam",function(newValue,oldValue){oldValue===newValue||!oldValue&&$scope.initLock||(watching&&"undefined"!=typeof $scope.searchParam&&null!==$scope.searchParam&&($scope.completing=!0,$scope.searchFilter=$scope.searchParam,$scope.selectedIndex=-1),$scope.onType&&$scope.onType($scope.searchParam))}),this.preSelect=function(suggestion){watching=!1,$scope.suggestionviaEnter=suggestion,$scope.$apply(),watching=!0},$scope.preSelect=this.preSelect,$scope.type="buy",this.preSelectOff=function(){watching=!0},$scope.preSelectOff=this.preSelectOff,$scope.select=function(suggestion){$scope.type="buy",$scope.type="undefined"==typeof $location.search().type?"buy":$location.search().type;var isHomeAndRent="/"===$location.path();if("undefined"==typeof suggestion&&""===$scope.suggestionviaEnter||("undefined"==typeof $scope.searchParam||""===suggestion)&&!isHomeAndRent)return void(watching=!1);"undefined"==typeof suggestion&&""!==suggestion?suggestion=JSON.parse($scope.suggestionviaEnter):"undefined"==typeof suggestion.group&&""!==suggestion&&(suggestion=JSON.parse(suggestion)),$scope.suggestionviaEnter="",suggestion&&$scope.$emit("eventName",{message:suggestion});try{if(!isHomeAndRent)return"3Equipment"===suggestion.group?($scope.searchParam="",$scope.searchFilter="",$state.go("search.eqmtdetail2",{eqmtName:suggestion.name,equipmentId:suggestion.eid,type:$scope.type},{reload:!0})):"2Brand"===suggestion.group?($scope.searchParam=suggestion.make,$scope.onSelect(suggestion.make)):"0seeAll"===suggestion.group?($scope.searchParam="",$scope.searchFilter="",$state.go("search.equipment3",{categoryId:suggestion.cid,catname:suggestion.seo,type:$scope.type},{reload:!0})):($scope.searchParam=suggestion.cname,$scope.searchFilter=suggestion.cname,$state.go("search.equipment3",{q:suggestion.cname,type:$scope.type},{reload:!0})),watching=!1,void($scope.completing=!1)}catch(e){return watching=!1,void($scope.completing=!1)}suggestion&&isHomeAndRent&&("3Equipment"===suggestion.group?($scope.searchParam="",$scope.searchFilter="",$state.go("search.eqmtdetail2",{eqmtName:suggestion.name,equipmentId:suggestion.eid,type:$scope.type},{reload:!0})):"0seeAll"===suggestion.group?($scope.searchParam="",$scope.searchFilter="",$state.go("search.equipment3",{categoryId:suggestion.cid,catname:suggestion.seo,type:$scope.type},{reload:!0})):"2Brand"===suggestion.group?($scope.searchParam=suggestion.make,$scope.searchFilter=suggestion.make,$state.go("search.equipment2",{categoryId:suggestion.cid,catname:suggestion.seo,q:suggestion.make,type:$scope.type},{reload:!0})):($scope.searchParam=suggestion.cname,$scope.searchFilter=suggestion.cname,$state.go("search.equipment3",{q:suggestion.cname,type:$scope.type},{reload:!0}))),watching=!1,$scope.completing=!1,setTimeout(function(){watching=!0},1e3),$scope.setIndex(-1)}}],link:function(scope,element,attrs){setTimeout(function(){scope.initLock=!1,scope.$apply()},250);var attr="";scope.attrs={placeholder:"Search equipment here ...","class":"",id:"",inputclass:"",inputid:"itsearch"};for(var a in attrs)attr=a.replace("attr","").toLowerCase(),0===a.indexOf("attr")&&(scope.attrs[attr]=attrs[a]);attrs.clickActivation&&(element[0].onclick=function(e){scope.searchParam||setTimeout(function(){scope.completing=!0,scope.$apply()},200)});var key={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9};document.addEventListener("keydown",function(e){"none"===$(document).find(".autosug").css("display")&&$(document).find(".autosug").show();var keycode=e.keyCode||e.which;switch(scope.completing===!1&&"itsearch"===e.target.id&&(scope.completing=!0),keycode){case key.esc:scope.select(""),scope.setIndex(-1),scope.$apply(),e.preventDefault()}},!0),document.addEventListener("click",function(e){"none"!==$(document).find(".autosug").css("display")&&$(document).find(".autosug").hide()},!0),document.addEventListener("blur",function(e){setTimeout(function(){scope.select(""),scope.setIndex(-1),scope.$apply()},150)},!0),element[0].addEventListener("keydown",function(e){var keycode=e.keyCode||e.which,l=angular.element(this).find("li").length;if(scope.completing&&0!==l)switch(keycode){case key.up:if(index=scope.getIndex()-1,-1>index)index=l-1;else if(index>=l){index=-1,scope.setIndex(index),scope.preSelectOff();break}scope.setIndex(index),-1!==index&&scope.preSelect(angular.element(angular.element(this).find("li")[index]).attr("data")),scope.$apply();break;case key.down:if(index=scope.getIndex()+1,-1>index)index=l-1;else if(index>=l){index=-1,scope.setIndex(index),scope.preSelectOff(),scope.$apply();break}scope.setIndex(index),-1!==index&&scope.preSelect(angular.element(angular.element(this).find("li")[index]).attr("data"));break;case key.left:break;case key.right:case key.enter:case key.tab:index=scope.getIndex(),-1!==index?(scope.select(angular.element(angular.element(this).find("li")[index]).attr("data")),keycode===key.enter&&e.preventDefault()):keycode===key.enter&&scope.select(angular.element(angular.element(this).find("li")[index]).attr("data")),scope.setIndex(-1),scope.$apply();break;case key.esc:scope.select(),scope.setIndex(-1),scope.$apply(),e.preventDefault();break;default:return}})},template:'        <div ng-if="false">{{suggestions}}</div>        <div class=" autoSuggestion autocomplete {{ attrs.class }}" id="{{ attrs.id }}" >          <input            type="text"            ng-model="searchParam"            placeholder="{{ attrs.placeholder }}"            class="{{ attrs.inputclass }}"            id="{{ attrs.inputid }}"            ng-required="{{ autocompleteRequired }}" ng-model-options="{debounce: 500}" autocomplete="off"/>          <ul class="autosug" ng-show="completing && (suggestions | filter:searchParam).length > 0 && searchParam.length > 0">            <li              suggestion              ng-repeat="suggestion in suggestions | orderBy:suggestion.firstInGroup track by $index"              index="{{ $index }}"              ng-class="{ active: ($index === selectedIndex) }"              ng-click="select(suggestion)" data="{{suggestion}}" >                    <div class="suggestionHeader" ng-if="false"> <span>{{suggestion.header}} </span></div>                    <img ng-if="suggestion.img !== \'\' && suggestion.img !== \'na\'" ng-src="{{suggestion.img}}" style="width:50px"/>                    <span ng-bind-html="suggestion.name | highlight:searchParam"> {{suggestion.name}} </span>            </li>          </ul>        </div>'}}).directive("suggestion",function(){return{restrict:"A",require:"^autocomplete",link:function(scope,element,attrs,autoCtrl){element.bind("mouseenter",function(){autoCtrl.preSelect(attrs.val),autoCtrl.setIndex(attrs.index)}),element.bind("mouseleave",function(){autoCtrl.preSelectOff()})}}}).directive("onlyAlphabets",function(){return{require:"ngModel",link:function(scope,element,attr,ngModelCtrl){function fromUser(text){var transformedInput=text.replace(/[^0-9a-zA-Z\-\s]/g,"");return transformedInput!==text&&(ngModelCtrl.$setViewValue(transformedInput),ngModelCtrl.$render()),transformedInput}ngModelCtrl.$parsers.push(fromUser)}}}).directive("onlyAlphabet",function(){return{require:"ngModel",link:function(scope,element,attr,ngModelCtrl){function fromUser(text){var transformedInput=text.replace(/[^0-9a-zA-Z.\/\-\s]/g,"");return transformedInput!==text&&(ngModelCtrl.$setViewValue(transformedInput),ngModelCtrl.$render()),transformedInput}ngModelCtrl.$parsers.push(fromUser)}}}).directive("captcha",function(){function drawTextBG(c,txt,x,y){var ctx=c.getContext("2d"),font="20px Verdana";ctx.save(),ctx.font=font,ctx.textBaseline="top",ctx.fillStyle="#ffffff";var width=ctx.measureText(txt).width;ctx.fillRect(x,y,width,parseInt(font,10)),ctx.fillStyle="#000",ctx.fillText(txt,x,y),ctx.restore()}return{restrict:"AE",template:'<canvas class="itcaptcha" width="200" height="20"></canvas>',controller:["$scope","coreWS","ipCookie",function($scope,coreWS,ipCookie){$scope.captchaValue="",$scope.captchaNew=function(){coreWS.captcha({},function(res){if(200===res.status.statusCode){$scope.captchaValue=res.data.value,ipCookie("captcha",res.data.token);try{$scope.captchaValue=$scope.captchaValue.toString().split("").join(" ")}catch(e){console.error(e)}angular.forEach(document.querySelectorAll("canvas.itcaptcha"),function(v){drawTextBG(v,$scope.captchaValue,0,0)})}})},$scope.captchaNew(),$scope.$on("reCaptcha",function(event,data){$scope.captchaNew()})}]}}).directive("alphabets",function(){return{require:"ngModel",link:function(scope,element,attr,ngModelCtrl){function fromUser(text){var transformedInput=text.replace(/[^a-zA-Z\-\s]/g,"");return transformedInput!==text&&(ngModelCtrl.$setViewValue(transformedInput),ngModelCtrl.$render()),transformedInput}ngModelCtrl.$parsers.push(fromUser)}}}).directive("draggable",["$document",function($document){return function(scope,element,attr){function mousemove(event){y=event.screenY-startY,x=event.screenX-startX,element.css({top:y+"px",left:x+"px"})}function mouseup(){$document.off("mousemove",mousemove),$document.off("mouseup",mouseup)}var startX=0,startY=0,x=0,y=0;element.css({position:"relative",cursor:"pointer",display:"block",width:"50%"}),element.on("mousedown",function(event){event.preventDefault(),startX=event.screenX-x,startY=event.screenY-y,$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)})}}]).directive("capitalize",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){var capitalize=function(inputValue){inputValue="undefined"==typeof inputValue?"":inputValue;var capitalized="";return inputValue&&""!==inputValue&&(capitalized=inputValue.toUpperCase(),capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render())),capitalized};modelCtrl.$parsers.push(capitalize),capitalize(scope[attrs.ngModel])}}}).directive("ngElevateZoom",function(){return{restrict:"A",link:function(scope,element,attrs){element.attr("data-zoom-image",attrs.zoomImage),$(element).elevateZoom()}}}).directive("format",["$filter",function($filter){return{require:"?ngModel",link:function(scope,elem,attrs,ctrl){ctrl&&(ctrl.$formatters.unshift(function(a){return $filter(attrs.format)(ctrl.$modelValue)}),ctrl.$parsers.unshift(function(viewValue){var plainNumber=viewValue.replace(/[^\d|\-+|\.+]/g,"");return elem.val($filter(attrs.format)(plainNumber)),plainNumber}))}}}]).directive("schrollBottom",function(){return{scope:{schrollBottom:"="},link:function(scope,element){scope.$watchCollection("schrollBottom",function(newValue){if(newValue){var h=$(element)[0].scrollHeight;$(element).scrollTop(h)}})}}}).directive("eventFocus",["focus",function(focus){return function(scope,elem,attr){elem.on(attr.eventFocus,function(){focus(attr.eventFocusId)}),scope.$on("$destroy",function(){elem.off(attr.eventFocus)})}}]).directive("autoSubmitForm",["$interpolate","$timeout","$sce",function($interpolate,$timeout,$sce){return{restrict:"AEC",replace:!0,scope:{},template:'<form action="{{formData.url}}" method="{{formData.method}}" target="_blank" ng-hide="true"><input ng-repeat="(key,val) in formData.params" type="hidden" name="{{ key | lowercase}}" value="{{ val }}" /></form>',link:function($scope,element,$attr){$scope.$on($attr.fill,function(event,data){$scope.formData=data,$scope.formData.url=$sce.trustAsResourceUrl("live"===$scope.formData.server?"https://secure.payu.in/_payment":"https://test.payu.in/_payment")}),$scope.$on($attr.submit,function(event,data){$timeout(function(){element.submit()})})}}}]).directive("selectOnClick",["$window",function($window){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(){$window.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]).filter("highlight",["$sce",function($sce){return function(input,searchParam){if("function"==typeof input)return"";if(searchParam){var words="("+searchParam.split(/\ /).join(" |")+"|"+searchParam.split(/\ /).join("|")+")",exp=new RegExp(words,"gi");words.length&&(input=input.replace(exp,'<span class="highlight">$1</span>'))}return input=input.replace("@@"," <em>in</em> <strong>All Categories</strong>"),input=input.replace("$$",' <em>in</em> <span class="text-color-prime">'),input=input.replace("##"," </span>"),input=input.replace("~~","<strong>See All </strong> "),$sce.trustAsHtml(input)}}]),angular.module("core").directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(scope,element,attrs,controller){var opts,watchEnter=!1,initOpts=function(){opts={},scope.options&&(scope.options.country?(opts.componentRestrictions={country:scope.options.country},scope.gPlace.setComponentRestrictions(opts.componentRestrictions)):scope.gPlace.setComponentRestrictions(null))};void 0===scope.gPlace&&(scope.gPlace=new google.maps.places.Autocomplete(element[0],{})),google.maps.event.addListener(scope.gPlace,"place_changed",function(){var result=scope.gPlace.getPlace();void 0!==result&&(void 0!==result.address_components?scope.$apply(function(){scope.details=result,controller.$setViewValue(element.val()),scope.options.place_changed(result)}):watchEnter&&getPlace(result))});var getPlace=function(result){var autocompleteService=new google.maps.places.AutocompleteService;result.name.length>0&&autocompleteService.getPlacePredictions({input:result.name,offset:result.name.length},function(list,status){if(null===list||0===list.length)scope.$apply(function(){scope.details=null});else{var placesService=new google.maps.places.PlacesService(element[0]);placesService.getDetails({reference:list[0].reference},function(detailsResult,placesServiceStatus){placesServiceStatus===google.maps.GeocoderStatus.OK&&scope.$apply(function(){controller.$setViewValue(detailsResult.formatted_address),element.val(detailsResult.formatted_address),scope.details=detailsResult;element.on("focusout",function(event){element.val(detailsResult.formatted_address),element.unbind("focusout")})})})}})};controller.$render=function(){var location=controller.$viewValue;element.val(location)},scope.watchOptions=function(){return scope.options},scope.$watch(scope.watchOptions,function(){initOpts()},!0)}}}),angular.module("core").directive("scrollTo",["ScrollTo",function(ScrollTo){return{restrict:"AC",compile:function(){return function(scope,element,attr){element.bind("click",function(event){ScrollTo.idOrName(attr.scrollTo,attr.offset)})}}}}]).service("ScrollTo",["$window","ngScrollToOptions",function($window,ngScrollToOptions){this.idOrName=function(idOrName,offset,focus){var document=$window.document;idOrName||$window.scrollTo(0,0),void 0===focus&&(focus=!0);var el=document.getElementById(idOrName);el||(el=document.getElementsByName(idOrName),el=el&&el.length?el[0]:null),el&&(focus&&el.focus(),ngScrollToOptions.handler(el,offset))}}]).provider("ngScrollToOptions",function(){this.options={handler:function(el,offset){if(offset){var top=angular.element(el).offset().top-offset;window.scrollTo(0,top)}else el.scrollIntoView()}},this.$get=function(){return this.options},this.extend=function(options){this.options=angular.extend(this.options,options)}}),angular.module("core").filter("capitalize",function(){return function(input,all){var reg=all?/([^\W_]+[^\s-]*) */g:/([^\W_]+[^\s-]*)/;return input?input.replace(reg,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}):""}}).filter("split",function(){return function(input,splitChar,splitIndex){return-1===input.indexOf(".")&&(input=".."+input),input.split(splitChar)[splitIndex]}}).filter("limitHtml",function(){return function(text,limit){var changedString=String(text).replace(/<[^>]+>/gm,"");changedString.length;return changedString.length>limit?changedString.substr(0,limit-1):changedString}}).filter("durationview",["CounDownTimer",function(CounDownTimer,$timeout){return function(input,css){var duration=CounDownTimer.duration(input);return"undefined"==typeof duration?"0d: 0h: 0m: 0s":duration.days<0||duration.hours<0||duration.minutes<0||duration.seconds<0?"0d: 0h: 0m: 0s":duration.days+"d:"+duration.hours+"h:"+duration.minutes+"m:"+duration.seconds+"s"}}]).filter("splitValue",function(){return function(input,splitChar,splitIndex){return-1===input.indexOf("~")&&(input+="~"),input.split(splitChar)[splitIndex]}}).filter("replace",function(){return function(input){return input?input.replace("/","-"):void 0}}).filter("plus",function(){return function(input){return input?input.replace("+"," "):void 0}}).filter("unique",function(){return function(arr,field){return _.uniq(arr,function(a){return a[field]})}}).filter("replaceUnderscore",function(){return function(input){return input?input.replace(/_/g," "):void 0}}).filter("trustUrl",["$sce",function($sce){return function(recordingUrl){return $sce.trustAsResourceUrl(recordingUrl)}}]).filter("numberI",function(){return function(input){if(input){var parsed=parseFloat(input,10);if(parsed!==parsed)return null;input=Math.round(parsed),input=input.toString();var lastThree=input.substring(input.length-3),otherNumbers=input.substring(0,input.length-3);return""!==otherNumbers&&(lastThree=","+lastThree),input=otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g,",")+lastThree}}}).filter("changeUrl",["serverType",function(serverType){return function(input){if("live"===serverType){var s3Urls=["http://im1.irontread.com/","http://im2.irontread.com/","http://im3.irontread.com/","http://im4.irontread.com/"],index=Math.round(Math.floor(Math.random()*(s3Urls.length-0+1))+0);
return index>2&&(index=1),s3Urls[index]}return"staging"===serverType?"http://bapi.irontread.com/":"http://192.168.7.36:4000/"}}]).filter("emicalc",function(){return function(input){if(input.amount&&input.roi&&input.tenure){var a=input.amount,i=input.roi,t=input.tenure;try{if(parseInt(a)>0&&parseInt(i)>0&&parseInt(t)>0){var LoanA=a,IntR=i,TimeP=t,Multiplier=12,numerator=0,denominator=0,EMI=0;return TimeP/=12,numerator=LoanA*Math.pow(1+IntR/(100*Multiplier),TimeP*Multiplier),denominator=100*Multiplier*((Math.pow(1+IntR/(100*Multiplier),TimeP*Multiplier)-1)/IntR),EMI=12*(numerator/(12*denominator)),Math.round(EMI)}return null}catch(e){return console.error("Error 10013	"+e),null}}input=null}}).filter("yearrange",function(){return function(input,min,max){min=parseInt(min),max=parseInt(max);for(var i=min;max>=i;i++)input.push(i);return input}}),angular.module("core").factory("activationService",["$resource","contextPathpublic",function($resource,contextPathpublic){return $resource(contextPathpublic,{},{activation:{url:contextPathpublic+"activation",method:"GET"}})}]),angular.module("core").factory("AuthenticationService",["$uibModal","ipCookie","$rootScope","$state","$localStorage",function($uibModal,ipCookie,$rootScope,$state,$localStorage){var _isLoggedIn=!1,init=function(){_isLoggedIn=!!ipCookie("userCId")},_login=function(success,error){if(init(),_isLoggedIn)success();else{var modalInstance=$uibModal.open({animation:!0,templateUrl:"signup.login.popup.html",controller:"SignupLoginPopupCtrl",size:"lg",resolve:{fromSignup:function(){return!1}}});modalInstance.result.then(function(data){if("undefined"!=typeof data){ipCookie("userCId",data.id,{path:"/"}),ipCookie("userCName",data.name,{path:"/"}),ipCookie("userCompanyName",data.companyName,{path:"/"}),ipCookie("userDesignation",data.designation,{path:"/"}),ipCookie("authenticatedC",data.authenticated,{path:"/"}),ipCookie("roleC",data.role,{path:"/"}),ipCookie("dp",data.dp,{path:"/"}),ipCookie("verified",data.verified,{path:"/"}),_isLoggedIn=!0;var loginData={userCId:data.id,userCName:data.name,authenticatedC:data.authenticated,roleC:data.role,dp:data.dp,verified:data.verified,isLoggedIn:_isLoggedIn};$rootScope.$emit("validateLogin",loginData),success()}},function(){error&&error()}),_isLoggedIn=!0}},_logout=function(success,error){_isLoggedIn=!1,ipCookie.remove("userCId"),ipCookie.remove("userCName"),ipCookie.remove("userCompanyName"),ipCookie.remove("userDesignation"),ipCookie.remove("roleC"),ipCookie.remove("authenticatedC"),ipCookie.remove("tempsession"),ipCookie.remove("dp"),ipCookie.remove("verified");try{ipCookie.remove("userCId",{path:"/"}),ipCookie.remove("userCName",{path:"/"}),ipCookie.remove("userCompanyName",{path:"/"}),ipCookie.remove("userDesignation",{path:"/"}),ipCookie.remove("roleC",{path:"/"}),ipCookie.remove("dp",{path:"/"}),ipCookie.remove("verified",{path:"/"}),ipCookie.remove("authenticatedC",{path:"/"}),ipCookie.remove("tempsession",{path:"/"}),$localStorage.authToken=null,$localStorage.isrunning=!1,$localStorage.expiresin=null,$state.go("home",{},{reload:!0})}catch(e){}$state.go("home",{},{reload:!0}),$rootScope.$emit("validateLogout",_isLoggedIn)},_getUserId=function(){return ipCookie("userCId")},_isLogged=function(){return init(),_isLoggedIn};return init(),{login:_login,isLoggedIn:_isLoggedIn,isLogged:_isLogged,logout:_logout,getUserId:_getUserId}}]),angular.module("core").factory("Captcha",function(){return"6LfsJhoTAAAAABmhCV9bUPgaJNmQyNxK472Q1ORY"}),angular.module("core").factory("coreLS",["$resource","contextPath","multipartconverter",function($resource,contextPath,multipartconverter){return $resource(contextPath,{},{newcategory:{url:contextPath+"/json/cats.json",method:"GET",isArray:!0,interceptor:{response:function(data){return data.data}}}})}]),angular.module("core").factory("coreWS",["$resource","contextPathpublic","multipartconverter",function($resource,contextPathpublic,multipartconverter){return $resource(contextPathpublic,{},{getcategory:{url:contextPathpublic+"categories/catBySeoName",method:"GET"},register:{url:contextPathpublic+"user/register",method:"POST"},login:{url:contextPathpublic+"user/login",method:"POST"},forgotpassword:{url:contextPathpublic+"user/forgotPassword",method:"POST"},getSession:{url:contextPathpublic+"core/generatesession",method:"POST"},coomingSoon:{url:contextPathpublic+"cms/getcomingsoons",method:"GET"},breadCrumb:{url:contextPathpublic+"common/getBreadcrumb",method:"POST"},suggestionSearch:{url:contextPathpublic+"equip/getMatchEquipments",method:"POST"},getCreditAgency:{url:contextPathpublic+"rating/getrating",method:"GET"},getUpcomingAuction:{url:contextPathpublic+"equip/getUpcomingAuction",method:"GET"},getFeaturedEquip:{url:contextPathpublic+"equip/getFeaturedEquip",method:"GET"},captcha:{url:contextPathpublic+"captcha",method:"GET"},getCategeoryDec:{url:contextPathpublic+"common/getcatdes",method:"POST"},getSeo:{url:contextPathpublic+"seo/get",method:"POST"},csvTest:{url:contextPathpublic+"equip/csvtest",method:"POST",transformRequest:multipartconverter,headers:{"Content-Type":void 0}}})}]),angular.module("core").factory("financeHomeService",["$resource","contextPathpublic","contextPathprivate",function($resource,contextPathpublic,contextPathprivate){return $resource(contextPathpublic,{},{getState:{url:contextPathpublic+"state/all",method:"GET"},getCat:{url:contextPathpublic+"cat/find",method:"GET"},getEquipment:{url:contextPathpublic+"equip/findEquip",method:"GET"},checkITCode:{url:contextPathpublic+"finance/checkITCode",method:"POST"},applyForFinance:{url:contextPathprivate+"finance/applyForFinance",method:"POST"}})}]),angular.module("core").factory("focus",["$timeout","$window",function($timeout,$window){return function(id){$timeout(function(){var element=$window.document.getElementById(id);element&&element.focus()})}}]),angular.module("core").factory("pdfPopup",["$uibModal",function($uibModal){var _pdfPopup=function(pdfUrl){$uibModal.open({templateUrl:"pdf.popup.html",controller:"pdfController",size:"lg",resolve:{pdfurl:function(){return pdfUrl}}})};return{pdfpopup:_pdfPopup}}]),angular.module("core").factory("rentRequest",["$uibModal",function($uibModal){var _rentPopup=function(item){$uibModal.open({templateUrl:"requestRent.popup.html",controller:"rentPopup",size:"md",resolve:{data:function(){return item}}})};return{rentPopup:_rentPopup}}]).factory("chatuser",["$uibModal",function($uibModal){var _chatPopup=function(){$uibModal.open({templateUrl:"modules/chat/views/chat.client.view.html",controller:"chatCtrl"})};return{chatPopup:_chatPopup}}]),angular.module("core").service("Socket",["$state","$timeout","$localStorage","contextPathpublic",function($state,$timeout,$localStorage,contextPathpublic){this.connect=function(){if("undefined"!=typeof $localStorage.authToken&&""!==$localStorage.authToken)try{this.socket=io(contextPathpublic.replace("api/",""),{query:"token="+$localStorage.authToken})}catch(e){console.error("Error 10013	"+e)}},this.connect(),this.on=function(eventName,callback){this.socket&&this.socket.on(eventName,function(data){$timeout(function(){callback(data)})})},this.emit=function(eventName,data){this.socket&&this.socket.emit(eventName,data)},this.removeListener=function(eventName){this.socket&&this.socket.removeListener(eventName)}}]),angular.module("core").factory("stateList",function(){return["search.dash.board.lessee","search.dash.board.lessor","search.dash.user","search.dash.userverification","search.dash.newfinance","search.dash.financeMain.finance","search.dash.useradd","search.dash.useredit","search.changepass","search.dash.review","search.dash.notification","search.dash.profile","search.dash.orderdetails","search.dash.cancelInvite","search.dash.cancelOrder","search.dash.currentrental","search.dash.pastrental","search.dash.wishlist","search.dash.wishlistitem","search.verifyemail","search.dash.usereqmtlist","search.dash.usereqmtadd","logo.payment.paymentbid","logo.payment.paymentsolo","logo.payment.paymentnonsolo","logo.payment.listingFeePayment","logo.payment.paymentFinance","logo.payment.paymentauction","search.dash.auctionHall","search.dash.misReport","search.dash.preferences","search.thankyouSA","search.dash.auctionEquipList"]}),angular.module("core").factory("CounDownTimer",["$timeout",function($timeout){function getRemainigTime(referenceTime){var now=moment().utc().toDate();return moment(referenceTime)-now}var duration=function(timeSpan){var days=Math.floor(timeSpan/864e5),diff=timeSpan-864e5*days,hours=Math.floor(diff/36e5);diff-=36e5*hours;var minutes=Math.floor(diff/6e4);diff-=6e4*minutes;var secs=Math.floor(diff/1e3);return{days:days,hours:hours,minutes:minutes,seconds:secs}};return{duration:duration,getRemainigTime:getRemainigTime}}]),angular.module("core").factory("multipartconverter",[function(){return function(data){if(void 0===data)return data;var fd=new FormData;return angular.forEach(data,function(value,key){value instanceof FileList||value instanceof Array&&value.length>0&&value[0]instanceof File?angular.forEach(value,function(file,index){fd.append(key,file)}):fd.append(key,value)}),fd}}]).factory("Item",function(){for(var items=[],i=0;50>i;i++)items.push();return{get:function(offset,limit){return items.slice(offset,offset+limit)},total:function(){return items.length}}}).factory("title",function(){return function(value){}}).factory("description",function(){return function(value){}}).factory("download",function(){return function(value){value===!0?($("header").hide(),$("footer").hide()):($("header").show(),$("footer").show())}}),angular.module("core").factory("WishlistService",["$uibModal",function($uibModal){var _addToWishList=function(value,data){$uibModal.open({templateUrl:"equipDetail.popup.html",controller:"eqdetailWishListCtrl",size:"md",resolve:{wishData:function(){return data}}})};return{addToWishList:_addToWishList}}]).factory("SecurityDeposit",["$uibModal",function($uibModal){return{securityDeposit:function(eObj,direct){try{$uibModal.open({templateUrl:"emdSecurityDeposit.html",controller:"statusController",size:"md",resolve:{eObj:function(){return eObj},direct:function(){return direct}}})}catch(e){console.error("Error 10014	"+e)}}}}]),angular.module("dealer").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("search.dash.userConnectToDealer",{url:"/lessor/ctd",views:{"useractions@search.dash":{templateUrl:"modules/dealer/views/ctd.client.view.html",controller:"ctdCtrl"}}}).state("search.dash.connectToDealerRequest",{url:"/lessor/ctd/:eid",params:{eid:""},views:{"useractions@search.dash":{templateUrl:"modules/dealer/views/ctdRequest.client.view.html",controller:"ctdRequestCtrl"}}}).state("search.dash.connectToDealerPrevious",{url:"/lessor/ctdPrevious",views:{"useractions@search.dash":{templateUrl:"modules/dealer/views/ctdPrevious.client.view.html",controller:"ctdPreviousCtrl"}}}).state("search.dash.userFleet",{url:"/lessor/fleet",views:{"useractions@search.dash":{templateUrl:"modules/dealer/views/fleet.client.view.html",controller:"fleet"}}}).state("search.dash.userFleetEquipment",{url:"/lessor/fleet/:eid/:type",params:{eid:"",type:"view"},views:{"useractions@search.dash":{templateUrl:"modules/dealer/views/fleetEquipment.client.view.html",controller:"fleetCtrl"}}})}]),angular.module("dealer").controller("ctdCtrl",["DealerAPI","$scope","AuthenticationService","$uibModal","$localStorage","contextPathimageurl","$state",function(DealerAPI,$scope,AuthenticationService,$uibModal,$localStorage,contextPathImageUrl,$state){$scope.data={imgPath:contextPathImageUrl,equipment:[]},$scope.field={left:0,top:0,img:""},$scope.popover=!1,$scope.showPopover=function(mouseEvent,img){return mouseEvent||(mouseEvent=window.event),$scope.field.left=parseInt(mouseEvent.pageX)-200+"px",$scope.field.top=parseInt(mouseEvent.pageY)-110+"px",$scope.field.img=img,$scope.popover=!$scope.popover,$scope.popover};try{AuthenticationService.login(function(){DealerAPI.allEquipments({},function(res){200===res.status.statusCode&&($scope.data.equipment=res.data)})})}catch(e){console.error(e)}$scope.request=function(eObj){$state.go("search.dash.connectToDealerRequest",{eid:eObj._id})},$scope.previous=function(){$state.go("search.dash.connectToDealerPrevious",{})}}]),angular.module("dealer").controller("ctdPreviousCtrl",["DealerAPI","$scope","AuthenticationService","$uibModal","$localStorage","contextPathimageurl","$state","contextPathpublic",function(DealerAPI,$scope,AuthenticationService,$uibModal,$localStorage,contextPathImageUrl,$state,contextPathpublic){$scope.data={imgPath:contextPathImageUrl,imgPathPublic:contextPathpublic,equipment:[]},$scope.field={left:0,top:0,img:""},$scope.popover=!1,$scope.showPopover=function(mouseEvent,img){return mouseEvent||(mouseEvent=window.event),$scope.field.left=parseInt(mouseEvent.pageX)-200+"px",$scope.field.top=parseInt(mouseEvent.pageY)-110+"px",$scope.field.img=img,$scope.popover=!$scope.popover,$scope.popover};try{AuthenticationService.login(function(){DealerAPI.addCtdPrevious({},function(res){200===res.status.statusCode&&($scope.data.equipment=res.data)})})}catch(e){console.error(e)}$scope.goTo=function(state){$state.go(state,{})},$scope.view=function(eobj){$uibModal.open({templateUrl:"viewCtdPrevious.html",controller:"viewCtdPreviousCtrl",size:"md",resolve:{eObj:function(){return eobj}}})}}]),angular.module("dealer").controller("viewCtdPreviousCtrl",["DealerAPI","$scope","AuthenticationService","$uibModal","$localStorage","contextPathimageurl","Notification","SweetAlert","$sce","eObj","$modalInstance","contextPathpublic",function(DealerAPI,$scope,AuthenticationService,$uibModal,$localStorage,contextPathImageUrl,Notification,SweetAlert,$sce,eObj,$uibModalInstance,contextPathpublic){$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.data={imgPath:contextPathImageUrl,imgPathPublic:contextPathpublic,eObj:eObj}}]),angular.module("dealer").controller("ctdRequestCtrl",["DealerAPI","$scope","AuthenticationService","$uibModal","$localStorage","contextPathimageurl","$state","$stateParams","gMap","Notification","SweetAlert","$document",function(DealerAPI,$scope,AuthenticationService,$uibModal,$localStorage,contextPathImageUrl,$state,$stateParams,gMap,Notification,SweetAlert,$document){$scope.data={back:!1,imgPath:contextPathImageUrl,equipment:{},"new":"new"===$stateParams.request,requestType:["For Maintenance","Conditional Repair","Warranty Related","Other"],isMachineWork:["Yes","No"],uomList:["Kg","Unit","Lts","Mts"],searchPlace:"",images:[],temp:{lat:"","long":""},params:{pincodeDealer:"",pincode:"",serialno:"",eid:"",type:"sr",address:"",location:"",lat:"","long":"",type_of_request:"",spare_json:[{idx:1,itemreq:"",partno:"",uom:"",qty:"",img:""}],description:"",is_machine_work:""}},AuthenticationService.login(function(){DealerAPI.allEquipments({eid:$stateParams.eid},function(res){200===res.status.statusCode&&($scope.data.equipment=res.data,$scope.data.params.eid=res.data._id)})}),$scope.ctdAutoCompleteOptions={country:"in",place_changed:function(data){var _location=data.geometry.location;$scope.latlong=_location.lat()+"~"+_location.lng(),angular.forEach(data.address_components,function(item){"locality"===item.types[0]&&($scope.addr.city=item.long_name),"administrative_area_level_1"===item.types[0]&&($scope.addr.state=item.long_name)})}},$scope.addRow=function(){$scope.data.params.spare_json.push({idx:parseInt($scope.data.params.spare_json[$scope.data.params.spare_json.length-1].idx)+1,itemreq:"",partno:"",uom:"",qty:"",img:""})},$scope.removeRow=function(idx){$scope.data.params.spare_json.length>0&&$scope.data.params.spare_json.splice(idx,1)},$scope.search=function(){$scope.data.searchPlace?gMap.search($scope.data.searchPlace).then(function(res){gMap.addMarker(res),$scope.data.params.pincodeDealer&&$scope.data.params.pincodeDealer.length>0?$scope.data.params.location=$scope.data.searchPlace+($scope.data.params.pincode?" Pincode: "+$scope.data.params.pincode:""):$scope.data.params.location=$scope.data.searchPlace,$scope.data.params.lat=res.geometry.location.lat(),$scope.data.params["long"]=res.geometry.location.lng(),$scope.data.temp.lat=res.geometry.location.lat().toFixed(2),$scope.data.temp["long"]=res.geometry.location.lng().toFixed(2)},function(status){}):Notification.warning("Enter your equipment location")},$scope.active=function(str){$scope.data.params.type=str,gMap.init()},$scope.active("sr");$document.on("keyup","#idPincode",function(e){$(this).val($(this).val().trim()),6===$(this).val().length&&",48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,".indexOf(","+e.keyCode+",")>-1?($document.find('input[tabindex="'+(parseInt($(this).attr("tabindex"))+1)+'"]').focus(),e.preventDefault()):$(this).val($(this).val().substr(0,6))}),$scope.callme=function(idx){setTimeout(function(){$scope.data.params.spare_json[idx].img=angular.element("#file"+idx).data("ji")},500)};var submitAction=function(){var data={params:JSON.stringify($scope.data.params),images:$scope.data.images};return""===$scope.data.params.location?(Notification.error("Please fill full address."),!1):void($scope.data.params.pincodeDealer&&0===$scope.data.params.pincodeDealer.length?SweetAlert.swal("Error!","No dealer found in your locality","error"):DealerAPI.addCtd(data,function(res){200===res.status.statusCode&&res.data.pincodeDealer?($scope.data.back=!0,SweetAlert.swal("Success!","Your request has been successfully submitted","success")):200!==res.status.statusCode||res.data.pincodeDealer?SweetAlert.swal("Error!","We are unable to process your request at this time. Please try again later.","error"):($scope.data.back=!0,SweetAlert.swal("Warning!",res.data.msg?res.data.msg:"Unable to find dealer for your location, Please try after some time.","warning"))}))};$scope.submitRequest=function(){var isError=!1;AuthenticationService.login(function(){if($scope.data.params.lat&&$scope.data.params["long"])if("sr"===$scope.data.params.type)for(var i=0;i<$scope.data.params.spare_json.length;i++){if(!$scope.data.params.spare_json[i].itemreq)return Notification.error("Please fill Item Req. (Row: "+(i+1)+")"),isError=!0,!1;if(!$scope.data.params.spare_json[i].uom)return Notification.error("Please select UOM. (Row: "+(i+1)+")"),isError=!0,!1;if(!$scope.data.params.spare_json[i].qty)return Notification.error("Please fill Quantity. (Row: "+(i+1)+")"),isError=!0,!1;isError||i!==$scope.data.params.spare_json.length-1||submitAction()}else"rse"===$scope.data.params.type?$scope.data.params.type_of_request?$scope.data.params.description?submitAction():Notification.error("Please fill Description"):Notification.error("Please select Request Type"):"bs"===$scope.data.params.type&&($scope.data.params.is_machine_work?$scope.data.params.description?submitAction():Notification.error("Please fill Description"):Notification.error("Please select 'Is Machine able to work?'"));else SweetAlert.swal("Warning!","Please select the nearest location","warning")})}}]),angular.module("dealer").controller("fleet",["DealerAPI","$scope","AuthenticationService","$uibModal","$localStorage","contextPathimageurl","$state",function(DealerAPI,$scope,AuthenticationService,$uibModal,$localStorage,contextPathImageUrl,$state){$scope.data={imgPath:contextPathImageUrl,equipment:[]},$scope.field={left:0,top:0,img:""},$scope.popover=!1,$scope.showPopover=function(mouseEvent,img){return mouseEvent||(mouseEvent=window.event),$scope.field.left=parseInt(mouseEvent.pageX)-200+"px",$scope.field.top=parseInt(mouseEvent.pageY)-110+"px",$scope.field.img=img,$scope.popover=!$scope.popover,$scope.popover};try{AuthenticationService.login(function(){DealerAPI.allEquipments({},function(res){200===res.status.statusCode&&($scope.data.equipment=res.data)})})}catch(e){console.error("Error 10015	"+e)}$scope.viewFleet=function(eObj){$state.go("search.dash.userFleetEquipment",{eid:eObj._id})},$scope.generateReport=function(eObj){$state.go("search.dash.userFleetEquipment",{eid:eObj._id,type:"report"})},$scope.openFleet=function(eobj){$uibModal.open({templateUrl:"openFleet.html",controller:"openFleetCtrl",size:"md",resolve:{eObj:function(){return eobj}}})}}]),angular.module("dealer").controller("openFleetCtrl",["DealerAPI","$scope","AuthenticationService","$uibModal","$localStorage","contextPathimageurl","Notification","SweetAlert","$sce","eObj","$modalInstance",function(DealerAPI,$scope,AuthenticationService,$uibModal,$localStorage,contextPathImageUrl,Notification,SweetAlert,$sce,eObj,$uibModalInstance){$(document).on("click",".customTimeContainer",function(){}),$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.temp={fleet:{startTimeHour:"8",startTimeMinutes:"00",startTimeMeridiem:"AM",stopTimeHour:"6",stopTimeMinutes:"00",stopTimeMeridiem:"PM"}},$scope.data={imgPath:contextPathImageUrl,equipment:eObj,fleet:{_id:null,eid:eObj._id,date:new Date,startTime:"8:00 AM",stopTime:"6:00 PM",hmrStart:0,hrmStop:0,kmStart:0,kmStop:0,bdHour:0,otHour:0,diesel:0,engineTopup:0,hydroulicTopup:0}},$scope.setTime=function(sString,timeStr){var s1="8",s2="00",s3="AM",e1="6",e2="00",e3="PM";if("start"===sString)try{timeStr=timeStr?timeStr:"8:00 AM";var st=timeStr.split(":"),st2=st[1].split(" ");s1=st[0],s2=st2[0],s3=st2[1],$scope.temp.fleet.startTimeHour=s1,$scope.temp.fleet.startTimeMinutes=s2,$scope.temp.fleet.startTimeMeridiem=s3}catch(e){console.error("Error 10016	"+e)}else try{timeStr=timeStr?timeStr:"6:00 PM";var et=timeStr.split(":"),et2=et[1].split(" ");e1=et[0],e2=et2[0],e3=et2[1],$scope.temp.fleet.stopTimeHour=e1,$scope.temp.fleet.stopTimeMinutes=e2,$scope.temp.fleet.stopTimeMeridiem=e3}catch(e){console.error("Error 10017	"+e)}},$scope.setStartTime=function(){var h=$scope.temp.fleet.startTimeHour?$scope.temp.fleet.startTimeHour.trim():"8",m=$scope.temp.fleet.startTimeMinutes?$scope.temp.fleet.startTimeMinutes.trim():"00",a=$scope.temp.fleet.startTimeMeridiem?$scope.temp.fleet.startTimeMeridiem.trim():"AM";$scope.data.fleet.startTime=h+":"+m+" "+a},$scope.setStopTime=function(){var h=$scope.temp.fleet.stopTimeHour?$scope.temp.fleet.stopTimeHour.trim():"6",m=$scope.temp.fleet.stopTimeMinutes?$scope.temp.fleet.stopTimeMinutes.trim():"00",a=$scope.temp.fleet.stopTimeMeridiem?$scope.temp.fleet.stopTimeMeridiem.trim():"PM";$scope.data.fleet.stopTime=h+":"+m+" "+a},$scope.dateFormat={changeYear:!0,changeMonth:!0,dateFormat:"dd-mm-yy",changetime:!0},$scope.getFleet=function(){var date=moment($scope.data.fleet.date).isValid()?moment($scope.data.fleet.date).format("YYYY-MM-DD"):moment($scope.data.fleet.date,"DD-MM-YYYY").format("YYYY-MM-DD"),query={eid:$scope.data.equipment._id,date:date};DealerAPI.getFleet(query,function(res){200===res.status.statusCode&&(res.data&&res.data.date?($scope.data.fleet=res.data,$scope.setTime("start",res.data.startTime),$scope.setTime("stop",res.data.stopTime)):DealerAPI.getLastFleet(query,function(res){200===res.status.statusCode&&200===res.status.statusCode&&res.data&&res.data.log.date&&($scope.setTime("start"),$scope.setTime("stop"),$scope.data.fleet={_id:null,eid:eObj._id,date:moment($scope.data.fleet.date).format("YYYY-MM-DD"),startTime:"8:00 AM",stopTime:"6:00 PM",hmrStart:res.data.log.hrmStop,hrmStop:0,kmStart:res.data.log.kmStop,kmStop:0,bdHour:0,otHour:0,diesel:0,engineTopup:0,hydroulicTopup:0})}))})},$scope.submit=function(){if(0!==$scope.data.fleet.hrmStop&&0!==$scope.data.fleet.kmStop){var tempvalue=$scope.data.fleet,query={eid:eObj._id,fleet_json:[]};tempvalue.date=moment(tempvalue.date).format("YYYY-MM-DD"),query.fleet_json.push(tempvalue),DealerAPI.addFleet(query,function(res){200===res.status.statusCode&&(Notification.success("Your changes have been successfully updated"),$scope.close())})}};var init=function(){$scope.getFleet()};init()}]),angular.module("dealer").controller("fleetCtrl",["$scope","$state","$stateParams","contextPathpublic","DealerAPI","SweetAlert","contextPathimageurl","Socket","$uibModal","$q","Notification","AuthenticationService",function($scope,$state,$stateParams,contextPathpublic,DealerAPI,SweetAlert,contextPathimageurl,Socket,$uibModal,$q,Notification,AuthenticationService){Chart.plugins.register({afterDatasetsDraw:function(chart,easing){var ctx=chart.ctx;chart.data.datasets.forEach(function(dataset,i){try{var meta=chart.getDatasetMeta(i);meta.hidden||meta.data.forEach(function(element,index){ctx.fillStyle="rgb(50, 50, 50)";var fontSize=14,fontStyle="Bold",fontFamily="Helvetica Neue";ctx.font=Chart.helpers.fontString(fontSize,fontStyle,fontFamily);var dataString=dataset.data[index].toString();ctx.textAlign="center",ctx.textBaseline="middle";var padding=0,position=element.tooltipPosition();ctx.fillText(dataString,position.x,position.y-fontSize/2-padding)})}catch(e){console.error("Error 10018	"+e)}})}}),$scope.contextPathimageurl=contextPathimageurl,$scope.contextPathpublic=contextPathpublic,$scope.forReport="report"===$stateParams.type,$scope.dateFormat={changeYear:!0,changeMonth:!0,dateFormat:"dd-mm-yy",changetime:!0},$scope.data={hasFleetData:!1,hasCanvas:!1,canvasHeader:"Fuel Consumption V/s Engine hours",fleet:[],floatHintValue:0,type:null,color1:"#0B96EB",color2:"#FB0200",date:{from:moment().subtract(1,"months").format("DD-MM-YYYY"),to:moment().format("DD-MM-YYYY")},report:{ownerName:null,clientName:null,location:null,email:null}},$scope.goTo=function(state){$state.go(state,{})};var funPromiseBarChartData=function(obj,data){return $q(function(resolve,reject){try{angular.forEach(data,function(value,key){obj.labels.push(value.date),obj.datasets[0].data.push(value.diesel?value.diesel:0),obj.datasets[1].data.push(value.hrmStop||value.hmrStart||value.hrmStop-value.hmrStart?value.hrmStop-value.hmrStart:0),key===data.length-1&&resolve(obj)})}catch(e){reject(e)}})},funPromiseBarData=function(obj,data){return $q(function(resolve,reject){try{angular.forEach(data,function(value,key){obj.labels.push(value.date),obj.datasets[0].data.push(value.hrmStop||value.hmrStart||value.hrmStop-value.hmrStart?value.hrmStop-value.hmrStart:0),obj.datasets[1].data.push(value.bdHour?value.bdHour:0),key===data.length-1&&resolve(obj)})}catch(e){reject(e)}})},init=function(){AuthenticationService.login(function(){DealerAPI.getFleetBetweenDates({eid:$stateParams.eid,date:$scope.data.date},function(res){200===res.status.statusCode?res.data&&($scope.data.hasFleetData=!1,res.data.length>0?($scope.data.fleet=res.data,$scope.data.hasFleetData=!0,$scope.data.fleet.sort(function(a,b){return moment(a.date,"YYYY-MM-DD")-moment(b.date,"YYYY-MM-DD")}),$scope.data.hasCanvas&&1===$scope.data.type?$scope.showWorkingHoursReport():$scope.data.hasCanvas&&2===$scope.data.type&&$scope.showFuelConsumptionEngineHours()):$scope.data.fleet=[]):console.info("Error 10019"+JSON.stringify(res))})})},hideCanvas=function(){$scope.data.hasCanvas=!1,$(document).find("#allGraph, .chartjs-hidden-iframe").remove()};$scope.downloadPDF=function(){Notification.success({message:"Creating PDF"});try{if($scope.data.type){var dataURL,pdf,fleetCanvas=null,hint="Average Fuel Consumption",hintValue=" Lts / Hour",hintOffset1=178,hintValueOffset1=hintOffset1+55,text="Fuel Consumption V/s Engine hours",xOffset=0,resizedCanvas=document.createElement("canvas"),resizedContext=resizedCanvas.getContext("2d");resizedCanvas.height="690",resizedCanvas.width="1060",fleetCanvas=1===$scope.data.type?document.getElementById("allGraph"):document.getElementById("allGraph");var h=1050-fleetCanvas.width?1050-fleetCanvas.width+fleetCanvas.height:fleetCanvas.height;resizedContext.drawImage(fleetCanvas,0,0,1050,h>650?650:h),dataURL=resizedCanvas.toDataURL("image/png",1),pdf=new jsPDF("l","mm","a4"),pdf.setTextColor(50,50,50),xOffset=pdf.internal.pageSize.width/2-pdf.getStringUnitWidth(text)/2*(pdf.internal.getFontSize()/2),1===$scope.data.type&&(text="Working Hours Report",pdf.text(xOffset+25,10,text)),2===$scope.data.type&&(pdf.text(xOffset,10,text),pdf.setFontSize(12),pdf.text(hintOffset1,20,hint+" : "),pdf.setTextColor(255,0,0),pdf.setFontSize(12),pdf.text(hintValueOffset1,20,$scope.data.floatHintValue+hintValue)),pdf.addImage(dataURL,"JPEG",10,25),pdf.save("download.pdf")}else Notification.error("Please select the graph first")}catch(e){console.error("Error 10020	"+e)}},$scope.showFuelConsumptionEngineHours=function(){$(document).find("#allGraph, .chartjs-hidden-iframe").remove(),$(document).find("#canvasContainer").append('<canvas id="allGraph"></canvas>');var ctx=document.getElementById("allGraph").getContext("2d");$scope.data.canvasHeader="Fuel Consumption V/s Engine hours",$scope.data.hasCanvas=!0,$scope.data.type=2;var barChartData={labels:[],datasets:[{label:"Fuel Issue",type:"line",data:[],fill:!1,borderColor:$scope.data.color2,backgroundColor:$scope.data.color2,pointBorderColor:$scope.data.color2,pointBackgroundColor:$scope.data.color2,pointHoverBackgroundColor:$scope.data.color2,pointHoverBorderColor:$scope.data.color2,yAxisID:"y-axis-2"},{type:"bar",label:"Engine Hours",data:[],fill:!1,backgroundColor:$scope.data.color1,borderColor:$scope.data.color1,hoverBackgroundColor:$scope.data.color1,hoverBorderColor:$scope.data.color1,yAxisID:"y-axis-1"}]},promise=funPromiseBarChartData(barChartData,$scope.data.fleet);promise.then(function(resultObj){$scope.data.floatHintValue=resultObj.datasets[0].data.reduce(function(a,b){return a+b},0)/resultObj.datasets[1].data.reduce(function(a,b){return a+b},0),$scope.data.floatHintValue=$scope.data.floatHintValue.toFixed(2),window.myBarChart=new Chart(ctx,{type:"bar",data:resultObj,options:{responsive:!0,tooltips:{mode:"label"},elements:{line:{tension:0,fill:!1}},scales:{xAxes:[{ticks:{fontColor:"rgb(40, 40, 40)"},display:!0,gridLines:{display:!0},labels:{show:!0},scaleLabel:{display:!0,labelString:"Date",fontStyle:"Bold",fontColor:"rgb(40, 40, 40)",fontFamily:"Times-Roman"}}],yAxes:[{ticks:{beginAtZero:!0,fontColor:"rgb(40, 40, 40)"},type:"linear",display:!0,position:"left",id:"y-axis-1",scaleLabel:{display:!0,labelString:"Hours",fontStyle:"Bold",fontColor:"rgb(40, 40, 40)",fontFamily:"Times-Roman"},gridLines:{display:!0},labels:{show:!0}},{ticks:{beginAtZero:!0,fontColor:"rgb(40, 40, 40)"},type:"linear",display:!0,position:"right",id:"y-axis-2",scaleLabel:{display:!0,labelString:"Liters",fontStyle:"Bold",fontColor:"rgb(40, 40, 40)",fontFamily:"Times-Roman"},gridLines:{display:!1},labels:{show:!0}}]}}})},function(reason){alert("Failed: "+reason)})},$scope.showWorkingHoursReport=function(){$(document).find("#allGraph, .chartjs-hidden-iframe").remove(),$(document).find("#canvasContainer").append('<canvas id="allGraph"></canvas>');var ctx=document.getElementById("allGraph").getContext("2d");$scope.data.canvasHeader="Working Hours Report",$scope.data.hasCanvas=!0,$scope.data.type=1;var barData={labels:[],datasets:[{label:"Engine Working Hours",backgroundColor:$scope.data.color1,data:[]},{label:"B/d Hours",backgroundColor:$scope.data.color2,data:[]}]},promise=funPromiseBarData(barData,$scope.data.fleet);promise.then(function(resultObj){window.myBarChart2=new Chart(ctx,{type:"bar",data:resultObj,options:{barValueSpacing:5,scales:{xAxes:[{ticks:{fontColor:"rgb(50, 50, 50)"},gridLines:{display:!0},display:!0,scaleLabel:{display:!0,labelString:"Date",fontStyle:"Bold",fontColor:"rgb(40, 40, 40)",fontFamily:"Times-Roman"}}],yAxes:[{ticks:{fontColor:"rgb(50, 50, 50)"},display:!0,scaleLabel:{display:!0,labelString:"Hours",fontStyle:"Bold",fontColor:"rgb(40, 40, 40)",fontFamily:"Times-Roman"}}]}}})},function(reason){console.error("Error 10069	"+reason)})},$scope.hideCanvas=hideCanvas,$scope.filter=function(k){if($scope.forReport&&!k)if($scope.data.report.email=$scope.data.report.email?$scope.data.report.email:"",0===$scope.data.fleet.length)Notification.error("No Data is available for creating pdf");else if(-1===$scope.data.report.email.toString().indexOf(".")||-1===$scope.data.report.email.toString().indexOf("@"))Notification.error("Please enter the valid email address");else{var fDateTemp=moment(new Date($scope.data.date.from)).isValid()?moment(new Date($scope.data.date.from)).format("YYYY-MM-DD"):moment($scope.data.date.from,"DD-MM-YYYY").format("YYYY-MM-DD"),tDateTemp=moment(new Date($scope.data.date.to)).isValid()?moment(new Date($scope.data.date.to)).format("YYYY-MM-DD"):moment($scope.data.date.to,"DD-MM-YYYY").format("YYYY-MM-DD");
AuthenticationService.login(function(){DealerAPI.sendEmail({eid:$stateParams.eid,from:fDateTemp,to:tDateTemp,email:$scope.data.report.email,ownerName:$scope.data.report.ownerName,clientName:$scope.data.report.clientName,location:$scope.data.report.location},function(res){200===res.status.statusCode?Notification.success(res.data):Notification.error(res.data)})})}else{var FROM=moment($scope.data.date.from,["DD-MM-YYYY","YYYY-MM-DDTHH:mm:SS.SSSZ"]).isValid()?moment($scope.data.date.from,["DD-MM-YYYY","YYYY-MM-DDTHH:mm:SS.SSSZ"]):moment($scope.data.date.from),TO=moment($scope.data.date.to,["DD-MM-YYYY","YYYY-MM-DDTHH:mm:SS.SSSZ"]).isValid()?moment($scope.data.date.to,["DD-MM-YYYY","YYYY-MM-DDTHH:mm:SS.SSSZ"]):moment($scope.data.date.to),dateDiff=TO.diff(FROM,"days");dateDiff>0&&dateDiff>180?Notification.warning("Dates range more than 180 days not allowed"):dateDiff>0?init():Notification.error("Invalid date range")}},init()}]),angular.module("dealer").factory("DealerAPI",["$resource","contextPathprivate","multipartconverter",function($resource,contextPathprivate,multipartconverter){return $resource(contextPathprivate,{},{allEquipments:{url:contextPathprivate+"dealer/allEquipments",method:"POST"},getFleetEquipments:{url:contextPathprivate+"fleet/equipments",method:"POST"},getFleet:{url:contextPathprivate+"fleet/get",method:"POST"},getFleetBetweenDates:{url:contextPathprivate+"fleet/getFleetBetweenDates",method:"POST"},sendEmail:{url:contextPathprivate+"fleet/pdf",method:"POST"},getLastFleet:{url:contextPathprivate+"fleet/getLast",method:"POST"},addFleet:{url:contextPathprivate+"fleet/add",method:"POST"},addCtd:{url:contextPathprivate+"ctd/add",method:"POST",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},addCtdPrevious:{url:contextPathprivate+"dealer/connect/list",method:"POST"},findDealerFromPincode:{url:contextPathprivate+"dealer/findDealerFromPincode",method:"POST"}})}]),angular.module("dealer").service("gMap",["$q",function($q){var userLocation={lat:28.575379,lng:77.2377626};this.init=function(){try{var options={center:new google.maps.LatLng(userLocation.lat,userLocation.lng),zoom:17,disableDefaultUI:!0};this.map=new google.maps.Map(document.getElementById("map"),options),this.places=new google.maps.places.PlacesService(this.map)}catch(e){console.error("Error 10022	"+e)}},this.search=function(str){var d=$q.defer();return this.places.textSearch({query:str},function(results,status){"OK"===status?d.resolve(results[0]):d.reject(status)}),d.promise},this.addMarker=function(res){this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({map:this.map,position:res.geometry.location,draggable:!0,animation:google.maps.Animation.DROP}),this.marker.addListener("dragend",function(event){try{document.getElementById("resLat").value=this.getPosition().lat(),document.getElementById("resLng").value=this.getPosition().lng(),document.getElementById("tempLat").value=this.getPosition().lat().toFixed(2),document.getElementById("tempLng").value=this.getPosition().lng().toFixed(2)}catch(e){console.error("Error 10023	"+e)}}),this.map.setCenter(res.geometry.location)}}]),angular.module("equipment").config(["$stateProvider",function($stateProvider){$stateProvider.state("search.equipment1",{url:"/search/{path:.*}",views:{"main@search":{templateUrl:"modules/equipment/views/equipment.client.view.html",controller:"EquipmentController"}},ncyBreadcrumb:{label:"categoryName",parent:"search.category"}}).state("search.equipment2",{url:"/search/:catname?type=&categoryId=&q=",views:{"main@search":{templateUrl:"modules/equipment/views/equipment.client.view.html",controller:"EquipmentController"}},params:{catname:"",categoryId:"",type:"",q:""},ncyBreadcrumb:{label:"categoryName",parent:"search.category"}}).state("search.equipment3",{url:"/search/:catname?type=&categoryId=&q=&location=&latlong=&duration-start=&duration-end=",views:{"main@search":{templateUrl:"modules/equipment/views/equipment.client.view.html",controller:"EquipmentController"}},params:{categoryId:"",catname:"",type:"",q:"",location:"",latlong:"","duration-start":"","duration-end":""},ncyBreadcrumb:{label:"categoryName",parent:"search.category"}}).state("search.equipment4",{url:"/search/?:type=&sa=&sadate=",views:{"main@search":{templateUrl:"modules/equipment/views/equipment.client.view.html",controller:"EquipmentController"}},params:{sa:"",sadate:"",type:""},ncyBreadcrumb:{label:"categoryName",parent:"search.category"}}).state("search.eqmtdetail2",{url:"/equipmentdetail/:eqmtName/:equipmentId?type=",views:{"main@search":{templateUrl:"modules/equipment/views/eqmtdetail.client.view.html",controller:"eqmtDetailCtrl"}},params:{eqmtName:"",equipmentId:"",type:"buy"}}).state("search.dash.usereqmtlist",{url:"/lessor/manageequip",views:{"useractions@search.dash":{templateUrl:"modules/equipment/views/usereqmtlist.client.view.html",controller:"userEqmtListCtrl"}}}).state("search.auction",{url:"/straightauction/{path:.*}",views:{"main@search":{templateUrl:"modules/equipment/views/equipment.client.view.html",controller:"EquipmentController"}},ncyBreadcrumb:{label:"categoryName",parent:"search.category"}}).state("search.auctiondetails",{url:"/auctiondetails/:eqmtId",views:{"main@search":{templateUrl:"modules/equipment/views/auctiondetail.client.view.html",controller:"AuctionDetailController"}},params:{eqmtId:""},ncyBreadcrumb:{label:"categoryName",parent:"search.category"}}).state("search.dash.usereqmtadd",{url:"/lessor/addequip/:tab/:eqmtId",views:{"useractions@search.dash":{templateUrl:"modules/equipment/views/usereqmtadd.client.view.html",controller:"userEqmtAddCtrl"}},params:{eqmtId:"",tab:""}}).state("compare",{url:"/download/:id",templateUrl:"modules/equipment/views/compare.client.view.html",controller:"CompareController",params:{id:""}}).state("search.dash.auctionEquipList",{url:"/lessor/auctionEquipList/:?tabName=&layout=",views:{"useractions@search.dash":{templateUrl:"modules/equipment/views/auctionList.client.view.html",controller:"userEqmtListCtrl"}},params:{tabName:"inauction",layout:"list"}}).state("search.dash.inspectionquestion",{url:"/lessor/inspectionquestion?:catId&:equipId&:insId",views:{"useractions@search.dash":{templateUrl:"modules/equipment/views/inspectionquestion.client.view.html",controller:"inspectionQuestionCtr"}},params:{catId:"",equipId:"",insId:""}}).state("search.dash.inspectioncertification",{url:"/lessor/inspectioncertification?:catId&:equipId&:insId&:questionId",views:{"useractions@search.dash":{templateUrl:"modules/equipment/views/inspectioncertification.client.view.html",controller:"inspectionCertiCtr"}},params:{catId:"",equipId:"",insId:"",questionId:""}})}]),angular.module("equipment").controller("AuctionDetailController",["$scope","Equipments","EquipmentsPublic","ipCookie","$stateParams","$state","$uibModal","AuthenticationService","contextPathimageurl","$location","rentRequest","title","Notification","CounDownTimer","$timeout","$rootScope","$filter","Lightbox",function($scope,Equipments,EquipmentsPublic,ipCookie,$stateParams,$state,$uibModal,AuthenticationService,contextPathimageurl,$location,rentRequest,title,Notification,CounDownTimer,$timeout,$rootScope,$filter,Lightbox){function makeUL(array){var fake=document.createElement("div");fake.className="fake";for(var list=document.createElement("ul"),i=0;i<array.length;i++){var item=document.createElement("li"),img=document.createElement("img");img.setAttribute("src",$scope.contextPathimageurl+array[i].path),item.appendChild(img),list.appendChild(item)}fake.appendChild(list),$("body").append(fake)}$scope.init=function(){},$scope.contextPathimageurl=contextPathimageurl,$scope.certificationData=[];var _eqmtName="",_startDate=0,_endDate=0;$scope.diff=0,$scope.user={},$scope.data={},$scope.user.price="",$scope.UserId=ipCookie("userCId"),$scope.imageLibrary=[];var updateStatus=function(s,e){"undefined"!=typeof $scope.data&&(moment()<moment(s)?$scope.data.sauction.sa="emdpaid":moment()>moment(s)&&moment()<moment(e)?$scope.data.sauction.sa="inauction":moment()>moment(s)&&moment()>moment(e)&&($scope.data.sauction.sa="outauction"))};$scope.replaceDecimal=function(value){var _value=value.split(" ")[0];if(isNaN(_value))return value;if(value.indexOf(" ")>0||isNaN(_value)){var parsed=parseFloat(_value),input=Math.round(100*parsed)/100;return input=input+" "+value.split(" ")[1]}return value},$scope.scrollbarConfig={setHeight:350,theme:"dark",axis:"y",scrollInertia:200},$scope.certified=!1,EquipmentsPublic.equipmentDetails({eqmtId:$stateParams.eqmtId,t:new Date},function(_data){var auctionStatus="";try{auctionStatus=_data.data[0]._source.sauction.sa}catch(e){console.error("Error 10024	"+e)}$scope.data=_data.data[0]._source,angular.forEach($scope.data.images_large,function(value,key){value.path=value.eue_path,$scope.imageLibrary.push(value)}),$scope.certified=$scope.data.is_certified,_eqmtName=_data.data[0]._source.name,_startDate=_data.data[0]._source.sauction.sa_sdate,_endDate=_data.data[0]._source.sauction.sa_edate,updateStatus(_startDate,_endDate),title("Auction for "+$scope.data.manufacturer+" "+$scope.data.name+" online : irontread.com"),""!==auctionStatus&&("outauction"===auctionStatus||"singlebidder"===auctionStatus||"auctioncancel"===auctionStatus||"auctionclosed"===auctionStatus||"zerobidder"===auctionStatus)&&($scope.UserId===$scope.data.owner||$scope.UserId===$scope.data.admin?$state.go("search.dash.auctionEquipList",{tabName:"inauction"},{reload:!0}):$state.go("search.dash.auctionHall",{tabName:"history"},{reload:!0}))}),$scope.certificationData=[],$scope.imageCount=function(img){if(img){var _image=img;return"string"==typeof img&&(_image=JSON.parse(img)),_image}},$scope.certiData=[],$scope.certivalue=[];var dupData=[];$scope.getImage=function(data,image){("undefined"==typeof $scope.certiData[data]||0===$scope.certiData[data].length)&&($scope.certiData[data]=[]);var _image=[];image&&(_image="string"==typeof image?JSON.parse(image):image),_image.length>0&&-1===dupData.indexOf(data+_image[0].imageId)&&angular.forEach(_image,function(imgItems){$scope.certiData[data].push(imgItems),dupData.push(data+imgItems.imageId),$scope.imageLibrary.push(imgItems)})},$scope.getproductcertification=function(){EquipmentsPublic.getproductcertification({equipmentId:$state.params.eqmtId},function(res){200===res.status.statusCode&&($scope.certificationData=res.data)})},$scope.getproductcertification(),$scope.openLightboxModal=function(){var pictures=document.querySelector(".slides"),options={modal:!0,url:"data-original"};new window.Viewer(pictures,options)},$scope.checkBlank=function(strData){var strDataStatus=!1;return"undefined"!=typeof strData&&""!==strData&&(strDataStatus=!0),strDataStatus};var addEventListener=function(element,type,handler){element.addEventListener?element.addEventListener(type,handler,!1):element.attachEvent&&element.attachEvent("on"+type,handler)};$scope.openLightboxModalImage=function(imagesList){"string"==typeof imagesList&&(imagesList=JSON.parse(imagesList)),makeUL(imagesList),setTimeout(function(){var pictures=document.querySelector(".fake");new window.Viewer(pictures,{modal:!0,url:"src"});$(".fake ul li:first img").click(),addEventListener(pictures,"hide",function(e){$(document).find(".fake").remove()}),addEventListener(pictures,"hidden",function(e){$(document).find(".fake").remove()})},500)};var clock,pageReload=function(){$timeout(function(){$state.go($state.current,{},{reload:!0})},1e3)},timerSafe=0;$scope.timerFun=function(s,e,c){var currentTime="undefined"===c?moment():moment(c);currentTime<moment(s)?$scope.diff=Math.round(moment(s).diff(moment())/1e3):currentTime>moment(s)&&currentTime<moment(e)?$scope.diff=Math.round(Math.abs(moment(e).diff(moment())/1e3)):currentTime>moment(s)&&currentTime>moment(e)&&($scope.diff=0);try{moment().diff(moment(e))>-1&&5>timerSafe&&(timerSafe++,$timeout(pageReload,1e3*$scope.diff))}catch(e){console.error("Error 10025	"+e)}$(document).ready(function(){clock=$(".clock").FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){}}})})},$scope.newTime="",$scope.time=function(time){moment(time,"DD-MM-YYYY hh:mm A",!0).isValid()?$scope.newTime=moment(time,"DD-MM-YYYY hh:mm A").format("hh:mm A"):$scope.newTime="--:--"},$scope.getEquip={},EquipmentsPublic.getSAEquip({eid:$stateParams.eqmtId},function(res){200===res.status.statusCode&&($scope.getEquip=res.data)}),$scope.getParticipants={},$scope.getParticipants.isowner=!1,$scope.getParticipants.iserror=!0,$scope.getParticipants.ishide=!1,$scope.userLoginValidate=AuthenticationService.isLogged(),$rootScope.$on("validateLogin",function(event,data){$scope.userLoginValidate=data.isLoggedIn,$scope.isLoggedIn=data.isLoggedIn,$scope.isLoggedIn&&$scope.getParticipantsFun()}),$rootScope.$on("loginData",function(event,data){$scope.userLoginValidate=data,$scope.userLoginValidate&&$scope.getParticipantsFun()});var promise="";$scope.getParticipantsFun=function(){Equipments.getParticipants({eid:$stateParams.eqmtId},function(res){200===res.status.statusCode?(promise=res.data.isowner,$scope.getParticipants="object"==typeof res.data?res.data:{},$scope.getParticipants=null===$scope.getParticipants?{}:$scope.getParticipants,$scope.getParticipants.iserror="undefined"==typeof $scope.getParticipants.iserror?!1:!0,1===res.data.parti_payment&&"undefined"!=typeof res.data.warningMsg&&($scope.getParticipants.successmessage=res.data.warningMsg)):($scope.errMsg="string"==typeof res.data?res.data:"",$scope.errMsg.indexOf("not confirm by")>-1&&$state.go("home",{},{reload:!0}),$scope.getParticipants="object"==typeof res.data?res.data:{},$scope.getParticipants=null===$scope.getParticipants?{}:$scope.getParticipants,$scope.getParticipants.iserror="undefined"==typeof $scope.getParticipants.iserror?!0:!1,$scope.getParticipants.message=res.status.statusMessage,$scope.getParticipants.showPayment=!0)},function(err){$scope.getParticipants.isowner=!1,$scope.getParticipants.iserror=!0,$scope.getParticipants.ishide=!1})},$scope.userLoginValidate&&$scope.getParticipantsFun(),$scope.init(),$scope.addBidPrice=function(amount){var newval=999;try{newval=parseInt("undefined"!=typeof $scope.getParticipants.maxBidPrice?$scope.getParticipants.maxBidPrice:0)+999}catch(e){console.error("Error 10025	"+e)}if(amount>newval&&$scope.user.price>newval){if(amount>1e10)return $scope.Error="Limit Exceeded.",Notification.error("Limit Exceeded.");Equipments.addParticipantBidPrice({eid:$stateParams.eqmtId,bidPrice:amount},function(res){200===res.status.statusCode?($scope.getParticipants.maxBidPrice=amount,$scope.getParticipants.currUserLastBid=amount,$scope.user.price="",Notification.success("Price Added.")):Notification.error(res.data)}),$scope.Error=""}else Notification.error("Price must be "+(parseInt(newval)+1)+"+ than current highest bid."),$scope.Error="Price must be "+(parseInt(newval)+1)+"+ than current highest bid."},$rootScope.$on("counter",function(event,message){message.isreload&&pageReload(),"undefined"!=typeof message&&("sAuction"===message.type&&"old"===message.action?angular.forEach($scope.getParticipants.list,function(item,index){item.uid===message.uid&&($scope.getParticipants.list[index].cur_price=message.bidPrice,$scope.getParticipants.list[index].cur_tot_price=message.bidPrice,$scope.getParticipants.list[index].datetime=message.datetime,$scope.getParticipants.list[index].datetime=message.datetime,$scope.getParticipants.maxBidPrice=message.bidPrice)}):"sAuction"===message.type&&"new"===message.action&&$scope.getParticipants.list.push({uid:message.uid,buyer:message.buyer,cur_price:message.bidPrice,cur_tot_price:message.bidPrice,datetime:message.datetime}))}),$scope.sAutionLessee=function(eqmt,getEquip){AuthenticationService.login(function(){$timeout(function(){popup.auction(eqmt,getEquip)},1e3)})};var popup={auction:function(eqmt,getEquip){if(promise)Notification.error("Yor are the owner of this equipment.");else{$uibModal.open({templateUrl:"straightAuctionLessee.popup.html",controller:"straightAuctionLessee",size:"lg",resolve:{data:function(){return{eqmt:eqmt,getEquip:getEquip}}}})}}}}]).controller("straightAuctionLessee",["$scope","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","$modalInstance","data","Notification",function($scope,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathimageurl,$uibModal,$modalInstance,data,Notification){$scope.contextPathimageurl=contextPathimageurl,$scope.eqmt=data.eqmt,$scope.getEquip=data.getEquip,$scope.paymentData={},$scope.paymentData.eid=data.eqmt.key,$scope.paymentData.type="",Equipments.misc({key:"paymentType"},function(res){$scope.paymentType=res.data.value,$scope.paymentData.type=$scope.paymentType[0]}),$scope.saDateFormat=function(d){return"undefined"!=typeof d?moment(d).format("DD/MM/YYYY HH:mm:ss A"):void 0},$scope.onConfirmPaymentSubmit=function(){return"undefined"==typeof $scope.paymentData.eid?(Notification.error("Something wrong, Please retry!"),!1):"undefined"==typeof $scope.paymentData.type?(Notification.error("Please select the Payment Type"),!1):"undefined"==typeof $scope.paymentData.number?(Notification.error("Please enter the "+$scope.paymentData.type),!1):void Equipments.addBidParticipantLessee($scope.paymentData,function(res){200===res.status.statusCode?($modalInstance.dismiss("cancel"),$state.go($state.current,{},{reload:!0})):Notification.error(res.status.statusMessage)})},$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("equipment").controller("CompareController",["$scope","$http","$state","contextPathimageurl","$localStorage","EquipmentsPublic","title","download",function($scope,$http,$state,contextPathimageurl,$localStorage,EquipmentsPublic,title,download){$scope.contextPathimageurl=contextPathimageurl,download(!0),$scope.detailList=function(){EquipmentsPublic.equipmentDetails({eqmtId:$state.params.id},function(_data){$scope.data=_data.data[0]._source,title("Buy, Rent or Finance: "+$scope.data.manufacturer+" "+$scope.data.name+" online : irontread.com")})},$scope.detailList(),$scope.getproductcertification=function(){EquipmentsPublic.getproductcertification({equipmentId:$state.params.id},function(res){200===res.status.statusCode&&($scope.certificationData=res.data)})},$scope.getproductcertification(),$scope.imageCount=function(img){if(img){var _image=JSON.parse(img);return _image}},$scope.imgTest="",$scope.testfunction=function(imageUrl){var img=new Image;img.setAttribute("crossOrigin","anonymous"),img.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height;var ctx=canvas.getContext("2d");ctx.drawImage(this,0,0);var dataURL=canvas.toDataURL("image/jpg");$scope.imgTest=dataURL},img.src=imageUrl},$scope.imgData="",$scope.convertStringToObj=function(strData){strData&&JSON.parse(strData).length>0},$scope.downloadImage=function(imgPath){}}]),angular.module("equipment").controller("userEqmtAddCtrl",["$scope","ipCookie","Equipments","EquipmentsPublic","contextPathimageurl","$q","AuthenticationService","$stateParams","Notification","SweetAlert","$state","$location","title","$rootScope","$anchorScroll","serverType",function($scope,ipCookie,Equipments,EquipmentsPublic,contextPathimageurl,$q,AuthenticationService,$stateParams,Notification,SweetAlert,$state,$location,title,$rootScope,$anchorScroll,serverType){function noWeekendsOrHolidays(date){var noWeekend=$.datepicker.noWeekends(date);return noWeekend[0]?disableDays(date):noWeekend}function disableDays(date){for(var i=0;i<disabledDates.length;i++)if(new Date(disabledDates[i]).toString()===date.toString())return[!1];return[!0]}$scope.contextPathimageurl=contextPathimageurl,$scope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){from.name&&"home"===from.name&&setTimeout(function(){$anchorScroll.yOffset=120,$location.hash("dashboard-middle"),$anchorScroll()},1e3)}),$scope.isBeta="live"!==serverType,$scope.dateformat={changeYear:!0,changeMonth:!0,dateFormat:"dd/mm/yy",changetime:!0},$scope.dateInformat={minDate:1,changeYear:!0,changeMonth:!0,dateFormat:"dd/mm/yy",changetime:!0},$scope.manuYear={minDate:1,maxDate:"+30y",changeYear:!0,changeMonth:!0,dateFormat:"dd/mm/yy",changetime:!0},$scope.arrayYear=[];for(var y=1965;y<=(new Date).getFullYear();y++)$scope.arrayYear.push(y.toString());var disabledDates=[];$scope.minDate="+15D",5===(new Date).getDay()&&($scope.minDate="+17D"),6===(new Date).getDay()&&($scope.minDate="+16D"),0===(new Date).getDay()&&($scope.minDate="+15D");var setDefaultTime=function(obj){var currDay=(new Date).getDay(),mydate=moment().add(15,"days").format("DD/MM/YYYY");5===currDay&&(mydate=moment().add(17,"days").format("DD/MM/YYYY")),6===currDay&&(mydate=moment().add(16,"days").format("DD/MM/YYYY")),0===currDay&&(mydate=moment().add(15,"days").format("DD/MM/YYYY")),obj.straightauction.startTime=mydate};$scope.auctionDateInformat={minDate:$scope.minDate,maxDate:"+365D",changeYear:!0,changeMonth:!0,dateFormat:"dd/mm/yy",changetime:!0,beforeShowDay:noWeekendsOrHolidays},$scope.editEquip=function(index){$state.go("search.dash.usereqmtadd",{eqmtId:$state.params.eqmtId,tab:"basic"},{reload:!0})},$scope.avil={Location:""},$scope.allStates=[],$scope.equipmentID=$stateParams.eqmtId,$scope.tcAuction={},$scope.tcAuction.val=!1,$scope.getDate=function(d){return moment(d).format("DD MMM, YYYY")},$scope.auction_end=moment().format("DD-MM-YYYY HH:mm A"),$scope.goToAuction=function(){$state.go("search.auctiondetails",{eqmtId:$scope.equipmentID},{reload:!0})},$scope.getDateMoment=function(){return moment($scope.eqmt.straightauction.startTime).format("DD-MM-YYYY HH:mm A")},$scope.calfuturedate=function(hours){try{var d=moment($scope.eqmt.straightauction.startTime);$scope.auction_end=moment(d).add(hours,"hours").format("DD-MM-YYYY HH:mm A")}catch(e){console.error("Error 10026	"+e)}},$scope.beforeRenderStartDate=function($view,$dates,$leftDate,$upDate,$rightDate){for(var activeDate=moment().unix(),i=0;i<$dates.length;i++)$dates[i].utcDateValue/1e3<=activeDate.valueOf()&&($dates[i].selectable=!1)},$scope.removeRentalPeriods=function(id){SweetAlert.swal({title:"Are you sure want to delete? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Delete it!",cancelButtonText:"No, Delete!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){if(isConfirm){var req={equipId:$stateParams.eqmtId,rentalPeriod:id};Equipments.removeRentalPeriod(req,function(res){200===res.status.statusCode&&(angular.forEach($scope.eqmt.terms.rental_periods,function(rp,idx){rp.id===id&&$scope.eqmt.terms.rental_periods.splice(idx,1)}),Notification.success("Rental Period Deleted"))})}})};var _eqmtId=$stateParams.eqmtId,_userId=AuthenticationService.getUserId(),_getNextDate=function(){var date=new Date;return date.setMonth(date.getMonth()+1),date},_removeImageIndex=[],_defaultEqmt={disabled:!0,basic:{category:{id:null,name:null},name:{id:null,make:null,equipName:null},othManu:null,othModel:null,nickname:null,eqmtId:null,admin:null,modelYear:null,manufacturer:null,eqmtSerialNo:null,yearofregistration:null,runofequipment:null,mpValue:null,manpower:null,lastmaintenancedate:null,insurancevalid:null,regNo:null,hourMinuteReading:null,eqmtDescription:null},pricing:{inSaleBid:!1,inRentBid:!1,currencyType:"INR",daily:{enabled:!1,price:null},weekly:{enabled:!1,price:null},monthly:{enabled:!1,price:null},yearly:{enabled:!1,price:null},sale:{enabled:!1,price:null},transport:{providing:!1,one_km:null,hundred_km:null,thousand_km:null}},terms:{regisValidUpto:null,workingHourPerDay:10,rentTerms:null,saleTerms:null,mantainance_periods:[{what:null,when:new Date,isDue:!0}],mantainance_document:null,rental_periods:[{startDate:new Date,endDate:_getNextDate()}],min_rental_druation:30},gallery:{upload_images:[],images:[]},location:{position:{available_location:null,country:"India",state:null,city:null,locality:null,lat:null,"long":null}},transportation:{length:null,width:null,height:null,weight:null,hbt_up:null,hbt:null,slbt_up:null,slbt:null,lbt:null,open_truck:null,truck:null,tauras_open:null,tauras20:null,tauras16:null,canter7:null,canter5:null,canter14:null,tata407:null,others:null},straightauction:{basePrice:null,reservePrice:null,duration:0,startTime:new Date,serviceTax:null,straightStatus:"notavailable",isdisabled:!0},defaultImg:null},_errorHandler=function(e){};$scope.addr={locality:null,pincode:null,city:null,state:null},$scope.removeDuplicateCity=function(){for(var test=$scope.addr.city,array=test.split(","),finalArr=[],i=0;i<array.length;i++)array[i]=array[i].trim(),-1===finalArr.indexOf(array[i])&&finalArr.push(array[i]),i===array.length-1&&($scope.addr.city=finalArr.toString())},$scope.removeDuplicateLocality=function(){for(var test=$scope.addr.locality,array=test.split(","),finalArr=[],i=0;i<array.length;i++)array[i]=array[i].trim(),-1===finalArr.indexOf(array[i])&&finalArr.push(array[i]),i===array.length-1&&($scope.addr.locality=finalArr.toString())},$scope.autoCompleteOptions={types:"(cities)",country:"in",place_changed:function(data){$scope.eqmt.location.position.lat=data.geometry.location.lat(),$scope.eqmt.location.position["long"]=data.geometry.location.lng(),$scope.addr.locality="",$scope.addr.city="";var k=0;angular.forEach(data.address_components,function(item){"administrative_area_level_1"===item.types[0]&&($scope.addr.state=item.long_name),",administrative_area_level_2,administrative_area_level_1,".indexOf(item.types[0])>-1&&($scope.addr.city=$scope.addr.city+(""===$scope.addr.city?"":", ")+item.long_name),",sublocality_level_1,locality,administrative_area_level_2,administrative_area_level_1,".indexOf(item.types[0])>-1&&($scope.addr.locality=$scope.addr.locality+(""===$scope.addr.locality?"":", ")+item.long_name),"postal_code"===item.types[0]&&($scope.addr.pincode=item.long_name),k===data.address_components.length-1&&($scope.removeDuplicateCity(),$scope.removeDuplicateLocality()),k+=1}),null!==$scope.addr.state&&angular.forEach($scope.states,function(state){$scope.addr.state===state.stateName&&($scope.eqmt.location.position.state=state)})}},$scope.title=function(){$scope.mainHeader="Add equipment",title("My Account - Add equipment : irontread.com");try{""!==$stateParams.eqmtId&&($scope.mainHeader="Edit equipment",title("My Account - Edit equipment : irontread.com")),"straightauction"===$stateParams.tab&&($scope.mainHeader="Create an auction",title("My Account - Create an auction : irontread.com"))}catch(e){console.error("Error 10027	"+e)}},$scope.title(),$rootScope.$on("$locationChangeSuccess",function(){$scope.title()});var _activeTab=$stateParams.tab;$scope.activeTab=_activeTab,$scope.gallery=!1,$scope.pricing=!1,$scope.terms=!1,$scope.locationTab=!1,$scope.transportationTab=!1,$scope.straightauctionTab=!1,$scope.basic=!0,$scope.changeTab=function(tab){""!==$stateParams.eqmtId&&$state.go($state.current,{tab:tab},{reload:!0})},$scope.selectTab=function(tabName){$scope.gallery=!1,$scope.pricing=!1,$scope.terms=!1,$scope.locationTab=!1,$scope.basic=!1,$scope.straightauctionTab=!1,$scope.transportationTab=!1,"gallery"===$stateParams.tab?(_activeTab="gallery",$scope.gallery=!0):"pricing"===$stateParams.tab?(_activeTab="pricing",$scope.pricing=!0):"terms"===$stateParams.tab?(_activeTab="terms",$scope.terms=!0):"location"===$stateParams.tab?(_activeTab="location",$scope.locationTab=!0):"transportation"===$stateParams.tab?(_activeTab="transportation",$scope.transportationTab=!0):"straightauction"===$stateParams.tab?(_activeTab="straightauction",$scope.straightauctionTab=!0):(_activeTab="basic",$scope.basic=!0)},$scope.isSA=!1,"straightauction"===$stateParams.tab&&($scope.isSA=!0,$scope.mainHeader="Create an auction"),$scope.success=function(){},$scope.setDefaultImage=function(data){Equipments.setDefaultImage(data,function(res){200===res.status.statusCode&&Notification.success("The selected image has been updated as default image of the equipment.")})},$scope.deleteImage=function(data){Equipments.deleteImage(data,function(res){200===res.status.statusCode&&($state.go($state.current,{},{reload:!0}),Notification.warning("The selected image has been deleted as default image of the equipment."))})},$scope.defaults={hours:[],minutes:[],allowedFiles:"",allowedImages:""},$scope.eqmt=_defaultEqmt,"undefined"!=typeof _eqmtId?Equipments.getEqmp({eqmtId:_eqmtId},function(res){if(200===res.status.statusCode){var _emt=res.data;""!==$stateParams.eqmtId&&($scope.addr.locality=_emt.location.position.locality,$scope.addr.city=_emt.location.position.city.city,$scope.avil.Location=_emt.location.position.available_location),angular.forEach(_emt.terms.mantainance_periods,function(mp){mp.when=new Date(mp.when)}),angular.forEach(_emt.terms.rental_periods,function(rp){rp.startDate=new Date(rp.startDate),rp.endDate=new Date(rp.endDate)}),_emt.gallery.uploadImages=[],$scope.eqmt=_emt,"straightauction"===$stateParams.tab&&setDefaultTime($scope.eqmt),_addEqmt.getEquipment(),$scope.$watch("eqmt.gallery.uploadImages",function(newVal,oldVal){newVal!==oldVal&&newVal instanceof Array&&newVal.length>0&&_addEqmt.addEquip($scope.eqmt)}),$scope.eqmt.straightauction.isdisabled="notavailable"===$scope.eqmt.straightauction.straightStatus}},_errorHandler):$scope.$watch("eqmt.gallery.uploadImages",function(newVal,oldVal){newVal!==oldVal&&newVal instanceof Array&&newVal.length>0&&_addEqmt.addEquip($scope.eqmt)}),$scope.goMangeEqip=function(){$state.go("search.dash.usereqmtlist",{},{reload:!0})},$scope.message="Eqmt Add",$scope.makeName=[],$scope.allEquipments=[],$scope.otherId=null,$scope.funEquipments=function(){"~Other"===$scope.eqmt.basic.manufacturer&&($scope.eqmt.basic.manufacturer="Other");try{$scope.equipments=[],$scope.eqmt.basic.name=null,angular.forEach($scope.allEquipments,function(val){val.make===$scope.eqmt.basic.manufacturer&&$scope.equipments.push(val)}),"Other"!==$scope.eqmt.basic.manufacturer&&$scope.equipments.push({equipName:" Other",id:$scope.otherId,make:$scope.eqmt.basic.manufacturer})}catch(e){console.error("Error 10028	"+e)}};var _addEqmt={getCat:function(){EquipmentsPublic.getCat({},function(res){200===res.status.statusCode&&($scope.cats=res.data)},_errorHandler)},getEquipment:function(data){Equipments.getEquipment({cat_id:$scope.eqmt.basic.category.id},function(res){200===res.status.statusCode&&(""===_eqmtId&&($scope.eqmt.basic.manufacturer=null,$scope.eqmt.basic.name=null),$scope.allEquipments=res.data,$scope.equipments=res.data,$scope.makeName=[],angular.forEach(res.data,function(val){-1===$scope.makeName.indexOf(val.make)&&($scope.makeName.push("Other"===val.make?"~Other":val.make),$scope.makeName=$scope.makeName.sort()),"Other"===val.make.trim()&&($scope.otherId=val.id)}),$scope.equipments=[])},_errorHandler)},getAdministrator:function(){Equipments.getAdministrator({userId:_userId},function(res){if(200===res.status.statusCode){var userId=ipCookie("userCId"),userName=ipCookie("userCName"),admin={id:userId,userName:userName};res.data.push(admin),$scope.administrators=res.data}},_errorHandler)},getState:function(){Equipments.getState({},function(res){200===res.status.statusCode&&($scope.states=res.data,angular.forEach(res.data,function(val){$scope.allStates.push(val.stateName)}))},_errorHandler)},getCity:function(){Equipments.getCity({stateId:$scope.eqmt.location.position.state.id},function(res){200===res.status.statusCode&&($scope.cities=res.data)},_errorHandler)},removeFile:function(index){$scope.eqmt.gallery.uploadImages.splice(index,1)},removeImage:function($index){_removeImageIndex.push($index),_addEqmt.addEquip($scope.eqmt),Notification.success("Image Removed")},addMaintainence:function(){$scope.eqmt.terms.mantainance_periods.push({what:"",when:new Date,isDue:!0}),Notification.success("Maintainence Added")},addRentalPeriod:function(){$scope.eqmt.terms.rental_periods.push({startDate:new Date,endDate:_getNextDate()}),Notification.success("Rental Period Added")},loadCities:function(query){var deffered=$q.defer();return Equipments.getCityHint({
hint:query},function(cities){deffered.resolve(cities)}),deffered.promise},addEquip:function(eqmt){$scope.eqmtSerialNo=eqmt.basic.eqmtId;var req,reqObj;if("basic"===_activeTab){if(null===eqmt.basic.category.id)return void Notification.error("Category is Mandatory.");if(null===eqmt.basic.admin)return void Notification.error("Please select an Admin.");if(null===eqmt.basic.manufacturer)return void Notification.error("Manufacturer is Mandatory");if(null===eqmt.basic.name)return void Notification.error("Model is Mandatory");if(parseInt(eqmt.basic.modelYear)<1965)return void Notification.error("Equipment Manufactured after 1965 is accept.");if(eqmt.basic.yearofregistration&&parseInt(eqmt.basic.modelYear)>parseInt(eqmt.basic.yearofregistration))return void Notification.error("Year of Manufacturer should be lesser then Year of Registration");"Other"===eqmt.basic.name.equipName.trim()&&"Other"!==eqmt.basic.manufacturer.trim()&&(eqmt.basic.othManu=eqmt.basic.manufacturer),eqmt.basic.yearofregistration||(eqmt.basic.yearofregistration=""),reqObj={category:{id:eqmt.basic.category.id,name:eqmt.basic.category.catName},eqmt:{id:eqmt.basic.name.id,name:eqmt.basic.name.equipName,make:eqmt.basic.name.equipName},othManu:eqmt.basic.othManu,othModel:eqmt.basic.othModel,eqmtSerialNo:eqmt.basic.eqmtSerialNo,modelYear:eqmt.basic.modelYear,manufacturer:eqmt.basic.manufacturer,nickname:eqmt.basic.nickname,regNo:eqmt.basic.regNo,yearofregistration:eqmt.basic.yearofregistration,runofequipment:eqmt.basic.runofequipment,hourMinuteReading:eqmt.basic.hourMinuteReading,mpValue:eqmt.basic.mpValue,manpower:eqmt.basic.manpower,lastmaintenancedate:moment(eqmt.basic.lastmaintenancedate).format("DD/MM/YYYY"),insurancevalid:moment(eqmt.basic.insurancevalid).format(),eqmtDescription:eqmt.basic.eqmtDescription,admin:{id:eqmt.basic.admin.id,userName:eqmt.basic.admin.userName}},req={userId:_userId,type:_activeTab,params:JSON.stringify(reqObj)},"undefined"==typeof req.id&&(req.eqmtId=eqmt.id)}if(eqmt.pricing.daily.enabled!==!0&&eqmt.pricing.weekly.enabled!==!0&&eqmt.pricing.monthly.enabled!==!0&&eqmt.pricing.yearly.enabled!==!0?eqmt.pricing.inRentBid=!1:eqmt.pricing.inRentBid=!0,"pricing"===_activeTab){if(eqmt.pricing.sale.enabled!==!0&&eqmt.pricing.daily.enabled!==!0&&eqmt.pricing.weekly.enabled!==!0&&eqmt.pricing.monthly.enabled!==!0&&eqmt.pricing.yearly.enabled!==!0)return void Notification.error("Atleast one process must be selected to proceed.");if("0"===eqmt.pricing.daily.price||"0"===eqmt.pricing.monthly.price||"0"===eqmt.pricing.sale.price)return void Notification.error("Price must be greater than 0.");reqObj={inSaleBid:eqmt.pricing.inSaleBid,inRentBid:eqmt.pricing.inRentBid,currencyType:eqmt.pricing.currencyType,daily:{enabled:eqmt.pricing.daily.enabled,price:eqmt.pricing.daily.price},weekly:{enabled:eqmt.pricing.weekly.enabled,price:eqmt.pricing.weekly.price},monthly:{enabled:eqmt.pricing.monthly.enabled,price:eqmt.pricing.monthly.price},yearly:{enabled:eqmt.pricing.yearly.enabled,price:eqmt.pricing.yearly.price},sale:{enabled:eqmt.pricing.sale.enabled,price:eqmt.pricing.sale.price},transport:{providing:!0,one_km:eqmt.pricing.transport.one_km,hundred_km:eqmt.pricing.transport.hundred_km,thousand_km:eqmt.pricing.transport.thousand_km}},req={eqmtId:eqmt.id,userId:_userId,type:_activeTab,params:JSON.stringify(reqObj)}}if("terms"===_activeTab&&(reqObj={rental_periods:eqmt.terms.rental_periods,min_rental_druation:eqmt.terms.min_rental_druation,regisValidUpto:eqmt.terms.regisValidUpto,workingHourPerDay:eqmt.terms.workingHourPerDay,mantainance_periods:eqmt.terms.mantainance_periods},req={eqmtId:eqmt.id,userId:_userId,rentTerms:eqmt.terms.rentTerms,saleTerms:eqmt.terms.saleTerms,mantainance_document:eqmt.terms.mantainance_document,type:_activeTab,params:JSON.stringify(reqObj)}),"gallery"===_activeTab&&(reqObj={remove_small:_removeImageIndex.map(function(idx){return eqmt.gallery.small_images[idx].id}),remove_medium:_removeImageIndex.map(function(idx){return eqmt.gallery.images[idx].id}),remove_large:_removeImageIndex.map(function(idx){return eqmt.gallery.large_images[idx].id})},req={eqmtId:eqmt.id,userId:_userId,images:eqmt.gallery.uploadImages,type:_activeTab,params:JSON.stringify(reqObj)}),"location"===_activeTab&&(reqObj={available_location:$scope.avil.Location,country:"India",state:eqmt.location.position.state.stateName,city:$scope.addr.city,pincode:$scope.addr.pincode,locality:$scope.addr.locality,lat:eqmt.location.position.lat,"long":eqmt.location.position["long"]},req={eqmtId:eqmt.id,userId:_userId,type:_activeTab,params:JSON.stringify(reqObj)}),"transportation"===_activeTab&&(reqObj={length:eqmt.transportation.length,width:eqmt.transportation.width,height:eqmt.transportation.height,weight:eqmt.transportation.weight,hbt_up:eqmt.transportation.hbt_up,hbt:eqmt.transportation.hbt,slbt_up:eqmt.transportation.slbt_up,slbt:eqmt.transportation.slbt,lbt:eqmt.transportation.lbt,open_truck:eqmt.transportation.open_truck,truck:eqmt.transportation.truck,tauras_open:eqmt.transportation.tauras_open,tauras20:eqmt.transportation.tauras20,tauras16:eqmt.transportation.tauras16,canter7:eqmt.transportation.canter7,canter5:eqmt.transportation.canter5,canter14:eqmt.transportation.canter14,tata407:eqmt.transportation.tata407,others:eqmt.transportation.others},req={eqmtId:eqmt.id,userId:_userId,type:_activeTab,params:JSON.stringify(reqObj)}),"straightauction"===_activeTab&&!eqmt.straightauction.isdisabled){if(parseFloat(eqmt.straightauction.basePrice)<1)return Notification.error("Please enter the valid Base price"),!1;if(parseFloat(eqmt.straightauction.reservePrice)<1)return Notification.error("Please enter the valid Reserved price"),!1;if(parseFloat(eqmt.straightauction.basePrice)+999>parseFloat(eqmt.straightauction.reservePrice))return Notification.error("Reserve price should be greater then "+(parseFloat(eqmt.straightauction.basePrice)+1e3)+"."),!1;if(parseFloat(eqmt.straightauction.serviceTax)<1||parseFloat(eqmt.straightauction.serviceTax)>100)return Notification.error("Please enter the valid Applicable Tax"),!1;reqObj={basePrice:eqmt.straightauction.basePrice,reservePrice:eqmt.straightauction.reservePrice,startTime:eqmt.straightauction.startTime,serviceTax:eqmt.straightauction.serviceTax},req={eqmtId:eqmt.id,userId:_userId,type:_activeTab,params:JSON.stringify(reqObj)}}Equipments.addEquip(req,function(res){200===res.status.statusCode?"basic"===_activeTab?($scope.eqmt.id=res.data.id,$scope.eqmt.disabled=!1,res.data["new"]&&$state.go("search.dash.usereqmtadd",{eqmtId:res.data.id},{reload:!1}),Notification.success("Basic info has been updated.")):"gallery"===_activeTab?("undefined"!=typeof res.data.gallery&&($scope.eqmt.gallery.images.unshift(res.data.gallery.images),$scope.eqmt.gallery.small_images.unshift(res.data.gallery.small_images),$scope.eqmt.gallery.large_images.unshift(res.data.gallery.large_images),$scope.eqmt.gallery.uploadImages=[]),"undefined"!=typeof res.data.removed_images&&"success"===res.data.removed_images&&angular.forEach(_removeImageIndex,function(index){$scope.eqmt.gallery.images.splice(index,1),$scope.eqmt.gallery.small_images.splice(index,1),$scope.eqmt.gallery.large_images.splice(index,1)}),$state.go($state.current,{tab:"gallery"},{reload:!0}),Notification.success("Form is Updated.")):"location"===_activeTab?Notification.success("Location has been updated."):"terms"===_activeTab?Notification.success("Equipment Documents has been updated."):"pricing"===_activeTab?Notification.success("Pricing has been updated."):"transportation"===_activeTab?Notification.success("Transportation has been updated."):"straightauction"===_activeTab&&Equipments.straightAuctionPayment({eid:_eqmtId},function(res){$state.go("search.thankyouSA",{userType:"lessor",paymentType:"emd",eid:_eqmtId})}):413===res.status.statusCode?Notification.success("Flie size is to large."):205===res.status.statusCode?Notification.success("Nothing updated."):"straightauction"===_activeTab?Notification.error(res.status.statusMessage):""!==res.data.msg&&Notification.error(res.data.msg)},_errorHandler)}};$scope.checkAccountField=function(eqmt){Equipments.accountCheck({},function(res){200===res.status.statusCode&&(res.data===!0?$scope.equipmentData.addEquip(eqmt):(SweetAlert.swal({title:"<div style='font-size:14px;'>Banking and Documentation field needs to be updated first before proceeding for transaction.<br/>This is required for the site to process refund payments (if applicable) and generate invoice.<br>In case you wish to proceed without updating your refund and invoice will not be available unless these fields are updated.</div>",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"PROCEED ANYWAY",cancelButtonText:"UPDATE DETAILS",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm?$scope.equipmentData.addEquip(eqmt):window.location.href="/myaccount/lessor/userverification#Banking-Details"}),$(document).find(".sweet-alert").css({"margin-left":parseInt($(document).find(".sweet-alert").css("marginLeft"))-100+"px"})))},_errorHandler)};var _init=function(){for(var i=1;24>=i;i++)$scope.defaults.hours.push(i);for(var j=1;60>=j;j++)$scope.defaults.minutes.push(j);_addEqmt.getCat(),_addEqmt.getAdministrator(),_addEqmt.getState()};_init(),$scope.equipmentData=_addEqmt}]),angular.module("equipment").controller("eqmtDetailCtrl",["$scope","Equipments","EquipmentsPublic","ipCookie","$stateParams","$state","$uibModal","AuthenticationService","contextPathimageurl","contextPathPdf","$location","rentRequest","title","Notification","$rootScope","Lightbox","$timeout","fenvType","SweetAlert","description",function($scope,Equipments,EquipmentsPublic,ipCookie,$stateParams,$state,$uibModal,AuthenticationService,contextPathimageurl,contextPathPdf,$location,rentRequest,title,Notification,$rootScope,Lightbox,$timeout,fenvType,SweetAlert,description){function makeUL(array){try{var fake=document.createElement("div");fake.className="fake";for(var list=document.createElement("ul"),i=0;i<array.length;i++){var item=document.createElement("li"),img=document.createElement("img");img.setAttribute("src",$scope.contextPathimageurl+array[i].path),item.appendChild(img),list.appendChild(item)}fake.appendChild(list),$("body").append(fake)}catch(e){console.error("Unable to create images list")}}var _errorHandler=function(e){alert(e.statusMessage)},_sessionId=ipCookie("tempsession"),_userId=ipCookie("userCId"),_startDate="",_endDate="",_willbeback="",dupData=[],addEventListener=function(element,type,handler){element.addEventListener?element.addEventListener(type,handler,!1):element.attachEvent&&element.attachEvent("on"+type,handler)};$scope.strAbsUrl=$location.absUrl(),$scope.contextPathimageurl=contextPathimageurl,$scope.fenvType=fenvType,$scope.Math=window.Math,$scope.breadCrumb=[],$scope.auctionStarted=!0,$scope.data=[],$scope.finance="",$scope.images=[],$scope.type=$location.search().type?$location.search().type:$stateParams.type,$scope.catId=null,$scope.diff="",$scope.diffR="",$scope.certificationData=[],$scope.specData="",$scope.noResult=!1,$scope.daysDiff=0,$scope.imageLibrary=[],$scope.isInspectionLinkValid=!1,$scope.titleName=[],$scope.certiData=[],$scope.certivalue=[],$scope.imgTest="",$scope.equipmentId=$stateParams.equipmentId,$scope.isNew="new"===$location.search().type,EquipmentsPublic.isInspectionLinkValid({eqmtId:$stateParams.equipmentId},function(res){200===res.status.statusCode&&($scope.isInspectionLinkValid=!0)}),$scope.scrollbarConfig={setHeight:300,theme:"dark",axis:"y",scrollInertia:200},$scope.updateObjects=function(){var diffDays,startDatenew=$scope.duration.startDate,endDatenew=$scope.duration.endDate;try{diffDays=moment(endDatenew).diff(startDatenew,"days")}catch(e){diffDays=0}$scope.daysDiff=diffDays},$scope.detailList=function(){EquipmentsPublic.equipmentDetails({eqmtId:$stateParams.equipmentId,dateForm:$stateParams.dateForm},function(_data){$scope.data=_data.data[0]._source,$scope.certified=$scope.data.is_certified,"available"!==$scope.data.islisted&&($scope.noResult=!0),$scope.catId=$scope.data.category_id,angular.forEach($scope.data.images_large,function(value){value.path=value.eue_path,$scope.imageLibrary.push(value)}),_startDate=_data.data[0]._source.sauction.sa_sdate,_endDate=_data.data[0]._source.sauction.sa_edate,_willbeback=_data.data[0]._source.willbeback,"inauction"===$scope.data.sauction.sa?($scope.auctionStarted=!0,$scope.auctionTimer(_endDate)):$scope.auctionStarted=!1,$scope.willbebackTimer(_willbeback),$scope.breadCrumbfun($scope.data.manufacturer,$scope.data.name,$scope.data.description,$scope.data.eqmp_id),$scope.$watch("type",function(newval){newval=newval?newval:"buy";try{newval&&"rent"===newval.toString()&&0===$scope.data.for_rent&&(0!==$scope.data.for_sale&&$state.go($state.current,{type:"buy"},{reload:!1}),Notification.error("This equipment is not available for rent.")),newval&&"buy"===newval.toString()&&0===$scope.data.for_sale&&(0!==$scope.data.for_sale&&$state.go($state.current,{type:"rent"},{reload:!1}),Notification.error("This equipment is not available for sale."))}catch(e){console.error("Error ED 154	"+e)}})})},$scope.getproductcertification=function(){EquipmentsPublic.getproductcertification({equipmentId:$stateParams.equipmentId},function(res){200===res.status.statusCode&&($scope.certificationData=res.data)})},$scope.getproductcertification(),$scope.replaceDecimal=function(value){var _value=value.split(" ")[0];if(!isNaN(_value)&&value.indexOf(" ")>0){var parsed=parseFloat(_value).toFixed(2),input=Math.round(100*parsed)/100;return input=input+" "+value.split(" ")[1]}return value},$scope.imageCount=function(img){return img&&"string"==typeof img?JSON.parse(img):img},$scope.testfunction=function(imageUrl){var img=new Image;img.setAttribute("crossOrigin","anonymous"),img.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height;var ctx=canvas.getContext("2d");ctx.drawImage(this,0,0),$scope.imgTest=canvas.toDataURL("image/jpg")},img.src=imageUrl},$scope.downloadImage=function(image){if(image){var _image=JSON.parse(image);if(_image.length>0){var img=_image[0].path;return img=img.replace(".","_thumb.")}}},$scope.downloadPdf=function(_id){$state.go("compare",{id:_id},{reload:!0})},$scope.getImage=function(data,image){("undefined"==typeof $scope.certiData[data]||0===$scope.certiData[data].length)&&($scope.certiData[data]=[]);var _image=[];image&&(_image="string"==typeof image?JSON.parse(image):image),_image.length>0&&-1===dupData.indexOf(data+_image[0].imageId)&&angular.forEach(_image,function(imgItems){$scope.certiData[data].push(imgItems),dupData.push(data+imgItems.imageId),$scope.imageLibrary.push(imgItems)})},angular.element(document).on("click",".viewer-close",function(e){angular.element(document.querySelector(".fake"))&&(angular.element(document.querySelector("body")).removeClass("viewer-open"),angular.element(document.querySelector(".viewer-container"))&&(angular.element(document.querySelectorAll(".viewer-container")).removeClass("viewer-in").addClass("viewer-hide"),angular.element(document.querySelector(".fake")).next(".viewer-container").remove(),angular.element(document.querySelectorAll(".fake")).remove()))}),$scope.checkBlank=function(strData){var strDataStatus=!1;return strData&&(strDataStatus=!0),strDataStatus},$scope.tentativePrice=function(rates){$scope.updateObjects();var rate=0,days=$scope.daysDiff,d=rates.daily,m=rates.monthly;if(0===days)return{val:"Invalid Days."};try{if(30>days){if("undefined"!=typeof d)return rate=Math.round(days*d)}else if("undefined"!=typeof m)return rate=Math.round(days/30*m)}catch(e){return console.error("Error 10029	"+e),-1}};var viewer=[];$scope.openLightboxModalImage=function(imagesList){"string"==typeof imagesList&&(imagesList=JSON.parse(imagesList)),makeUL(imagesList),setTimeout(function(){var pictures=document.querySelector(".fake");addEventListener(pictures,"hide",function(e){e.preventDefault(),$(document).find(".fake").remove()}),addEventListener(pictures,"hidden",function(e){e.preventDefault(),$(document).find(".fake").remove()}),viewer.push(new window.Viewer(pictures,{modal:!0,url:"src"})),$(".fake ul li:first img").click()},500)};var gViewer=null;$scope.openLightboxModal=function(data){var pictures=document.querySelector(".slides"),options={modal:!0,url:"data-original"};gViewer?(gViewer.destroy(),gViewer=new window.Viewer(pictures,options)):gViewer=new window.Viewer(pictures,options)},$scope.auctionTimer=function(endDate){$scope.diff=Math.abs(moment(endDate).diff(moment())/1e3);$(document).ready(function(){var clock;clock=$(".clock").FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed.")}}})})},$scope.willbebackTimer=function(_willbeback){$scope.diffR=Math.abs(moment(_willbeback).diff(moment())/1e3),$(document).ready(function(){$(".clock1").FlipClock($scope.diffR,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Completed.")}}})})},$scope.specifications=function(cat,manu,equip,desc){EquipmentsPublic.getequipspec({equipId:$stateParams.equipmentId},function(res){200===res.status.statusCode&&($scope.specData=res.data,description(cat+" "+manu+" "+equip+" "+desc+" "+$scope.specData))})},$scope.breadCrumbfun=function(manu,equipName,desc,eqipId){EquipmentsPublic.getBreadCrumb({equipid:$stateParams.equipmentId},function(res){200===res.status.statusCode&&($scope.breadCrumb=res.data,angular.forEach($scope.breadCrumb,function(data){$scope.titleName.push(data.name);var temp=$scope.type?$scope.type.toUpperCase():"";title(eqipId+" "+temp+" "+$scope.titleName.join(" ")+" "+manu+" "+equipName+" online - Irontread.com"),$scope.specifications($scope.titleName,manu,equipName,desc)}))},_errorHandler)},$scope.filterPrice=function(data){var result={};return angular.forEach(data,function(value,key){value.hasOwnProperty("_id")||(result[key]=value)}),result},$scope.openBuyNow=function(data,direct){AuthenticationService.login(function(){if(""===fenvType){var cbToPayment=function(){$state.go("logo.payment",{orderId:"",rtype:"buyer",ptype:"db",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})};$scope.addCart("solo",data,cbToPayment)}else $uibModal.open({templateUrl:"emdBuyer.popup.html",controller:"emdBuyerController",size:"md",resolve:{eObj:data,direct:direct}})})},$scope.sendAnEnquiry=function(data){AuthenticationService.login(function(){$uibModal.open({templateUrl:"sendAnEnquiry.popup.html",controller:"sendAnEnquiryCtrl",size:"md",resolve:{equip:function(){return data}}})})},$scope.auctionprocess=function(eqmtid){AuthenticationService.login(function(){Equipments.checkUserInSAuction({eid:$stateParams.equipmentId},function(res){200===res.status.statusCode&&(res.data.isOwner===!0&&res.data.isParticipate===!1?$state.go("search.auctiondetails",{eqmtId:eqmtid,reqUserType:"lessee"},{reload:!0}):res.data.isOwner===!1&&res.data.isParticipate===!0?$state.go("search.auctiondetails",{eqmtId:eqmtid,reqUserType:"lessee"},{reload:!0}):$state.go("logo.payment.paymentauction",{equipmentId:eqmtid,reqUserType:"lessee"},{reload:!0}))})})},$scope.newfinance=function(_eqmtid,_price){AuthenticationService.login(function(){$uibModal.open({templateUrl:"financeForm.popup.html",controller:"userFinanceRequest",size:"md",resolve:{eqmtid:function(){return _eqmtid},price:function(){return _price}}})})},$scope.isEquipInAuction=function(){EquipmentsPublic.isEquipInAuction({eid:$stateParams.equipmentId},function(res){200===res.status.statusCode&&($scope.isEquipInAuction=res.data)})},$scope.addCart=function(orderType,data,cbToPayment){$scope.type="buy";var soloEquipId=data.key,equipId=soloEquipId;if($scope.rentDurationCart={},"bid"===orderType&&(equipId=$stateParams.equipmentId),"rent"===$scope.type){var _durationStart=moment($scope.duration.startDate).format("DD/MM/YYYY"),_durationEnd=moment($scope.duration.endDate).format("DD/MM/YYYY");$scope.rentDurationCart.startDate=_durationStart,$scope.rentDurationCart.endDate=_durationEnd}"buy"===$scope.type&&($scope.rentDurationCart={}),$scope.userLoginValidate===!0?Equipments.addcartp({sessionId:_sessionId,categeoryId:data.category_id,equipmentId:equipId,duration:$scope.rentDurationCart,trasactionType:$scope.type,requestType:orderType,locationCity:$scope.addr.city,locationState:$scope.addr.state},function(res){200===res.status.statusCode?cbToPayment():Notification.error(res.status.statusMessage)}):EquipmentsPublic.addCartItems({sessionId:_sessionId,categeoryId:data.category_id,equipmentId:equipId,duration:$scope.rentDurationCart,trasactionType:$scope.type,requestType:orderType,locationCity:$scope.addr.city,locationState:$scope.addr.state},function(res){200===res.status.statusCode?cbToPayment():Notification.error(res.status.statusMessage)})},$scope.openRentPopup=function(data){AuthenticationService.login(function(){$uibModal.open({templateUrl:"requestRent.popup.html",controller:"rentPopup",size:"md",resolve:{data:function(){return $scope.data}}})})},$scope.loginCart=function(){Equipments.logincart({sessionId:_sessionId},function(res){})},$scope.inspectionImage=function(data,index){$uibModal.open({templateUrl:"inspectionImage.popup.html",controller:"inspectionImageCtrl",size:"lg",resolve:{data:function(){return data},index:function(){return index}}})},$scope.addToWishList=function(wishData){AuthenticationService.login(function(){$uibModal.open({templateUrl:"equipDetail.popup.html",controller:"eqdetailWishListCtrl",size:"md",resolve:{wishData:function(){return $scope.data}}})})},$scope.addToInterested=function(equipData){AuthenticationService.login(function(){var eId=equipData.key;SweetAlert.swal({title:"Are you interested?",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm?$scope.saveInterested(eId,!0):$scope.saveInterested(eId,!1)})})},$scope.saveInterested=function(equipId,uStatus){Equipments.addInterested({equipmentId:equipId,uStatus:uStatus},function(res){200===res.status.statusCode?Notification.success(res.data):Notification.error(res.data)})},$rootScope.$on("validateLogin",function(event,data){$scope.isLoggedIn=data.isLoggedIn,$scope.isLoggedIn&&$scope.loginCart()}),$rootScope.$on("$locationChangeSuccess",function(){$scope.type=$location.search().type}),$scope.$watch("type",function(newval,oldval){if(newval!==oldval){var tempUrl=$location.url();"rent"===newval?tempUrl=tempUrl.replace("-new","-rental").replace("-for-sale","-rental"):"buy"===newval?tempUrl=tempUrl.replace("-new","-for-sale").replace("-rental","-for-sale"):"new"===newval&&(tempUrl=tempUrl.replace("-rental","-new").replace("-for-sale","-new")),$location.url(tempUrl)}}),void 0!==$location.search()["duration-start"]&&void 0!==$location.search()["duration-end"]?$scope.duration={startDate:new Date(moment($location.search()["duration-start"].replace(/%2F/g,"/"),"DD/MM/YYYY")),endDate:new Date(moment($location.search()["duration-end"].replace(/%2F/g,"/"),"DD/MM/YYYY"))}:$scope.duration={startDate:"",endDate:""},_userId?$scope.userLoginValidate=!0:($scope.userLoginValidate=AuthenticationService.isLogged(),$rootScope.$on("validateLogin",function(event,data){$scope.userLoginValidate=data.isLoggedIn}),$rootScope.$on("loginData",function(event,data){$scope.userLoginValidate=data}),$scope.$watch("AuthenticationService.isLoggedIn",function(){$scope.userLoginValidate=AuthenticationService.isLoggedIn})),$scope.init=function(){$scope.isEquipInAuction(),$scope.detailList(),$scope.specifications(),$(".flex-main .flexslider-container .flexslider .flex-viewport .slides .flex-active-slide a  img:first").load(function(){$(".flex-main .flexslider-container .flexslider .flex-viewport").height($(this).height())})},$scope.init()}]),angular.module("equipment").config(["LightboxProvider",function(LightboxProvider){LightboxProvider.templateUrl="lightbox-modal.html",LightboxProvider.calculateImageDimensionLimits=function(dimensions){return{maxWidth:dimensions.windowWidth>=768?dimensions.windowWidth-92:dimensions.windowWidth-52,maxHeight:1600}},LightboxProvider.calculateModalDimensions=function(dimensions){var width=Math.max(400,dimensions.imageDisplayWidth+32);return(width>=dimensions.windowWidth-20||dimensions.windowWidth<768)&&(width="auto"),{width:width,height:"auto"}}}]),angular.module("equipment").controller("LightboxCtrl",["$scope","$window",function($scope,$window){function initImage(){$("#image").apImageZoom({cssWrapperClass:"custom-wrapper-class"})}$(document).ready(function(){setTimeout(function(){initImage()},500)}),$("#zoom-in").click(function(){$("#image").apImageZoom("zoomIn")}),$("#zoom-out").click(function(){$("#image").apImageZoom("zoomOut")}),$("#reset").click(function(){$("#image").apImageZoom("reset")})}]),angular.module("equipment").controller("eqdetailWishListCtrl",["$scope","Equipments","EquipmentsPublic","$stateParams","$state","$uibModal","$modalInstance","wishData","ipCookie","contextPathimageurl","$rootScope",function($scope,Equipments,EquipmentsPublic,$stateParams,$state,$uibModal,$modalInstance,wishData,ipCookie,contextPathimageurl,$rootScope){var _userId=ipCookie("userCId");$scope.wishItem=wishData,$scope.wish={},$scope.wish.wishListItem="",$scope.userWishList=[],$scope.contextPathimageurl=contextPathimageurl,wishData&&($scope.currentView="addWishList"),$scope.imgScr="img/no_image_small.png";try{angular.forEach(wishData.images_thumbnail,function(imgItem){$scope.imgScr=contextPathimageurl+imgItem.eue_path})}catch(e){$scope.imgScr="img/no_image_small.png"}$scope.addWishList=function(){Equipments.addWishList({userId:_userId,wishListName:$scope.wish.wishListItem},function(resData){200===resData.status.statusCode?($scope.wish.wishListItem="",$scope.allWishList()):alert(resData.data)})},$scope.allWishList=function(){Equipments.getUserWishList({userId:_userId},function(_data){$scope.userWishList=_data.data[0].eu_wishlist})},$scope.allWishList(),$scope.opensaveWishList=function(wishItem){Equipments.addEquipmentInWishList({userId:_userId,wishListId:$scope.userWishList[wishItem.index]._id,equipmentId:$scope.wishItem.key,note:wishItem.note},function(resData){200===resData.status.statusCode?$scope.currentView="saveWishList":alert(resData.data)}),$scope.$emit("wish",wishItem)},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.viewWishList=function(){$state.go("search.dash.wishlist",{}),$modalInstance.close()}}]),angular.module("equipment").controller("rentPopup",["$scope","$modalInstance","$state","data","$location","Equipments","ipCookie","Notification",function($scope,$modalInstance,$state,data,$location,Equipments,ipCookie,Notification){var _errorHandler=function(e){alert(e.statusMessage)},_userId=ipCookie("userCId");if($scope.addr={city:"",state:""},"undefined"!=typeof $location.search().location){var addrArray=$location.search().location.split("~");$scope.addr.city=addrArray.length>=0?addrArray[0]:"",$scope.addr.state=addrArray.length>0?addrArray[1]:""}$scope.options={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"locality"===item.types[0]&&($scope.addr.city=item.long_name)})}},$scope.type=$location.search().type,void 0!==$location.search()["duration-start"]&&void 0!==$location.search()["duration-end"]?$scope.duration={startDateInner:new Date(moment($location.search()["duration-start"].replace(/%2F/g,"/"),"DD/MM/YYYY")),endDateInner:new Date(moment($location.search()["duration-end"].replace(/%2F/g,"/"),"DD/MM/YYYY"))}:$scope.duration={startDateInner:"",endDateInner:""},$scope.rentalPurpose=[],$scope.location="",$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.dateFrom={minDate:1,dateFormat:"dd/mm/yy"},$scope.dateTo={minDate:2,dateFormat:"dd/mm/yy"},$scope.updateToDate=function(date){var _newMin=new Date(date);_newMin.setDate(_newMin.getDate()+2),$scope.dateTo.minDate=_newMin};var _equipKey=data.key;$scope.openPaymentSolo=function(){$scope.type="rent",Equipments.addSolo({userId:_userId,equipmentId:_equipKey,requiredLocation:$scope.addr.city,stateRequired:$scope.addr.state,period:{startDate:moment($scope.duration.startDateInner).format("DD/MM/YYYY"),endDate:moment($scope.duration.endDateInner).format("DD/MM/YYYY")},orderType:"Solo Binding",transactionFor:$scope.type,purpose:$scope.rentalPurpose},function(res){200===res.status.statusCode&&(""!==res.orderId?$state.go("logo.payment",{orderId:res.orderId,rtype:"lessee",ptype:"dr",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0}):Notification.error(res.data))},_errorHandler),$modalInstance.close()}}]),angular.module("equipment").controller("speciController",["$scope","Equipments","EquipmentsPublic","$stateParams","$state","$uibModal","$modalInstance","eqmtid","ipCookie","contextPathimageurl",function($scope,Equipments,EquipmentsPublic,$stateParams,$state,$uibModal,$modalInstance,eqmtid,ipCookie,contextPathimageurl){$scope.data=null,$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("equipment").controller("inspectionImageCtrl",["$scope","Equipments","EquipmentsPublic","$stateParams","$state","$uibModal","$modalInstance","data","index","ipCookie","contextPathimageurl","Lightbox",function($scope,Equipments,EquipmentsPublic,$stateParams,$state,$uibModal,$modalInstance,data,index,ipCookie,contextPathimageurl,Lightbox){"string"==typeof data?(data=data.replace(/\\/g,"/"),data=data.replace(/\/\//g,"/"),data=data.replace(/\/\//g,"/"),$scope.data=JSON.parse(data)):($scope.data=[],angular.forEach(data,function(value,key){value=value.replace(/\\/g,"/"),value=value.replace(/\/\//g,"/"),value=value.replace(/\/\//g,"/"),value=JSON.parse(value),angular.forEach(value,function(val,k){$scope.data.push(val)})})),$scope.openLightboxModal=function(index){Lightbox.openModal($scope.data,index)},$scope.index=index,$scope.contextPathimageurl=contextPathimageurl,$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("equipment").controller("userFinanceRequest",["$scope","Equipments","EquipmentsPublic","$stateParams","$state","$modalInstance","eqmtid","ipCookie","contextPathimageurl","Notification","price",function($scope,Equipments,EquipmentsPublic,$stateParams,$state,$modalInstance,eqmtid,ipCookie,contextPathimageurl,Notification,price){$scope.error=null,$scope.acceptValue=null,$scope.userFinance={salePrice:price,eqmpId:eqmtid,loanAmount:price,loan_tenure:null,downPayment:parseInt(price/100)},$scope.$watch("userFinance.downPayment",function(newval){price<=$scope.userFinance.downPayment?$scope.userFinance.loanAmount=0:$scope.userFinance.loanAmount=price-$scope.userFinance.downPayment}),$scope.submitFinance=function(){$scope.acceptValue?$scope.userFinance.loan_tenure?$scope.userFinance.downPayment?parseInt($scope.userFinance.loanAmount)>=parseInt(price)?($scope.errorRoi="Loan amount must be less than sale price.",$scope.error=null,Notification.error("Loan amount must be less than sale price.")):Equipments.applyForFinance($scope.userFinance,function(res){200===res.status.statusCode?($state.go("search.dash.financeMain.finance",{tabName:"inprocess",eqmtId:eqmtid},{reload:!0}),$modalInstance.close()):(Notification.error(res.data),$modalInstance.close())}):Notification.error("Please enter the down payment amount."):Notification.error("Please select the rate of Term of loan(Months)."):($scope.error="Error: Accept Terms & Condition",Notification.error("Please Accept Terms & Condition."))},$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("equipment").controller("sendAnEnquiryCtrl",["$scope","Equipments","$stateParams","$state","$modalInstance","equip","Notification",function($scope,Equipments,$stateParams,$state,$modalInstance,equip,Notification){var toggleThis=function(a){1===a&&($scope.data.btnLabel="Send Query",$scope.data.tab=1),2===a&&($scope.data.btnLabel="Send Request",$scope.data.tab=2)},closeThis=function(){
$modalInstance.dismiss("cancel")},sendThis=function(){2===$scope.data.tab&&$scope.data.tnc?Notification.error("Please accept the 'Term of Services'."):Equipments.saveAnEnquiry({eid:equip.key,type:$scope.data.tab,query:$scope.data.query,tnc:$scope.data.tnc,datetime:$scope.data.datetime},function(res){200===res.status.statusCode?(Notification.success(res.data),$modalInstance.close()):res.error?(Notification.error(res.error),$modalInstance.close()):res.data&&(Notification.info(res.data),$modalInstance.close())})};$scope.data={btnLabel:"Send Query",tab:1,query:null,close:closeThis,toggle:toggleThis,send:sendThis,datetime:null};var timeArray=["12:00 AM","1:00 AM","2:00 AM","3:00 AM","4:00 AM","5:00 AM","6:00 AM","7:00 AM","8:00 AM","9:00 AM","7:00 PM","8:00 PM","9:00 PM","10:00 PM","11:00 PM"];$scope.beforeRender=function($view,$dates,$leftDate,$upDate,$rightDate){try{"hour"===$view?$dates.filter(function(date){return-1!==timeArray.indexOf(date.display)}).forEach(function(date){date.selectable=!1}):"year"===$view?$dates.filter(function(date){return moment.unix(date.utcDateValue/1e3).format("YYYY")!==moment().format("YYYY")}).forEach(function(date){date.selectable=!1}):"month"===$view?$dates.filter(function(date){if(moment.unix(date.utcDateValue/1e3).format("YYYY")===moment().format("YYYY")){var realVal=moment.unix(date.utcDateValue/1e3).format("MM"),currVal=moment().format("MM"),nextVal=moment().add(1,"month").format("MM");return!(realVal===currVal||realVal===nextVal)}return!0}).forEach(function(date){date.selectable=!1}):$dates.filter(function(date){return date.localDateValue()<moment().valueOf()||date.localDateValue()>moment().add(1,"month").valueOf()||"Sun"===moment.unix(date.utcDateValue/1e3).format("ddd")}).forEach(function(date){date.selectable=!1})}catch(e){console.error(e)}}}]),angular.module("equipment").controller("emdBuyerController",["$scope","$rootScope","serverType","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","$modalInstance","eObj","Notification","$timeout","direct",function($scope,$rootScope,serverType,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathImageUrl,$uibModal,$modalInstance,eObj,Notification,$timeout,direct){$scope.contextPathImageUrl=contextPathImageUrl,$scope.inc=0,$scope.data={p:null,sd:null,allow:!1,submit:"emdDetail",txn:null,remark:null,paymentStatus:null,isShowTab:!1},$scope.user={id:ipCookie("userCId"),name:ipCookie("userCName"),auth:ipCookie("authenticatedC"),role:ipCookie("roleC")},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.justCall=function(){function increment(){if($scope.inc>100){clearInterval(interval),$scope.data.loading=!0,console.log(JSON.stringify($scope.data,null,2));try{var url=$scope.data.sd.url,token=url.split("/")[url.split("/").length-1];Equipments.pInfo({token:token,owner:$scope.data.sd.owner},function(res){200===res.status.statusCode?($rootScope.$broadcast("sdData",{server:serverType,url:$scope.data.sd.url,method:"POST",params:res.data.payment}),$timeout(function(){$scope.data.loading=!1,$rootScope.$broadcast("justCall",{}),$scope.inc=0},1e3)):"string"==typeof res.data?Notification.warning(res.data):"string"==typeof res.error&&Notification.error(res.error)},function(e){console.error("Error 10030	"+e)})}catch(e){console.error("Error 10031	"+e)}}else $scope.inc+=2}$scope.inc=1;var interval=null;interval=setInterval(increment,100)};var getSDP=function(){Equipments.getSecurityDepositPayment({eid:eObj.key},function(res){200===res.status.statusCode&&res.data?(res.data.length>1&&res.data.sort(function(a,b){return new Date(b.cdate)-new Date(a.cdate)}),$scope.data.paymentStatus=res.data,$scope.data.isShowTab=3===$scope.data.paymentStatus[0].status||1===$scope.data.paymentStatus[0].status):res.data&&"string"==typeof res.data?Notification.warning(res.data):res.error&&"string"==typeof res.error&&Notification.error(res.error)})},init=function(){Equipments.securityDeposit({eid:eObj.key},function(res){200===res.status.statusCode&&res.data?($scope.data.allow=res.error&&res.data.amount&&res.error===res.data.amount,$scope.data.sd=res.data):res.data&&"string"==typeof res.data?(Notification.warning(res.data),$scope.close()):res.error&&"string"==typeof res.error&&(Notification.error(res.error),$scope.close())}),getSDP()};$scope.submit=function(){$scope.data.remark?$scope.data.txn?$scope.data.submit?Equipments.addSecurityDepositPayment({owner:$scope.data.sd.owner,type:$scope.data.submit,txn:$scope.data.txn,remark:$scope.data.remark,eid:eObj.key},function(res){200===res.status.statusCode?res.data&&"string"==typeof res.data?(Notification.success(res.data),getSDP()):res&&res.data&&res.data.msg&&(Notification.success(res.data.msg),$scope.close()):res.data&&"string"==typeof res.data?Notification.warning(res.data):res.error&&"string"==typeof res.error&&Notification.error(res.error)}):Notification.error("Invalid option"):Notification.error("Transaction id cannot be blank"):Notification.error("Please enter remark")},init()}]);var sortPriority=function(data){var newData=[],finalData={};angular.forEach(data,function(n,key){newData.push({key:key,value:n,priority:n.priority})}),newData.sort(function(a,b){return a=parseInt("undefined"==typeof a.priority?9999:a.priority),b=parseInt("undefined"==typeof b.priority?9999:b.priority),a-b});for(var i=0;i<newData.length;i++)finalData[newData[i].key]=newData[i].value;return finalData},removeKeyIfValueNotAvailable=function($location,keyValueJson){angular.forEach(keyValueJson,function(value,key){null===value?delete keyValueJson[key]:""===value?delete keyValueJson[key]:"category"===key?delete keyValueJson[key]:"layout"===key?delete keyValueJson[key]:"lang"===key?delete keyValueJson[key]:"page"===key?delete keyValueJson[key]:"size"===key?delete keyValueJson[key]:"min-price"===key?delete keyValueJson[key]:keyValueJson[key]=value}),$location.search(keyValueJson)},funUpdatePassingParameters=function(searchingParameters,passingParameters){return searchingParameters.layout&&delete searchingParameters.layout,"undefined"!=typeof passingParameters.startDate&&(searchingParameters["duration-start"]=moment(passingParameters.startDate).format("DD/MM/YYYY")),"undefined"!=typeof passingParameters.endDate&&(searchingParameters["duration-end"]=moment(passingParameters.endDate).format("DD/MM/YYYY")),"undefined"!=typeof passingParameters["sort-order"]&&(searchingParameters["sort-order"]=passingParameters["sort-order"]),"undefined"!=typeof passingParameters["sort-by"]&&(searchingParameters["sort-by"]=passingParameters["sort-by"]),searchingParameters},getAggregate=function(catId){if("undefined"==typeof catId||null===catId||""===catId)return!1;var tempArray=[],categoriesFilters={CAT56d02b50782a16fd1cbdb83b:["capacity","working_pressure","rated_power"],CAT56d02b7f782a16fd1cbdb83d:["capacity","working_pressure","rated_power"],CAT56d02bc7782a16fd1cbdb840:["capacity","with_hopper_without_hoper","total_power_in_kw"],CAT56d02bf8782a16fd1cbdb842:["capacity","with_without_silo","total_power_in_kw"],CAT56d02c0d782a16fd1cbdb844:["capacity","engine_driven","power"],CAT56d02c1e782a16fd1cbdb845:["capacity","pumping_height","power"],CAT56d02c30782a16fd1cbdb846:["capacity","power"],CAT56d02c9a782a16fd1cbdb848:["power","operating_weight","blade_capacity"],CAT56d02cb6782a16fd1cbdb84a:["power","operating_weight","blade_capacity"],CAT56d02cfa782a16fd1cbdb84d:["operating_weight","bucket_capacity","power"],CAT56d02d09782a16fd1cbdb84f:["operating_weight","bucket_capacity","power"],CAT56d02d1d782a16fd1cbdb851:["operating_weight","bucket_capacity","power"],CAT56d02d2b782a16fd1cbdb853:["operating_weight","bucket_capacity","power"],CAT56d02d65782a16fd1cbdb856:["loader_bucket_capacity","backhoe_bucket_capacity","operating_weight","power"],CAT56d02d77782a16fd1cbdb858:["bucket_capacity","operating_weight","power"],CAT56d02d84782a16fd1cbdb85a:["bucket_capacity","operating_weight","power"],CAT56d02da0782a16fd1cbdb85c:["power","operating_weight","bucket_capacity"],CAT56d02e1a782a16fd1cbdb85f:["maximum_rated_lifting_capacity","main_boom_length","fixed_jib_length","luffing_jib_length","operating_weight_of_crane"],CAT56d02e2d782a16fd1cbdb861:["lifting_capacity"],CAT56d02e4d782a16fd1cbdb865:["maximum_rated_lifting_capacity","main_boom_length","fixed_jib_length","luffing_jib_length","operating_weight_of_crane"],CAT56d02e5b782a16fd1cbdb867:["maximum_rated_lifting_capacity","main_boom_length","fixed_jib_length","luffing_jib_length","operating_weight_of_crane"],CAT56d02e96782a16fd1cbdb869:["maximum_rated_lifting_capacity","main_boom_length","fixed_jib_length","luffing_jib_length","operating_weight_of_crane"],CAT56d02eb4782a16fd1cbdb86b:["maximum_rated_lifting_capacity","maximum_height","operating_weight_of_crane"],CAT56d02ef3782a16fd1cbdb86f:["maximum_rated_capacity","maximum_height","jib_length"],CAT56d02f10782a16fd1cbdb871:["maximum_rated_capacity","maximum_height","jib_length"],CAT56d02f83782a16fd1cbdb874:["load_capacity","lifting_height"],CAT56d02f94782a16fd1cbdb876:["load_capacity","lifting_height"],CAT56d02fd0782a16fd1cbdb879:["maximum_load","maximum_height"],CAT56d02fe0782a16fd1cbdb87b:["maximum_load","maximum_height"],CAT56d030f2782a16fd1cbdb87d:["maximum_rated_capacity","span_length"],CAT56d03109782a16fd1cbdb87f:["maximum_rated_capacity","span_length"],CAT56d03147782a16fd1cbdb881:["load_capacity","lifting_height"],CAT56d031e97e4db9786220cf8a:["diameter","power","weight"],CAT56d032207e4db9786220cf8c:["diameter","power","weight"],CAT56d032597e4db9786220cf8e:["diameter","power","weight"],CAT56d032f17e4db9786220cf92:["needle_length","power"],CAT56d033137e4db9786220cf94:["needle_length","power"],CAT56d0335d7e4db9786220cf96:["needle_length","power"],CAT56d037527e4db9786220cf9e:["power"],CAT56d037647e4db9786220cfa0:["power"],CAT56d037ce7e4db9786220cfa4:["power","operating_weight"],CAT56d037f37e4db9786220cfa6:["rated_measurement_capacity","accuracy"],CAT56d038177e4db9786220cfa8:["capacity","pressure"],CAT56d0387c7e4db9786220cfaa:["pipe_external_diameter_range"],CAT56d0389d7e4db9786220cfac:["pipe_internal_diameter_range"],CAT56d0395c7e4db9786220cfaf:["flow","pressure","power"],CAT56d03ab47e4db9786220cfb6:["pipe_internal_diameter"],CAT56d03acd7e4db9786220cfb8:["pipe_internal_diameter"],CAT56d03b1c7e4db9786220cfba:["min._pipe_diameter_range","max._pipe_diameter_range"],CAT56d03b747e4db9786220cfbd:["maximum_transportation_weight","maximum_transportation_diameter_meter"],CAT56d03bb07e4db9786220cfbf:["operating_weight","maximum_rated_lift_capacity","power"],CAT56d03bdb7e4db9786220cfc0:["flow","pressure","power"],CAT56d03cca7e4db9786220cfc7:["power"],CAT56d03ceb7e4db9786220cfc9:["power"],CAT56d03d037e4db9786220cfcb:["power"],CAT56d03d2e7e4db9786220cfcd:["height","power"],CAT56d03d497e4db9786220cfce:["tank_capacity"],CAT56d03d627e4db9786220cfcf:["capacity","number_of_stages"],CAT56d03dbb7e4db9786220cfd1:["capacity"],CAT56d03df17e4db9786220cfd3:["capacity"],CAT56d03e467e4db9786220cfd6:["maximum_paving_width","hopper_capacity"],CAT56d03e767e4db9786220cfd8:["maximum_paving_width","paving_thickness"],CAT56d03f087e4db9786220cfdc:["maximum_paving_width"],CAT56d03f527e4db9786220cfdd:["maximum_paving_width","hopper_capacity"],CAT56d03f7b7e4db9786220cfdf:["capacity"],CAT56d03fda7e4db9786220cfe0:["operating_weight","drum_width"],CAT56d0401c7e4db9786220cfe1:["operating_weight","compaction_width"],CAT56d0403f7e4db9786220cfe2:["operating_weight","drum_width"],CAT56d041357e4db9786220cfe3:["operating_weight","drum_width"],CAT56d041507e4db9786220cfe4:["operating_weight","drum_width"],CAT56d041727e4db9786220cfe5:["power","blade_width","operating_weight"],CAT56d041857e4db9786220cfe6:["milling_width","milling_depth","operating_weight"],CAT56d041ee7e4db9786220cfe8:["current_rating","power"],CAT56d0421d7e4db9786220cfea:["current_rating"],CAT56d042427e4db9786220cfec:["current_rating"],CAT56d0427a7e4db9786220cfee:["range_wire_diameter"],CAT56d042e17e4db9786220cff0:["current_rage","min._pipe_diameter_capacity"],CAT56d043587e4db9786220cff4:["operating_weight","rated_power","maximum_rated_lifting_load"],CAT56d043997e4db9786220cff6:["operating_weight","casing_diameter_range","drilling_depth_range"],CAT56d043ae7e4db9786220cff7:["operating_weight","max._sheet_thickness","casing_diameter_range","power"],CAT56d043ca7e4db9786220cff8:["holl_diameter","max._drilling_depth"],CAT56d043db7e4db9786220cff9:["rated_payload"],CAT56d043f67e4db9786220cffa:["tank_capacity"],CAT56d044317e4db9786220cffb:["tank_capacity"],CAT56d0447e7e4db9786220cffd:["payload","overalllength"],CAT56d0448e7e4db9786220cfff:["payload","overalllength"],CAT56d044b87e4db9786220d001:["payload","overalllength"],CAT56d046687e4db9786220d010:["power","operating_weight","maximum_depth_of_cut"],CAT56d0467e7e4db9786220d012:["power","operating_weight","bucket_capacity"],CAT56d046ad7e4db9786220d014:["maximum_liftingheight","lifting_capacity","operating_weight_of_crane"]};return"undefined"!=typeof catId&&(tempArray=categoriesFilters["CAT"+catId.toString()]),"undefined"==typeof tempArray&&(tempArray=[]),tempArray},checkUndefined=function(obj,def){var strObj=obj;return def="undefined"==typeof def?"":def,strObj="undefined"==typeof strObj?def:strObj,strObj=null===strObj?def:strObj,strObj=""===strObj?def:strObj};angular.module("equipment").directive("thereIsMore",["$timeout","$document","$window","$rootScope","$location",function($timeout,$document,$window,$rootScope,$location){return{restrict:"A",scope:!0,compile:function(tElement){return tElement.append("<div>&nbsp;</div>"),function(scope,element){var windowBottom=0,footerSize=500;angular.element($window).bind("scroll",function(){var windowHeight="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,body=document.body,html=document.documentElement,docHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight)-footerSize;windowBottom=windowHeight+window.pageYOffset,windowBottom>=docHeight&&!scope.bottom&&$location.path().indexOf("/search/")>-1&&$rootScope.$emit("list:bottom")})}}}}]),angular.module("equipment").config(["ScrollBarsProvider",function(ScrollBarsProvider){ScrollBarsProvider.defaults={autoHideScrollbar:!1,setHeight:100,scrollInertia:100,theme:"light",axis:"x",advanced:{updateOnContentResize:!0},scrollButtons:{scrollAmount:"auto",enable:!0}}}]),angular.module("equipment").controller("EquipmentController",["$timeout","$scope","$rootScope","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","AuthenticationService","paymentDetail","$uibModal","$localStorage","$sessionStorage","$http","$location","$routeParams","Item","WishlistService","contextPathimageurl","rentRequest","title","Notification","SweetAlert","description",function($timeout,$scope,$rootScope,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,AuthenticationService,paymentDetail,$uibModal,$localStorage,$sessionStorage,$http,$location,$routeParams,Item,WishlistService,contextPathimageurl,rentRequest,title,Notification,SweetAlert,description){var setTitle=function(text){title(text)},temp=$scope.type?$scope.type.toUpperCase():"";$scope.filterSeo=function(seo,type){return seo=seo.split(" ").join("-"),seo=seo.replace(/_/g,"-"),seo+="rent"===type?"-rental":"buy"===type?"-sale":"new"===type?"-new":"-sale",seo.replace(/--/g,"-").replace(/ & /g,"and").replace(/&/g," and ").toLowerCase()},$location.search().sa?$scope.urlType=!1:$scope.urlType=!0,$scope.equipmentlist=[],$scope.equipmentlocation=[],$scope.equipmentlocationKm=[],$scope.userCId=ipCookie("userCId"),$scope.bidItems=[],$scope.getCartItems=[],$scope.type=$location.search().type,$scope.filterData={},$scope.newFilterData={},$scope.filterlist=[],$scope.filterModel={},$scope.updateFilter={},$scope.contextPathimageurl=contextPathimageurl,$scope.maxNumberOfChar=22,$scope.max=10,$scope.isReadonly=!0,$scope.ispagechange=0,$scope.lastclickedfiltername=0,$scope.totalItems=0,$scope.defaultSize=12,$scope.equiDetailURLParams="",$scope.daysDiff=0,$scope.isHidePrice=!1,$scope.busy=!1,$scope.dataLoading=!1,$scope.breadCrumb=[],$scope.categoryName=[],$scope.willbackSoon=!1,$scope.autoCompletelocation=null,$scope.noResult=null,$scope.compareItems=[],$scope.status=!0,$scope.totalItemCount=!1,$scope.catDec="";var _bidItemId=[],equiDetailURLParamsList=["type","duration-start","duration-end","location","sa"],_sessionId=ipCookie("tempsession"),request=($stateParams.priceType,$stateParams.q,{}),searchList=$location.search(),_compareItemId=[],_errorHandler=function(e){console.error("Error 10070	"+e)},sURLVariables=window.location.search.substring(1).split("&");$scope.userCId?$scope.userLoginValidate=!0:($scope.userLoginValidate=AuthenticationService.isLogged(),$rootScope.$on("validateLogin",function(event,data){$scope.userLoginValidate=data.isLoggedIn,$scope.isLoggedIn=data.isLoggedIn,$scope.isLoggedIn&&$scope.loginCart()}),$rootScope.$on("loginData",function(event,data){$scope.userLoginValidate=data,$scope.userLoginValidate&&$scope.loginCart()}),$scope.$watch("AuthenticationService.isLoggedIn",function(){$scope.userLoginValidate=AuthenticationService.isLoggedIn})),$scope.updateEquipmentUrl=function(){setTimeout(function(){var sURLVariables=window.location.search.substring(1).split("&");$scope.equiDetailURLParams="";for(var i=0;i<sURLVariables.length;i++){var key=sURLVariables[i].split("=")[0],value=sURLVariables[i].split("=")[1];equiDetailURLParamsList.indexOf(key)>-1&&($scope.equiDetailURLParams.length>0?""!==value?$scope.equiDetailURLParams+="&"+key+"="+value:$scope.equiDetailURLParams+="&"+key+"="+$scope.filterModel[key]:$scope.equiDetailURLParams="?"+key+"="+value)}},100)},$scope.currentPage=1,$scope.updateURL=function($location,searchingParameters,passingParameters){var updatePassingParametersObj,searchList=$location.search();return searchingParameters.page=$scope.currentPage,searchingParameters.size=$scope.defaultSize,searchingParameters.type=checkUndefined(searchList.type,"buy"),searchingParameters.q=checkUndefined(searchList.q,""),searchingParameters.lang=checkUndefined(searchList.lang,"en"),searchingParameters["duration-start"]=checkUndefined(searchList["duration-start"],""),searchingParameters["duration-end"]=checkUndefined(searchList["duration-end"],""),searchingParameters["sort-order"]=checkUndefined(searchList["sort-order"],"price"),searchingParameters["sort-by"]=checkUndefined(searchList["sort-by"],"asc"),"undefined"==typeof searchingParameters.categoryId&&"undefined"!=typeof searchList.categoryId&&(searchingParameters.categoryId=checkUndefined(searchList.categoryId,""),searchingParameters.category=checkUndefined(searchList.category,"")),updatePassingParametersObj="undefined"!=typeof passingParameters&&null!==passingParameters?funUpdatePassingParameters(searchingParameters,passingParameters):searchingParameters,removeKeyIfValueNotAvailable($location,updatePassingParametersObj),updatePassingParametersObj};var _equipCatId=$scope.filterModel.categoryId=checkUndefined(searchList.categoryId,"");$scope.equipFeatures=getAggregate($scope.filterModel.categoryId),$scope.isRatingShow=function(index){$scope.rating=index},$scope.isRatingHide=function(index){$scope.rating=!1},$scope.isPriceShow=function(index){$scope.price=index},$scope.isPriceHide=function(index){$scope.price=!1},$scope.getCatDec=function(){EquipmentsPublic.getCategeoryDecS({catId:_equipCatId},function(res){if(200===res.status.statusCode){var catDescription=res.data;catDescription&&""!==catDescription&&(catDescription=catDescription.replace(/\s\s+/g," "),$scope.catDec=catDescription,description(catDescription))}},_errorHandler)},$scope.getCatDec(),$scope.isFeatureValidater=function(fData){var stat=!1;return"undefined"!=typeof fData&&fData===!0&&(stat=!0),stat},EquipmentsPublic.getBreadCrumb({catid:_equipCatId},function(res){200===res.status.statusCode&&(angular.forEach(res.data,function(value){$scope.categoryName.push(value.name)}),$scope.breadCrumb=res.data,setTitle(temp+" "+$scope.categoryName.join(" ")+" online - Irontread.com"))},_errorHandler),$scope.sortOptions={stores:[{id:1,"sort-order":"price","sort-by":"asc",name:"Price(Low-High)",isTrue:!0},{id:2,"sort-order":"price","sort-by":"desc",name:"Price(High-Low)",isTrue:!0},{id:3,"sort-order":"year","sort-by":"desc",name:"Year of Make ",isTrue:!0},{id:4,"sort-order":"distance","sort-by":"asc",name:"Distance of equipment",isTrue:!1}]},$scope.sortItem={store:$scope.sortOptions.stores[0]},$scope.selectDistance=function(){"undefined"!=typeof $location.search().location&&angular.forEach($scope.sortOptions.stores,function(data){data.isTrue=!0})},$rootScope.$on("$locationChangeSuccess",function(){temp=$location.search().type?$location.search().type.toUpperCase():"buy",setTitle(temp+" "+$scope.categoryName+" online - Irontread.com"),$scope.filterModel.type=$location.search().type,searchList=$location.search(),_bidItemId=[],$scope.bidItems=[],$scope.selectDistance(),$scope.type=$location.search().type}),$scope.equipUrlName=function(o,t){var equipNameTemp="",manufacture="",model="",type=t;model=o&&o._source&&o._source.name?o._source.name:"",manufacture=o&&o._source&&o._source.manufacturer?o._source.manufacturer:"";try{return equipNameTemp=(manufacture+" "+model).toLowerCase(),equipNameTemp=equipNameTemp.split(" ").join("-"),equipNameTemp=equipNameTemp.replace(/_/g,"-"),equipNameTemp.replace(/--/g,"-")}catch(e){}return type="rent"===t?"-rental":"new"===t?"-new":"-for-sale",equipNameTemp+type},$scope.$watch("type",function(newval,oldval){if(newval!==oldval&&"search.equipment1"===$state.current.name)$scope.getFilter();else if(newval!==oldval&&"search.equipment1"===$state.current.name){var tempUrl=$location.url();"rent"===newval?tempUrl=tempUrl.replace("-new","-rental").replace("-sale","-rental"):"buy"===newval?tempUrl=tempUrl.replace("-new","-sale").replace("-rental","-sale"):"new"===newval&&(tempUrl=tempUrl.replace("-rental","-new").replace("-sale","-new")),$location.url(tempUrl)}}),$scope.$watch("filterModel.categoryId",function(newval,oldval){newval!==oldval&&$scope.getFilter()}),$scope.accordionStatus=function(index){$scope.status[index]=!1},$scope.type=checkUndefined(searchList.type,"buy"),$scope.filterModel.type=checkUndefined(searchList.type,"buy"),$scope.filterModel.q=checkUndefined(searchList.q,""),$scope.filterModel.sa=checkUndefined(searchList.sa,""),$scope.filterModel.sadate=checkUndefined(searchList.sadate,""),$scope.filterModel.categoryId=checkUndefined(searchList.categoryId,""),$scope.filterModel.lang=checkUndefined(searchList.lang,"en"),$scope.filterModel.location=checkUndefined(searchList.location,""),$scope.filterModel.latlong=checkUndefined(searchList.latlong,""),$scope.filterModel["duration-start"]=checkUndefined(searchList["duration-start"],""),$scope.filterModel["duration-end"]=checkUndefined(searchList["duration-end"],""),$scope.filterModel["sort-order"]=checkUndefined(searchList["sort-order"],"price"),$scope.filterModel["sort-by"]=checkUndefined(searchList["sort-by"],"asc"),$scope.filterModel.page=$scope.currentPage,$scope.filterModel.size=$scope.defaultSize,$scope.tentativePrice=function(rates){var rate=0,days=$scope.daysDiff,d=checkUndefined(rates.daily,0),m=checkUndefined(rates.monthly,0);if(0===days)return{val:"Invalid Days."};try{if(30>days){if("undefined"!=typeof d)return rate=Math.round(days*d)}else{if("undefined"!=typeof m)return rate=Math.round(days/30*m)}}catch(e){return console.error("Error 10033	"+e),-1}},$scope.updateEquipmentUrl(),""!==$scope.filterModel["duration-start"]&&""!==$scope.filterModel["duration-end"]?2===$scope.filterModel["duration-start"].indexOf("~2F")?$scope.duration={startDate:new Date(moment($scope.filterModel["duration-start"].replace(/~2F/g,"/"),"DD/MM/YYYY")),endDate:new Date(moment($scope.filterModel["duration-end"].replace(/~2F/g,"/"),"DD/MM/YYYY"))}:$scope.duration={startDate:new Date(moment($scope.filterModel["duration-start"].replace(/%2F/g,"/"),"DD/MM/YYYY")),endDate:new Date(moment($scope.filterModel["duration-end"].replace(/%2F/g,"/"),"DD/MM/YYYY"))}:$scope.duration={startDate:"",endDate:""},$scope.getFilter=function(){EquipmentsPublic.filters($scope.filterModel,function(res){$scope.filterlist=res.aggs,angular.forEach(res.aggs,function(value,key){value.hasOwnProperty("_id")||(""===$scope.filterModel.categoryId?$scope.filterData.category=value:$scope.filterData[key]=value,$scope.filterModel[key]="",angular.forEach($scope.filterData,function(item,key){if(item.valuesfilterModel=[],angular.forEach(item.buckets,function(innerItems,InnerKey){innerItems.isDisable=!1,innerItems.isChecked=!1}),"undefined"!=typeof $location.search()[key]){var array=[];Array.isArray($location.search()[key])?item.valuesfilterModel=$location.search()[key]:(array.push($location.search()[key]),item.valuesfilterModel=array)}}))});var copyOfFilterData=JSON.parse(JSON.stringify($scope.filterData));$scope.filterData=sortPriority(copyOfFilterData);for(var sParameterName=[],i=0;i<sURLVariables.length;i++){var key=sURLVariables[i].split("=")[0];sURLVariables[i].split("=")[1];-1===sParameterName.indexOf(key)&&(key.indexOf("feature")>-1||key.indexOf("location")>-1)&&(sParameterName.push(key),$scope.filterModel[key]=searchList[key])}$scope.filterModel.page=0,$scope.filterModel.size=$scope.defaultSize,$scope.filterModel.type=checkUndefined(searchList.type,"buy"),$scope.filterModel.q=checkUndefined(searchList.q,""),$scope.filterModel.categoryId=checkUndefined(searchList.categoryId,""),$scope.filterModel.lang=checkUndefined(searchList.lang,"en"),$scope.filterModel.location=checkUndefined(searchList.location,""),$scope.filterModel.latlong=checkUndefined(searchList.latlong,""),$scope.filterModel["duration-start"]=checkUndefined(searchList["duration-start"],""),$scope.filterModel["duration-end"]=checkUndefined(searchList["duration-end"],""),$scope.filterModel["sort-order"]=checkUndefined(searchList["sort-order"],"price"),$scope.filterModel["sort-by"]=checkUndefined(searchList["sort-by"],"asc"),searchEquipments()},_errorHandler)},$scope.getFilter(),$scope.getCartData=function(){$scope.userLoginValidate===!0?Equipments.getcartp({sessionId:_sessionId,categeoryId:$scope.filterModel.categoryId,requestType:"bid"},function(res){if(void 0!==res.data&&res.data.length>0){var indexData=0;angular.forEach($scope.equipmentlist,function(itemsGrid,idx){angular.forEach(itemsGrid,function(value,key){"_id"===key&&angular.forEach(res.data,function(itemsRes){angular.forEach(itemsRes.equipmentId,function(euipId){value===euipId&&$scope.type===itemsRes.transaction&&(_bidItemId.push(itemsGrid._id),$scope.bidItems.push(itemsGrid),itemsGrid.bidChecked=!0),"rent"===itemsRes.transaction&&0===indexData&&(indexData+=1,$scope.addr.city=itemsRes.locationCity,"undefined"!=typeof itemsRes.duration&&""!==itemsRes.duration&&itemsRes.duration.length>0&&($scope.duration={startDate:new Date(moment(itemsRes.duration[0].startDate,"DD/MM/YYYY")),endDate:new Date(moment(itemsRes.duration[0].endDate,"DD/MM/YYYY"))}))})})})})}},_errorHandler):EquipmentsPublic.getCartItems({sessionId:_sessionId,categeoryId:$scope.filterModel.categoryId,requestType:"bid"},function(res){void 0!==res.data&&res.data.length>0&&angular.forEach($scope.equipmentlist,function(itemsGrid,idx){angular.forEach(itemsGrid,function(value,key){"_id"===key&&angular.forEach(res.data,function(itemsRes){angular.forEach(itemsRes.equipmentId,function(euipId){value===euipId&&$scope.type===itemsRes.transaction&&(_bidItemId.push(itemsGrid._id),$scope.bidItems.push(itemsGrid),itemsGrid.bidChecked=!0)})})})})},_errorHandler)},$scope.loginCart=function(){Equipments.logincart({sessionId:_sessionId},function(res){})};var getKilometerFromGoogleApi=function(location,equipmentlocations){if("undefined"!=typeof location){var newEquipmentLocations=[],equipmentKey=[];try{angular.forEach($scope.equipmentlist,function(e,i){if("undefined"==typeof e._source.locationkm&&(newEquipmentLocations.push(e._source.location.city),equipmentKey.push(e._source.key)),i===$scope.equipmentlist.length-1){var service=new google.maps.DistanceMatrixService;service.getDistanceMatrix({origins:[location],destinations:newEquipmentLocations,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},function(response,status){if(status!==google.maps.DistanceMatrixStatus.OK)console.error("Error 10034	"+status);else if(response.rows.length>0){var eleObj=response.rows[0].elements,eleLen=eleObj.length;eleLen>0&&angular.forEach(eleObj,function(data,idx){"OK"===data.status&&angular.forEach($scope.equipmentlist,function(e1,i1){e1._source.key===equipmentKey[idx]&&"undefined"==typeof e1._source.locationkm&&($scope.equipmentlist[i1]._source.locationkm=parseInt(data.distance.text.replace(" km","").replace(",","")))}),idx===eleObj.length-1&&$scope.$apply()})}})}})}catch(e){console.error("Error 10035	"+e)}}},searchEquipments=function(){$scope.dataLoading=!0,EquipmentsPublic.equipments($scope.filterModel,function(res){if(200===res.status.statusCode){$scope.dataLoading=!1,$scope.totalItems=res.totalcount,$scope.equipmentlist=res.data,$scope.totalItemCount=!1,0===$scope.equipmentlist.length?$scope.noResult=!0:$scope.noResult=!1,$scope.getCartData(),$scope.updateObjects();var equiLocation=$scope.equipmentlist.length;angular.forEach($scope.equipmentlist,function(value,idx){"undefined"!=typeof value._source.location.city&&""!==value._source.location.city?$scope.equipmentlocation.push(value._source.location.city):$scope.equipmentlocation.push(""),idx===equiLocation-1&&getKilometerFromGoogleApi($scope.addr.city+", "+$scope.addr.state,$scope.equipmentlocation)})}},_errorHandler)};$scope.SetLastClickedFilterName=function(len){$scope.lastclickedfiltername=len},$scope.updateObjects=function(){var diffDays,searchArgsnew=$location.search(),startDatenew="undefined"==typeof searchArgsnew["duration-start"]?"":moment(searchArgsnew["duration-start"].replace(/%2F/g,"/"),"DD/MM/YYYY"),endDatenew="undefined"==typeof searchArgsnew["duration-end"]?"":moment(searchArgsnew["duration-end"].replace(/%2F/g,"/"),"DD/MM/YYYY");$scope.type="undefined"==typeof searchArgsnew.type?"":searchArgsnew.type;try{diffDays=moment(endDatenew).diff(startDatenew,"days")}catch(e){diffDays=0}$scope.daysDiff=diffDays,""===startDatenew||""===endDatenew||""===$scope.addr.city?$scope.isHidePrice=!1:$scope.isHidePrice=!0},$scope.isHide=function(label){return"location"===label?!0:""!==$scope.filterModel.categoryId&&"category"===label?!0:!1},$scope.filtercheck="",$scope.categoryValue=function(id,label){if(!$scope.filterModel.categoryId&&"category"===label){var _id=id;_id=id.split("~"),$scope.categoryName=_id[0],_id=_id[_id.length-1],$scope.filterModel.categoryId=_id}};var _filter=function(parameterObj,filterName,value,isApplyClick){""!==$scope.filterModel.categoryId?(isApplyClick&&(parameterObj["sort-order"]="distance",parameterObj["sort-by"]="asc",$scope.sortOptions.stores[$scope.sortOptions.stores.length-1].isTrue=!0,$scope.sortItem.store=$scope.sortOptions.stores[$scope.sortOptions.stores.length-1]),$scope.dataLoading=!0,$scope.currentPage=0,"undefined"!=typeof filterName&&angular.forEach($scope.filterData,function(value,key){value.valuesfilterModel.length>0?(request[key]=value.valuesfilterModel,$scope.filterModel[key]=value.valuesfilterModel):$scope.filterModel[key]=""}),$scope.LoadMoreItems(parameterObj,filterName)):(Notification.error("Select Category"),"undefined"!=typeof value&&(value.checked=!1),$scope.duration.startDate=null,$scope.duration.endDate=null,$scope.addr.city=null,parameterObj=[])};if($scope.filterResults=_filter,$scope.LoadMoreItems=function(parameterObj,filterName){if(!$scope.busy||0===$scope.currentPage){$scope.busy=!0,$scope.currentPage++;var copyOfFilterModel=JSON.parse(JSON.stringify($scope.filterModel)),searchingParameters=$scope.updateURL($location,copyOfFilterModel,parameterObj);searchingParameters.page=$scope.currentPage,EquipmentsPublic.equipments(searchingParameters,function(res){if(200===res.status.statusCode){$scope.dataLoading=!1;
var searchAggregations;$scope.totalItems!==res.totalcount&&($scope.totalItems=res.totalcount,searchAggregations=res.aggregations),res.data.length>0&&1===$scope.currentPage?($scope.equipmentlist=res.data,searchAggregations=res.aggregations,$scope.busy=!1,$scope.totalItemCount=!1):res.data.length>0?($scope.equipmentlist=$scope.equipmentlist.concat(res.data),$scope.busy=!1,$scope.totalItemCount=!1):0===res.data.length&&0===res.totalcount&&($scope.equipmentlist=[],$scope.totalItemCount=!0),"undefined"!==searchAggregations&&angular.forEach($scope.filterData,function(filterData,key){if(filterName===key&&angular.forEach(filterData.buckets,function(value,innerkey1){filterData.valuesfilterModel.indexOf(value.key)>-1?value.isChecked=!0:value.isChecked=!1}),filterName!==key)try{angular.forEach(searchAggregations[key],function(updatedData,updatedKey){"buckets"===updatedKey&&angular.forEach(filterData,function(bucketData,bucketKey){filterData.buckets.length>0&&"buckets"===bucketKey&&angular.forEach(bucketData,function(final,finalKey){var res1=$.grep(updatedData,function(item){return item.key===final.key});if(res1.length>0){$scope.filterData[key][bucketKey][finalKey].isDisable=!1;try{$scope.filterData[key][bucketKey][finalKey].doc_count=parseInt(res1[0].doc_count)}catch(e){console.error(e)}}else{$scope.filterData[key][bucketKey][finalKey].isDisable=!0;try{$scope.filterData[key][bucketKey][finalKey].doc_count=0}catch(e){console.error(e)}}})})})}catch(e){}}),getKilometerFromGoogleApi($scope.addr.city+","+$scope.addr.state,$scope.equipmentlocation),$scope.updateEquipmentUrl(),$scope.updateObjects()}},function(){$scope.dataLoading=!1})}},$rootScope.$on("list:bottom",function(event,params){$scope.busy||($scope.dataLoading=!0,$scope.LoadMoreItems())}),$scope.addSolo=function(data){AuthenticationService.login(function(){rentRequest.rentPopup(data._source,function(){})})},$scope.dateFrom={minDate:1,dateFormat:"dd/mm/yy"},$scope.dateTo={minDate:2,dateFormat:"dd/mm/yy"},$scope.updateToDate=function(date){var _newMin=new Date(date);_newMin.setDate(_newMin.getDate()+2),$scope.dateTo.minDate=_newMin},$scope.wishlistId=[],$scope.wishlistEquip=function(){void 0!==$scope.userCId&&Equipments.wishlist({userId:$scope.userCId},function(res){if(200===res.status.statusCode){var jsonData=res.data[0].eu_wishlist;angular.forEach(jsonData,function(data){angular.forEach(data.euw_equipments,function(id){$scope.wishlistId.push(id.euwi_equipment_id)})})}},_errorHandler)},$scope.wishlistEquip(),$scope.addr={city:"",state:""},"undefined"!=typeof $location.search().location){var addrArray=$location.search().location.split("~");$scope.addr.city=addrArray.length>=0?addrArray[0]:"",$scope.addr.state=addrArray.length>0?addrArray[1]:""}$scope.autoCompleteOptions={types:"(cities)",country:"in",place_changed:function(data){var _location=data.geometry.location;$scope.filterModel.latlong=_location.lat()+"~"+_location.lng(),angular.forEach(data.address_components,function(item,index){"locality"===item.types[0]&&($scope.addr.city=item.long_name),"administrative_area_level_1"===item.types[0]&&($scope.localLoanData.state=item.long_name),index===data.address_components.length-1&&($scope.filterModel.location=$scope.addr.city+"~"+$scope.addr.state)})}},$scope.layout="grid",$scope.replaceDecimal=function(value){var _value=value.split(" ")[0];if(isNaN(_value))return value;if(value.indexOf(" ")>0||isNaN(_value)){var parsed=parseFloat(_value,10),input=Math.round(100*parsed)/100;return input=input+" "+value.split(" ")[1]}return value},$scope.replaceFilterDecimal=function(value){if(value=value.split("~")[0],-1!==value.indexOf(".")){var _value=value.split(" ")[0];if(value.indexOf(" ")>0){var parsed=parseFloat(_value,10),input=Math.round(100*parsed)/100;return input=input+" "+value.split(" ")[1]}return value}return value},$scope.containsId=function(id,wishIds){for(var found=0,i=0;i<wishIds.length;i++)if(0===found&&wishIds[i]===id){found=1;break}return 1===found?!0:!1},$scope.wishTrue="",$rootScope.$on("wish",function(event,data){$scope.wishTrue=data.key}),$scope.addToWishlist=function(value,data){AuthenticationService.login(function(){WishlistService.addToWishList(value,data._source,function(){})})},$scope.click=function(){$scope.show=!$scope.show},$scope.paymentDetail=function(data,orderType){var detail={};detail.equipId=data,detail.duration=45,detail.type=$scope.filterModel.type,detail.orderType=orderType,paymentDetail.setDetail(detail)};$scope.openBidInvitation=function(){ipCookie.remove("RequestType"),delete $sessionStorage.bidEquipmentList,$scope.addCart("bid",_bidItemId),AuthenticationService.login(function(){var orderType="bid";$scope.paymentDetail($scope.bidItems,orderType);var ptype="rab";"rent"===$scope.type&&(ptype="rar"),$state.go("logo.payment",{orderId:"",rtype:"lessee",ptype:ptype,financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})})},ipCookie.remove("equipmentData"),$scope.openRent=function(data){""!==$scope.filterModel.categoryId?(ipCookie.remove("RequestType"),AuthenticationService.login(function(){if($scope.userCId!==data._source.admin&&$scope.userCId!==data._source.owner)if(""!==$scope.addr.city&&void 0!==$scope.addr.city&&null!==$scope.addr.city){var orderType="solo binding";$scope.paymentDetail(data,orderType);var cbAddCart=function(){$state.go("logo.payment",{orderId:"",rtype:"buyer",ptype:"db",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})};$scope.addCart("solo",data._source.key,cbAddCart)}else SweetAlert.swal({title:"Entering the location lets you sort equipment on the basis of distance.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Proceed Anyway",cancelButtonText:"Yes, Want to enter",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){if(isConfirm){var orderType="solo binding";$scope.paymentDetail(data,orderType);var cbAddCartSolo=function(){$state.go("logo.payment",{orderId:"",rtype:"buyer",ptype:"db",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})};$scope.addCart("solo",data._source.key,cbAddCartSolo)}else Notification.error("Please select the location for which the equipment is required.")});else Notification.error("You are the Owner of this equipment.")})):Notification.error("Select Category")},$scope.productAvailabity=function(){$uibModal.open({templateUrl:"request.popup.html",controller:"requestPopupCtrl",size:"md",resolve:{categoryId:function(){return $scope.filterModel.categoryId}}})};$scope.compareItems;$scope.comparepop=function(compareEquip,closeComp,bidValue){$uibModal.open({templateUrl:"compare.html",controller:"comparePopupCtrl",size:"lg",resolve:{compareEquip:function(){return $scope.compareItems},closeComp:function(){return $scope.closeCompreDiv()},bidValue:function(){return $scope.bidItems}}})};var _removeComparedItem=function(id){var index=_compareItemId.indexOf(id);_compareItemId.splice(index,1),$scope.compareItems.splice(index,1)};$scope.check=function(eqmt){eqmt.checked?(_compareItemId.push(eqmt._id),$scope.compareItems.push(eqmt)):_removeComparedItem(eqmt._id)},$scope.removeComparedItem=function(data){data.checked=!1,_removeComparedItem(data._id)},$scope.closeCompreDiv=function(){angular.forEach($scope.compareItems,function(data){data.checked=!1}),$scope.compareItems=[]};var _removeBidItem=function(id){var bidIndex=_bidItemId.indexOf(id);_bidItemId.splice(bidIndex,1),$scope.bidItems.splice(bidIndex,1)};$scope.checkBid=function(bideqmt){""!==$scope.filterModel.categoryId?$scope.userCId!==bideqmt._source.owner?$scope.bidItems.length<6?bideqmt.bidChecked?(_bidItemId.push(bideqmt._id),$scope.bidItems.push(bideqmt)):_removeBidItem(bideqmt._id):(Notification.error("Only 6 equipment are allowed for bid request."),bideqmt.bidChecked=!1):(Notification.error("You are the Owner of this equipment."),bideqmt.bidChecked=!1):(Notification.error("Select Category"),bideqmt.bidChecked=!1)},$scope.get=function(){return $scope.$broadcast("bidEvent"),$scope.checkBid()},$scope.removeBidItem=function(orderType,data){data.bidChecked=!1,_removeBidItem(data._id),$scope.addCart(orderType,data._id)},$scope.closeBidDiv=function(orderType,data){angular.forEach($scope.bidItems,function(data){data.bidChecked=!1,$scope.addCart(orderType,data._id),_bidItemId.splice(data._id,1)}),$scope.bidItems=[]},$scope.addCart=function(orderType,soloEquipId){if(""!==$scope.filterModel.categoryId){var equipId=soloEquipId;if($scope.rentDurationCart={},"bid"===orderType&&(equipId=_bidItemId),"rent"===$scope.type){var _durationStart=moment($scope.duration.startDate).format("DD/MM/YYYY"),_durationEnd=moment($scope.duration.endDate).format("DD/MM/YYYY");$scope.rentDurationCart.startDate=_durationStart,$scope.rentDurationCart.endDate=_durationEnd}"buy"===$scope.type&&($scope.rentDurationCart={}),$scope.userLoginValidate===!0?Equipments.addcartp({sessionId:_sessionId,categeoryId:$scope.filterModel.categoryId,equipmentId:equipId,duration:$scope.rentDurationCart,trasactionType:$scope.type,requestType:orderType,locationCity:$scope.addr.city,locationState:$scope.addr.state},function(_data){$state.go("logo.payment",{orderId:"",rtype:"buyer",ptype:"db",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})}):EquipmentsPublic.addCartItems({sessionId:_sessionId,categeoryId:$scope.filterModel.categoryId,equipmentId:equipId,duration:$scope.rentDurationCart,trasactionType:$scope.type,requestType:orderType,locationCity:$scope.addr.city,locationState:$scope.addr.state},function(_data){AuthenticationService.login(function(){$state.go("logo.payment",{orderId:"",rtype:"buyer",ptype:"db",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})})})}else Notification.error("Select Category")},$scope.addToInterested=function(equipData){AuthenticationService.login(function(){var eId=equipData._source.key;SweetAlert.swal({title:"Are you interested?",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm?$scope.saveInterested(eId,!0):$scope.saveInterested(eId,!1)})})},$scope.saveInterested=function(equipId,uStatus){Equipments.addInterested({equipmentId:equipId,uStatus:uStatus},function(res){200===res.status.statusCode?Notification.success(res.data):Notification.error(res.data)})}}]),angular.module("equipment").controller("comparePopupCtrl",["$scope","Equipments","EquipmentsPublic","compareEquip","$modalInstance","closeComp","$stateParams","bidValue","contextPathimageurl","$location","AuthenticationService","rentRequest","$state","$rootScope","ipCookie",function($scope,Equipments,EquipmentsPublic,compareEquip,$modalInstance,closeComp,$stateParams,bidValue,contextPathimageurl,$location,AuthenticationService,rentRequest,$state,$rootScope,ipCookie){var searchList=$location.search();$scope.type="undefined"==typeof searchList.type?"rent":searchList.type,$scope.contextPathimageurl=contextPathimageurl,$scope.compEquip=[],$scope.bidItems=[],$scope.city="",$scope.state="",$scope.startDate="",$scope.endDate="";var _sessionId=ipCookie("tempsession"),_catId=(ipCookie("userCId"),$location.search().categoryId);if("undefined"!=typeof $location.search().location){var addrArray=$location.search().location.split("~");$scope.city=addrArray.length>=0?addrArray[0]:"",$scope.state=addrArray.length>0?addrArray[1]:""}"rent"===$scope.type&&(void 0!==$location.search()["duration-start"]&&void 0!==$location.search()["duration-end"]?($scope.startDate=$location.search()["duration-start"],$scope.endDate=$location.search()["duration-end"]):($scope.startDate="",$scope.endDate="")),$scope.compEquip=compareEquip,$scope.closePopup=function(){$scope.compEquip.length<=0&&$scope.close()},$scope.closePopup(),$scope.addSoloComp=function(data){AuthenticationService.login(function(){rentRequest.rentPopup(data._source,function(){}),$modalInstance.close()})},$scope.openRentComp=function(data){AuthenticationService.login(function(){var cbAddCartRent=function(){$state.go("logo.payment",{orderId:"",rtype:"buyer",ptype:"db",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})};$scope.addCart("solo",data._source.key,cbAddCartRent),$modalInstance.close()})},$scope.userLoginValidate=AuthenticationService.isLogged(),$rootScope.$on("validateLogin",function(event,data){$scope.userLoginValidate=data.isLoggedIn}),$rootScope.$on("loginData",function(event,data){$scope.userLoginValidate=data}),$scope.$watch("AuthenticationService.isLoggedIn",function(){$scope.userLoginValidate=AuthenticationService.isLoggedIn}),$scope.addCart=function(orderType,soloEquipId,cbToPayment){if(""!==_catId){var equipId=soloEquipId;if($scope.rentDurationCart={},"bid"===orderType&&(equipId=_bidItemId),"rent"===$scope.type){var _durationStart=moment($scope.startDate).format("DD/MM/YYYY"),_durationEnd=moment($scope.endDate).format("DD/MM/YYYY");$scope.rentDurationCart.startDate=_durationStart,$scope.rentDurationCart.endDate=_durationEnd}"buy"===$scope.type&&($scope.rentDurationCart={}),$scope.userLoginValidate===!0?Equipments.addcartp({sessionId:_sessionId,categeoryId:_catId,equipmentId:equipId,duration:$scope.rentDurationCart,trasactionType:$scope.type,requestType:orderType,locationCity:$scope.city,locationState:$scope.state},function(res){200===res.status.statusCode?cbToPayment():Notification.error(res.status.statusMessage)}):EquipmentsPublic.addCartItems({sessionId:_sessionId,categeoryId:_catId,equipmentId:equipId,duration:$scope.rentDurationCart,trasactionType:$scope.type,requestType:orderType,locationCity:$scope.city,locationState:$scope.state},function(res){200===res.status.statusCode?cbToPayment():Notification.error(res.status.statusMessage)})}else Notification.error("Select Category")},$rootScope.$on("validateLogin",function(event,data){$scope.isLoggedIn=data.isLoggedIn,$scope.isLoggedIn&&$scope.loginCart()}),$scope.loginCart=function(){Equipments.logincart({sessionId:_sessionId},function(res){})},$scope.max=10,$scope.isReadonly=!0,$scope.close=function(){$modalInstance.close()};var _compItems=[],_removeCompItem=function(id){var comIndex=$scope.compEquip.indexOf(id);$scope.compEquip.splice(comIndex,1)};$scope.remove=function(data){_compItems.splice(data,1),_removeCompItem(data),$scope.closePopup()};var _bidItemId=($scope.compEquip,[]);$scope.bidItems=bidValue;var _removeBidItem=function(id){var bidIndex=_bidItemId.indexOf(id);_bidItemId.splice(bidIndex,1),$scope.bidItems.splice(bidIndex,1)};$scope.checkBid=function(data){data.bidChecked?(_bidItemId.push(data._id),$scope.bidItems.push(data)):_removeBidItem(data._id)},$scope.$on("bidEvent",function(e){$scope.$parent.checkBid=$scope.checkBid()}),$scope.proxy=function(x){return x}}]),angular.module("equipment").controller("requestPopupCtrl",["$scope","Equipments","EquipmentsPublic","$modalInstance","categoryId","Notification",function($scope,Equipments,EquipmentsPublic,$modalInstance,categoryId,Notification){$scope.user=[],$scope.submit=function(user){EquipmentsPublic.addcatreq({name:user.name,contact:user.contact,emailId:user.email,catgeoryId:categoryId},function(res){200===res.status.statusCode&&(Notification.success(res.data),$modalInstance.close())})},$scope.close=function(){$modalInstance.close()}}]),angular.module("equipment").controller("AuctionController",["$scope","Equipments","EquipmentsPublic","ipCookie","$stateParams","$state","$uibModal","AuthenticationService","contextPathimageurl","$location","rentRequest","title","Notification",function($scope,Equipments,EquipmentsPublic,ipCookie,$stateParams,$state,$uibModal,AuthenticationService,contextPathimageurl,$location,rentRequest,title,Notification){$scope.contextPathimageurl=contextPathimageurl;ipCookie("tempsession"),ipCookie("userCId")}]),angular.module("equipment").controller("userEqmtListCtrl",["$scope","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","Notification","$rootScope","title","SweetAlert","$timeout","CounDownTimer","Lightbox","SecurityDeposit",function($scope,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathimageurl,$uibModal,Notification,$rootScope,title,SweetAlert,$timeout,CounDownTimer,Lightbox,SecurityDeposit){var _userId=$scope.userCId,_role=$scope.roleC,_defaultName={disabled:!0,basic:{id:null}};$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC"),$scope.contextPathimageurl=contextPathimageurl,$scope.dynamic=0,$scope.allEqmtList=[],$scope.filter={},$scope.eqmtListNew=[],$scope.searchTextBox=!1,$scope.searchHeading="",$scope.layout=$state.params.layout,$scope.dynamic=0,$scope.eqmtList={eqmtId:[]},$scope.date={from:new Date,to:null},$scope.dateFrom={minDate:0,dateFormat:"dd/mm/yy"},$scope.dateTo={minDate:365,dateFormat:"dd/mm/yy"},$scope.eqmts=[],$scope.Name=_defaultName,$scope.totalItems=10,$scope.currentPage=1,$scope.inAuction=!0,$scope.createNew=!1,$scope.history=!1,$scope.showFilter=!0,$scope.max=5,$scope.isReadonly=!0,$scope.status=!0,$scope._addEqmt=function(){$state.go("search.dash.usereqmtadd",{tab:"basic"},{reload:!0})},$scope.editEquip=function(index){$state.go("search.dash.usereqmtadd",{eqmtId:$scope.equipments[index].equipmentId,tab:"basic"},{reload:!0})},$scope.filterEquip=function(){$scope.showFilter=!$scope.showFilter},$scope.setPage=function(pageNo){$scope.currentPage=pageNo},$scope.pageChangedNew=function(pageNo){$scope.currentPage=pageNo,$scope.users=$scope.Eqmt.getEqmp()},$scope.pageChanged=function(){$scope.users=$scope.Eqmt.getEqmp()},title("search.dash.usereqmtlist"===$state.current.name?"My Account - Manage my equipment : irontread.com":"My Account - Auction my equipment : irontread.com"),$scope.searchFilter=[{name:"Categories",id:"category"},{name:"Manufacturer",id:"manufacturer"},{name:"Year of Manufacture",id:"make_year"}],$scope.searchFilterAscDesc=[{name:"Ascending",id:"asc"},{name:"Descending",id:"desc"},{name:"via Text",id:"value"}],$scope.saStatus=function(str,opt){var other=["active","applied","emdpaid","inauction","commissionpaid"],past=["notavailable","singlebidder","zerobidder","auctioncancel","auctionclosed","outauction"];return"past"===opt?past.indexOf(str)>-1:other.indexOf(str)>-1},$scope.sAution=function(eqmt){$uibModal.open({templateUrl:"straightAuction.popup.html",controller:"straightAuction",size:"lg",resolve:{data:function(){return eqmt}}})},$scope.confirmation=function(_data){SweetAlert.swal({title:"Are you accept winner's price Rs. "+_data.winningAmount,text:"Your reserve price was "+_data.sa_reserved,type:"info",showCancelButton:!0,confirmButtonColor:"#5cb85c",confirmButtonText:"Accept",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Equipments.sellerConfirm({bid:_data.sa_bid_no,eid:_data.equipmentId,flag:1},function(res){200===res.status.statusCode&&(SweetAlert.swal("Accepted","You have accepted to Sell equipment at highest Bid price","success"),$state.go($state.current,{tabName:"inauction"},{reload:!0}))}):SweetAlert.swal("Canceled","","error")})},$scope.toggleView=function(layout){$state.go($state.current,{tabName:"create",layout:layout},{reload:!1})},$scope.openLightboxModal=function(img){$scope.image=[];var image={};image.url=contextPathimageurl+img,image.url=image.url.replace("175X175.","800X800.").replace("250X250.","800X800."),$scope.image.push(image),Lightbox.openModal($scope.image,0)},$scope.rejectAuction=function(_data){SweetAlert.swal({title:"Are you accept winner's price Rs. "+_data.winningAmount,text:"Your reserve price was "+_data.sa_reserved,type:"warning",showCancelButton:!0,confirmButtonColor:"#d9534f",confirmButtonText:"Reject",cancelButtonText:"Cancel",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Equipments.sellerConfirm({bid:_data.sa_bid_no,eid:_data.equipmentId,flag:0},function(res){200===res.status.statusCode&&(SweetAlert.swal("Reject","You have denied to Sell equipment at highest Bid price","error"),$state.go($state.current,{tabName:"inauction"},{reload:!0}))}):SweetAlert.swal("Canceled","","error")})},$scope.sortSelect=function(cat,feature){$scope.filter.on=cat.id,"via Text"===feature.name?($scope.searchHeading=cat.name,$scope.filter.by="",$scope.searchTextBox=!0):($scope.filter.by=feature.id,$scope.searchHeading=cat.name+" - "+feature.name,$scope.searchTextBox=!1)},$scope.updateToDate=function(date){var _newMin=new Date(date);_newMin.setDate(_newMin.getDate()+365),$scope.date.to=_newMin},$scope.updateToDate($scope.date.from),$scope.profileComplete=function(data){if(0!==data.length){var _value=data[0].basic+data[0].location+data[0].price+data[0].transportation,x=41;return $scope.dynamic=_value/x*100,Math.ceil($scope.dynamic)}$scope.dynamic=0},$rootScope.$on("$locationChangeSuccess",function(){$scope.select(),"search.dash.usereqmtlist"===$state.current.name&&title("My Account - Manage my equipment : irontread.com")}),$scope.select=function(){"inauction"===$state.params.tabName?($scope.inAuction=!0,$scope.createNew=!1,$scope.history=!1,title("My Account - Current Auction : irontread.com")):"create"===$state.params.tabName?($scope.inAuction=!1,$scope.createNew=!0,$scope.history=!1,title("My Account - Create new Auction : irontread.com")):"auctionhistory"===$state.params.tabName&&($scope.inAuction=!1,$scope.createNew=!1,$scope.history=!0,title("My Account - Auction History : irontread.com"))},$scope.onselect=function(data){$state.go($state.current,{tabName:data},{reload:!0}),$scope.Eqmt.getEqmp()},$scope.toTimeDate=function(d){return new Date(d)};var _errorHandler=function(e){console.error("Error 10037	"+e)},_eqmt={getEqmp:function(){ipCookie("userCId")&&("inauction"===$state.params.tabName||"auctionhistory"===$state.params.tabName?Equipments.getSAEquiList({tab:$state.params.tabName},function(res){200===res.status.statusCode&&($scope.equipments=res.data,$scope.totalItems=res.data.length)},_errorHandler):Equipments.getEqmpList({userId:_userId,role:_role,catid:null===$scope.Name.basic.id?"":$scope.Name.basic.id.catId,curentPage:$scope.currentPage,sa:$state.params.tabName,filter:$scope.filter},function(res){200===res.status.statusCode&&($scope.equipments=res.data.items,$scope.totalItems=res.data.length)},_errorHandler))},getCat:function(){EquipmentsPublic.getCat({userId:_userId,role:_role},function(res){200===res.status.statusCode&&($scope.categories=res.data)},_errorHandler)},getCatEqmp:function(){_eqmt.getEqmp()},searchEqmp:function(){Equipments.searchEqmp($scope.eqmp,function(res){200===res.status.statusCode&&($scope.equipments=res.data)},_errorHandler)}};$scope.getCategoriesNew=function(){ipCookie("userCId")&&Equipments.getUserCategories({},function(res){if(200===res.status.statusCode){var data=res.data,prop="catName";data=data.sort(function(a,b){return a[prop]>b[prop]?1:a[prop]<b[prop]?-1:0}),$scope.catsNew=data}},_errorHandler)};var tick=function(){processAuctionItems($scope.equipments),$timeout(tick,1e3)},processAuctionItems=function(data){angular.forEach(data,function(item){item.remainingTime=CounDownTimer.getRemainigTime(item.time_for_seller)})};$timeout(tick,1e3),$scope.allEqmt=function(){$scope.allEqmtList.eqmtId?($scope.eqmtList.eqmtId=$scope.equipments.map(function(res){return"1"!==res.payment&&""!==res.city&&0!==res.pricing.length&&"files/equipments/no_image_small.png"!==res.equipmentImg?res.equipmentId:void 0}),angular.forEach($scope.eqmtList.eqmtId,function(res){void 0!==res&&$scope.eqmtListNew.push(res)}),$scope.eqmtListNew>=0&&($scope.eqmtList.eqmtId=[])):($scope.eqmtList.eqmtId=[],$scope.eqmtListNew=[])},$scope.paylisting=function(fromdate,todate){null!==$scope.date.from&&null!==$scope.date.to?($scope.eqmtListNew.length>0&&($scope.eqmtList.eqmtId=$scope.eqmtListNew),$scope.eqmtList.eqmtId.length>0?$state.go("logo.payment",{orderId:"",rtype:"lessor",ptype:"elf",financeId:"",eqmtList:$scope.eqmtList.eqmtId,listingFrom:$scope.date.from,listingTo:$scope.date.to},{reload:!0}):Notification.error("Please select atleast one Equipment.")):Notification.error("Please select a date range for listing Equipments.")},$scope.Eqmt=_eqmt,$scope.rentStatus=function(data){if("files/equipments/no_image_small.png"===data.equipmentImg)return Notification.error("Please upload the equipment image to make it live for rent."),!1;if(0===data.length)return Notification.error("Please enter the rental & sale price of the machine to make it live for rent/sale."),!1;if(0!==data.length){var _daily=null,_weekly=null,_monthly=null,_yearly=null;if(angular.forEach(data.pricing,function(value,key){value.daily&&(_daily=value.daily),value.weekly&&(_weekly=value.weekly),value.monthly&&(_monthly=value.monthly),value.yearly&&(_yearly=value.yearly)}),!(_daily||_weekly||_monthly||_yearly))return Notification.error("Please enter the Rental price of the machine to make it live for rent."),!1;Equipments.changeEqmtFlag({eid:data.equipmentId,type:"Rent"},function(res){if(200===res.status.statusCode){$scope.Eqmt.getEqmp();var _change=!0;$rootScope.$emit("equiCount",_change)}210===res.status.statusCode&&SweetAlert.swal(res.data)})}},$scope.rentStatusRed=function(data){Equipments.changeEqmtFlag({eid:data.equipmentId,type:"Rent"},function(res){if(200===res.status.statusCode){$scope.Eqmt.getEqmp();var _change=!0;$rootScope.$emit("equiCount",_change)}})},$scope.saleStatus=function(data){if("files/equipments/no_image_small.png"===data.equipmentImg)Notification.error("Please upload the equipment image to make it live for sale.");else{if(0===data.length)return Notification.error("Please enter the rental & sale price of the machine to make it live for rent/sale."),!1;if(0!==data.length){var _salePrice=null;if(angular.forEach(data.pricing,function(value,key){_salePrice=value.sale}),_salePrice)return Notification.error("Please enter the Sale price of the machine to make it live for sale."),!1;Equipments.changeEqmtFlag({eid:data.equipmentId,type:"Sale"},function(res){if(200===res.status.statusCode){$scope.Eqmt.getEqmp();var _change=!0;$rootScope.$emit("equiCount",_change)}210===res.status.statusCode&&SweetAlert.swal(res.data)})}}},$scope.saleStatusRed=function(data,idx){Equipments.changeEqmtFlag({eid:data.equipmentId,type:"Sale",currentStatus:data.isSale},function(res){200===res.status.statusCode?$timeout(function(){$scope.equipments[idx].isSale=!$scope.equipments[idx].isSale,angular.forEach([1,3,4],function(k){$timeout(function(){$rootScope.$emit("equiCount",!0)},1e3*k)})},500):"string"==typeof res.data&&(Notification.error('<i class="fa fa-exclamation-circle" aria-hidden="true"></i> '+res.data),res.data.indexOf("Security deposit")>-1&&$scope.statusPopup(data,!1))})},$scope.statusPopup=function(eObj,direct){SecurityDeposit.securityDeposit(eObj.equipmentId,direct)},$scope.goToAuction=function(eid){$state.go("search.auctiondetails",{eqmtId:eid},{reload:!0})},$scope.createAuction=function(eid){$state.go("search.dash.usereqmtadd",{eqmtId:eid,tab:"straightauction"},{reload:!0})},$scope.leesorPaymentConfirm=function(equiData){SweetAlert.swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, confirm it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&Equipments.getSellerPayment({eid:equiData.equipmentId},function(res){200===res.status.statusCode?(equiData.is_winner_paid=2,SweetAlert.swal("Success!","Record Updated Successfully","success")):SweetAlert.swal("Error!",res.data,"error")},function(e){console.error("Error 10038	"+e)})})},$scope.doFilter=function(){_eqmt.getEqmp()},$scope.getInspection=function(catId,equipId,insId){$state.go("search.dash.inspectionquestion",{catId:catId,equipId:equipId,insId:insId},{reload:!1})};var _init=function(){_eqmt.getEqmp(),_eqmt.getCat()};_init(),$scope.select(),$scope.getCategoriesNew()}]),angular.module("equipment").controller("statusController",["$scope","$rootScope","serverType","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","$modalInstance","eObj","Notification","$timeout","direct",function($scope,$rootScope,serverType,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathImageUrl,$uibModal,$modalInstance,eObj,Notification,$timeout,direct){$scope.contextPathImageUrl=contextPathImageUrl,$scope.inc=0,$scope.data={p:null,sd:null,allow:!1,submit:"emdDetail",txn:null,remark:null,paymentStatus:null,isShowTab:!1},$scope.user={id:ipCookie("userCId"),name:ipCookie("userCName"),auth:ipCookie("authenticatedC"),role:ipCookie("roleC")},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.justCall=function(){function increment(){if($scope.inc>100){clearInterval(interval),$scope.data.loading=!0;try{var url=$scope.data.sd.url,token=url.split("/")[url.split("/").length-1];Equipments.pInfo({token:token,owner:$scope.data.sd.owner},function(res){200===res.status.statusCode?($rootScope.$broadcast("sdData",{server:serverType,url:$scope.data.sd.url,method:"POST",params:res.data.payment}),$timeout(function(){$scope.data.loading=!1,$rootScope.$broadcast("justCall",{}),$scope.inc=0},1e3)):"string"==typeof res.data?Notification.warning(res.data):"string"==typeof res.error&&Notification.error(res.error)},function(e){console.error("Error 10039	"+e)})}catch(e){console.error("Error 10040	"+e)}}else $scope.inc+=2}$scope.submit("true"),$scope.inc=1;var interval=setInterval(increment,100)};var getSDP=function(){Equipments.getSecurityDepositPayment({eid:eObj},function(res){200===res.status.statusCode&&res.data?(res.data.length>1&&res.data.sort(function(a,b){return new Date(b.cdate)-new Date(a.cdate)}),$scope.data.paymentStatus=res.data,$scope.data.isShowTab=3===$scope.data.paymentStatus[0].status||1===$scope.data.paymentStatus[0].status):res.data&&"string"==typeof res.data?Notification.warning(res.data):res.error&&"string"==typeof res.error&&Notification.error(res.error)})},init=function(){Equipments.securityDeposit({eid:eObj},function(res){200===res.status.statusCode&&res.data?($scope.data.allow=res.error&&res.data.amount&&res.error===res.data.amount,$scope.data.sd=res.data):res.data&&"string"==typeof res.data?(Notification.warning(res.data),$scope.close()):res.error&&"string"==typeof res.error&&(Notification.error(res.error),$scope.close())}),getSDP()};$scope.submit=function(isOnline){Equipments.addSecurityDepositPayment({owner:$scope.data.sd.owner,type:$scope.data.submit,txn:$scope.data.txn,remark:$scope.data.remark,eid:eObj,online:isOnline},function(res){200===res.status.statusCode?res.data&&"string"==typeof res.data?(Notification.success(res.data),getSDP()):res&&res.data&&"string"==typeof res.data.msg&&(Notification.success(res.data.msg),$scope.data.sd.url=res.data.plink,$scope.close()):res.data&&"string"==typeof res.data?Notification.warning(res.data):res.error&&"string"==typeof res.error&&Notification.error(res.error)})},init()}]),angular.module("equipment").controller("straightAuction",["$scope","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","$modalInstance","data","Notification",function($scope,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathimageurl,$uibModal,$modalInstance,data,Notification){$scope.contextPathimageurl=contextPathimageurl,$scope.eqmt=data,$scope.paymentData={},$scope.paymentData.eid=data.equipmentId,$scope.paymentData.type="",Equipments.misc({key:"paymentType"},function(res){$scope.paymentType=res.data.value,$scope.paymentData.type=$scope.paymentType[0]}),$scope.onConfirmPaymentSubmit=function(){return"undefined"==typeof $scope.paymentData.eid?(Notification.error("Something wrong, Please retry!"),!1):"undefined"==typeof $scope.paymentData.type?(Notification.error("Please select the Payment Type"),!1):"undefined"==typeof $scope.paymentData.number?(Notification.error("Please enter the "+$scope.paymentData.type),!1):void Equipments.addPaymentInfo($scope.paymentData,function(res){200===res.status.statusCode?($modalInstance.dismiss("cancel"),$state.go($state.current,{},{
reload:!0})):Notification.error(res.status.statusMessage)})},$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("equipment").controller("inspectionQuestionCtr",["$scope","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","Notification","$rootScope","title","SweetAlert","$timeout","CounDownTimer","Lightbox",function($scope,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathimageurl,$uibModal,Notification,$rootScope,title,SweetAlert,$timeout,CounDownTimer,Lightbox){$scope.init=function(){$scope.questionList=[],$scope.catId=$stateParams.catId,$scope.equipId=$stateParams.equipId,$scope.insId=$stateParams.insId,$scope.getQueryQuestion()},$scope.backFromIn=function(){window.history.back()};$scope.getQueryQuestion=function(){("undefined"!=typeof $scope.insId||""!==$scope.insId)&&Equipments.getQueryQuestion({queryId:$scope.insId},function(res){200===res.status.statusCode?$scope.questionList=res.data:Notification.error("Oops some thing is wrong.")},function(e){console.error("Error 10042	"+e)})},$scope.getQuestionDesign=function(questionId){$state.go("search.dash.inspectioncertification",{questionId:questionId,catId:$scope.catId,equipId:$scope.equipId,insId:$scope.insId},{reload:!1})},$scope.init()}]),angular.module("equipment").controller("inspectionCertiCtr",["$scope","Equipments","EquipmentsPublic","$state","$stateParams","ipCookie","contextPathimageurl","$uibModal","Notification","$rootScope","title","SweetAlert","$timeout","CounDownTimer","Lightbox",function($scope,Equipments,EquipmentsPublic,$state,$stateParams,ipCookie,contextPathimageurl,$uibModal,Notification,$rootScope,title,SweetAlert,$timeout,CounDownTimer,Lightbox){var _errorHandler=function(ex){console.error("Error 10043	"+ex)};$scope.init=function(){$scope.questionList=[],$scope.questionId=$stateParams.questionId,$scope.catId=$stateParams.catId,$scope.equipId=$stateParams.equipId,$scope.queryId=$stateParams.insId,$scope.certificationFormList=[],$scope.equipData=[],$scope.contextPathimageurl=contextPathimageurl,$scope.getCertificationForm()},$scope.backFromIn=function(){window.history.back()},$scope.convertStringToInt=function(strData){var convertData=0;try{convertData=parseFloat(strData)}catch(e){convertData=strData}return convertData},$scope.convertStringToArray=function(strData){var convertData=[];try{convertData=JSON.parse(strData)}catch(e){convertData=strData}return convertData},$scope.removeSlashString=function(strData){var convertData="";try{convertData=strData.replace(/\\/g,"/")}catch(e){convertData=strData}return convertData},$scope.convertImageStringToArray=function(strData){try{if(""!==strData)return"string"==typeof strData?JSON.parse(strData):strData}catch(e){return[]}},$scope.timeReset=function(dateTime){try{return moment(dateTime).format("MM/DD/YYYY")}catch(e){console.error("Error 10044	"+e)}},$scope.getCertificationForm=function(){Equipments.getCertificationForm({queryId:$scope.queryId,questionId:$scope.questionId,equipId:$scope.equipId},function(res){if(200===res.status.statusCode){var jsonData=res.data;"ans"===res.stat?($scope.mode=!0,$scope.ansId=res.ansId,$scope.certificationFormList=jsonData):$scope.certificationFormList=jsonData[0].ecqm_settings}},_errorHandler)},$scope.timeReset=function(dateTime){try{return moment(dateTime).format("MM/DD/YYYY")}catch(e){console.error("Error 10045	"+e)}},$scope.deleteImage=function(levelId,imgIndex){SweetAlert.swal({title:"Are you sure want to delete?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Delete it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){if(isConfirm){var temp=levelId.uploadFilePath;temp.splice(imgIndex,1),levelId.uploadFilePath=temp}})},$scope.uploadImage=function(image,levelId){Equipments.uploadImg({queryId:$scope.queryId,equipId:$scope.equipId,certImage:image},function(res){if(200===res.status.statusCode){var temp=levelId.uploadFilePath,tempDb=res.data,tempArray=[];""!==temp&&null!==temp&&(("undefined"==typeof temp||"undefined"===temp)&&(temp=[]),0===temp.length?tempArray.push(tempDb):(temp.push(tempDb),tempArray=temp)),delete levelId.certImage,delete levelId.tempcatImage,delete levelId.data,delete levelId.$$hashKey,levelId.uploadFilePath=[],$timeout(function(){levelId.uploadFilePath=tempArray},3e3),Notification.success("Image successfully added.")}},_errorHandler)},$scope.updateCerification=function(data){Equipments.submitAnswer({queryId:$scope.queryId,questionId:$scope.questionId,equipId:$scope.equipId,answerJson:data,questionName:$scope.certificationFormList[0].sno},function(res){200===res.status.statusCode&&Notification.success("Records are successfully updated.")},_errorHandler)},$scope.init()}]),angular.module("equipment").factory("Equipments",["$resource","contextPathprivate","multipartconverter",function($resource,contextPathprivate,multipartconverter){return $resource(contextPathprivate,{},{getEquipment:{url:contextPathprivate+"equip/find",method:"GET"},getAdministrator:{url:contextPathprivate+"users/findAll",method:"GET"},getState:{url:contextPathprivate+"state/all",method:"GET"},countEqmp:{url:contextPathprivate+"equip/countEqmp",method:"GET"},getEqmpList:{url:contextPathprivate+"equip/getEqmpList",method:"GET"},getEqmp:{url:contextPathprivate+"equip/getEqmp",method:"GET"},getCatEqmp:{url:contextPathprivate+"equip/catEqmp",method:"POST"},searchEqmp:{url:contextPathprivate+"equip/searchEqmp",method:"POST"},addWishList:{url:contextPathprivate+"user/addwishlist",method:"POST"},getUserWishList:{url:contextPathprivate+"user/getuserwishlist",method:"POST"},addEquipmentInWishList:{url:contextPathprivate+"user/addequipmentinwishlist",method:"POST"},setDefaultImage:{url:contextPathprivate+"equip/setDefaultImage",method:"POST"},deleteImage:{url:contextPathprivate+"equip/deleteImage",method:"POST"},addSolo:{url:contextPathprivate+"equipmentorder/addSolo",method:"POST"},removeRentalPeriod:{url:contextPathprivate+"equip/removeRentalPeriod",method:"POST"},wishlist:{url:contextPathprivate+"user/getuserwishlist",method:"POST"},getUserDeatail:{url:contextPathprivate+"finance/getuser",method:"POST"},getParticipants:{url:contextPathprivate+"straightbidding/getParticipantsList",method:"POST"},addParticipantBidPrice:{url:contextPathprivate+"straightbidding/addParticipantBidPrice",method:"POST"},applyForFinance:{url:contextPathprivate+"finance/applyForFinance",method:"POST"},changeEqmtFlag:{url:contextPathprivate+"equip/changeEqmtFlag",method:"POST"},logincart:{url:contextPathprivate+"equipmentcart/logincart",method:"POST"},addcartp:{url:contextPathprivate+"equipmentcart/addcartp",method:"POST"},getcartp:{url:contextPathprivate+"equipmentcart/getcartp",method:"POST"},getUserCategories:{url:contextPathprivate+"equip/getUserCategories",method:"GET"},straightAuctionPayment:{url:contextPathprivate+"straightbidding/addbid",method:"POST"},misc:{url:contextPathprivate+"user/misc",method:"POST"},addPaymentInfo:{url:contextPathprivate+"straightauction/addPaymentInfo",method:"POST"},addBidParticipantLessee:{url:contextPathprivate+"straightbidding/addBidParticipant",method:"POST"},getSAEquiList:{url:contextPathprivate+"straightauction/getSAEquiList",method:"GET"},getSellerPayment:{url:contextPathprivate+"straightbidding/getSellerPayment",method:"POST"},sellerConfirm:{url:contextPathprivate+"straightauction/sellerConfirm",method:"POST"},accountCheck:{url:contextPathprivate+"user/userFieldCheck",method:"POST"},addInterested:{url:contextPathprivate+"equipmentManagement/addinterested",method:"POST"},getQueryQuestion:{url:contextPathprivate+"inspector/getquestionlistuser",method:"POST"},getCertificationForm:{url:contextPathprivate+"certificationquestion/question",method:"POST"},submitAnswer:{url:contextPathprivate+"certificationquestion/saveanswerequip",method:"POST"},saveAnEnquiry:{url:contextPathprivate+"equip/saveAnEnquiry",method:"POST"},addSecurityDepositPayment:{url:contextPathprivate+"dealer/sale/addSecurityDepositPayment",method:"POST"},getSecurityDepositPayment:{url:contextPathprivate+"dealer/sale/getSecurityDepositPayment",method:"POST"},securityDeposit:{url:contextPathprivate+"sd/get",method:"POST"},pInfo:{method:"POST",url:contextPathprivate+"payment/getInfo"},finance:{url:contextPathprivate+"finance/add",method:"POST",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},addEquip:{url:contextPathprivate+"equip/addEquip",method:"POST",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},uploadImg:{url:contextPathprivate+"certificationquestion/imageupload",method:"POST",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},equipments:{url:contextPathprivate+"equip/search",method:"GET",params:{category:"@category",categoryId:"@categoryId"},interceptor:{response:function(data){return data.data}}},equipmentDetails:{url:contextPathprivate+"equip/details",method:"GET",params:{eqmtID:"@eqmtID"},interceptor:{response:function(data){return data.data}}},getCity:{url:contextPathprivate+"city/getbyid",method:"GET",interceptor:{response:function(data){return data.data}}},getCityHint:{url:contextPathprivate+"city/byhint",method:"GET",interceptor:{response:function(data){return data.data}}}})}]),angular.module("equipment").factory("EquipmentsPublic",["$resource","contextPathpublic","multipartconverter",function($resource,contextPathpublic,multipartconverter){return $resource(contextPathpublic,{},{countEqmp:{method:"GET",url:contextPathpublic+"equip/countEqmp"},getEqmpList:{method:"GET",url:contextPathpublic+"equip/getEqmpList"},getEqmp:{method:"GET",url:contextPathpublic+"equip/getEqmp"},getCatEqmp:{method:"POST",url:contextPathpublic+"equip/catEqmp"},searchEqmp:{method:"POST",url:contextPathpublic+"equip/searchEqmp"},addCartItems:{method:"POST",url:contextPathpublic+"equipmentcart/addcart"},bulkCreate:{method:"POST",url:contextPathpublic+"bulkUpload/product"},getCartItems:{method:"POST",url:contextPathpublic+"equipmentcart/getcart"},getBreadCrumb:{method:"POST",url:contextPathpublic+"common/getBreadcrumb"},suggestionSearch:{method:"POST",url:contextPathpublic+"equip/getMatchEquipments"},isEquipInAuction:{method:"POST",url:contextPathpublic+"straightbidding/isEquipInSAuction"},getproductcertification:{method:"POST",url:contextPathpublic+"equip/getproductcertification"},getequipspec:{method:"GET",url:contextPathpublic+"equipmentmaster/getequipspec"},addcatreq:{method:"POST",url:contextPathpublic+"categorrequest/addcatreq"},getSAEquip:{method:"POST",url:contextPathpublic+"straightauction/getSAEquip"},getCategeoryDecS:{method:"POST",url:contextPathpublic+"common/getcatdes"},isInspectionLinkValid:{method:"POST",url:contextPathpublic+"equip/isInspectionLinkValid"},getEquipment:{method:"GET",url:contextPathpublic+"equip/find"},getAdministrator:{method:"GET",url:contextPathpublic+"users/findAll"},getState:{method:"GET",url:contextPathpublic+"state/all"},getCat:{method:"GET",url:contextPathpublic+"cat/find"},searchequipments:{method:"POST",url:contextPathpublic+"equip/search",params:{q:"@q"},interceptor:{response:function(data){return data.data}}},equipments:{method:"POST",url:contextPathpublic+"equip/search",interceptor:{response:function(data){return data.data}}},filters:{method:"POST",url:contextPathpublic+"equip/filters",interceptor:{response:function(data){return data.data}}},equipmentDetails:{method:"GET",url:contextPathpublic+"equip/details",params:{eqmtID:"@eqmtID"},interceptor:{response:function(data){return data.data}}},getCity:{method:"GET",url:contextPathpublic+"city/getbyid",interceptor:{response:function(data){return data.data}}},addEquip:{method:"POST",url:contextPathpublic+"equip/addEquip",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},getCityHint:{method:"GET",url:contextPathpublic+"city/byhint",interceptor:{response:function(data){return data.data}}}})}]),angular.module("payment").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("logo.payment",{url:'/payment?ptype=""&orderId=""',views:{"main@logo":{templateUrl:"modules/payment/views/payment.client.view.html",controller:"PaymentController"}},params:{orderId:"",rtype:"",ptype:"",financeId:"",eqmtList:"",listingFrom:"",listingTo:""}}).state("logo.paymentLink",{url:"/p/:token",views:{"main@logo":{templateUrl:"modules/payment/views/payment.link.client.view.html",controller:"PaymentLinkCtrl"}},params:{token:""}}).state("logo.payment.paymentbid",{url:"/paymentbid",views:{"paymentdetail@logo.payment":{templateUrl:"modules/payment/views/paymentBid.client.view.html",controller:"PaymentBidController"}},params:{bidEquipment:""}}).state("logo.payment.paymentnonsolo",{url:"/paymentnonsolo",views:{"paymentdetail@logo.payment":{templateUrl:"modules/payment/views/paymentNonSolo.client.view.html"}}}).state("logo.payment.listingFeePayment",{url:"/listingFeePayment",views:{"paymentdetail@logo.payment":{templateUrl:"modules/payment/views/listingFeePayment.client.view.html",controller:"listingFeePaymentController"}},params:{eqmtList:"",listingFrom:"",listingTo:""}}).state("logo.payment.paymentFinance",{url:"/paymentFinance/:financeId",views:{"paymentdetail@logo.payment":{templateUrl:"modules/payment/views/paymentFinance.client.view.html",controller:"paymentFinanceController"}},params:{financeId:""}}).state("logo.payment.paymentauction",{url:"/paymentauction",views:{"paymentdetail@logo.payment":{templateUrl:"modules/payment/views/paymentstraightauction.client.view.html",controller:"PaymentStraightBidController"}},params:{equipmentId:"",bidId:"",bidItemId:"",reqUserType:""}}).state("search.samplepayment",{url:'/samplepayment?status=""&orderno=""',views:{"main@search":{templateUrl:"modules/payment/views/sample.client.view.html",controller:"sampleController"}},params:{status:"",orderno:""}})}]),angular.module("payment").controller("bankPaymentController",["$scope","$http",function($scope,$http){}]),angular.module("payment").controller("listingFeePaymentController",["$scope","paymentWS","PaymentPublic","$state","contextPathimageurl","paymentDetail","$rootScope",function($scope,paymentWS,PaymentPublic,$state,contextPathimageurl,paymentDetail,$rootScope){$scope.contextPathimageurl=contextPathimageurl,$scope.eqmtDetails=[],$scope.isCouponList=!1,$scope.listingFeeTotal=1e3,$scope.couponValue=1e3,$scope.netPaymentList=1e3,$scope.equipmentList=$state.params.eqmtList,$scope.fromDate=$state.params.listingFrom,$scope.toDate=$state.params.listingTo,$scope.listingPay=function(){try{angular.forEach($scope.equipmentList,function(_eqmtId){PaymentPublic.details({eqmtId:_eqmtId},function(res){if(200===res.status.statusCode){var _eqmt=res.data[0]._source;$scope.eqmtDetails.push(_eqmt)}})});var orderData={orderId:$scope.toDate,equipmentId:$scope.equipmentList,reqUserType:$scope.fromDate,reqOrderType:"eqmtListing"};paymentDetail.setorderDetail(orderData)}catch(e){}},$scope.listingPay(),$rootScope.$on("couponValue",function(event,data){$scope.isCouponList=!0,$scope.netPaymentList=0})}]),angular.module("payment").controller("PaymentController",["$scope","$http","paymentWS","$state","ipCookie","$stateParams","paymentDetail","$sessionStorage","$localStorage","SweetAlert","title","$rootScope","Notification","PaymentPublic","contextPathimageurl","$timeout","serverType",function($scope,$http,paymentWS,$state,ipCookie,$stateParams,paymentDetail,$sessionStorage,$localStorage,SweetAlert,title,$rootScope,Notification,PaymentPublic,contextPathimageurl,$timeout,serverType){$scope.paymentlink="","staging"===serverType||"local"===serverType?$("form#payform").attr("action","https://test.payu.in/_payment"):$("form#payform").attr("action","https://secure.payu.in/_payment"),$scope.paymentData={},$scope.paymentInfo={},$scope.paymentInfo.couponcode="ITCUP5000",$scope.pStat=!1,$scope.coupanStatus=!1,$scope.isPromoHide=!1,$rootScope.$on("$locationChangeSuccess",function(){title("IronTrade Secure Online Payment")}),title("IronTrade Secure Online Payment"),$scope.add={},$scope.max=5,$scope.orderNoDB="",$scope.isReadonly=!0,$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope._sessionId=ipCookie("tempsession"),$scope.reqAddressStatus="show",$scope.contextPathimageurl=contextPathimageurl,$scope.orderId=$state.params.orderId,$scope.rtype=$state.params.rtype,$scope.ptype=$state.params.ptype,$scope.transactionType="buy",$scope.termType="",$scope.equipmentIdP="",$scope.categoryId="",$scope.locationCity="",$scope.locationState="",$scope.priceInit=0,$scope.priceType="",$scope.processType="",$scope.equipData={},$scope.bidEquipmentList=[],$scope.equipData.quantity=1,$scope.eqmtDetails=[],"undefined"!=typeof $scope.rtype&&""!==$scope.rtype?"buyer"===$scope.rtype&&"db"===$scope.ptype?($scope.getCartData(),$scope.processType="db"):"lessee"===$scope.rtype&&"dr"===$scope.ptype?($scope.processType="dr",$scope.getGlobalDataPayment("direct rental",$scope.rtype)):"lessee"===$scope.rtype&&"rar"===$scope.ptype?($scope.processType="rar",$scope.getGlobalDataPayment("rental auction",$scope.rtype)):"lessee"===$scope.rtype&&"rab"===$scope.ptype?($scope.processType="rab",$scope.getGlobalDataPayment("buy auction",$scope.rtype)):"lessee"===$scope.rtype&&"dbf"===$scope.ptype?($scope.processType="dbf",$scope.getOrderDetails(),$scope.getGlobalDataPayment("direct buy",$scope.rtype)):"lessee"===$scope.rtype&&"drf"===$scope.ptype?($scope.processType="drf",$scope.getGlobalDataPayment("direct rental",$scope.rtype)):"lessee"===$scope.rtype&&"rabf"===$scope.ptype?($scope.processType="rabf",$scope.getGlobalDataPayment("buy auction",$scope.rtype),$scope.getOrderDetails()):"lessee"===$scope.rtype&&"rarf"===$scope.ptype?($scope.processType="rarf",$scope.getGlobalDataPayment("rental auction",$scope.rtype),$scope.getOrderDetails()):"lessee"===$scope.rtype&&"frp"===$scope.ptype?($scope.processType="frp",$scope.financeId=$stateParams.financeId,$scope.getFinanceData(),$scope.getGlobalDataPayment("finance",$scope.rtype)):"lessor"===$scope.rtype&&"elf"===$scope.ptype&&($scope.processType="elf",$scope.equipmentList=$state.params.eqmtList,$scope.startDate=moment($state.params.listingFrom).format("DD/MM/YYYY"),$scope.endDate=moment($state.params.listingTo).format("DD/MM/YYYY"),$scope.listingPay(),$scope.getGlobalDataPayment("Equipment List Fee",$scope.rtype)):$scope.rollBack()},$scope.rollBack=function(){window.history.back()},$scope.getFinanceData=function(){paymentWS.paymentpageinfo({financeId:$scope.financeId},function(res){200===res.status.statusCode&&($scope.data=res.data)})},$scope.listingPay=function(){try{angular.forEach($scope.equipmentList,function(_eqmtId){PaymentPublic.details({eqmtId:_eqmtId},function(res){if(200===res.status.statusCode){var _eqmt=res.data[0]._source;$scope.eqmtDetails.push(_eqmt)}})})}catch(e){}},$scope.getEquipmentDetail=function(equipId,reqType){try{PaymentPublic.getEquipment({eqmtId:equipId},function(res){if(res.data.length>0&&null!==res.data.length){$scope.data=res.data[0],"cart"===reqType&&($scope.priceInit=parseInt($scope.data._source.price_details.rates.sale)),$scope.imgScr="";try{angular.forEach($scope.data._source.images_thumbnail,function(imgItem){$scope.imgScr=contextPathimageurl+imgItem.eue_path})}catch(e){$scope.imgScr=""}}},_errorHandler)}catch(e){}},$scope.getCartData=function(){try{paymentWS.getCartData({userId:$scope.userCId},function(res){angular.forEach(res.data,function(bidObj){var orderTypeDb=bidObj.orderType,equipmentIdDb=bidObj.equipmentId;if($scope.transactionType=bidObj.transaction,$scope.requiredLocation=bidObj.locationCity+" , "+bidObj.locationState,"solo"===orderTypeDb)$scope.locationCity=bidObj.locationCity,$scope.locationState=bidObj.locationState,$scope.equipmentIdP=equipmentIdDb,$scope.getEquipmentDetail(equipmentIdDb,"cart"),$scope.getGlobalDataPayment("direct buy",$scope.rtype);else if("bid"===orderTypeDb&&"rent"===$scope.transactionType){var rentStartDate="",rentEndDate="";try{"undefined"!=typeof bidObj.duration[0].startDate&&""!==bidObj.duration[0].endDate&&"rent"===bidObj.transaction&&(rentStartDate=bidObj.duration[0].startDate,rentEndDate=bidObj.duration[0].endDate,$scope.startDate=rentStartDate,$scope.endDate=rentStartDate)}catch(e){}$scope.equipmentIdP=equipmentIdDb,$scope.categoryId=bidObj.categoryId,$scope.locationCity=bidObj.locationCity,$scope.locationState=bidObj.locationState,$scope.rentDuration=bidObj.duration,$scope.getEquipData(equipmentIdDb,rentStartDate,rentEndDate)}else"bid"===orderTypeDb&&"buy"===$scope.transactionType&&($scope.equipmentIdP=equipmentIdDb,$scope.categoryId=bidObj.categoryId,$scope.locationCity=bidObj.locationCity,$scope.locationState=bidObj.locationState,$scope.getEquipData(equipmentIdDb,"",""))})},_errorHandler)}catch(e){}};var _userId=$scope.userCId,_errorHandler=function(e){SweetAlert.swal("Error!",e.statusMessage,"error")};$scope.addressBook=[],$scope.getState=function(){paymentWS.getState({},function(res){if(200===res.status.statusCode){var jsonData=res.data;jsonData.length>0&&($scope.stateList=jsonData)}},_errorHandler)},$scope.getCity=function(_stateId){paymentWS.getCity({stateId:_stateId},function(res){if(200===res.status.statusCode){var jsonData=res.data;jsonData.length>0?$scope.cityList=jsonData:$scope.cityList=[]}},_errorHandler)},$scope.newAddress=function(isValid,add){if(isValid){var stateName="",cityName="";try{stateName=add.state.stateName}catch(e){stateName=""}try{cityName=add.city.city}catch(e){cityName=""}paymentWS.saveAddress({userId:_userId,userName:add.userName,address1:add.address1,address2:add.address2,landMark:add.landMark,state:stateName,city:$scope.addr.city,pinCode:add.pinCode,phoneNo:add.phoneNo,altPhoneNo:add.altPhoneNo},function(res){200===res.status.statusCode&&($scope.getAddress(),$scope.show=!1,$scope.addBook=!0)},_errorHandler)}else Notification.error("Please enter valid address.")},$scope.getAddress=function(){paymentWS.getAddress({userId:_userId},function(res){if(200===res.status.statusCode){var jsonData=res.data;jsonData&&jsonData.length>0&&($scope.addressBook=jsonData)}},_errorHandler)},$scope.getAddress(),$scope.selectedAddress=function(index){var a=$scope.addressBook[0];$scope.addressBook[0]=$scope.addressBook[index],$scope.addressBook[index]=a},$scope.addBook=!0,$scope.addr={city:null,state:null},$scope.autoCompleteOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"administrative_area_level_1"===item.types[0]&&($scope.addr.state=item.long_name),"locality"===item.types[0]&&($scope.addr.city=item.long_name)}),null!==$scope.addr.state&&angular.forEach($scope.stateList,function(state){$scope.addr.state===state.stateName&&($scope.add.state=state)})}},$scope.click=function(){$scope.show=!0,$scope.addBook=!1,$scope.getState()},$scope.back=function(){$scope.show=!1,$scope.addBook=!0},$scope.addAddress=function(addressId){$scope.addBook=!0,$scope.show=!1,$scope.addModel=$scope.addressBook[addressId]},$scope.removeAddress=function(addressData,index,addId){SweetAlert.swal({title:"Are you sure?",text:"You will not be able to recover this address!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel it!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&paymentWS.removeAddress({addressId:addId},function(res){200===res.status.statusCode?(addressData.splice(index,1),SweetAlert.swal("Success!",res.data,"success")):SweetAlert.swal("Error!",res.data,"error")},_errorHandler)})},$scope.detailsShow=!1;var intIndex=0;$scope.detailsClick=function(){$scope.detailsShow=intIndex%2===0,intIndex++},$scope.emptyCartItems=function(categoryId,trType){},$scope.brokeragePerPayment=0,$scope.interestRatePayment=0,$scope.serviceTaxPay=0,$scope.totalPay=0,$scope.promoCodeValue=0,$scope.netPayment=0,$scope.subtotal=0,$scope.orderType="",$scope.getPaymentHash=function(){PaymentPublic.getPaymentHash({paymentData:$scope.paymentData},function(res){200===res.status.statusCode&&($scope.paymentData.hash=res.data)},function(err){console.error("Error 10046	"+err)})},$scope.getGlobalDataPayment=function(type,reqUserTypeS){try{paymentWS.getStraightAuctionData({name:type},function(res){200===res.status.statusCode&&"undefined"!=typeof res.data[0]&&(angular.forEach(res.data[0].settings,function(items){angular.forEach(items,function(val,key){"frp"===$scope.ptype?"lessee"!==reqUserTypeS&&"buyer"!==reqUserTypeS||"serviceTax"!==key?"lessee"!==reqUserTypeS&&"buyer"!==reqUserTypeS||"financeEmd"!==key||($scope.brokeragePerPayment=val,$scope.inspectionFee=2500,$scope.valutationFee=1e3):$scope.interestRatePayment=val:"elf"===$scope.ptype?"lessor"===reqUserTypeS&&"serviceTax"===key?$scope.interestRatePayment=val:"lessor"===reqUserTypeS&&"lessorEmd"===key&&($scope.brokeragePerPayment=val):("lessee"!==reqUserTypeS&&"buyer"!==reqUserTypeS||"lesseePercentage"!==key)&&("lessee"!==reqUserTypeS&&"buyer"!==reqUserTypeS||"serviceTax"!==key?"lessee"!==reqUserTypeS&&"buyer"!==reqUserTypeS||"lesseeEmd"!==key||($scope.brokeragePerPayment=val):$scope.interestRatePayment=val)})}),"direct rental"!==type||"dr"!==$scope.ptype&&"drf"!==$scope.ptype?"direct buy"!==type||"db"!==$scope.ptype&&"dbf"!==$scope.ptype?"rental auction"===type&&"rar"===$scope.ptype?($scope.termType="reverse-rent-auction",$scope.pCalculation("rentalauction"),$scope.getCartData()):"buy auction"===type&&"rab"===$scope.ptype?($scope.termType="reverse-sale-auction",$scope.pCalculation("buyauction"),$scope.getCartData()):"buy auction"===type&&"rabf"===$scope.ptype?($scope.termType="reverse-sale-auction",$scope.pCalculation("buyauction")):"rental auction"===type&&"rarf"===$scope.ptype?($scope.termType="reverse-rent-auction",$scope.pCalculation("rentalauction")):"finance"===type&&"frp"===$scope.ptype?($scope.termType="#",$scope.pCalculation("finance")):"Equipment List Fee"===type&&"elf"===$scope.ptype&&($scope.termType="#",$scope.pCalculation("Equipment List Fee")):($scope.termType="direct-sale",$scope.pCalculation("directbuy")):($scope.getOrderDetails(),$scope.termType="direct-rent",$scope.pCalculation("directrent")))},_errorHandler)}catch(e){}},$scope.pCalculation=function(reType){$scope.orderType=reType,"Equipment List Fee"===reType?($scope.brokerageBase=$scope.brokeragePerPayment,$scope.brokeragePerPayment=$scope.brokerageBase*$scope.equipmentList.length,$scope.serviceTaxPay=parseInt($scope.interestRatePayment/100*$scope.brokeragePerPayment),$scope.totalPay=parseInt($scope.brokeragePerPayment)+parseInt($scope.serviceTaxPay),$scope.promoCodeValue=$scope.totalPay,$scope.netPayment=$scope.totalPay-$scope.promoCodeValue,0===$scope.netPayment&&($scope.isPromoHide=!0)):"finance"===reType?($scope.subtotal=parseInt($scope.brokeragePerPayment)+parseInt($scope.inspectionFee)+parseInt($scope.inspectionFee),$scope.serviceTaxPay=parseInt($scope.interestRatePayment/100*$scope.subtotal),$scope.totalPay=$scope.subtotal+parseInt($scope.serviceTaxPay),$scope.promoCodeValue=0,$scope.netPayment=$scope.totalPay-$scope.promoCodeValue):($scope.serviceTaxPay=parseInt($scope.interestRatePayment/100*$scope.brokeragePerPayment),$scope.totalPay=parseInt($scope.brokeragePerPayment)+parseInt($scope.serviceTaxPay),$scope.promoCodeValue=0,$scope.netPayment=$scope.totalPay-$scope.promoCodeValue)},$scope.doPayment=function(confirmpayment){"undefined"!=typeof confirmpayment&&confirmpayment===!0?"directbuy"===$scope.orderType&&""!==$scope.equipmentIdP?$scope.soloBuyPayment($scope.equipmentIdP,$scope.transactionType):"lessee"===$scope.rtype&&"dr"===$scope.ptype?$scope.soloPayment():"lessee"===$scope.rtype&&"rar"===$scope.ptype?"undefined"!=typeof $scope.equipData.quantity&&"undefined"!=typeof $scope.equipData.bidDuration&&"undefined"!=typeof $scope.equipData.rentalPurpose&&""!==$scope.equipData.rentalPurpose?$scope.bidRentPayment():SweetAlert.swal("Error!","Please Enter Mandatary Inputs to Send Bid Invitation","error"):"lessee"===$scope.rtype&&"rab"===$scope.ptype?"undefined"!=typeof $scope.equipData.quantity&&"undefined"!=typeof $scope.equipData.bidDuration?$scope.bidBuyPayment():SweetAlert.swal("Error!","Please Enter Mandatary Inputs to Send Bid Invitation","error"):"lessee"===$scope.rtype&&"dbf"===$scope.ptype?$scope.failedTrasaction():"lessee"===$scope.rtype&&"drf"===$scope.ptype?$scope.failedTrasaction():"lessee"===$scope.rtype&&"rabf"===$scope.ptype?$scope.failedBidTrasaction():"lessee"===$scope.rtype&&"rarf"===$scope.ptype?$scope.failedBidTrasaction():"lessee"===$scope.rtype&&"frp"===$scope.ptype?$scope.financePayment():"lessor"===$scope.rtype&&"elf"===$scope.ptype?$scope.payLisitingFee():SweetAlert.swal("Error!","Please Select Equipment.","error"):SweetAlert.swal("Error!","Please Confirm Terms & Conditions","error")},$scope.soloBuyPayment=function(equipmentId,transactionFor){"undefined"==typeof $scope.addressBook||null===$scope.addressBook||0===$scope.addressBook.length?SweetAlert.swal("Error!","Please provide shipping address.","error"):(delete $scope.addressBook[0].$$hashKey,$scope.addressBook[0].country="India",paymentWS.placeEquipmentBuyOrder({equipmentId:equipmentId,transactionFor:transactionFor,orderType:"Solo Binding",cityRequired:$scope.locationCity,stateRequired:$scope.locationState,shippingAddress:$scope.addressBook[0],billingAddress:$scope.addressBook[0],isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode},function(res){200===res.status.statusCode&&""!==res.orderId?($scope.paymentData=res.data,"indirect"===res.action?$scope.submitPayment():$state.go("search.thankyou",{type:"direct-buy",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):SweetAlert.swal("Error!",res.data,"error")},_errorHandler))},$scope.getOrderDetails=function(){paymentWS.getOrderItem({orderId:$scope.orderId},function(res){if("undefined"!=typeof res.data&&res.data.length>0)if($scope.orderNoDB=res.data[0].orderNoDB,"Solo Binding"===res.data[0].orderType)$scope.getEquipmentDetail(res.data[0].equipmentId,"order"),$scope.type=res.data[0].transactionFor,"rent"===$scope.type?($scope.startDate=res.data[0].rentalStartDate,$scope.endDate=res.data[0].rentalEndDate,$scope.requiredLocation=res.data[0].locationReq,$scope.daysDuration=moment(moment($scope.endDate,"DD/MM/YYYY")).diff(moment($scope.startDate,"DD/MM/YYYY"),"days"),$scope.durationReq=0,$scope.priceInit=parseInt(res.data[0].priceRate),$scope.daysDuration>29?$scope.priceType="Monthly":$scope.priceType="Daily"):$scope.priceInit=parseInt(res.data[0].amount);else if("Bid"===res.data[0].orderType){$scope.priceInit=parseInt(res.data[0].amount);var equipDb=[];angular.forEach(res.data[0].bidArray.eb_bid_items,function(items){equipDb.push(items.eb_bid_items_equipment_id)}),$scope.getEquipData(equipDb,"","")}},_errorHandler)},$scope.soloPayment=function(){"undefined"==typeof $scope.addressBook||null===$scope.addressBook||0===$scope.addressBook.length?SweetAlert.swal("Error!","Please provide shipping address.","error"):(delete $scope.addressBook[0].$$hashKey,$scope.addressBook[0].country="India",paymentWS.placeEquipmentOrder({orderId:$scope.orderId,reqUserType:$scope.rtype,shippingAddress:$scope.addressBook[0],billingAddress:$scope.addressBook[0],isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode},function(res){200===res.status.statusCode?"indirect"===res.action?($scope.paymentData=res.data,$scope.submitPayment()):(SweetAlert.swal("Success","Your rental request has been processed successfully.","success"),$state.go("search.thankyou",{type:"directrent",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):SweetAlert.swal("Error!",res.data,"error")},_errorHandler))},$scope.getEquipData=function(equipmentIdArray,rentStartDate,rentEndDate){angular.forEach(equipmentIdArray,function(equipId){try{PaymentPublic.getEquipment({eqmtId:equipId},function(res){if(res.data.length>0&&($scope.bidEquipmentList.push(res.data[0]),
"rar"===$scope.ptype)){var duration=moment(moment(rentEndDate,"DD/MM/YYYY")).diff(moment(rentStartDate,"DD/MM/YYYY"),"days");$scope.priceType="Daily Rate",duration>29&&($scope.priceType="Monthly Rate"),$scope.priceCalculation(res.data[0],duration)}},_errorHandler)}catch(e){}})},$scope.priceCalculation=function(equipData,days){var _monthly=0;try{_monthly=equipData._source.price_details.rates.monthly}catch(e){_monthly=0}var _daily=0;try{_daily=equipData._source.price_details.rates.daily}catch(e){_daily=0}days>29?equipData.rate=_monthly:equipData.rate=_daily},$scope.bidRentPayment=function(){"undefined"==typeof $scope.addressBook||null===$scope.addressBook||0===$scope.addressBook.length?SweetAlert.swal("Error!","Please provide shipping address.","error"):(delete $scope.addressBook[0].$$hashKey,$scope.addressBook[0].country="India",$scope.equipmentIdArray=[],angular.forEach($scope.equipmentIdP,function(equipId){$scope.equipmentIdArray.push({equipmentId:equipId})}),$scope.equipmentIdArray.length>$scope.equipData.quantity?paymentWS.placeEquipmentBidOrder({userId:_userId,equipmentIdArray:$scope.equipmentIdArray,shippingAddress:$scope.addressBook[0],billingAddress:$scope.addressBook[0],period:$scope.rentDuration,orderType:"Bid",transactionFor:"rent",paymentType:"Credit card",quantity:$scope.equipData.quantity,bidDuration:$scope.equipData.bidDuration,rentalPurpose:$scope.equipData.rentalPurpose,categoryId:$scope.categoryId,isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode,locationCity:$scope.locationCity,locationState:$scope.locationState},function(res){200===res.status.statusCode?"indirect"===res.action?($scope.paymentData=res.data,$scope.submitPayment()):(SweetAlert.swal("Success","Your rental auction request has been processed successfully.","success"),$scope.emptyCartItems($scope.categoryId,"rent"),$state.go("search.thankyou",{type:"reverse-auction-rent",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):SweetAlert.swal("Error!",res.data,"error")},_errorHandler):SweetAlert.swal("Error!","Please add more equipment to send bid invitation.","error"))},$scope.bidBuyPayment=function(){"undefined"==typeof $scope.addressBook||null===$scope.addressBook||0===$scope.addressBook.length?SweetAlert.swal("Error!","Please provide shipping address.","error"):(delete $scope.addressBook[0].$$hashKey,$scope.addressBook[0].country="India",$scope.equipmentIdArray=[],angular.forEach($scope.equipmentIdP,function(equipId){$scope.equipmentIdArray.push({equipmentId:equipId})}),$scope.equipmentIdArray.length>$scope.equipData.quantity?paymentWS.placeEquipmentBuyBidOrder({equipmentIdArray:$scope.equipmentIdArray,shippingAddress:$scope.addressBook[0],billingAddress:$scope.addressBook[0],period:"",orderType:"Bid",transactionFor:"buy",quantity:$scope.equipData.quantity,bidDuration:$scope.equipData.bidDuration,rentalPurpose:"",categoryId:$scope.categoryId,isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode,locationCity:$scope.locationCity,locationState:$scope.locationState},function(res){200===res.status.statusCode?"indirect"===res.action?($scope.paymentData=res.data,$scope.submitPayment()):(SweetAlert.swal("Success","Your purchase auction request has been processed successfully.","success"),$scope.emptyCartItems($scope.categoryId,"buy"),$state.go("search.thankyou",{type:"reverse-auction-buy",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):SweetAlert.swal("Error!",res.data,"error")},_errorHandler):SweetAlert.swal("Error!","Please add more equipment to send bid invitation.","error"))},$scope.failedTrasaction=function(){paymentWS.failedTrasaction({orderId:$scope.orderId,isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode},function(res){200===res.status.statusCode?"indirect"===res.action?($scope.paymentData=res.data,$scope.submitPayment()):"dbf"===$scope.ptype?$state.go("search.thankyou",{type:"direct-buy",orderId:res.orderId,orderNo:res.orderNo},{reload:!0}):"drf"===$scope.ptype&&(SweetAlert.swal("Success","Your rental auction request has been processed successfully.","success"),$state.go("search.thankyou",{type:"reverse-auction-rent",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):SweetAlert.swal("Error!",res.data,"error")},_errorHandler)},$scope.failedBidTrasaction=function(){paymentWS.failedBidTrasaction({orderId:$scope.orderId,isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode},function(res){200===res.status.statusCode?"indirect"===res.action?($scope.paymentData=res.data,$scope.submitPayment()):"rabf"===$scope.ptype?(SweetAlert.swal("Success","Your purchase auction request has been processed successfully.","success"),$state.go("search.thankyou",{type:"reverse-auction-buy",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):"rarf"===$scope.ptype&&(SweetAlert.swal("Success","Your rental auction request has been processed successfully.","success"),$state.go("search.thankyou",{type:"reverse-auction-rent",orderId:res.orderId,orderNo:res.orderNo},{reload:!0})):SweetAlert.swal("Error!",res.data,"error")},_errorHandler)},$scope.financePayment=function(){paymentWS.financePayment({financeId:$scope.financeId,isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode},function(res){200===res.status.statusCode&&("indirect"===res.action?($scope.paymentData=res.data,$scope.submitPayment()):$state.go("search.dash.financeMain.finance",{},{reload:!0}))},_errorHandler)},$scope.payLisitingFee=function(){paymentWS.listingPayment({eqmtList:$scope.equipmentList,listingFrom:$scope.startDate,listingTo:$scope.endDate,isCoupon:$scope.coupanStatus,couponCode:$scope.paymentInfo.couponcode},function(res){200===res.status.statusCode&&(SweetAlert.swal("Success","Equipment has been successfully Listed.","success"),$state.go("search.dash.usereqmtlist",{},{reload:!0}))})},$scope.submitPayment=function(){$timeout(function(){$("#btnSubmit").click()},1e3)},$scope.applyCoupanCode=function(){if("frp"===$scope.processType){$scope.coupanStatus=!0,$scope.promoCodeValue=$scope.subtotal;var temp=parseInt($scope.subtotal)-parseInt($scope.promoCodeValue);$scope.serviceTaxPay=parseInt($scope.interestRatePayment/100*temp),$scope.totalPay=temp+$scope.serviceTaxPay,$scope.netPayment=temp+$scope.serviceTaxPay}else $scope.coupanStatus=!0,$scope.promoCodeValue=$scope.totalPay,$scope.netPayment=parseInt($scope.totalPay)-parseInt($scope.promoCodeValue)},$scope.init()}]),angular.module("payment").controller("PaymentLinkCtrl",["$scope","$state","$stateParams","PaymentPublic","paymentWS","contextPathimageurl","$uibModal",function($scope,$state,$stateParams,PaymentPublic,paymentWS,contextPathimageurl,$uibModal){$scope.pData={},$scope.fakeRow=function(num){return num=5-num,(!num||1>num)&&(num=1),new Array(num)},$scope.contextPathimageurl=contextPathimageurl,$scope.eurl="",$scope.getBase64FromImageUrl=function(url,index){var img=new Image;img.setAttribute("crossOrigin","anonymous"),img.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height;var ctx=canvas.getContext("2d");ctx.drawImage(this,0,0),$scope.eurl=canvas.toDataURL("image/jpg")},img.src=url},$scope.addPromo=function(){var modalInstance=$uibModal.open({templateUrl:"promo.html",controller:"promoPaymentLinkCtrl",size:"sm",resolve:{data:function(){return null}}});modalInstance.result.then(function(promo){try{$scope.pData.promo=promo}catch(e){$scope.pData.promo={code:null,amount:0,percent:null}}},function(){})};var init=function(){PaymentPublic.getInfo({token:$stateParams.token},function(res){200===res.status.statusCode&&($scope.pData=res.data)})};init()}]),angular.module("payment").controller("promoPaymentLinkCtrl",["$scope","$modalInstance","Notification",function($scope,$uibModalInstance,Notification){$scope.data={promo:null},$scope.close=function(){$uibModalInstance.dismiss(null)},$scope.applyPromo=function(){$uibModalInstance.close({code:$scope.data.promo,amount:1e3,percent:null})}}]),angular.module("payment").controller("PaymentBidController",["$scope","$state","$stateParams","paymentDetail","paymentWS","PaymentPublic","$sessionStorage","ipCookie","contextPathimageurl","$rootScope",function($scope,$state,$stateParams,paymentDetail,paymentWS,PaymentPublic,$sessionStorage,ipCookie,contextPathimageurl,$rootScope){var _errorHandler=function(e){};$scope.isFree=!0,$scope.isCoupan=!0,$scope.contextPathimageurl=contextPathimageurl,$scope.bidEquipmentList=[],$scope.transaction="",$scope.brokeragePrice=0,$scope.totalPay=0,$scope.netBrokrage=0,$scope.rentType="Daily Rate",$scope.priceValue=0,$scope.serviceTax=0,$scope.serviceTaxPrice=0,$scope.promocodeValue=0,$scope.netTotalPayment=0,$scope.totalPayment=0,$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.reqUserType=$state.params.reqUserType,"undefined"==typeof $scope.reqUserType?$scope.reqUserType="lessee":$scope.reqUserType="lessor"},$scope.getGlobalData=function(type){try{paymentWS.getStraightAuctionData({name:type},function(res){200===res.status.statusCode&&"undefined"!=typeof res.data[0]&&angular.forEach(res.data[0].settings,function(items){angular.forEach(items,function(val,key){"lessee"===$scope.reqUserType&&"lesseeEmd"===key?($scope.brokeragePrice=val,$scope.totalPay=val):"lessee"===$scope.reqUserType&&"serviceTax"===key&&($scope.serviceTax=val,$scope.serviceTaxPrice=Math.round($scope.serviceTax/100*$scope.brokeragePrice),$scope.totalPayment=Math.round(parseInt($scope.brokeragePrice)+parseInt($scope.serviceTaxPrice)),$scope.promocodeValue=Math.round($scope.totalPayment),$scope.netTotalPayment=Math.round(parseInt($scope.totalPayment)-parseInt($scope.promocodeValue)))})})},_errorHandler)}catch(e){}},$scope.init(),paymentWS.getCartData({userId:$scope.userCId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(bidData){if(bidData.equipStatus===!0){var rentStartDate="",rentEndDate="";try{"undefined"!=typeof bidData.duration[0].startDate&&""!==bidData.duration[0].endDate&&"rent"===bidData.transaction&&(rentStartDate=bidData.duration[0].startDate,rentEndDate=bidData.duration[0].endDate)}catch(e){}$scope.transaction=bidData.transaction;var orderRegType=bidData.orderType,orderData={orderId:$scope.transaction,equipmentId:"",reqUserType:$scope.reqUserType,reqOrderType:bidData.orderType};paymentDetail.setorderDetail(orderData),"bid"===orderRegType&&$scope.getEquipData(bidData.equipmentId,rentStartDate,rentEndDate),"rent"===$scope.transaction?$scope.getGlobalData("rental auction"):$scope.getGlobalData("buy auction")}})},_errorHandler),$scope.getEquipData=function(equipmentIdArray,rentStartDate,rentEndDate){angular.forEach(equipmentIdArray,function(equipId){try{PaymentPublic.getEquipment({eqmtId:equipId},function(res){if(res.data.length>0&&($scope.bidEquipmentList.push(res.data[0]),"rent"===$scope.transaction)){var duration=moment(moment(rentEndDate,"DD/MM/YYYY")).diff(moment(rentStartDate,"DD/MM/YYYY"),"days");duration>29&&($scope.rentType="Monthly Rate"),$scope.priceCalculation(res.data[0],duration)}},_errorHandler)}catch(e){}})},$scope.rollBack=function(){0===$state.params.bidEquipment.length&&window.history.back()},$scope.rollBack(),$scope.priceCalculation=function(equipData,days){var _monthly=0;try{_monthly=equipData._source.price_details.rates.monthly}catch(e){_monthly=0}var _weekly=0;try{_weekly=equipData._source.price_details.rates.weekly}catch(e){_weekly=0}var _daily=0;try{_daily=equipData._source.price_details.rates.daily}catch(e){_daily=0}days>29?equipData.rate=_monthly:equipData.rate=_daily},$scope.equipData=[],$scope.equipData.quantity=1,$scope.setBidData=function(equipData){var quantity=0,bidDuration=0;"undefined"!=typeof equipData.quantity&&(quantity=equipData.quantity),"undefined"!=typeof equipData.bidDuration&&(bidDuration=equipData.bidDuration);var quantityData={quantity:quantity,bidDuration:equipData.bidDuration,rentalPurpose:equipData.rentalPurpose};paymentDetail.setBidDetail(quantityData)},$rootScope.$on("couponValue",function(event,data){$scope.isCoupan=!0,$scope.netBrokrage=0})}]),angular.module("payment").controller("paymentFinanceController",["$scope","$http","paymentWS","$stateParams","contextPathimageurl","paymentDetail",function($scope,$http,paymentWS,$stateParams,contextPathimageurl,paymentDetail){$scope.data=[],$scope.contextPathimageurl=contextPathimageurl,$scope.paymentpageinfo=function(){paymentWS.paymentpageinfo({financeId:$stateParams.financeId},function(res){200===res.status.statusCode&&($scope.data=res.data)})};var orderData={orderId:"",equipmentId:$stateParams.financeId,reqUserType:"lessee",reqOrderType:"financepayment"};paymentDetail.setorderDetail(orderData),$scope.paymentpageinfo()}]),angular.module("payment").controller("PaymentNonSoloController",["$scope","$http",function($scope,$http){}]),angular.module("payment").controller("PaymentSoloController",["$scope","$http","$state","$stateParams","ipCookie","PaymentPublic","paymentWS","contextPathimageurl","paymentDetail","$rootScope",function($scope,$http,$state,$stateParams,ipCookie,PaymentPublic,paymentWS,contextPathimageurl,paymentDetail,$rootScope){}]),angular.module("payment").controller("PaymentStraightBidController",["$scope","$http","$state","$stateParams","ipCookie","PaymentPublic","paymentWS","contextPathimageurl","paymentDetail","$rootScope",function($scope,$http,$state,$stateParams,ipCookie,PaymentPublic,paymentWS,contextPathimageurl,paymentDetail,$rootScope){var _errorHandler=function(e){console.error("Error 10047	"+e)},pgData=function(data){if(data){var pDetails=JSON.parse(JSON.stringify($state.params));pDetails.percentageofBasic=$scope.sPrice,pDetails.equipBasicPrice=$scope.basicPrice,pDetails.emd=$scope.brokeragePrice,pDetails.securityPrice=$scope.securityPrice,pDetails.totalPrice=$scope.totalPrice,pDetails.netPayment=$scope.netPayment,$rootScope.$emit("paySAuction",pDetails)}};("undefined"==typeof $state.params.reqUserType||""===$state.params.reqUserType)&&$state.go("home"),$scope.init=function(){$scope.isCoupon=!1,$scope.netPayment=0,$scope.userCId=ipCookie("userCId"),$scope.reqAddressStatus="show",$scope.brokeragePrice=0,$scope.securityPrice=0,$scope.reqUserType=$state.params.reqUserType,$scope.equipmentId=$state.params.equipmentId,$scope.basicPrice=0,$scope.totalPrice=0,$scope.sPrice=0,$scope.getStraightAuctionData()},$scope.getStraightAuctionData=function(){try{paymentWS.getStraightAuctionData({name:"straight auction"},function(res){200===res.status.statusCode&&("undefined"!=typeof res.data[0]&&angular.forEach(res.data[0].settings,function(items){angular.forEach(items,function(val,key){"lessor"===$scope.reqUserType&&"lessorEmd"===key?$scope.brokeragePrice=parseFloat(val):"lessor"===$scope.reqUserType&&"lessorPercentage"===key?$scope.sPrice=parseFloat(val):"lessee"===$scope.reqUserType&&"lesseeEmd"===key?$scope.brokeragePrice=parseFloat(val):"lessee"===$scope.reqUserType&&"lesseePercentage"===key&&($scope.sPrice=parseFloat(val))})}),$scope.getEquipmentDetail($scope.equipmentId))},_errorHandler);var orderData={orderId:"",equipmentId:$scope.equipmentId,reqUserType:$scope.reqUserType,reqOrderType:"straightbid"};paymentDetail.setorderDetail(orderData)}catch(e){}},$scope.getEquipmentDetail=function(equipId){try{PaymentPublic.getEquipment({eqmtId:equipId},function(res){if(res.data.length>0&&null!==res.data.length){$scope.data=res.data[0],$scope.basicPrice=$scope.data._source.sauction.sa_base_price,$scope.securityPrice=$scope.basicPrice*$scope.sPrice/100,$scope.totalPrice=$scope.brokeragePrice+$scope.securityPrice,$scope.imgScr="";try{pgData(!0),angular.forEach($scope.data._source.images_thumbnail,function(imgItem){$scope.imgScr=contextPathimageurl+imgItem.eue_path})}catch(e){console.error(e),$scope.imgScr=""}}},_errorHandler)}catch(e){}},$scope.init(),$scope.detailsShow=!1,$scope.detailsClick=function(){$scope.detailsShow=!$scope.detailsShow},$rootScope.$on("couponValue",function(event,data){$scope.isCoupon=!0,$scope.netPayment=0,pgData(!0)})}]),angular.module("payment").factory("paymentWS",["$resource","contextPathprivate",function($resource,contextPathprivate){return $resource(contextPathprivate,{},{getAddress:{url:contextPathprivate+"user/getaddress",method:"POST"},placeEquipmentOrder:{url:contextPathprivate+"equipmentorder/updateorder",method:"POST"},placeEquipmentBuyOrder:{url:contextPathprivate+"equipmentorder/addSolobuy",method:"POST"},manageEqipMentList:{url:contextPathprivate+"equip/manageequipments",method:"POST"},placeEquipmentBidOrder:{url:contextPathprivate+"equipmentorder/addbid",method:"POST"},placeEquipmentBuyBidOrder:{url:contextPathprivate+"equipmentorder/addbuybid",method:"POST"},getState:{url:contextPathprivate+"state/all",method:"GET"},getCity:{url:contextPathprivate+"city/getbyiddata",params:{stateId:""},method:"POST"},saveAddress:{url:contextPathprivate+"user/addaddress",method:"POST"},updateSoloDuration:{url:contextPathprivate+"equipmentcart/updatesolocart",method:"POST"},getCartData:{url:contextPathprivate+"equipmentcart/getCartData",method:"POST"},getOrderItem:{url:contextPathprivate+"equipmentorder/getorderitem",method:"POST"},getBidDataItem:{url:contextPathprivate+"equipmentorder/getbiddataitem",method:"POST"},paymentBidCommission:{url:contextPathprivate+"equipmentorder/paymentbidcommission",method:"POST"},emptyCart:{url:contextPathprivate+"equipmentcart/removecartitem",method:"POST"},getStraightAuctionData:{url:contextPathprivate+"globals/getstraightauction",method:"POST"},addbidparticipant:{url:contextPathprivate+"straightbidding/addbidparticipant",method:"POST"},paymentpageinfo:{url:contextPathprivate+"finance/paymentpageinfo",method:"POST"},financePayment:{url:contextPathprivate+"finance/payment",method:"POST"},listingPayment:{url:contextPathprivate+"equipmentlisting/payment",method:"POST"},failedTrasaction:{url:contextPathprivate+"equipmentorder/failedtrasaction",method:"POST"},failedBidTrasaction:{url:contextPathprivate+"equipmentorder/failedbidtrasaction",method:"POST"},removeAddress:{url:contextPathprivate+"user/removeaddressbook",method:"POST"}})}]),angular.module("payment").factory("PaymentPublic",["$resource","contextPathpublic",function($resource,contextPathpublic){return $resource(contextPathpublic,{},{getCartItems:{url:contextPathpublic+"equipmentcart/getcart",method:"POST"},getEquipment:{url:contextPathpublic+"equip/details",method:"GET",params:{eqmtID:"@eqmtID"},interceptor:{response:function(data){return data.data}}},details:{url:contextPathpublic+"equip/details",method:"GET"},getPaymentHash:{url:contextPathpublic+"paymentmethod/gethash",method:"POST"},getInfo:{url:contextPathpublic+"payment/getInfo",method:"POST"},callPayu:{url:"https://test.payu.in/_payment",method:"POST"}})}]),angular.module("payment").factory("paymentDetail",function(){var data={},order={};return{getDetail:function(){return data},getorderDetail:function(){return order},setDetail:function(detail){data.equipmentId=detail.equipId,data.duration=detail.duration,data.type=detail.type,data.orderType=detail.orderType,data.priceInit=detail.priceInit},setorderDetail:function(detail){order.orderId=detail.orderId,order.equipmentId=detail.equipmentId,order.reqUserType=detail.reqUserType,order.reqOrderType=detail.reqOrderType,order.priceInit=detail.priceInit},setBidDetail:function(detail){data.quantity=detail.quantity,data.bidDuration=detail.bidDuration,data.rentalPurpose=detail.rentalPurpose}}}),angular.module("transporter").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("search.trans",{"abstract":!0,views:{"main@search":{templateUrl:"modules/transporter/views/transporter.client.view.html",controller:"dashboardCtrl"}}}).state("search.trans.board",{"abstract":!0,views:{"transuseractions@search.trans":{templateUrl:"modules/transporter/views/transporter.main.view.html",controller:"transMaindashboardCtrl"}}}).state("search.trans.board.main",{url:"/transdash",views:{"equipLT@search.trans.board":{templateUrl:"modules/transporter/views/transporter.live.equip.html"}}}).state("search.trans.currentrental",{url:"/transcurrental",views:{"transuseractions@search.trans":{templateUrl:"modules/transporter/views/currentrental.client.view.html",controller:"currentRentalCtrl"}}}).state("search.trans.completeorder",{url:"/transcomporder",views:{"transuseractions@search.trans":{templateUrl:"modules/transporter/views/completeorder.client.view.html",controller:"completeOrderCtrl"}}}).state("search.trans.servicearea",{url:"/transservicearea",views:{"transuseractions@search.trans":{templateUrl:"modules/transporter/views/servicearea.client.view.html",controller:"serviceAreaCtrl"}}})}]),angular.module("transporter").controller("completeOrderCtrl",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$modal","$localStorage",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$modal,$localStorage){$scope.userData=[],$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.init=function(){},$scope.init();$scope.userCId}]),angular.module("transporter").controller("currentRentalCtrl",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$modal","$localStorage",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$modal,$localStorage){$scope.userData=[],$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.init=function(){},$scope.init();$scope.userCId}]),angular.module("transporter").controller("serviceAreaCtrl",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$modal","$localStorage",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$modal,$localStorage){$scope.userData=[],$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.init=function(){},$scope.init();$scope.userCId}]),angular.module("transporter").controller("transMaindashboardCtrl",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$modal","$localStorage",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$modal,$localStorage){$scope.userData=[],$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.init=function(){},$scope.init();$scope.userCId}]),angular.module("user").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("search.dash",{url:"/myaccount",views:{"main@search":{templateUrl:"modules/user/views/dashboard.client.view.html",controller:"dashboardCtrl"}}}).state("search.dash.board",{"abstract":!0,views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.main.view.html",controller:"dashboardMainCtrl"}}}).state("search.dash.board.lessee",{url:"/lessee/?:tabName",views:{"rentLT@search.dash.board":{templateUrl:"modules/user/views/dashboard.live.rent.html",controller:"dashboardLiveRentCtrl"},"buyLT@search.dash.board":{templateUrl:"modules/user/views/dashboard.live.rentAuction.html",controller:"dashboardLiveRentCtrl"},"directbuyLT@search.dash.board":{templateUrl:"modules/user/views/directBuy.client.view.html",controller:"saleController"},"buyAuctionLT@search.dash.board":{templateUrl:"modules/user/views/buyAuction.client.view.html",controller:"dashboardLiveBuyCtrl"}},params:{tabName:"rent"}}).state("search.dash.board.lessor",{url:"/lessor/?:tabName",views:{"lessorRentIn@search.dash.board":{templateUrl:"modules/user/views/dashboard.live.lessor.html",controller:"dashboardLiveLessorCtrl"},"lessorRentInAuction@search.dash.board":{templateUrl:"modules/user/views/dashboard.live.seller.html",controller:"dashboardLiveLessorCtrl"},"lessorBuy@search.dash.board":{templateUrl:"modules/user/views/buyAuctionLessor.client.view.html",controller:"dashboardLiveSellerCtrl"},"lessorBuyAuction@search.dash.board":{templateUrl:"modules/user/views/buyAuctionLessor.client.view.html",controller:"dashboardLiveSellerCtrl"}},params:{tabName:"rent"}}).state("search.livetransaction",{url:"/livetransaction",views:{"main@search":{templateUrl:"modules/user/views/livetransaction.user.renting.html",controller:"livetransactionCtrl"}}}).state("search.dash.user",{url:"/lessor/usermanage",views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.user.managment.html",controller:"usermanagementCtrl"}}}).state("search.dash.misReport",{url:"/lessor/misReport",views:{"useractions@search.dash":{templateUrl:"modules/user/views/misReport.client.view.html",controller:"misReportController"}}}).state("search.dash.userverification",{url:"/lessor/userverification",views:{"useractions@search.dash":{templateUrl:"modules/user/views/userVerification.client.view.html",controller:"userVerificationCtrl"}}}).state("search.dash.newfinance",{url:"/lessee/newfinance/:tab/:eqmtId/:financeId&:tabs?:status",views:{"useractions@search.dash":{templateUrl:"modules/user/views/newfinance.client.view.html",controller:"newfinanceController"}},params:{tab:"",eqmtId:"",financeId:"",tabs:null,status:""}}).state("search.dash.financeMain",{"abstract":!0,views:{"useractions@search.dash":{templateUrl:"modules/user/views/financeMain.client.view.html",controller:"dashboardMainCtrl"}}}).state("search.dash.financeMain.finance",{url:"/lessee/finance/?:tabName=",views:{"finance@search.dash.financeMain":{templateUrl:"modules/user/views/finance.client.view.html",controller:"financeController"},"financeview@search.dash.financeMain":{templateUrl:"modules/user/views/financeView.client.view.html",controller:"financeViewController"}},params:{tabName:""}}).state("search.thankyou",{url:'/thankyou/?type=""&orderId=""&orderNo=""',views:{"main@search":{templateUrl:"modules/user/views/thankyou.client.view.html",controller:"thankyouController"}},params:{type:"",orderId:"",orderNo:""}}).state("search.dash.useradd",{url:'/lessor/usermanageadd?childUserId=""',views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.add.user.html",controller:"addusermanagementCtrl"}},params:{childUserId:null}}).state("search.dash.useredit",{url:"/lessor/usermanageedit",views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.edit.user.html",controller:"editusermanagementCtrl"}}}).state("search.dash.auctionHall",{url:"/lessee/auctionHall/?:tabName",views:{"useractions@search.dash":{templateUrl:"modules/user/views/auctionHall.client.view.html",controller:"auctionHallController"}},params:{tabName:"current"}}).state("search.dash.auctionHallLessor",{url:"/lessor/auctionHall",views:{"useractions@search.dash":{templateUrl:"modules/user/views/auctionHallLessor.client.view.html",controller:"auctionHallLessorController"}}}).state("search.dash.preferences",{url:"/lessee/preferences",views:{"useractions@search.dash":{templateUrl:"modules/user/views/userPrefrence.client.view.html",controller:"prefrenceController"}}}).state("search.changepass",{url:"/changepass",views:{"main@search":{templateUrl:"modules/user/views/changepassword.client.view.html",controller:"changepasswordCtrl"}}}).state("search.dash.review",{url:"/lessor/reviews",views:{"useractions@search.dash":{templateUrl:"modules/user/views/reviews.client.view.html",controller:"reviewsCtrl"}}}).state("search.dash.notification",{url:"/lessor/notification",views:{"useractions@search.dash":{templateUrl:"modules/user/views/notification.client.view.html",controller:"notificationCtrl"}}}).state("search.dash.profile",{url:"/lessor/profile",views:{"useractions@search.dash":{templateUrl:"modules/user/views/user.profile.client.view.html",controller:"userProfileCtrl"}}}).state("search.dash.orderdetails",{url:"/lessor/orderdetails/?:tabName",views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.orderdetails.lessor.html",controller:"orderdetailsCtrl"}},params:{tabName:"currentOrder"}}).state("search.dash.cancelInvite",{url:"/lessor/cancelinvite",views:{"useractions@search.dash":{templateUrl:"modules/user/views/cancelInvite.lessor.view.html",controller:"cancelInviteCtrl"}}}).state("search.dash.cancelOrder",{url:"/lessee/cancelorder",views:{"useractions@search.dash":{templateUrl:"modules/user/views/cancelOrder.lessee.view.html",controller:"cancelOrderCtrl"}}}).state("search.dash.currentrental",{url:"/lessee/currentrental/?:tabName:orderId",views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.currentrental.lessor.html",controller:"currentRentalCtrl"}},params:{tabName:"currentOrder"}}).state("search.dash.pastrental",{url:"/lessee/pastrental",views:{"useractions@search.dash":{templateUrl:"modules/user/views/dashboard.pastrental.lessor.html",controller:"pastRentalCtrl"}}}).state("search.dash.wishlist",{url:"/lessee/wishlist",views:{"useractions@search.dash":{templateUrl:"modules/user/views/wishlist.client.view.html",controller:"wishlistCtrl"}}}).state("search.dash.wishlistitem",{url:"/lessee/wishlistitem/:?tab",views:{"useractions@search.dash":{templateUrl:"modules/user/views/wishlist.item.client.view.html",controller:"wishlistitemCtrl"}},params:{wishItems:"",tab:""}}).state("search.verifyemail",{url:"/verifyemail/:token",views:{"main@search":{templateUrl:"modules/user/views/verifyemail.client.view.html",controller:"verifyemailCtrl"}},params:{token:""}}).state("search.thankyouSA",{url:"/sathankyou/:userType/:paymentType/:eid",views:{"main@search":{templateUrl:"modules/user/views/thankyouSA.client.view.html",controller:"thankyouControllerSA"}},params:{userType:"",paymentType:"",eid:""}})}]),angular.module("user").controller("auctionHallController",["$scope","userWS","$state","title","$rootScope","SweetAlert",function($scope,userWS,$state,title,$rootScope,SweetAlert){$scope.details=[],$scope.auctionData=function(){userWS.getEquipOfParticipants({},function(res){200===res.status.statusCode&&($scope.details=res.data)})},$scope.saStatus=function(str,opt){var future=["active","applied"],current=["emdpaid","inauction","commissionpaid"],past=["notavailable","singlebidder","zerobidder","auctioncancel","auctionclosed","outauction"];return"current"===opt?current.indexOf(str)>-1?!0:!1:"future"===opt?future.indexOf(str)>-1?!0:!1:"past"===opt?past.indexOf(str)>-1?!0:!1:void 0},$scope.auctionData(),$scope.goToAuction=function(eid){$state.go("search.auctiondetails",{eqmtId:eid},{reload:!0})},$scope.leeseePaymentConfirm=function(equiData){SweetAlert.swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, confirm it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&userWS.getBuyerPayment({eid:equiData.equipmentId},function(res){200===res.status.statusCode?(equiData.is_winner_paid=1,SweetAlert.swal("Success!","Record Updated Successfully","success")):SweetAlert.swal("Error!",res.data,"error")},function(e){console.error("Error 10050	"+e)})})},$scope.select=function(){"current"===$state.params.tabName?($scope.current=!0,$scope.future=!1,$scope.history=!1,title("My Account - Current Auctions : irontread.com")):"future"===$state.params.tabName?($scope.current=!1,$scope.future=!0,$scope.history=!1,title("My Account - Future Auctions : irontread.com")):"history"===$state.params.tabName?($scope.current=!1,$scope.future=!1,$scope.history=!0,title("My Account - Future Auctions : irontread.com")):($scope.current=!0,$scope.future=!1,$scope.history=!1,title("My Account - Current Auctions : irontread.com"))},$scope.select(),$rootScope.$on("$locationChangeSuccess",function(){$scope.select()}),$scope.changeUrl=function(value){$state.go($state.current,{tabName:value},{reload:!1})}}]),angular.module("user").controller("auctionHallLessorController",["$scope","userWS","userWSPublic","$state",function($scope,userWS,userWSPublic,$state){$scope.details=[],$scope.auctionData=function(){
userWS.auctionHallLessor({},function(res){200===res.status.statusCode&&($scope.details=res.data,angular.forEach($scope.details,function(value,key){$scope.equipDetail(value.eid),$scope.runBidTimerUserBuy(value.eid,value.end_time)}))})},$scope.auctionData(),$scope.equipDetail=function(_id){userWSPublic.equipmentDetails({eqmtID:_id},function(res){200===res.status.statusCode})},$scope.runBidTimerUserBuy=function(divId,endTime){$scope.diff=Math.abs(moment(endTime).diff(moment())/1e3);var itId="#"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}}]),angular.module("user").controller("cancelInviteCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage","$location",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage,$location){var _errorHandler=function(e){alert(e.statusMessage)};$scope.cancelInviteData=[],$scope.bidLostData=[],$scope.totalItemsBidLost=10,$scope.totalItemsBidInvite=10,$scope.currentBidLost=1,$scope.currentBidInvite=1,$scope.setPageBidLost=function(pageNo){},$scope.pageChangedBidLost=function(pageNo){$scope.currentBidLost=pageNo,$scope.getLostBid()},$scope.getLostBid=function(){userWS.getLostBidCount({},function(res){200===res.status.statusCode&&($scope.totalItemsBidLost=res.length,userWS.getLostBid({currentPage:$scope.currentBidLost},function(response){200===response.status.statusCode&&angular.forEach(response.finalout,function(items){angular.forEach(items,function(innerItem){$scope.bidLostData.push(innerItem)})})},_errorHandler))},_errorHandler)},$scope.setPageBidInvite=function(pageNo){},$scope.pageChangedBidInvite=function(pageNo){$scope.currentBidInvite=pageNo,$scope.getCancelInvite()},$scope.getCancelInvite=function(){userWS.getCancelInviteBidCount({},function(res){200===res.status.statusCode&&($scope.totalItemsBidInvite=res.length,userWS.cancelBid({reqUser:"lessor",currentPage:$scope.currentBidInvite},function(response){200===response.status.statusCode&&angular.forEach(response.finalout,function(items){angular.forEach(items,function(innerItem){$scope.cancelInviteData.push(innerItem)})})},_errorHandler))},_errorHandler)},$scope.getCancelInvite()}]),angular.module("user").controller("cancelOrderCtrl",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","SweetAlert",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,SweetAlert){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.usertype="lessee",$rootScope.$emit("onuserselect",$scope.usertype),$scope.getOrderDetails()};var _errorHandler=($scope.userCId,function(e){alert(e.statusMessage)});$scope.cancelOrderList=[],$scope.getOrderDetails=function(){userWS.getCancelRentals({userId:$scope.userCId,reqUserType:$scope.usertype},function(res){200===res.status.statusCode&&($scope.cancelOrderList=res.data)},_errorHandler)},$scope.init()}]),angular.module("user").controller("cancleInviteCtrl",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$uibModal","$localStorage","$location",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$uibModal,$localStorage,$location){}]),angular.module("user").controller("cancleOrderCtrl",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","SweetAlert",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,SweetAlert){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.usertype="lessee",$rootScope.$emit("onuserselect",$scope.usertype),$scope.getOrderDetails()};var _errorHandler=($scope.userCId,function(e){alert(e.statusMessage)});$scope.cancelOrderList=[],$scope.getOrderDetails=function(){userWS.getCancelRentals({userId:$scope.userCId,reqUserType:$scope.usertype},function(res){200===res.status.statusCode&&($scope.cancelOrderList=res.data)},_errorHandler)},$scope.init()}]),angular.module("user").controller("changepasswordCtrl",["$scope","$rootScope","ipCookie","$localStorage","userWS","$uibModal","Notification","$state","AuthenticationService","Captcha","title",function($scope,$rootScope,ipCookie,$localStorage,userWS,$uibModal,Notification,$state,AuthenticationService,Captcha,title){title("My Account - Change Password : irontread.com"),$scope.captchaKey=Captcha,$rootScope.$on("$locationChangeSuccess",function(){title("Change Password : irontread.com")}),$scope.refreshCaptcha=function(){$rootScope.$broadcast("reCaptcha",{})};var setBorderColor=function(obj,color){return color="undefined"==typeof color?"#ccc":color,obj.css({border:"1px solid "+color}),!0};$scope.changepassword=function(){var captchaObj=$(document).find("#usercaptcha"),oldPassObj=$(document).find("#oldPassword");setBorderColor(captchaObj),setBorderColor(oldPassObj),userWS.changePassword({OldPassword:$scope.user.oldPassword,NewPassword:$scope.user.newPassword,captcha:"undefined"==typeof $scope.user.captcha?"":$scope.user.captcha,token:ipCookie("captcha")},function(res){200===res.status.statusCode?(Notification.success("Password Changed"),AuthenticationService.logout(function(){$state.go("home",{},{reload:!0})})):(Notification.error(res.status.statusMessage),220===res.status.statusCode&&(captchaObj.select(),setBorderColor(captchaObj,"#a94442")),221===res.status.statusCode&&(oldPassObj.select(),setBorderColor(oldPassObj,"#a94442")))},function(e){console.error("Error 10051	"+e)})}}]),angular.module("user").controller("cancleOrderCtrl",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","SweetAlert",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,SweetAlert){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.usertype="lessee",$rootScope.$emit("onuserselect",$scope.usertype),$scope.getOrderDetails()};var _errorHandler=($scope.userCId,function(e){alert(e.statusMessage)});$scope.cancelOrderList=[],$scope.getOrderDetails=function(){userWS.getCancelRentals({userId:$scope.userCId,reqUserType:$scope.usertype},function(res){200===res.status.statusCode&&($scope.cancelOrderList=res.data)},_errorHandler)},$scope.init()}]),angular.module("user").controller("dashboardCtrl",["$scope","$rootScope","ipCookie","$state","$stateParams","$uibModal","$localStorage","$location","$route","contextPathimageurl","userWS","Upload","contextPathprivate","Notification","serverType",function($scope,$rootScope,ipCookie,$state,$stateParams,$uibModal,$localStorage,$location,$route,contextPathimageurl,userWS,Upload,contextPathprivate,Notification,serverType){$scope.userData=[],$scope.verified=ipCookie("verified"),$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.userCompanyName=ipCookie("userCompanyName"),$scope.userDesignation=ipCookie("userDesignation"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.isBeta="live"!==serverType,$scope.roleC=ipCookie("roleC"),$scope.dp="undefined"==typeof ipCookie("dp")?"":ipCookie("dp"),$scope.usertype="",$scope.contextPathimageurl=contextPathimageurl,$scope.profile=null,$scope.equiDetails=[],$scope.bidingDetails=[],$scope.hide="";var uploadDP=($scope.userCId,function(file,bool){bool&&Upload.upload({url:contextPathprivate+"user/uploadphoto",data:{newProfilePicture:file}}).then(function(resp){ipCookie("dp","undefined"==typeof resp.data.data.dp?"":resp.data.data.dp),$scope.dp=ipCookie("dp"),Notification.success("Your profile picture has been updated"),$state.go($state.current,{},{reload:!0})},function(resp){console.error("Error 10052	"+resp)},function(evt){try{parseInt(100*evt.loaded/evt.total)}catch(e){}})});$scope.upload=function(file){if("undefined"!=typeof file)try{var img=new Image;img.src=window.URL.createObjectURL(file),img.onload=function(){img.naturalWidth,img.naturalHeight;window.URL.revokeObjectURL(img.src),uploadDP(file,!0)}}catch(e){null!==file&&uploadDP(file,!0)}},$rootScope.$on("ProfileUpdate",function(){$scope.userCName=ipCookie("userCName")}),$rootScope.$on("onuserselect",function(event,data){$scope.usertype=data}),$scope.usertype=$location.path().split("/")[2],$scope.auctionTab=$state.params.tabName,$rootScope.$on("$locationChangeSuccess",function(){$scope.usertype=$location.path().split("/")[2],$scope.auctionTab=$state.params.tabName}),$rootScope.$on("equiCount",function(event,data){data&&$scope.equipmentStatus()}),$scope.urlChange=function(value){"user"===value?$state.go("search.dash.board.lessee",{tabName:"rent"},{reload:!1}):$state.go("search.dash.board.lessor",{tabName:"rent"},{reload:!1})},$scope.equipmentStatus=function(){ipCookie("userCId")&&userWS.equipmentStatus({},function(res){200===res.status.statusCode&&($scope.equiDetails=res.data)})},$scope.dashboardPref=function(_value){if(ipCookie("userCId")){var reqValue="undefined"==typeof _value?{}:{eu_dashboard_prefrence:_value};userWS.dashboardPref(reqValue,function(res){200===res.status.statusCode&&($scope.hide=res.data)})}},$scope.bidStatus=function(){ipCookie("userCId")&&userWS.getbidactivecount({},function(res){200===res.status.statusCode&&($scope.bidingDetails=res)})},$scope.equipmentStatus(),$scope.dashboardPref(),$scope.bidStatus()}]),angular.module("user").controller("currentRentalCtrl",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","SweetAlert","$uibModal","$state","contextPathPdf","title",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,SweetAlert,$uibModal,$state,contextPathPdf,title){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.contextPathPdf=contextPathPdf,$scope.usertype="lessee",$rootScope.$emit("onuserselect",$scope.usertype),$scope.select()};var _errorHandler=($scope.userCId,function(e){alert(e.statusMessage)});$scope.currentRentalList=[],$scope.cancellOrderList=[],$scope.itemPerPage=5,$scope.totalItems=10,$scope.currentOrderPage=1,$scope.totalItemsCancelL=10,$scope.totalItemsBidL=10,$scope.cancelOrderPageL=1,$scope.cancelBidPageL=1,$scope.setPage=function(pageNo){},$scope.pageChangedCurrentOrder=function(pageNo){$scope.currentOrderPage=pageNo,$scope.getOrderDetails()},$scope.pageChangedCancelOrderLessee=function(pageNo){$scope.cancelOrderPageL=pageNo,$scope.getCancelOrderLessee()},$scope.pageChangedCancelBidLessee=function(pageNo){$scope.cancelBidPageL=pageNo,$scope.getCancelledBidLess()},$scope.getOrderDetails=function(){userWS.getOrderCount({reqUserType:$scope.usertype,reqOrderType:"Order Created"},function(res){200===res.status.statusCode&&($scope.totalItems=res.length,userWS.getCurrentRentals({reqUserType:$scope.usertype,reqOrderType:"Order Created",currentPage:$scope.currentOrderPage},function(response){200===response.status.statusCode&&($scope.currentRentalList=response.data)},_errorHandler))},_errorHandler)},$rootScope.$on("$locationChangeSuccess",function(){$scope.select()}),$scope.active="",$scope.getactive=function(id){return $state.params.orderId===id?($scope.active="active-section",$scope.active):void($scope.active="")},$scope.select=function(){"cancelOrder"===$state.params.tabName?($scope.currentOrder=!1,$scope.cancelBid=!1,$scope.canceled=!0,$scope.getCancelOrderLessee(),title("My Account - Cancelled/Rejected Orders : irontread.com")):"currentOrder"===$state.params.tabName?($scope.canceled=!1,$scope.currentOrder=!0,$scope.cancelBid=!1,$scope.getOrderDetails(),title("My Account - Order History : irontread.com")):"cancelBid"===$state.params.tabName&&($scope.currentOrder=!1,$scope.canceled=!1,$scope.cancelBid=!0,$scope.getCancelledBidLess(),title("My Account - Cancelled Bids : irontread.com"))},$scope.urlChange=function(value){$state.go($state.current,{tabName:value},{reload:!1})},$scope.getCancelOrderLessee=function(){userWS.getOrderCount({reqUserType:$scope.usertype,reqOrderType:"Order Cancel"},function(res){200===res.status.statusCode&&($scope.totalItemsCancelL=res.length,userWS.getCurrentRentals({reqUserType:$scope.usertype,reqOrderType:"Order Cancel",currentPage:$scope.cancelOrderPageL},function(response){200===response.status.statusCode&&($scope.cancellOrderList=response.data)},_errorHandler))},_errorHandler)};$scope.getCancelledBidLess=function(){userWS.getBidCancelCountLessee({},function(res){200===res.status.statusCode&&($scope.totalItemsBidL=res.length,userWS.getCancelledBidLessee({currentPage:$scope.cancelBidPageL},function(res){if($scope.equipmentCancelledBidList=[],200===res.status.statusCode){var jsonData=res.data;angular.forEach(jsonData,function(items){$scope.equipmentCancelledBidList.push(items)})}},_errorHandler))},_errorHandler)},$scope.init(),$scope.cancelOrder=function(orderId){SweetAlert.swal({title:"Your EMD will be Forfeited.Are you sure want to cancel? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Cancel it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){})},$scope.openPdfPopup=function(pdfUrl){$uibModal.open({templateUrl:"pdf.popup.html",controller:"pdfController",size:"lg",resolve:{pdfurl:function(){return pdfUrl}}})},$scope.retryPayment=function(orderId,tType){var ptype="dbf";"rent"===tType&&(ptype="drf"),$state.go("logo.payment",{orderId:orderId,rtype:"lessee",ptype:ptype,financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})},$scope.retryBidPayment=function(orderId,tType){var ptype="rabf";"rent"===tType&&(ptype="rarf"),$state.go("logo.payment",{orderId:orderId,rtype:"lessee",ptype:ptype,financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})}}]),angular.module("user").controller("pdfController",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","SweetAlert","pdfurl","$modalInstance","contextPathPdf",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,SweetAlert,pdfurl,$modalInstance,contextPathPdf){$scope.pdfUrl=pdfurl,$scope.contextPathPdf=contextPathPdf,$scope.scroll=0,$scope.loading="loading",$scope.getNavStyle=function(scroll){return scroll>100?"pdf-controls fixed":"pdf-controls"},$scope.onError=function(error){console.error("Error 10053	"+error)},$scope.onLoad=function(){$scope.loading=""},$scope.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("user").controller("dashboardLiveBuyCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage","contextPathimageurl","CounDownTimer","$timeout","Socket","Notification","SweetAlert","$window",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage,contextPathimageurl,CounDownTimer,$timeout,Socket,Notification,SweetAlert,$window){if("undefined"!=typeof $state.params.tabName&&"buy"===$state.params.tabName){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.getLiveBuyEquipment(),$scope.usertype="lessee",$rootScope.$emit("onuserselect",$scope.usertype)};var _userId=$scope.userCId,_errorHandler=function(e){alert(e.statusMessage)},_orderType="buy";$scope.equipmentBuyList=[],$scope.equipmentBidBuyList=[];var rentIndex=0;$scope.getLiveBuyEquipment=function(){0===rentIndex&&(rentIndex+=1,userWS.getLiveRentEquipmentList({userId:_userId,orderType:_orderType,startIndex:"0",lastIndex:"3"},function(res){if(200===res.status.statusCode){var jsonData=res.data;angular.forEach(jsonData,function(items){angular.forEach(items,function(value,key){if("solo"===key&&"undefined"!=typeof value)for(var i=0;i<value.length;i++)$scope.equipmentBuyList.push(value[i]);if("bid"===key&&"undefined"!=typeof value)for(var j=0;j<value.length;j++){var bidJson=value[j];$scope.equipmentBidBuyList.push(bidJson),$scope.getBidingPriceBuyU(bidJson)}})})}},_errorHandler))},$scope.runBidTimerUserBuy=function(divId,bidEndTime,isBidStarted){if("1"===isBidStarted){$scope.diff=Math.abs(moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A").diff(moment())/1e3);var itId="#"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}};var lastId=0;$scope.bidingPriceBuyU=[],$scope.getBidingPriceBuyU=function(bidData){(0===lastId||lastId!==bidData.bidId)&&(userWS.bidPrice({bidId:bidData.bidId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(items){$scope.bidingPriceBuyU.push(items)})},_errorHandler),lastId=bidData.bidId)},$scope.paymentNowBid=function(bidId,bidItemId){$state.go("logo.payment.paymentsolo",{orderId:"bid",bidId:bidId,bidItemId:bidItemId,reqUserType:"lessee"})},$scope.verifyAssets=function(bidId,bidItemId){userWS.verifyAssets({bidId:bidId,bidItemId:bidItemId},function(response){200===response.status.statusCode&&(SweetAlert.swal("Success!","Your Order is created successfully","success"),$state.go("search.dash.currentrental",{}))},_errorHandler)},$scope.verifyAssetsBuy=function(orderId){userWS.verifyAssetsBuy({orderId:orderId},function(response){200===response.status.statusCode&&(SweetAlert.swal("Success!","Your Order is created successfully","success"),$state.go("search.dash.currentrental",{}))},_errorHandler)},$scope.closeBid=function(bidId){userWS.closeBid({bidId:bidId},function(res){},_errorHandler)},$scope.init(),$scope.messages=[],Socket.socket||Socket.connect(),Socket.on("bidMessage",function(message){angular.forEach($scope.equipmentBidBuyList,function(items){items.bidId===message.bidId&&angular.forEach(items.bidItem,function(bidItems){bidItems.bidItemId===message.bidItemId&&(bidItems.myPrice=message.amountCost,bidItems.trasportationPrice=message.transportationCost,bidItems.totalPrice=parseInt(message.amountCost)+parseInt(message.transportationCost),Notification.success("New Price For bid No "+items.bidNo+" Of equipment name "+bidItems.equipmentName+" is "+(parseInt(message.amountCost)+parseInt(message.transportationCost))))})}),$scope.messages.unshift(message)}),$scope.$on("$destroy",function(){Socket.removeListener("bidMessage")}),$scope.modifyOrder=function(orderData){var modalInstance=$uibModal.open({templateUrl:"orderChange.html",controller:"orderChangeController",size:"md",resolve:{soloItem:function(){return orderData}}});modalInstance.result.then(function(){},function(){})},$scope.cancelOrder=function(orderId){SweetAlert.swal({title:"Your EMD will be Forfeited.Are you sure want to cancel? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Cancel it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&userWS.orderAction({userId:ipCookie("userCId"),orderId:orderId,actionType:"cancel",transportationPrice:"0",isTrasportation:"0",rejectionReason:"",rejectionQuestion:"",transportPickUpDate:""},function(response){200===response.status.statusCode&&$window.location.reload()},_errorHandler)})},$rootScope.$on("counter",function(event,message){if("undefined"!=typeof message){var orderId=message.orderId,notificationType=message.notificationType,bidId=message.bidId,bidItemId=message.bidItemId;"undefined"!=typeof orderId&&userWS.getCurrentLiveOrder({userType:"lessee",orderType:"buy",orderId:orderId,notificationType:notificationType,bidId:bidId,bidItemId:bidItemId},function(res){if(200===res.status.statusCode){var newOrderData=res.equipOrderArray;"bid"===notificationType&&angular.forEach($scope.equipmentBidBuyList,function(items,index){items.orderId===newOrderData[0].orderId&&items.bidId===bidId&&(items.orderCurrentStatusType=newOrderData[0].orderCurrentStatusType,items.orderCurrentStatus=newOrderData[0].orderCurrentStatus,items.bidStartTime=newOrderData[0].bidStartTime,items.bidEndTime=newOrderData[0].bidEndTime,items.bidStatArray=newOrderData[0].bidStatArray,angular.forEach(items.bidItem,function(innerItem){angular.forEach(newOrderData[0].bidItem,function(bidItem){innerItem.bidItemId===bidItem.bidItemId&&(innerItem.totalPrice=bidItem.totalPrice,innerItem.trasportationPrice=bidItem.trasportationPrice,innerItem.myPrice=bidItem.myPrice,innerItem.isbIdAccept=bidItem.isbIdAccept,innerItem.isWinner=bidItem.isWinner,innerItem.lesseePaid=bidItem.lesseePaid,innerItem.lessorPaid=bidItem.lessorPaid,innerItem.isverified=bidItem.isverified,innerItem.transportation=bidItem.transportation,innerItem.isProvideTrasport=bidItem.isProvideTrasport,"0"!==bidItem.isbIdAccept&&"1"!==bidItem.isbIdAccept&&$scope.equipmentBidBuyList.splice(items.orderId,1))})})),angular.forEach($scope.bidingPriceBuyU,function(bidPartItem){"bid"===notificationType&&bidPartItem.orderIdDb===newOrderData[0].orderId&&bidPartItem.bidIdDb===bidId&&angular.forEach(newOrderData[0].bidItem,function(bidItem){bidPartItem.bidIdItemIdDb===bidItem.bidItemId&&(bidPartItem.itemPriceDb=bidItem.totalPrice,bidPartItem.transportPriceDb=bidItem.trasportationPrice,bidPartItem.currentPriceDb=bidItem.myPrice,bidPartItem.isbIdAcceptDb=bidItem.isbIdAccept,bidPartItem.isWinnerDb=bidItem.isWinner,bidPartItem.lesseePaidDb=bidItem.lesseePaid,bidPartItem.lessorPaidDb=bidItem.lessorPaid,bidPartItem.isverifiedDb=bidItem.transportation)})})})}},_errorHandler)}})}}]),angular.module("user").controller("dashboardLiveLessorCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage","$window","CounDownTimer","$timeout","contextPathimageurl","Notification","SweetAlert","Socket","title",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage,$window,CounDownTimer,$timeout,contextPathimageurl,Notification,SweetAlert,Socket,title){if("undefined"!=typeof $state.params.tabName&&"rent"===$state.params.tabName){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.getLiveLessorEquipment(),$scope.usertype="lessor",$rootScope.$emit("onuserselect",$scope.usertype)},title("My Account Lessor - Buy,Rent or Finance online : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account Lessor - Buy,Rent or Finance online : irontread.com")});var _errorHandler=($scope.userCId,function(e){SweetAlert.swal("Error!",e.statusMessage,"error")});$scope.equipmentLessorAuctionList=[],$scope.equipmentLessorRentList=[],$scope.bidingPriceLessor=[];var index=0;$scope.getLiveLessorEquipment=function(){0===index&&(index++,userWS.getLiveLessorEquipmentList({orderType:"rent",startIndex:"0",lastIndex:"3"},function(res){if(200===res.status.statusCode){var jsonData=res.data;angular.forEach(jsonData,function(items){angular.forEach(items,function(value,key){if("solo"===key&&"undefined"!=typeof value)for(var i=0;i<value.length;i++)$scope.equipmentLessorRentList.push(value[i]);if("bid"===key&&"undefined"!=typeof jsonData[0])for(var k=0;k<value.length;k++)for(var bidJson=value[k],j=0;j<value[k].length;j++)$scope.equipmentLessorRentList.push(bidJson[j]),$scope.getBidPriceLessor(bidJson[j])})})}},_errorHandler))},$scope.init(),$scope.auctionStarted=!1,$scope.runBidTimer=function(divId,bidEndTime,isBidStarted){var _currentDate=moment(),_bidEndTime=moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A");if($scope.auctionStarted=_bidEndTime>=_currentDate,"1"===isBidStarted&&$scope.auctionStarted===!0){$scope.diff=Math.abs(moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A").diff(moment())/1e3);var itId="#"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}};var lastId=0;$scope.getBidPriceLessor=function(bidData){(0===lastId||lastId!==bidData.bidId)&&(userWS.bidPrice({bidId:bidData.bidId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(items){$scope.bidingPriceLessor.push(items)})},_errorHandler),lastId=bidData.bidId)},$rootScope.$on("counter",function(event,message){if("undefined"!=typeof message){var statusOrderForReload=!0,orderId=message.orderId,notificationType=message.notificationType,bidId=message.bidId,bidItemId=message.bidItemId;"undefined"!=typeof orderId&&userWS.getCurrentLiveOrder({userType:"lessor",orderType:"rent",orderId:orderId,notificationType:notificationType,bidId:bidId,bidItemId:bidItemId},function(res){if(200===res.status.statusCode){var newOrderData=res.equipOrderArray;0===$scope.equipmentLessorRentList.length?$window.location.reload():angular.forEach($scope.equipmentLessorRentList,function(items,index){"bid"===notificationType?(items.orderId===newOrderData[0].orderId&&items.bidId===bidId&&(items.orderCurrentStatusType=newOrderData[0].orderCurrentStatusType,items.orderCurrentStatus=newOrderData[0].orderCurrentStatus,angular.forEach(newOrderData[0].bidItem,function(bidItem){items.bidItemId===bidItem.bidItemId&&(items.totalPrice=bidItem.totalPrice,items.trasportationPrice=bidItem.trasportationPrice,items.myPrice=bidItem.myPrice,items.isbIdAccept=bidItem.isbIdAccept,items.isWinner=bidItem.isWinner,items.lesseePaid=bidItem.lesseePaid,items.lessorPaid=bidItem.lessorPaid,items.isverified=bidItem.isverified,items.transportation=bidItem.transportation,items.isProvideTrasport=bidItem.isProvideTrasport,items.newPriceRate=bidItem.priceRate,items.bidStatArray=newOrderData[0].bidStatArray,"1"===newOrderData[0].isBidStarted&&$scope.runBidTimer(items.bidItemId,newOrderData[0].bidEndTime,newOrderData[0].isBidStarted),"0"!==bidItem.isbIdAccept&&"1"!==bidItem.isbIdAccept&&$scope.equipmentLessorRentList.splice(items.orderId,1))}),statusOrderForReload=!1),angular.forEach($scope.bidingPriceLessor,function(bidPartItem){"bid"===notificationType&&(bidPartItem.orderIdDb===newOrderData[0].orderId&&bidPartItem.bidIdDb===bidId&&angular.forEach(newOrderData[0].bidItem,function(bidItem){bidPartItem.bidIdItemIdDb===bidItem.bidItemId&&(bidPartItem.itemPriceDb=bidItem.totalPrice,bidPartItem.transportPriceDb=bidItem.trasportationPrice,bidPartItem.currentPriceDb=bidItem.myPrice,bidPartItem.isbIdAcceptDb=bidItem.isbIdAccept,bidPartItem.isWinnerDb=bidItem.isWinner,bidPartItem.lesseePaidDb=bidItem.lesseePaid,bidPartItem.lessorPaidDb=bidItem.lessorPaid,bidPartItem.isverifiedDb=bidItem.transportation,bidPartItem.newPriceRate=bidItem.priceRate)}),statusOrderForReload=!1)})):items.orederId===newOrderData[0].orderId&&(items.amount=newOrderData[0].amount,items.serviceTax=newOrderData[0].serviceTax,items.totalPrice=newOrderData[0].totalPrice,items.traportationPrice=newOrderData[0].traportationPrice,items.traportationTax=newOrderData[0].traportationTax,items.orderCurrentStatusType=newOrderData[0].orderCurrentStatusType,items.orderCurrentStatus=newOrderData[0].orderCurrentStatus,items.isverified=newOrderData[0].isverified,items.isProvideTrasport=newOrderData[0].isProvideTrasport,statusOrderForReload=!1,"Order Created"===items.orderCurrentStatus?$state.go("search.dash.orderdetails",{tabName:"currentOrder"},{reload:!1}):"Order Cancel"===items.orderCurrentStatus&&$state.go("search.dash.orderdetails",{tabName:"cancelOrder"},{reload:!1})),index===$scope.equipmentLessorAuctionList.length-1})}},_errorHandler)}}),$scope.acceptBidOrder=function(bidData){var modalInstance=$uibModal.open({templateUrl:"acceptBid.html",controller:"acceptBidController",size:"md",resolve:{placeBid:function(){return bidData}}});modalInstance.result.then(function(bidItemArray){},function(){})},$scope.openPlaceBidLessor=function(equipmentObject){var modalInstance=$uibModal.open({templateUrl:"placeBidLessor.html",controller:"placeBidControllerLessor",size:"lg",resolve:{placeBid:function(){return equipmentObject}}});modalInstance.result.then(function(bidItemArray){},function(){})},$scope.paymentNow=function(orderId){$state.go("logo.payment.paymentsolo",{orderId:orderId,bidId:"",bidItemId:"",reqUserType:"lessor"})},$scope.paymentNowBid=function(bidId,bidItemId){$state.go("logo.payment.paymentsolo",{orderId:"bid",bidId:bidId,bidItemId:bidItemId,reqUserType:"lessor"})},$scope.openPlaceSolo=function(equipmentObject){var modalInstance=$uibModal.open({templateUrl:"acceptsolo.html",controller:"placeSoloController",size:"md",resolve:{soloItem:function(){return equipmentObject}}});modalInstance.result.then(function(){},function(){})},$scope.openPlaceSoloReject=function(equipmentObject){var modalInstance=$uibModal.open({templateUrl:"acceptsoloreject.html",controller:"placeSoloRejectController",size:"md",resolve:{soloItem:function(){return equipmentObject}}});modalInstance.result.then(function(){},function(){})},$scope.openPlaceBidReject=function(bidData){var modalInstance=$uibModal.open({templateUrl:"acceptbidreject.html",controller:"placeBidRejectController",size:"md",resolve:{placeBid:function(){return bidData}}});modalInstance.result.then(function(){},function(){})}}}]).controller("acceptBidController",["$scope","$modalInstance","placeBid","userWS","ipCookie","$window","CounDownTimer","$timeout","Socket","contextPathimageurl","Notification","SweetAlert",function($scope,$modalInstance,placeBid,userWS,ipCookie,$window,CounDownTimer,$timeout,Socket,contextPathimageurl,Notification,SweetAlert){var _errorHandler=($scope.userCId,function(e){SweetAlert.swal("Error!",e.statusMessage,"error")});$scope.bidingPrice=[],$scope.bidItem=placeBid,$scope.transStatus="0",$scope.getTrasportation=function(){$scope.bidItem.transportationProvide?$scope.transStatus="1":$scope.transStatus="0"},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.acceptBid=function(bidSelected){bidSelected.confirmation?"1"===$scope.transStatus?moment(bidSelected.transportPickUpDate,"DD/MM/YYYY").isValid()?$scope.acceptBidOrder(bidSelected,bidSelected.transportationProvide,bidSelected.transportPickUpDate):SweetAlert.swal("Error!","Please Enter Valid Pick up Date.","error"):$scope.acceptBidOrder(bidSelected,bidSelected.transportationProvide,""):SweetAlert.swal("Error!","Please Confirm Terms & Conditions.","error")},$scope.acceptBidOrder=function(bidData,isTransportation,transportPickUpDate){var bidId=bidData.bidId,bidItemId=bidData.bidItemId,isProvideTrans=!1;("undefined"==typeof $scope.bidItem.transportationProvide||$scope.bidItem.transportationProvide===!1)&&(isProvideTrans=!0),userWS.bidReqAction({bidId:bidId,bidItemId:bidItemId,actionType:"accept",rejectionReason:"",rejectionQuestion:"",isTransportation:!0,transportPickUpDate:transportPickUpDate},function(response){200===response.status.statusCode?($scope.bidItem.isbIdAccept="1",$scope.bidItem.isWinner="0",$scope.close()):SweetAlert.swal("Error!","Your request is not saved.","error")},_errorHandler)}}]).controller("placeBidControllerLessor",["$scope","$modalInstance","placeBid","userWS","ipCookie","$window","CounDownTimer","$timeout","Socket","contextPathimageurl","Notification","SweetAlert",function($scope,$modalInstance,placeBid,userWS,ipCookie,$window,CounDownTimer,$timeout,Socket,contextPathimageurl,Notification,SweetAlert){var _errorHandler=($scope.userCId,function(e){SweetAlert.swal("Error!",e.statusMessage,"error")});$scope.init=function(){$scope.getBidPriceReal()},$scope.bidingPriceTable=[],$scope.bidItem=placeBid,$scope.imgPath=contextPathimageurl,$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.placeBid=function(bidItem){$scope.placeBidItem(bidItem,"accept")},$scope.withDraw=function(bidItem){$scope.withDrawBid(bidItem)},$scope.timeReset=function(dateTime){try{return moment(dateTime).format("DD/MM/YYYY hh:mm:ss")}catch(e){console.error("Error 10054	"+e)}},$scope.placeBidItem=function(bidItemArray,bidActionType){var bidId=bidItemArray.bidId;
userWS.bidValidater({bidId:bidId},function(response){200===response.status.statusCode&&("Bid underway"===response.data?$scope.placeBidPrice(bidItemArray,bidActionType):SweetAlert.swal("Error!",response.data,"error"))},_errorHandler)},$scope.placeBidPrice=function(bidItemArray,bidActionType){var bidId=bidItemArray.bidId,bidItemId=bidItemArray.bidItemId,bidLastPrice=bidItemArray.myPrice,newBidPrice=0,transportationPrice=0;if(("undefined"!=typeof bidItemArray.myPrice||null!==typeof bidItemArray.myPrice)&&(newBidPrice=bidItemArray.newBidPrice),"undefined"==typeof newBidPrice||0===newBidPrice)SweetAlert.swal("Error!","Please Enter New Price","error");else{var totalPrice=parseInt(newBidPrice);parseInt(bidLastPrice)<totalPrice?SweetAlert.swal("Error!","Bid price should be lower than last entered price","error"):userWS.bidAction({userId:ipCookie("userCId"),bidId:bidId,bidItemId:bidItemId,newBidPrice:newBidPrice,transportationPrice:transportationPrice,bidActionType:bidActionType},function(response){if(200===response.status.statusCode)"undefined"!=typeof response.data&&""===response.data?($scope.sendMessage(ipCookie("userCId"),bidId,bidItemId,newBidPrice,transportationPrice),bidItemArray.myPrice=newBidPrice,bidItemArray.trasportationPrice=transportationPrice,bidItemArray.totalPrice=parseInt(newBidPrice)+parseInt(transportationPrice),$scope.close()):SweetAlert.swal("Error!",response.data,"error");else try{SweetAlert.swal("Error!",response.data,"error")}catch(e){}},_errorHandler)}},$scope.withDrawBid=function(bidItemArray,bidActionType){var bidId=bidItemArray.bidId,bidItemId=bidItemArray.bidItemId;userWS.bidWithDrawAction({bidId:bidId,bidItemId:bidItemId},function(response){200===response.status.statusCode&&(placeBid.isbIdAccept="3",$scope.close())},_errorHandler)},$scope.getBidPriceReal=function(){userWS.bidPrice({bidId:placeBid.bidId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(items){$scope.bidingPriceTable.push(items)})},_errorHandler)},$scope.init(),$scope.runBidTimerRentLessorM=function(divId,bidEndTime,isBidStarted){var _currentDate=moment(),_bidEndTime=moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A");if(_bidEndTime>=_currentDate?$scope.auctionStarted=!0:$scope.auctionStarted=!1,"1"===isBidStarted&&$scope.auctionStarted===!0){$scope.diff=Math.abs(moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A").diff(moment())/1e3);var itId="#R"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}},$scope.messages=[],Socket.socket||Socket.connect(),Socket.on("bidMessage",function(message){$scope.messages.unshift(message)}),$scope.sendMessage=function(userId,bidId,bidItemId,amountCost,transportationCost){var message={userId:userId,bidId:bidId,bidItemId:bidItemId,amountCost:amountCost,transportationCost:transportationCost};Socket.emit("bidMessage",message),this.messageText=""},Socket.on("bidMessage",function(message){angular.forEach(placeBid,function(items){placeBid.bidId===message.bidId&&angular.forEach(items.bidItem,function(bidItems){placeBid.bidItemId===message.bidItemId&&Notification.success("New Price For "+placeBid.equipmentName+" is "+parseInt(message.amountCost)+parseInt(message.transportationCost))})}),$scope.messages.unshift(message)}),$scope.$on("$destroy",function(){Socket.removeListener("bidMessage")})}]).controller("placeSoloController",["$scope","$state","$modalInstance","soloItem","userWS","ipCookie","$window","CounDownTimer","$timeout","Socket","contextPathimageurl","SweetAlert",function($scope,$state,$modalInstance,soloItem,userWS,ipCookie,$window,CounDownTimer,$timeout,Socket,contextPathimageurl,SweetAlert){var _errorHandler=function(e){SweetAlert.swal("Error!",e.statusMessage,"error")};$scope.soleData=soloItem,$scope.init=function(){$scope.transStatus="0"},$scope.init(),$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.getTrasportation=function(){"true"===$scope.soleData.transportation?$scope.transStatus="1":$scope.transStatus="0"},$scope.acceptOrder=function(soloSelected){soloSelected.confirmation?$scope.confirmOrder(soloSelected.orederId,"accept",0,"true",""):SweetAlert.swal("Error!","Please Confirm Terms & Conditions.","error")},$scope.confirmOrder=function(orderId,actionType,transportationPrice,isTrasportation,transportPickUpDate){userWS.orderAction({userId:ipCookie("userCId"),orderId:orderId,actionType:actionType,transportationPrice:transportationPrice,isTrasportation:isTrasportation,rejectionReason:"",rejectionQuestion:"",transportPickUpDate:transportPickUpDate},function(response){200===response.status.statusCode&&($scope.close(),$state.reload())},_errorHandler)}}]).controller("placeSoloRejectController",["$scope","$state","$modalInstance","soloItem","userWS","ipCookie","$window","CounDownTimer","$timeout","Socket","contextPathimageurl","SweetAlert",function($scope,$state,$modalInstance,soloItem,userWS,ipCookie,$window,CounDownTimer,$timeout,Socket,contextPathimageurl,SweetAlert){var _errorHandler=function(e){SweetAlert.swal("Error!",e.statusMessage,"error")};$scope.questionList=[],$scope.soleData=soloItem,$scope.init=function(){$scope.getRejectQuestion()},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.getRejectQuestion=function(){userWS.getRejectQuestion({queType:"soloreject"},function(response){200===response.status.statusCode&&($scope.questionList=response.data)},_errorHandler)},$scope.init(),$scope.rejectOrder=function(soloSelected){var rejectionReason=soloSelected.rejection,rejectionRemark=soloSelected.rejectionReason;"undefined"!=typeof rejectionReason||"undefined"!=typeof rejectionRemark&&""!==rejectionRemark.trim()?"undefined"==typeof rejectionReason?SweetAlert.swal("Error!","Please give Reason for rejecting this order request.","error"):"undefined"==typeof rejectionReason||"Others."!==rejectionReason||"undefined"!=typeof rejectionRemark&&""!==rejectionRemark.trim()?("undefined"==typeof rejectionReason&&(rejectionReason="Others."),"undefined"==typeof rejectionRemark&&(rejectionRemark=""),$scope.rejectOrderData(soloSelected.orederId,"reject",rejectionRemark,rejectionReason)):SweetAlert.swal("Error!","Please give Remark for rejecting this order request.","error"):SweetAlert.swal("Error!","Please give Reason/Remark for rejecting this order request.","error")},$scope.rejectOrderData=function(orderId,actionType,rejectionReason,rejectionQuestion){userWS.orderAction({userId:ipCookie("userCId"),orderId:orderId,actionType:actionType,transportationPrice:"0",rejectionReason:rejectionReason,rejectionQuestion:rejectionQuestion,transportPickUpDate:""},function(response){200===response.status.statusCode&&($scope.close(),$state.reload())},_errorHandler)}}]).controller("placeBidRejectController",["$scope","$modalInstance","placeBid","userWS","ipCookie","$window","CounDownTimer","$timeout","Socket","contextPathimageurl","SweetAlert",function($scope,$modalInstance,placeBid,userWS,ipCookie,$window,CounDownTimer,$timeout,Socket,contextPathimageurl,SweetAlert){var _errorHandler=function(e){SweetAlert.swal("Error!",e.statusMessage,"error")};$scope.questionList=[],$scope.bidData=[],$scope.bidItem=placeBid,$scope.init=function(){$scope.getRejectQuestion()},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.getRejectQuestion=function(){userWS.getRejectQuestion({queType:"soloreject"},function(response){200===response.status.statusCode&&($scope.questionList=response.data)},_errorHandler)},$scope.init(),$scope.rejectOrder=function(){var bidId=$scope.bidItem.bidId,bidItemId=$scope.bidItem.bidItemId,rejectionReason=$scope.bidData.rejection,rejectionRemark=$scope.bidData.rejectionReason;"undefined"!=typeof rejectionReason||"undefined"!=typeof rejectionRemark&&""!==rejectionRemark.trim()?"undefined"==typeof rejectionReason?SweetAlert.swal("Error!","Please give Reason for rejecting this order request.","error"):"undefined"==typeof rejectionReason||"Others."!==rejectionReason||"undefined"!=typeof rejectionRemark&&""!==rejectionRemark.trim()?("undefined"==typeof rejectionReason&&(rejectionReason="Others."),"undefined"==typeof rejectionRemark&&(rejectionRemark=""),$scope.rejectOrderData(bidId,bidItemId,rejectionRemark,rejectionReason)):SweetAlert.swal("Error!","Please give Remark for rejecting this order request.","error"):SweetAlert.swal("Error!","Please give Reason/Remark for rejecting this order request.","error")},$scope.rejectOrderData=function(bidId,bidItemId,rejectionReason,rejectionQuestion){userWS.bidReqAction({userId:ipCookie("userCId"),bidId:bidId,bidItemId:bidItemId,actionType:"reject",rejectionReason:rejectionReason,rejectionQuestion:rejectionQuestion,isTransportation:!1,transportPickUpDate:""},function(response){200===response.status.statusCode&&($scope.close(),$scope.bidItem.isbIdAccept="2",$scope.bidItem.isWinner="0")},_errorHandler)}}]),angular.module("user").controller("dashboardLiveRentCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage","CounDownTimer","$timeout","Socket","contextPathimageurl","Notification","SweetAlert","title",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage,CounDownTimer,$timeout,Socket,contextPathimageurl,Notification,SweetAlert,title){if(title("My Account Lessee : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account Lessee : irontread.com")}),"undefined"!=typeof $state.params.tabName&&"rent"===$state.params.tabName){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.getLiveRentEquipment(),$scope.usertype="lessee",$rootScope.$emit("onuserselect",$scope.usertype);Date.now()};var _userId=$scope.userCId,_errorHandler=function(e){alert(e.statusMessage)};$scope.equipmentRentList=[],$scope.equipmentSoloList=[],$scope.equipmentBidList=[];var rentIndex=0;$scope.getLiveRentEquipment=function(){0===rentIndex&&(rentIndex+=1,userWS.getLiveRentEquipmentList({userId:_userId,orderType:"rent",startIndex:"0",lastIndex:"3"},function(res){if(200===res.status.statusCode){var jsonData=res.data;angular.forEach(jsonData,function(items){angular.forEach(items,function(value,key){if("solo"===key&&"undefined"!=typeof value)for(var i=0;i<value.length;i++)$scope.equipmentRentList.push(value[i]);if("bid"===key&&"undefined"!=typeof value)for(var j=0;j<value.length;j++){var bidJson=value[j];$scope.equipmentRentList.push(bidJson),$scope.getBidingPriceRentU(bidJson)}})})}},_errorHandler))},$scope.runBidTimerUser=function(divId,bidEndTime,isBidStarted){var _currentDate=moment(),_bidEndTime=moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A");if(_bidEndTime>=_currentDate?$scope.auctionStarted=!0:$scope.auctionStarted=!1,"1"===isBidStarted&&$scope.auctionStarted===!0){$scope.diff=Math.abs(moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A").diff(moment())/1e3);var itId="#"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}};var lastId=0;$scope.bidingPriceRentU=[],$scope.getBidingPriceRentU=function(bidData){(0===lastId||lastId!==bidData.bidId)&&(userWS.bidPrice({bidId:bidData.bidId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(items){$scope.bidingPriceRentU.push(items)})},_errorHandler),lastId=bidData.bidId)},$scope.paymentNow=function(orderId){$state.go("logo.payment",{orderId:orderId,rtype:"lessee",ptype:"dr",financeId:"",eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})},$scope.paymentNowBid=function(bidId,bidItemId){var orderId="undefined"==typeof orderId?"":orderId;$state.go("logo.payment.paymentsolo",{orderId:orderId,bidId:bidId,bidItemId:bidItemId,reqUserType:"lessee"})},$scope.closeBid=function(bidId){userWS.closeBid({bidId:bidId},function(res){},_errorHandler)},$scope.messages=[],Socket.socket||Socket.connect(),Socket.on("bidMessage",function(message){angular.forEach($scope.equipmentBidList,function(items){items.bidId===message.bidId&&angular.forEach(items.bidItem,function(bidItems){bidItems.bidItemId===message.bidItemId&&(bidItems.myPrice=message.amountCost,bidItems.trasportationPrice=message.transportationCost,bidItems.totalPrice=parseInt(message.amountCost)+parseInt(message.transportationCost),Notification.success("New Price For bid No "+items.bidNo+" Of equipment name "+bidItems.equipmentName+" is "+(parseInt(message.amountCost)+parseInt(message.transportationCost))))})}),$scope.messages.unshift(message)}),$scope.$on("$destroy",function(){Socket.removeListener("bidMessage")}),$scope.modifyOrder=function(orderData){var modalInstance=$uibModal.open({templateUrl:"orderChange.html",controller:"orderChangeController",size:"md",resolve:{soloItem:function(){return orderData}}});modalInstance.result.then(function(){},function(){})},$scope.cancelOrder=function(orderId,indexNo){SweetAlert.swal({title:"Are you sure want to cancel? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Cancel it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){isConfirm&&userWS.orderAction({userId:ipCookie("userCId"),orderId:orderId,actionType:"cancel",transportationPrice:"0",isTrasportation:"0",rejectionReason:"",rejectionQuestion:"",transportPickUpDate:""},function(response){200===response.status.statusCode&&$scope.equipmentRentList.splice(indexNo)},_errorHandler)})},$scope.init(),$scope.auctionStarted=!0,$rootScope.$on("counter",function(event,message){if("undefined"!=typeof message){var orderId=message.orderId,notificationType=message.notificationType,bidId=message.bidId,bidItemId=message.bidItemId;"undefined"!=typeof orderId&&userWS.getCurrentLiveOrder({userType:"lessee",orderType:"rent",orderId:orderId,notificationType:notificationType,bidId:bidId,bidItemId:bidItemId},function(res){if(200===res.status.statusCode){var newOrderData=res.equipOrderArray;"bid"===notificationType?angular.forEach($scope.equipmentRentList,function(items,index){items.orderId===newOrderData[0].orderId&&items.bidId===bidId&&(items.orderCurrentStatusType=newOrderData[0].orderCurrentStatusType,items.orderCurrentStatus=newOrderData[0].orderCurrentStatus,items.bidStartTime=newOrderData[0].bidStartTime,items.bidEndTime=newOrderData[0].bidEndTime,items.bidStatArray=newOrderData[0].bidStatArray,angular.forEach(items.bidItem,function(innerItem){angular.forEach(newOrderData[0].bidItem,function(bidItem){innerItem.bidItemId===bidItem.bidItemId&&(innerItem.totalPrice=bidItem.totalPrice,innerItem.trasportationPrice=bidItem.trasportationPrice,innerItem.myPrice=bidItem.myPrice,innerItem.isbIdAccept=bidItem.isbIdAccept,innerItem.isWinner=bidItem.isWinner,innerItem.lesseePaid=bidItem.lesseePaid,innerItem.lessorPaid=bidItem.lessorPaid,innerItem.isverified=bidItem.isverified,innerItem.transportation=bidItem.transportation,innerItem.newPriceRate=bidItem.priceRate,innerItem.isProvideTrasport=bidItem.isProvideTrasport,"0"!==bidItem.isbIdAccept&&"1"!==bidItem.isbIdAccept&&$scope.equipmentRentList.splice(items.orderId,1),"1"===newOrderData[0].isBidStarted&&($scope.auctionStarted=!0,$scope.runBidTimerUser(items.bidId,newOrderData[0].bidEndTime,newOrderData[0].isBidStarted)))})})),angular.forEach($scope.bidingPriceRentU,function(bidPartItem){"bid"===notificationType&&bidPartItem.orderIdDb===newOrderData[0].orderId&&bidPartItem.bidIdDb===bidId&&angular.forEach(newOrderData[0].bidItem,function(bidItem){bidPartItem.bidIdItemIdDb===bidItem.bidItemId&&(bidPartItem.itemPriceDb=bidItem.totalPrice,bidPartItem.transportPriceDb=bidItem.trasportationPrice,bidPartItem.currentPriceDb=bidItem.myPrice,bidPartItem.isbIdAcceptDb=bidItem.isbIdAccept,bidPartItem.isWinnerDb=bidItem.isWinner,bidPartItem.lesseePaidDb=bidItem.lesseePaid,bidPartItem.lessorPaidDb=bidItem.lessorPaid,bidPartItem.isverifiedDb=bidItem.transportation,bidPartItem.newPriceRate=bidItem.priceRate)})})}):angular.forEach($scope.equipmentRentList,function(items){items.orederId===newOrderData[0].orderId&&(items.amount=newOrderData[0].amount,items.serviceTax=newOrderData[0].serviceTax,items.totalPrice=newOrderData[0].totalPrice,items.traportationPrice=newOrderData[0].traportationPrice,items.traportationTax=newOrderData[0].traportationTax,items.orderCurrentStatusType=newOrderData[0].orderCurrentStatusType,items.orderCurrentStatus=newOrderData[0].orderCurrentStatus,items.isverified=newOrderData[0].isverified,items.isProvideTrasport=newOrderData[0].isProvideTrasport)})}},_errorHandler)}})}}]).controller("orderChangeController",["$scope","$modalInstance","soloItem","userWS","ipCookie","$window","contextPathimageurl","SweetAlert",function($scope,$modalInstance,soloItem,userWS,ipCookie,$window,contextPathimageurl,SweetAlert){var _errorHandler=function(e){alert(e.statusMessage)};$scope.questionList=[],$scope.soleData=soloItem,$scope.duration={startDateInner:$scope.soleData.startDate,endDateInner:$scope.soleData.endDate},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.changeOrderRequest=function(){moment($scope.duration.startDateInner,"MM-DD-YYYY").isValid()&&moment($scope.duration.endDateInner,"MM-DD-YYYY").isValid()?userWS.changeOrderRequest({orderId:$scope.soleData.orederId,newStartDate:$scope.duration.startDateInner,newEndDate:$scope.duration.endDateInner},function(response){200===response.status.statusCode&&($scope.close(),$window.location.reload())},_errorHandler):SweetAlert.swal("Error!","Please Enter Valid Date.","error")}}]),angular.module("user").controller("dashboardLiveSellerCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage","$window","CounDownTimer","$timeout","contextPathimageurl","Notification","SweetAlert","title",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage,$window,CounDownTimer,$timeout,contextPathimageurl,Notification,SweetAlert,title){if(title("My Account Lessor : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account Lessor : irontread.com")}),"undefined"!=typeof $state.params.tabName&&"sell"===$state.params.tabName){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.contextPathimageurl=contextPathimageurl,$scope.getLiveSellerEquipment(),$scope.usertype="lessor",$rootScope.$emit("onuserselect",$scope.usertype)};var _errorHandler=($scope.userCId,function(e){});$scope.equipmentSellerBuyList=[],$scope.equipmentSellerBIdList=[],$scope.getLiveSellerEquipment=function(){userWS.getLiveSellerEquipmentList({orderType:"buy",startIndex:"0",lastIndex:"3"},function(res){if(200===res.status.statusCode){var jsonData=res.data;angular.forEach(jsonData,function(items){angular.forEach(items,function(value,key){if("solo"===key&&"undefined"!=typeof value)for(var i=0;i<value.length;i++)$scope.equipmentSellerBuyList.push(value[i]);if("bid"===key&&"undefined"!=typeof jsonData[0])for(var k=0;k<value.length;k++)for(var bidJson=value[k],j=0;j<value[k].length;j++)ipCookie("userCId")===bidJson[j].equipUser&&($scope.equipmentSellerBIdList.push(bidJson[j]),$scope.getBidPriceBuy(bidJson[j]))})})}},_errorHandler)};var lastId=0;$scope.bidingPriceSell=[],$scope.getBidPriceBuy=function(bidData){(0===lastId||lastId!==bidData.bidId)&&(userWS.bidPrice({bidId:bidData.bidId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(items){$scope.bidingPriceSell.push(items)})},_errorHandler),lastId=bidData.bidId)},$scope.init(),$scope.runBidTimerBuyLessor=function(divId,bidEndTime,isBidStarted){if("1"===isBidStarted){$scope.diff=Math.abs(moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A").diff(moment())/1e3);var itId="#"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}},$scope.paymentNow=function(orderId){$state.go("logo.payment.paymentsolo",{orderId:orderId,bidId:"",bidItemId:"",reqUserType:"lessor"})},$scope.paymentNowBid=function(bidId,bidItemId){$state.go("logo.payment.paymentsolo",{orderId:"bid",bidId:bidId,bidItemId:bidItemId,reqUserType:"lessor"})},$scope.bidData={},$scope.openPlaceBid=function(data){$scope.bidData=data;$uibModal.open({templateUrl:"placeBid.html",controller:"placeBidController",size:"lg",resolve:{placeBid:function(){return $scope.bidData}}})},$rootScope.$on("counter",function(event,message){if("undefined"!=typeof message){var statusOrderForReload=!1,orderId=message.orderId,notificationType=message.notificationType,bidId=message.bidId,bidItemId=message.bidItemId;"undefined"!=typeof orderId&&userWS.getCurrentLiveOrder({userType:"lessor",orderType:"buy",orderId:orderId,notificationType:notificationType,bidId:bidId,bidItemId:bidItemId},function(res){if(200===res.status.statusCode&&200===res.status.statusCode){var newOrderData=res.equipOrderArray;0===$scope.equipmentSellerBIdList.length?$window.location.reload():angular.forEach($scope.equipmentSellerBIdList,function(items,index){"bid"===notificationType&&(items.orderId===newOrderData[0].orderId&&items.bidId===bidId&&(items.orderCurrentStatusType=newOrderData[0].orderCurrentStatusType,items.orderCurrentStatus=newOrderData[0].orderCurrentStatus,items.bidStatArray=newOrderData[0].bidStatArray,angular.forEach(newOrderData[0].bidItem,function(bidItem){items.bidItemId===bidItem.bidItemId&&(items.totalPrice=bidItem.totalPrice,items.trasportationPrice=bidItem.trasportationPrice,items.myPrice=bidItem.myPrice,items.isbIdAccept=bidItem.isbIdAccept,items.isWinner=bidItem.isWinner,items.lesseePaid=bidItem.lesseePaid,items.lessorPaid=bidItem.lessorPaid,items.isverified=bidItem.isverified,items.transportation=bidItem.transportation,items.isProvideTrasport=bidItem.isProvideTrasport,"0"!==bidItem.isbIdAccept&&"1"!==bidItem.isbIdAccept&&$scope.equipmentSellerBIdList.splice(items.orderId,1),"1"===newOrderData[0].isBidStarted&&$scope.runBidTimerBuyLessor(items.bidItemId,newOrderData[0].bidEndTime,newOrderData[0].isBidStarted))}),statusOrderForReload=!1),angular.forEach($scope.bidingPriceSell,function(bidPartItem){"bid"===notificationType&&(bidPartItem.orderIdDb===newOrderData[0].orderId&&bidPartItem.bidIdDb===bidId&&angular.forEach(newOrderData[0].bidItem,function(bidItem){bidPartItem.bidIdItemIdDb===bidItem.bidItemId&&(bidPartItem.itemPriceDb=bidItem.totalPrice,bidPartItem.transportPriceDb=bidItem.trasportationPrice,bidPartItem.currentPriceDb=bidItem.myPrice,bidPartItem.isbIdAcceptDb=bidItem.isbIdAccept,bidPartItem.isWinnerDb=bidItem.isWinner,bidPartItem.lesseePaidDb=bidItem.lesseePaid,bidPartItem.lessorPaidDb=bidItem.lessorPaid,bidPartItem.isverifiedDb=bidItem.transportation)}),statusOrderForReload=!1)}))})}},_errorHandler)}})}}]).controller("placeBidController",["$scope","$modalInstance","placeBid","userWS","ipCookie","$window","CounDownTimer","$timeout","Socket","contextPathimageurl","Notification","SweetAlert",function($scope,$modalInstance,placeBid,userWS,ipCookie,$window,CounDownTimer,$timeout,Socket,contextPathimageurl,Notification,SweetAlert){var _errorHandler=($scope.userCId,function(e){SweetAlert.swal("Error!",e.statusMessage,"error")});$scope.init=function(){$scope.getBidPrice()},$scope.bidingPrice=[],$scope.bidItem=placeBid,$scope.imgPath=contextPathimageurl,$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.placeBid=function(bidItem){$scope.placeBidItem(bidItem,"accept")},$scope.withDraw=function(bidItem){$scope.withDrawBid(bidItem)},$scope.timeReset=function(dateTime){try{return moment(dateTime).format("DD/MM/YYYY hh:mm:ss")}catch(e){console.error("Error 10055	"+e)}},$scope.placeBidItem=function(bidItemArray,bidActionType){var bidId=bidItemArray.bidId;userWS.bidValidater({bidId:bidId},function(response){200===response.status.statusCode&&("Bid underway"===response.data?$scope.placeBidPrice(bidItemArray,bidActionType):SweetAlert.swal("Error!",response.data,"error"))},_errorHandler)},$scope.placeBidPrice=function(bidItemArray,bidActionType){var bidId=bidItemArray.bidId,bidItemId=bidItemArray.bidItemId,bidLastPrice=bidItemArray.myPrice,newBidPrice=0,transportationPrice=0;if(("undefined"!=typeof bidItemArray.myPrice||null!==typeof bidItemArray.myPrice)&&(newBidPrice=bidItemArray.newBidPrice),"undefined"!=typeof bidItemArray.transportation&&(transportationPrice=bidItemArray.transportation),"undefined"==typeof newBidPrice||0===newBidPrice)SweetAlert.swal("Error!","Please Enter New Price","error");else{var totalPrice=parseInt(newBidPrice)+parseInt(transportationPrice);parseInt(bidLastPrice)<totalPrice?SweetAlert.swal("Error!","New Bid Price Should be less than Last Entered Price","error"):userWS.bidAction({bidId:bidId,bidItemId:bidItemId,newBidPrice:newBidPrice,transportationPrice:transportationPrice,bidActionType:bidActionType},function(response){200===response.status.statusCode&&("undefined"!=typeof response.data&&""===response.data?($scope.sendMessage(ipCookie("userCId"),bidId,bidItemId,newBidPrice,transportationPrice),bidItemArray.myPrice=newBidPrice,bidItemArray.trasportationPrice=transportationPrice,bidItemArray.totalPrice=parseInt(newBidPrice)+parseInt(transportationPrice),$scope.close()):SweetAlert.swal("Error!",response.data,"error"))},_errorHandler)}},$scope.withDrawBid=function(bidItemArray,bidActionType){var bidId=bidItemArray.bidId,bidItemId=bidItemArray.bidItemId;userWS.bidWithDrawAction({bidId:bidId,bidItemId:bidItemId},function(response){200===response.status.statusCode&&(placeBid.isbIdAccept="3",$scope.close())},_errorHandler)},$scope.getBidPrice=function(){userWS.bidPrice({bidId:placeBid.bidId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(items){$scope.bidingPrice.push(items)})},_errorHandler)},$scope.init(),$scope.runBidTimerBuyLessorM=function(divId,bidEndTime,isBidStarted){if("1"===isBidStarted){$scope.diff=Math.abs(moment(bidEndTime,"DD/MM/YYYY hh:mm:ss A").diff(moment())/1e3);var itId="#M"+divId;$(itId).FlipClock($scope.diff,{clockFace:"DailyCounter",countdown:!0,callbacks:{stop:function(){$(".message").html("Auction Completed")}}})}},$scope.messages=[],Socket.socket||Socket.connect(),Socket.on("bidMessage",function(message){$scope.messages.unshift(message)}),$scope.sendMessage=function(userId,bidId,bidItemId,amountCost,transportationCost){var message={userId:userId,bidId:bidId,bidItemId:bidItemId,amountCost:amountCost,transportationCost:transportationCost};Socket.emit("bidMessage",message),this.messageText=""},Socket.on("bidMessage",function(message){angular.forEach(placeBid,function(items){placeBid.bidId===message.bidId&&angular.forEach(items.bidItem,function(bidItems){placeBid.bidItemId===message.bidItemId&&Notification.success("New Price For "+placeBid.equipmentName+" is "+parseInt(message.amountCost)+parseInt(message.transportationCost))})}),$scope.messages.unshift(message)}),$scope.$on("$destroy",function(){Socket.removeListener("bidMessage")})}]),angular.module("user").controller("dashboardMainCtrl",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$uibModal","$localStorage","$location","title",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$uibModal,$localStorage,$location,title){$scope.userData=[],$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0];$scope.userCId;$scope.activeTab=$state.params.tabName,$rootScope.$on("$locationChangeSuccess",function(){$scope.activeTab=$state.params.tabName,$scope.select()}),$scope.select=function(){"rent"===$state.params.tabName?($scope.rentLessee=!0,$scope.buyLessee=!1,$scope.rentLessor=!0,$scope.sellLessor=!1):"buy"===$state.params.tabName?($scope.rentLessee=!1,$scope.buyLessee=!0):"sell"===$state.params.tabName?($scope.rentLessor=!1,$scope.sellLessor=!0):($scope.rentLessee=!0,$scope.buyLessee=!1,$scope.rentLessor=!0,$scope.sellLessor=!1)},$scope.select(),$scope.changeUrl=function(value){$state.go($state.current,{tabName:value},{reload:!1})}}]),angular.module("user").controller("orderdetailsCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","contextPathimageurl","SweetAlert","title","contextPathPdf","SecurityDeposit",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,contextPathimageurl,SweetAlert,title,contextPathPdf,SecurityDeposit){var init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.contextPathimageurl=contextPathimageurl,$scope.contextPathPdf=contextPathPdf,$scope.usertype="lessor",$rootScope.$emit("onuserselect",$scope.usertype),$scope.select()},_errorHandler=($scope.userCId,function(e){alert(e.statusMessage)});$scope.itemPerPage=5,$scope.currentRentalList=[],$scope.cancelOrderList=[],$scope.totalItems=2,$scope.totalItemsCancel=2,$scope.currentOrderPage=1,$scope.cancelOrderPage=1,$scope.setPage=function(pageNo){},$scope.pageChangedCurrentOrder=function(pageNo){$scope.currentOrderPage=pageNo,$scope.users=$scope.getOrderDetails()},$scope.pageChangedCancelOrder=function(pageNo){$scope.cancelOrderPage=pageNo,$scope.getCancelOrderLessor()},$scope.getOrderDetails=function(){userWS.getOrderCount({reqUserType:$scope.usertype,reqOrderType:"Order Created"},function(res){200===res.status.statusCode&&($scope.totalItems=res.length,userWS.getCurrentRentals({reqUserType:$scope.usertype,reqOrderType:"Order Created",currentPage:$scope.currentOrderPage},function(response){200===response.status.statusCode&&($scope.currentRentalList=response.data)},_errorHandler))},_errorHandler)},$scope.getCancelOrderLessor=function(){userWS.getOrderCount({reqUserType:$scope.usertype,reqOrderType:"Order Cancel"},function(res){200===res.status.statusCode&&($scope.totalItemsCancel=res.length,userWS.getCurrentRentals({reqUserType:$scope.usertype,reqOrderType:"Order Cancel",currentPage:$scope.cancelOrderPage},function(response){200===response.status.statusCode&&($scope.cancelOrderList=response.data)},_errorHandler))},_errorHandler)},$scope.getCancelBidLessor=function(){userWS.getCancelBidCount({reqUserType:$scope.usertype},function(res){200===res.status.statusCode&&($scope.totalItemsCancel=res.length,userWS.getCancelledBid({reqUserType:$scope.usertype,currentPage:$scope.cancelOrderPage},function(response){200===response.status.statusCode&&"undefined"!=typeof response.data&&response.data.length>0&&($scope.equipmentCancelledBidListLessor=[],angular.forEach(response.data,function(items){angular.forEach(items,function(innerItem){$scope.equipmentCancelledBidListLessor.push(innerItem)})}))},_errorHandler))},_errorHandler)},$rootScope.$on("$locationChangeSuccess",function(){$scope.activeTab=$state.params.tabName,$scope.select()}),$scope.select=function(){"currentOrder"===$state.params.tabName?($scope.currentOrder=!0,$scope.cancelOrder=!1,$scope.cancelBid=!1,$scope.getOrderDetails(),title("My Account - Order History : irontread.com")):"cancelOrder"===$state.params.tabName?($scope.currentOrder=!1,$scope.cancelOrder=!0,$scope.cancelBid=!1,$scope.getCancelOrderLessor(),title("My Account - Cancelled/Rejected Orders : irontread.com")):"cancelBid"===$state.params.tabName?($scope.currentOrder=!1,$scope.cancelOrder=!1,$scope.cancelBid=!0,$scope.getCancelBidLessor(),title("My Account - Cancelled/Rejected Bids : irontread.com")):($scope.currentOrder=!0,$scope.cancelOrder=!1,$scope.cancelBid=!1,title("My Order History - Buy,Rent or Finance online : irontread.com"))},$scope.urlChange=function(value){$state.go($state.current,{tabName:value},{reload:!1})},$scope.cancelOrder=function(orderId){SweetAlert.swal({title:"Your EMD will be Forfeited.Are you sure want to cancel? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, Cancel it!",cancelButtonText:"No, cancel!",closeOnConfirm:!0,closeOnCancel:!0},function(isConfirm){})},$scope.openPdfPopup=function(pdfUrl){
$uibModal.open({templateUrl:"pdf.popup.html",controller:"pdfControllerLessor",size:"lg",resolve:{pdfurl:function(){return pdfUrl}}})},init(),$scope.sAution=function(eObj){SecurityDeposit.securityDeposit(eObj,!0)},$scope.checkIndexOf=function(val,matchWith){return val&&matchWith?val.toLowerCase().indexOf(matchWith)>-1:!1}}]),angular.module("user").controller("pdfControllerLessor",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","SweetAlert","pdfurl","$modalInstance","contextPathPdf",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,SweetAlert,pdfurl,$modalInstance,contextPathPdf){$scope.pdfUrl=pdfurl,$scope.contextPathPdf=contextPathPdf,$scope.scroll=0,$scope.loading="loading",$scope.onError=function(error){console.error("Error 10056	"+error)},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.getNavStyle=function(scroll){return scroll>100?"pdf-controls fixed":"pdf-controls"},$scope.onLoad=function(){$scope.loading=""}}]),angular.module("user").controller("pastRentalCtrl",["$scope","userWS","ipCookie",function($scope,userWS,ipCookie){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0]},$scope.init();var _userId=$scope.userCId,_errorHandler=function(e){alert(e.statusMessage)};$scope.pastRentalList=[];userWS.getCurrentRentals({userId:_userId},function(res){200===res.status.statusCode&&($scope.pastRentalList=res.data)},_errorHandler)}]),angular.module("user").controller("financeController",["$scope","$uibModal","userWS","ipCookie","contextPathimageurl","$state","SweetAlert","pdfPopup",function($scope,$uibModal,userWS,ipCookie,contextPathimageurl,$state,SweetAlert,pdfPopup){$scope.init=function(){$scope.getfinanceDetails()};var _errorHandler=function(e){},_userId=ipCookie("userCId");$scope.contextPathimageurl=contextPathimageurl,$scope.payModel={value:null},$scope.finance={bankId:null},$scope.financeDetails=[],$scope.getfinanceDetails=function(){userWS.getuserquery({userId:_userId},function(res){if(200===res.status.statusCode){var jsonData=res.data;$scope.financeDetails=jsonData}},_errorHandler)},$scope.payment=function(financeId){$state.go("logo.payment",{orderId:"",rtype:"lessee",ptype:"frp",financeId:financeId,eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})},$scope.financeForm=function(url){pdfPopup.pdfpopup(url,function(){})},$scope.financebankapply=function(financeId,bankId){null!==bankId?userWS.financebankapply({financeId:financeId,bankId:bankId},function(res){200===res.status.statusCode&&SweetAlert.swal({title:"Request has been processed.",type:"success",showCancelButton:!1,confirmButtonColor:"#7FFFD4",confirmButtonText:"Okay!",closeOnConfirm:!0})}):SweetAlert.swal("Error! Please select a bank")},$scope.init()}]),angular.module("user").controller("financeViewController",["$scope","$uibModal","userWS","ipCookie","$state","$stateParams","AuthenticationService","Notification","SweetAlert",function($scope,$uibModal,userWS,ipCookie,$state,$stateParams,AuthenticationService,Notification,SweetAlert){var _errorHandler=function(e){console.error("Error 10057	"+e)};$scope.init=function(){$scope.getFinanceEqmt()};AuthenticationService.getUserId();$scope.userFinance=[],$scope.acceptBank=function(objArray,fid){if(2!==objArray.length)return Notification.warning("Please select <b>only two</b> banks offer."),!1;var message="You have selected two bank(";angular.forEach(objArray,function(d,k){1===k&&(message+=" & "),message+=d.bankname}),message+=") for your loan application.",SweetAlert.swal({title:message,text:"Do you really want to proceed?",type:"success",showCancelButton:!0,confirmButtonColor:"#3e8f3e",confirmButtonText:"Yes, Proceed",cancelButtonText:"No, Cancel!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?userWS.acceptOffer({bank:objArray,fid:fid},function(response){200===response.status.statusCode&&(SweetAlert.swal("Request Sent!","Your application has been processed and sent to bank .","success"),angular.forEach($scope.userFinance,function(value,key){fid===value.finId&&(value.checkBank=[],value.bidData=[],value.bidDataCount=[],userWS.getBidData({fid:value.finId,offer:value.isAcceptOffer},function(res){200===res.status.statusCode&&(value.bidData=res.data.result,value.bidDataCount=res.data.totAccepted)},_errorHandler))}))},_errorHandler):SweetAlert.swal("Cancelled","Your request has been cancel :)","error")})},$scope.getFinanceEqmt=function(){userWS.getFinanceEqmt({},function(res){200===res.status.statusCode&&($scope.userFinance=res.data,angular.forEach($scope.userFinance,function(value,key){value.checkBank=[],value.bidData=[],value.bidDataCount=[],userWS.getBidData({fid:value.finId,offer:value.isAcceptOffer},function(res){200===res.status.statusCode&&(value.bidData=res.data.result,value.bidDataCount=res.data.totAccepted)},_errorHandler)}))},_errorHandler)},$scope.loanForm=function(eqmtid,finId){$state.go("search.dash.newfinance",{tab:"pdetails",eqmtId:eqmtid,financeId:finId,tabs:1},{reload:!0})},$scope.editForm=function(index){$state.go("search.dash.newfinance",{financeId:$scope.userFinance[index].financeId,eqmtId:$scope.userFinance[index].eqmtId,status:$scope.userFinance[index].applyStatus,tab:"pdetails"})},$scope.proceed=function(fid){$state.go("logo.payment",{orderId:"",rtype:"lessee",ptype:"frp",financeId:fid,eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})},$scope.init()}]),angular.module("user").controller("livetransactionCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")[0],$scope.getLiveTransactionEquipment()};var _userId=$scope.userCId,_errorHandler=function(e){alert(e.statusMessage)},_orderType="rent";$scope.transactionListSolo=[],$scope.transactionListBid=[],$scope.getLiveTransactionEquipment=function(){userWS.getLiveRentEquipmentList({userId:_userId,orderType:_orderType},function(res){if(200===res.status.statusCode){var jsonData=res.data;angular.forEach(jsonData,function(items){angular.forEach(items,function(value,key){if("solo"===key&&"undefined"!=typeof value)for(var i=0;i<value.length;i++)$scope.transactionListSolo.push(value[i]);if("bid"===key&&"undefined"!=typeof value)for(var j=0;j<value.length;j++){var bidJson=value[j];$scope.transactionListBid.push(bidJson)}})})}},_errorHandler)},$scope.init()}]),angular.module("user").controller("misReportController",["$scope","userWS",function($scope,userWS){}]),angular.module("user").controller("newfinanceController",["$scope","$uibModal","userWS","ipCookie","$state","$stateParams","AuthenticationService","Notification","$location","SweetAlert",function($scope,$uibModal,userWS,ipCookie,$state,$stateParams,AuthenticationService,Notification,$location,SweetAlert){$scope.mainHeader="Finance Form";var _eqmtId=$stateParams.eqmtId,_userId=!1,_defaultValue={disabled:!1,pdetails:{ef_applicant_name:null,ef_applicant_father:null,ef_applicant_dob:null,ef_applicant_gender:null,ef_applicant_aadhaar:null,ef_applicant_pan:null,ef_applicant_passport:null,ef_applicant_contactNo:null,ef_present_address:[{ef_locality:null,ef_city:null,ef_state:null,ef_country:null,ef_pin:null,ef_type:null}],ef_permanent_address:[{ef_locality:null,ef_city:null,ef_state:null,ef_country:null,ef_pin:null}]},business:{ef_applicant_company:null,ef_business_type:"Company",ef_applicant_company_address:{ef_locality:null,ef_city:null,ef_state:null,ef_country:null,ef_pin:null,ef_type:null},ef_applicant_company_contact:[{ef_contact_no:null}],ef_applicant_company_type:null,ef_applicant_company_cin:null,ef_company_establishment_date:null,ef_company_partener:[{ef_name:null,ef_contactNo:null,ef_pan:null}],ef_applicant_registrationNo:null,ef_applicant_serviceTax:null,ef_applicant_tin:null},bankdetails:{ef_bank_name:null,ef_bank_add:{ef_locality:null,ef_city:null,ef_state:null,ef_country:null,ef_pin:null},ef_bank_account_no:null,ef_bank_account_type:null,ef_bank_ifsc:null,ef_bank_credit_facility:null,ef_bank_facility_nature:null},reference:[{ef_reference_name:null,ef_reference_address:{ef_reference_locality:null,ef_reference_city:null,ef_reference_state:null,ef_reference_country:null,ef_reference_pin:null},ef_reference_contact:null,ef_reference_relation:null}],guarantor:[{ef_guarantor_name:null,ef_guarantor_father:null,ef_guarantor_email:null,ef_guarantor_address:{ef_guarantor_locality:null,ef_guarantor_city:null,ef_guarantor_state:null,ef_guarantor_country:null,ef_guarantor_pin:null},ef_guarantor_contact:null,ef_sign_borrower:null,ef_sign_guarantor:null}],documents:{ef_financial_statment:null,ef_residence_proof:null,ef_bank_statment:null,ef_pan_card:null,ef_passport:null,ef_quoprofarma:null}};$scope.emailToGau=function(gauEmail){$uibModal.open({templateUrl:"gauEmail.html",controller:"gauEmailController",size:"md",resolve:{email:function(){return{email:gauEmail,message:""}}}})},$scope.formDetails=_defaultValue,$scope.setBusinessType=function(type){"Individual"===type?($scope.businessForm=!1,$scope.formDetails.business={ef_applicant_company:null,ef_business_type:"Individual",ef_applicant_company_address:{ef_locality:null,ef_city:null,ef_state:null,ef_country:null,ef_pin:null,ef_type:null},ef_applicant_company_contact:[{ef_contact_no:null}],ef_applicant_company_type:null,ef_applicant_company_cin:null,ef_company_establishment_date:null,ef_company_partener:[{ef_name:null,ef_contactNo:null,ef_pan:null}],ef_applicant_registrationNo:null,ef_applicant_serviceTax:null,ef_applicant_tin:null}):$scope.businessForm=!0},$scope.financeId=$stateParams.financeId,$scope.tabStatus=$stateParams.tabs,$scope.bankReturnInfo=[],userWS.getReturnBankInfo({financeId:$scope.financeId},function(res){$scope.bankReturnInfo=res.data}),$scope.updateReturnValue=function(item){$uibModal.open({templateUrl:"returnBankUpdate.html",controller:"returnBankUpdateController",size:"md",resolve:{updateReturnInfo:function(){return{item:item,financeId:$scope.financeId}}}})},"1"!==$stateParams.status?$scope.status=!1:$scope.status=!0,$scope.sameAddr=!1,$scope.sameAddress=function(value){value===!1?($scope.formDetails.pdetails.ef_permanent_address.ef_locality=null,$scope.formDetails.pdetails.ef_permanent_address.ef_city=null,$scope.formDetails.pdetails.ef_permanent_address.ef_state=null,$scope.formDetails.pdetails.ef_permanent_address.ef_country=null,$scope.formDetails.pdetails.ef_permanent_address.ef_pin=null):($scope.formDetails.pdetails.ef_permanent_address.ef_locality=$scope.formDetails.pdetails.ef_present_address.ef_locality,$scope.formDetails.pdetails.ef_permanent_address.ef_city=$scope.formDetails.pdetails.ef_present_address.ef_city,$scope.formDetails.pdetails.ef_permanent_address.ef_state=$scope.formDetails.pdetails.ef_present_address.ef_state,$scope.formDetails.pdetails.ef_permanent_address.ef_country=$scope.formDetails.pdetails.ef_present_address.ef_country,$scope.formDetails.pdetails.ef_permanent_address.ef_pin=$scope.formDetails.pdetails.ef_present_address.ef_pin)},$scope.autoCompleteOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"locality"===item.types[0]&&($scope.formDetails.pdetails.ef_present_address.ef_city=item.long_name),"administrative_area_level_1"===item.types[0]&&($scope.formDetails.pdetails.ef_present_address.ef_state=item.long_name),"country"===item.types[0]&&($scope.formDetails.pdetails.ef_present_address.ef_country=item.long_name)})}},$scope.permanentOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"administrative_area_level_1"===item.types[0]&&($scope.formDetails.pdetails.ef_permanent_address.ef_state=item.long_name),"locality"===item.types[0]&&($scope.formDetails.pdetails.ef_permanent_address.ef_city=item.long_name),"country"===item.types[0]&&($scope.formDetails.pdetails.ef_permanent_address.ef_country=item.long_name)})}},$scope.companyOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"administrative_area_level_1"===item.types[0]&&($scope.formDetails.business.ef_applicant_company_address.ef_state=item.long_name),"locality"===item.types[0]&&($scope.formDetails.business.ef_applicant_company_address.ef_city=item.long_name),"country"===item.types[0]&&($scope.formDetails.business.ef_applicant_company_address.ef_country=item.long_name)})}},$scope.bankOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){"administrative_area_level_1"===item.types[0]&&($scope.formDetails.bankdetails.ef_bank_add.ef_state=item.long_name),"locality"===item.types[0]&&($scope.formDetails.bankdetails.ef_bank_add.ef_city=item.long_name),"country"===item.types[0]&&($scope.formDetails.bankdetails.ef_bank_add.ef_country=item.long_name)})}},$scope.Index="",$scope.indexFunction=function(index){$scope.Index=index},$scope.referenceOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){var i=$scope.Index;"administrative_area_level_1"===item.types[0]&&($scope.formDetails.reference[i].ef_reference_address.ef_reference_state=item.long_name),"locality"===item.types[0]&&($scope.formDetails.reference[i].ef_reference_address.ef_reference_city=item.long_name),"country"===item.types[0]&&($scope.formDetails.reference[i].ef_reference_address.ef_reference_country=item.long_name)})}},$scope.guarantorOptions={types:"(cities)",country:"in",place_changed:function(data){angular.forEach(data.address_components,function(item){var i=$scope.Index;"administrative_area_level_1"===item.types[0]&&($scope.formDetails.guarantor[i].ef_guarantor_address.ef_guarantor_state=item.long_name),"locality"===item.types[0]&&($scope.formDetails.guarantor[i].ef_guarantor_address.ef_guarantor_city=item.long_name),"country"===item.types[0]&&($scope.formDetails.guarantor[i].ef_guarantor_address.ef_guarantor_country=item.long_name)})}},null!==$scope.tabStatus&&userWS.getfinance({financeId:$scope.financeId,ef_user_id:_userId},function(res){if(200===res.status.statusCode){var _formdata=res.data;$scope.formDetails=_formdata,angular.forEach($scope.formDetails,function(v1,k1){"reference"===k1&&angular.forEach(v1,function(value,key){value.ef_reference_address=value.ef_reference_address.length>0?value.ef_reference_address[0]:[]}),"guarantor"===k1&&angular.forEach(v1,function(value,key){value.ef_guarantor_address=value.ef_guarantor_address.length>0?value.ef_guarantor_address[0]:[]})}),$scope.businessForm="Individual"!==res.data.business.ef_business_type,0===res.data.business.ef_applicant_company_contact.length&&$scope.formDetails.business.ef_applicant_company_contact.push({ef_contact_no:null}),0===res.data.business.ef_company_partener.length&&$scope.formDetails.business.ef_company_partener.push({ef_name:null,ef_contactNo:null,ef_pan:null}),0===res.data.reference.length&&($scope.formDetails.reference=[{ef_reference_name:null,ef_reference_address:{ef_reference_locality:null,ef_reference_city:null,ef_reference_state:null,ef_reference_country:null,ef_reference_pin:null},ef_reference_contact:null,ef_reference_relation:null}]),0===res.data.guarantor.length&&($scope.formDetails.guarantor=[{ef_guarantor_name:null,ef_guarantor_father:null,ef_guarantor_email:null,ef_guarantor_address:{ef_guarantor_locality:null,ef_guarantor_city:null,ef_guarantor_state:null,ef_guarantor_country:null,ef_guarantor_pin:null},ef_guarantor_contact:null,ef_sign_borrower:null,ef_sign_guarantor:null}])}}),$scope.dateformat={maxDate:"-18y",changeYear:!0,changeMonth:!0,dateFormat:"dd/mm/yy"},$scope.addContact=function(){$scope.formDetails.business.ef_applicant_company_contact.push({ef_contact_no:null})},$scope.removeContact=function(idx){if(idx>1){var lastItem=$scope.formDetails.business.ef_applicant_company_contact.length-1;$scope.formDetails.business.ef_applicant_company_contact.splice(lastItem)}},$scope.addReference=function(){$scope.formDetails.reference.push({ef_reference_name:null,ef_reference_address:{ef_reference_locality:null,ef_reference_city:null,ef_reference_state:null,ef_reference_country:null,ef_reference_pin:null},ef_reference_contact:null,ef_reference_relation:null})},$scope.removeReference=function(){var lastItem=$scope.formDetails.reference.length-1;$scope.formDetails.reference.splice(lastItem)},$scope.addGuarantor=function(){$scope.formDetails.guarantor.push({ef_guarantor_name:null,ef_guarantor_father:null,ef_guarantor_email:null,ef_guarantor_address:{ef_guarantor_locality:null,ef_guarantor_city:null,ef_guarantor_state:null,ef_guarantor_country:null,ef_guarantor_pin:null},ef_guarantor_contact:null,ef_sign_borrower:null,ef_sign_guarantor:null})},$scope.removeGuarantor=function(){var lastItem=$scope.formDetails.guarantor.length-1;$scope.formDetails.guarantor.splice(lastItem)},$scope.addPatner=function(){$scope.formDetails.business.ef_company_partener.push({ef_name:null,ef_contactNo:null,ef_pan:null})},$scope.removePatner=function(idx){if(idx>1){var lastItem=$scope.formDetails.business.ef_company_partener.length-1;$scope.formDetails.business.ef_company_partener.splice(lastItem)}};var _activeTab=$stateParams.tab;$scope.business=!1,$scope.bankdetails=!1,$scope.reference=!1,$scope.guarantor=!1,$scope.documents=!1,$scope.bankReturns=!1,$scope.pdetails=!0,$scope.changeTab=function(tab){null!==$scope.tabStatus&&$state.go($state.current,{tab:tab},{reload:!1})},$scope.selectTab=function(tab){"guarantor"===$stateParams.tab?($scope.guarantor=!0,$scope.pdetails=!1,$scope.business=!1,$scope.bankdetails=!1,$scope.reference=!1,$scope.documents=!1,$scope.bankReturns=!1):"bankdetails"===$stateParams.tab?($scope.bankdetails=!0,$scope.pdetails=!1,$scope.business=!1,$scope.reference=!1,$scope.guarantor=!1,$scope.documents=!1,$scope.bankReturns=!1):"reference"===$stateParams.tab?($scope.reference=!0,$scope.pdetails=!1,$scope.business=!1,$scope.bankdetails=!1,$scope.guarantor=!1,$scope.documents=!1,$scope.bankReturns=!1):"business"===$stateParams.tab?($scope.business=!0,$scope.pdetails=!1,$scope.bankdetails=!1,$scope.reference=!1,$scope.guarantor=!1,$scope.documents=!1,$scope.bankReturns=!1):"documents"===$stateParams.tab?($scope.documents=!0,$scope.pdetails=!1,$scope.business=!1,$scope.bankdetails=!1,$scope.reference=!1,$scope.guarantor=!1,$scope.bankReturns=!1):"bankReturns"===$stateParams.tab?($scope.documents=!1,$scope.pdetails=!1,$scope.business=!1,$scope.bankdetails=!1,$scope.reference=!1,$scope.guarantor=!1,$scope.bankReturns=!0):($scope.pdetails=!0,$scope.business=!1,$scope.bankdetails=!1,$scope.reference=!1,$scope.guarantor=!1,$scope.documents=!1,$scope.bankReturns=!1)},$scope.submitForm=function(isValid,data){var req,reqObj;isValid&&"pdetails"===_activeTab&&(reqObj={ef_applicant_name:data.pdetails.ef_applicant_name,ef_applicant_father:data.pdetails.ef_applicant_father,ef_applicant_dob:moment(data.pdetails.ef_applicant_dob).format("DD/MM/YYYY"),ef_applicant_gender:data.pdetails.ef_applicant_gender,ef_applicant_aadhaar:data.pdetails.ef_applicant_aadhaar,ef_applicant_pan:data.pdetails.ef_applicant_pan,ef_applicant_passport:data.pdetails.ef_applicant_passport,ef_applicant_contactNo:data.pdetails.ef_applicant_contactNo,ef_present_address:[{ef_locality:data.pdetails.ef_present_address.ef_locality,ef_city:data.pdetails.ef_present_address.ef_city,ef_state:data.pdetails.ef_present_address.ef_state,ef_country:data.pdetails.ef_present_address.ef_country,ef_pin:data.pdetails.ef_present_address.ef_pin,ef_type:data.pdetails.ef_present_address.ef_type}],ef_permanent_address:[{ef_locality:data.pdetails.ef_permanent_address.ef_locality,ef_city:data.pdetails.ef_permanent_address.ef_city,ef_state:data.pdetails.ef_permanent_address.ef_state,ef_country:data.pdetails.ef_permanent_address.ef_country,ef_pin:data.pdetails.ef_permanent_address.ef_pin}]},req=""!==$scope.financeId?{financeId:$scope.financeId,ef_equipment_id:_eqmtId,ef_user_id:_userId,type:_activeTab,params:JSON.stringify(reqObj)}:{ef_equipment_id:_eqmtId,ef_user_id:_userId,type:_activeTab,params:JSON.stringify(reqObj)}),isValid&&"business"===_activeTab&&(reqObj={ef_applicant_company:data.business.ef_applicant_company,ef_business_type:data.business.ef_business_type,ef_applicant_company_address:[{ef_locality:data.business.ef_applicant_company_address.ef_locality,ef_city:data.business.ef_applicant_company_address.ef_city,ef_state:data.business.ef_applicant_company_address.ef_state,ef_country:data.business.ef_applicant_company_address.ef_country,ef_pin:data.business.ef_applicant_company_address.ef_pin,ef_type:data.business.ef_applicant_company_address.ef_type}],ef_applicant_company_contact:data.business.ef_applicant_company_contact,ef_applicant_company_type:data.business.ef_applicant_company_type,ef_applicant_company_cin:data.business.ef_applicant_company_cin,ef_company_establishment_date:moment(data.business.ef_company_establishment_date).format("DD/MM/YYYY"),ef_company_partener:data.business.ef_company_partener,ef_applicant_registrationNo:data.business.ef_applicant_registrationNo,ef_applicant_serviceTax:data.business.ef_applicant_serviceTax,ef_applicant_tin:data.business.ef_applicant_tin},req={ef_equipment_id:_eqmtId,ef_user_id:_userId,financeId:$scope.financeId,type:_activeTab,params:JSON.stringify(reqObj)}),isValid&&"bankdetails"===_activeTab&&("undefined"==typeof data.bankdetails.ef_bank_add&&(data.bankdetails.ef_bank_add={ef_locality:"",ef_city:"",ef_country:"",ef_pin:""}),reqObj={ef_bank_name:data.bankdetails.ef_bank_name,ef_bank_add:{ef_locality:data.bankdetails.ef_bank_add.ef_locality,ef_city:data.bankdetails.ef_bank_add.ef_city,ef_state:data.bankdetails.ef_bank_add.ef_state,ef_country:data.bankdetails.ef_bank_add.ef_country,ef_pin:data.bankdetails.ef_bank_add.ef_pin},ef_bank_account_no:data.bankdetails.ef_bank_account_no,ef_bank_account_type:data.bankdetails.ef_bank_account_type,ef_bank_ifsc:data.bankdetails.ef_bank_ifsc,ef_bank_credit_facility:data.bankdetails.ef_bank_credit_facility,ef_bank_facility_nature:data.bankdetails.ef_bank_facility_nature},req={ef_equipment_id:_eqmtId,ef_user_id:_userId,financeId:$scope.financeId,type:_activeTab,params:JSON.stringify(reqObj)}),isValid&&"reference"===_activeTab&&(reqObj=data.reference,req={ef_equipment_id:_eqmtId,ef_user_id:_userId,financeId:$scope.financeId,type:_activeTab,params:JSON.stringify(reqObj)}),isValid&&"guarantor"===_activeTab&&(reqObj=data.guarantor,req={ef_equipment_id:_eqmtId,ef_user_id:_userId,financeId:$scope.financeId,type:_activeTab,params:JSON.stringify(reqObj)}),isValid&&"documents"===_activeTab&&(req={financial_statment:data.documents.ef_financial_statment,residence_proof:data.documents.ef_residence_proof,bank_statment:data.documents.ef_bank_statment,pan_card:data.documents.ef_pan_card,passport:data.documents.ef_passport,quoprofarma:data.documents.ef_quoprofarma,ef_equipment_id:_eqmtId,ef_user_id:_userId,financeId:$scope.financeId,type:_activeTab}),isValid&&userWS.addfinance(req,function(res){200===res.status.statusCode&&("pdetails"===_activeTab?($scope.financeId=res.data.id,$scope.tabStatus=res.data.pdetailStatus,$state.go("search.dash.newfinance",{tab:"business"},{reload:!1}),Notification.success("Personal information has been saved.")):"business"===_activeTab?($state.go("search.dash.newfinance",{tab:"bankdetails"},{reload:!1}),Notification.success("Business Details has been saved.")):"bankdetails"===_activeTab?($state.go("search.dash.newfinance",{tab:"reference"},{reload:!1}),Notification.success("Bank Details has been saved.")):"reference"===_activeTab?($state.go("search.dash.newfinance",{tab:"guarantor"},{reload:!1}),Notification.success("Reference has been saved.")):"guarantor"===_activeTab?(Notification.success("Guarantor has been saved."),$state.go("search.dash.newfinance",{tab:"documents"},{reload:!1})):"documents"===_activeTab&&($state.go($state.current,{},{reload:!0}),Notification.success("Documents has been saved.")))})},$scope.proceed=function(){$state.go("logo.payment",{orderId:"",rtype:"lessee",ptype:"frp",financeId:$scope.financeId,eqmtList:"",listingFrom:"",listingTo:""},{reload:!0})}}]).controller("gauEmailController",["$scope","$rootScope","$stateParams","$state","userWS","contextPathimageurl","$uibModal","$uibModalInstance","SweetAlert","email",function($scope,$rootScope,$stateParams,$state,userWS,contextPathimageurl,$uibModal,$uibModalInstance,SweetAlert,email){$scope.gauEmail=email,$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.sendGauEmail=function(){userWS.sendGauEmail($scope.gauEmail,function(res){200===res.status.statusCode&&$scope.close()})},$scope.selectInspectorPop=function(inspectPop){}}]).controller("returnBankUpdateController",["$scope","$rootScope","$stateParams","$state","userWS","contextPathimageurl","$uibModal","$uibModalInstance","SweetAlert","updateReturnInfo",function($scope,$rootScope,$stateParams,$state,userWS,contextPathimageurl,$uibModal,$uibModalInstance,SweetAlert,updateReturnInfo){$scope.updateReturnInfo=updateReturnInfo,$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.sendUpdatedValue=function(){$scope.retInfo.finId=$scope.updateReturnInfo.financeId,$scope.retInfo.subDocId=$scope.updateReturnInfo.item._id,$scope.retInfo.subDocPosition=$scope.updateReturnInfo.item.position,$scope.retInfo.subDocLabel=$scope.updateReturnInfo.item.label,userWS.sendUpdatedValue($scope.retInfo,function(res){200===res.status.statusCode&&$scope.close()})},$scope.selectInspectorPop=function(inspectPop){}}]),angular.module("user").controller("notificationCtrl",["$scope","$rootScope","ipCookie","userWS","$state","$stateParams","$uibModal","$localStorage","$location","title",function($scope,$rootScope,ipCookie,userWS,$state,$stateParams,$uibModal,$localStorage,$location,title){$scope.init=function(){$scope.getNotificationCount()},title("My Account - Notification : irontread.com"),$scope.notification={header:[],rows:[]},$scope.unRead=[],$scope.updatenotification=[];var _userId=ipCookie("userCId");$scope.getNotification=function(){userWS.getnotification({userId:_userId},function(res){200===res.status.statusCode&&angular.forEach(res.data,function(jsonData){$scope.notification={header:jsonData.header,rows:jsonData.rows}})})},$scope.getNotification(),$rootScope.$on("counter",function(event,message){$scope.unRead+=1,"undefined"!=typeof message&&""!==message&&$scope.notification.rows.push(message)}),$scope.countZero=function(){userWS.updateallnotificationread({},function(res){200===res.status.statusCode&&($scope.unRead=0)})},$scope.link="",$scope.getNotificationUrl=function(state,id){},$scope.getNotificationUrl(),$scope.getNotificationCount=function(){userWS.getunreadcount({userId:_userId},function(res){200===res.status.statusCode&&($scope.unRead=res.data?res.data:0)})},$rootScope.$on("$locationChangeSuccess",function(){$scope.updateNotificationRead(),title("My Account - Notification : irontread.com")}),$scope.updateNotificationRead=function(notificationId){userWS.updateNotificationRead({userId:_userId,notificationId:notificationId},function(res){200===res.status.statusCode&&($scope.unRead=res.data?res.data:0)})},$scope.init(),$scope.showPrefrence=!1,$scope.prefrence=function(){$scope.showPrefrence=!$scope.showPrefrence}}]),angular.module("user").controller("reviewsCtrl",["$scope","$uibModal",function($scope,$uibModal){$scope.message="Reviews"}]),angular.module("user").controller("saleController",["$scope","$rootScope","ipCookie","Equipments","$state","$stateParams","$uibModal","$localStorage","$location",function($scope,$rootScope,ipCookie,Equipments,$state,$stateParams,$uibModal,$localStorage,$location){}]),angular.module("equipment").controller("thankyouController",["$scope","$http","$state","$stateParams","$localStorage","AuthenticationService","ipCookie","userWS","contextPathimageurl","$location","contextPathPdf","$timeout",function($scope,$http,$state,$stateParams,$localStorage,AuthenticationService,ipCookie,userWS,contextPathimageurl,$location,contextPathPdf,$timeout){$scope.contextPathimageurl=contextPathimageurl,$scope.processType=$state.params.type,$scope.process="",$scope.isMobile=!1,$scope.myOrderText=" Go to My Dashboard",$scope.contextPathPdf=contextPathPdf;var test=0;angular.element(document).ready(function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&($scope.isMobile=!0,angular.element(document).find("header").remove(),angular.element(document).find("footer").remove(),angular.element(document).find(".thankyoutop").removeClass("mt120"),$scope.myOrderText=" Go to My Order"),$scope.$on("$locationChangeStart",function(event,next,from,current){0!==test&&(alert("Sorry ! Back Button is disabled"),event.preventDefault()),test++})}),$scope.userName=ipCookie("userCName")?ipCookie("userCName"):"Guest";var _errorHandler=(ipCookie("userCId"),function(e){console.error("Error 10058	"+e)});$scope.myAccount=function(){$scope.isMobile?window.location.href=window.location.href+"&goto=myorder":"rentRequest"===$state.params.type||"reverse-auction-rent"===$state.params.type?$state.go("search.dash.board.lessee",{tabName:"rent"},{reload:!1}):"directrent"===$state.params.type||"direct-buy"===$state.params.type||"reverse-buy-order"===$state.params.type||"reverse-rent-order"===$state.params.type?$state.go("search.dash.currentrental",{},{reload:!1}):"reverse-auction-buy"===$state.params.type&&$state.go("search.dash.board.lessee",{tabName:"buy"},{reload:!1})},$scope.originalimage=[],$scope.dataimage="",$scope.requestList=[],$scope.getOrdSummary=function(){ipCookie("userCName")?userWS.getordersummary({orderId:$state.params.orderId},function(res){200===res.status.statusCode&&($scope.process=res.info,"solo"===res.info&&($scope.requestList=res.data[0]),"bid"===res.info&&($scope.requestList=res.data[0]))},_errorHandler):userWS.getordersummary1({orderId:$state.params.orderId},function(res){200===res.status.statusCode&&($scope.process=res.info,"solo"===res.info&&($scope.requestList=res.data[0]),"bid"===res.info&&($scope.requestList=res.data[0]))},_errorHandler)},$scope.imageLoading=!0,$scope.buttonEnable=!0;var countUp=function(){$scope.imageLoading=!1,$scope.buttonEnable=!1};$scope.getOrdSummary(),$scope.getBase64FromImageUrl=function(url,index){var img=new Image;img.setAttribute("crossOrigin","anonymous"),img.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height;var ctx=canvas.getContext("2d");ctx.drawImage(this,0,0);var dataURL=canvas.toDataURL("image/jpg");$scope.originalimage[index]=dataURL,$timeout(countUp,2e3)},img.src=url}}]),angular.module("equipment").controller("thankyouControllerSA",["$scope","$http","$state","$stateParams","$localStorage","AuthenticationService","ipCookie","userWS","contextPathimageurl","EquipmentsPublic","$location","$window","contextPathPdf","$timeout",function($scope,$http,$state,$stateParams,$localStorage,AuthenticationService,ipCookie,userWS,contextPathimageurl,EquipmentsPublic,$location,$window,contextPathPdf,$timeout){$scope.originalimage=[],$scope.saEquipment={},$scope.forMail="",$scope.contextPathimageurl=contextPathimageurl,$scope.contextPathPdf=contextPathPdf,$scope.userName=ipCookie("userCName"),$scope.myAccount=function(){$state.go("search.dash.usereqmtadd",{tab:"straightauction",eqmtId:$stateParams.eid})},$scope.dashboard=function(){$state.go("search.dash.auctionEquipList",{tabName:"inauction"})},$scope.getSAEquipLessor=function(){userWS.getSAEquipLessor({eid:$stateParams.eid},function(res){200===res.status.statusCode&&(null!==res.data?$scope.saEquipment=res.data:$state.go("home",{},{reload:!0}))})},$scope.getSAEquipLessor(),$scope.getBase64FromImageUrl=function(url,index){var img=new Image;
img.setAttribute("crossOrigin","anonymous"),img.onload=function(){var canvas=document.createElement("canvas");canvas.width=this.width,canvas.height=this.height;var ctx=canvas.getContext("2d");ctx.drawImage(this,0,0);var dataURL=canvas.toDataURL("image/jpg");$scope.originalimage[index]=dataURL},img.src=url}}]),angular.module("user").controller("addusermanagementCtrl",["$scope","$state","$stateParams","$rootScope","ipCookie","$localStorage","userWS","$uibModal","Notification","title","$timeout",function($scope,$state,$stateParams,$rootScope,ipCookie,$localStorage,userWS,$uibModal,Notification,title,$timeout){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC"),$scope.message="Add User",$scope.isEditMode=!1,$scope.getUserRole(),$scope.getCreditAgencyList(),null!==$stateParams.childUserId?($scope.message="Edit User",$scope.isEditMode=!0,$scope.getUserDetail()):$timeout(function(){$scope.user={Email:"",fname:"",lname:"",Password:"",CompanyName:"",ContactNo:"",RegistrationNo:"",PanNo:"",CompanyBrief:"",Designation:"",userCreditRating:"",userCreditAgency:"",Role:"",SuperUserId:""}},1e3)},title("My Account - Add User : IronTread.com"),$scope.user={Email:"",fname:"",lname:"",Password:"",CompanyName:"",ContactNo:"",RegistrationNo:"",PanNo:"",CompanyBrief:"",Designation:"",userCreditRating:"",userCreditAgency:"",Role:"",SuperUserId:""},$scope.roleData=[];var _userId=$scope.userCId,_errorHandler=function(e){console.error("Error 10060	"+e)};$scope.getCreditAgencyList=function(){userWS.getCreditAgency({},function(res){200===res.status.statusCode&&($scope.creditAgencyArray=res.data),$scope.close=function(){}},function(e){console.error("Error 10061	"+e)})},$scope.saveUser=function(isValid){isValid&&userWS.add({Email:$scope.user.Email,Name:$scope.user.fname+" "+$scope.user.lname,fname:$scope.user.fname,lname:$scope.user.lname,Password:$scope.user.Password,CompanyName:"",ContactNo:$scope.user.ContactNo,RegistrationNo:"",PanNo:"",CompanyBrief:"",Designation:$scope.user.Designation,userCreditRating:$scope.user.userCreditRating,userCreditAgency:$scope.user.userCreditAgency,Role:$scope.user.Role,SuperUserId:_userId,registerFrom:"website"},function(res){200===res.status.statusCode?"register"===res.data?$state.go("search.dash.user",{}):res.data&&res.data.msg?Notification.success(res.data.msg):res.data&&res.error&&Notification.error(res.error):Notification.error(res.data.msg)},_errorHandler)},$scope.getUserRole=function(){userWS.getRole(function(res){200===res.status.statusCode&&($scope.roleData=res.data)},_errorHandler)},$scope.getUserDetail=function(){null!==$stateParams.childUserId&&userWS.getUser({userId:$stateParams.childUserId},function(res){if(200===res.status.statusCode){var jsonData=res.data;jsonData.length>0&&($scope.user=jsonData[0])}},_errorHandler)},$scope.editUser=function(){null!==$stateParams.childUserId&&userWS.edit({id:$stateParams.childUserId,userEmail:$scope.user.Email,userName:$scope.user.fname+" "+$scope.user.lname,fname:$scope.user.fname,lname:$scope.user.lname,userContactNo:$scope.user.ContactNo,Designation:$scope.user.Designation,Role:$scope.user.Role,userCreditRating:$scope.user.userCreditRating,userCreditAgency:$scope.user.userCreditAgency},function(res){200===res.status.statusCode?$state.go("search.dash.user",{}):alert(res.message)},_errorHandler)},$scope.saveUserData=function(isValid){var userIdP=$stateParams.childUserId;userIdP?$scope.editUser(isValid):$scope.saveUser(isValid)},$scope.init()}]),angular.module("user").controller("editusermanagementCtrl",["$scope","userWS",function($scope,userWS){$scope.message="Edit User"}]),angular.module("user").controller("usermanagementCtrl",["$scope","$state","$rootScope","ipCookie","$localStorage","userWS","$uibModal","title",function($scope,$state,$rootScope,ipCookie,$localStorage,userWS,$uibModal,title){$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")},$scope.init(),title("My Account - User Management : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account - User Management : irontread.com")});var _userId=$scope.userCId;$scope.users={header:[],rows:[]};var _errorHandler=function(e){},_users={refresh:function(){userWS.all({SuperUserId:_userId},function(res){200===res.status.statusCode&&($scope.users={header:[{userName:"Name"},{userEmail:"Email"},{userContactNo:"ContactNo"},{Designation:"Designation"},{Role:"Role"},{isActive:"Status"},{"":""}],rows:res.data})},_errorHandler)},edit:function(user){$state.go("search.dash.useradd",{childUserId:user.id})},deactivate:function(_id){userWS.deactivate({id:_id,deleteStatus:"1",SuperUserId:_userId},function(res){_users.refresh()},_errorHandler)},activate:function(_id){userWS.activate({id:_id,deleteStatus:"0",SuperUserId:_userId},function(res){_users.refresh()},_errorHandler)},search:function(user){userWS.search({searchData:user.userData,SuperUserId:_userId},function(res){200===res.status.statusCode&&($scope.users={header:[{userName:"Name"},{userEmail:"Email"},{userContactNo:"ContactNo"},{Designation:"Designation"},{Role:"Role"},{isActive:"Status"},{"":""}],rows:res.data})},_errorHandler)}};$scope.userdata=_users,_users.refresh(),$scope.openAddModal=function(size){var modalInstance=$uibModal.open({animation:!0,templateUrl:"user.add.html",controller:"userAddCtrl",size:"md"});modalInstance.result.then(function(user){_users.add(user)},function(){})},$scope.openEditModal=function(_user){var modalInstance=$uibModal.open({animation:!0,templateUrl:"user.edit.html",controller:"userEditCtrl",size:"md",resolve:{user:function(){return _user}}});modalInstance.result.then(function(user){user.SuperUserId=_userId,_users.edit(user)},function(){})}}]).controller("userAddCtrl",["$scope","$modalInstance",function($scope,$modalInstance){"undefined"==typeof $scope.user&&($scope.user={}),$scope.user={},$scope.ok=function(){$modalInstance.close($scope.user)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("userEditCtrl",["$scope","$modalInstance","user",function($scope,$modalInstance,user){$scope.user=user,$scope.ok=function(){$modalInstance.close($scope.user)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("user").controller("userProfileCtrl",["$scope","$state","$rootScope","ipCookie","$localStorage","userWS","$uibModal","AuthenticationService","$modalInstance",function($scope,$state,$rootScope,ipCookie,$localStorage,userWS,$uibModal,AuthenticationService,$modalInstance){$scope.message="User Profile",$scope.init=function(){$scope.userCId=ipCookie("userCId"),$scope.getCreditAgencyList()},$scope.getCreditAgencyList=function(){userWS.getCreditAgency({},function(res){200===res.status.statusCode&&($scope.creditAgencyArray=res.data),$scope.close=function(){$modalInstance.close()}},function(e){alert(e.statusMessage)})},$scope.init();var _userId=$scope.userCId,_errorHandler=function(e){},_profile={edit:function(){userWS.updateProfile($scope.user,function(res){200===res.status.statusCode&&(ipCookie.remove("userCName"),ipCookie("userCName",$scope.user.userName),$rootScope.$emit("ProfileUpdate"))},_errorHandler)},refresh:function(){userWS.findProfile({SuperUserId:_userId},function(res){200===res.status.statusCode&&($scope.user=res.data[0])},_errorHandler)}};$scope.profileupdate=_profile,_profile.refresh()}]),angular.module("user").controller("prefrenceController",["$scope","userWS","Notification","title","$rootScope",function($scope,userWS,Notification,title,$rootScope){$scope.data={email:{},sms:{}},$scope.data.email.general=!0,$scope.data.sms.general=!0,title("My Account - Preferences : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account - Preferences : irontread.com")}),$scope.preference=function(tempData){userWS.preference({data:tempData},function(res){200===res.status.statusCode&&(null!==tempData&&Notification.success("Your Preferences have been Saved."),$scope.data=res.data)})},$scope.preference(null)}]),angular.module("user").controller("userVerificationCtrl",["$scope","$rootScope","userWS","ipCookie","contextPathimageurl","Notification","$http","contextPathprivate","title","$location",function($scope,$rootScope,userWS,ipCookie,contextPathimageurl,Notification,$http,contextPathprivate,title,$location){var _myHandler=function(err){console.error("Error 10065	"+err)};$scope.user={},$scope.temp=null,$scope.baseUrl=contextPathimageurl,title("My Account - Profile : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account - Profile : irontread.com")}),userWS.misc({key:"nature_of_business"},function(res){$scope.nature_of_business=res.data.value}),userWS.misc({key:"security_question"},function(res){$scope.security_question=res.data.value}),userWS.misc({key:"credit_agency"},function(res){$scope.credit_agency=res.data.value}),$location.path().indexOf("#Banking-Details")&&($(document).find(".Banking-Details").css({"background-color":"#FFFF99"}),$(document).find(".Banking-Details").animate({backgroundColor:"#FFFFFF"},5e3)),$scope.submitForm=function(data){$scope.temp="undefined"==typeof data.auto?!0:!1,userWS.userVerification(data,function(res){200===res.status.statusCode&&($scope.user=res.data,$scope.temp&&Notification.success("Information has been updated"))},_myHandler)},$scope.submitForm({auto:!0}),$scope.userPic="",$scope.downloadDocument=function(fileReq,fileName,fileExtType){var url=contextPathprivate+"user/getdocument";$http({url:url,method:"POST",data:{fileType:fileReq,fileName:fileName},responseType:"blob"}).success(function(data,status,headers,config){var blob=new Blob([data],{type:fileExtType}),fileArray=fileName.split("/");saveAs(blob,fileArray[fileArray.length-1])}).error(function(data,status,headers,config){console.error("Error 10066	"+status)})};var vtooltip={company:{name:{position:"bottom",tooltip:"Enter your complete company name as appearing on the registration certificate"},natureofBuss:{position:"bottom",tooltip:"Change the existing options to :Rental Company, OEM, Contractor, Used Equipment Dealer"},about:{position:"bottom",tooltip:"Please enter in brief about the company"},website:{position:"top",tooltip:'Eg"-www.abc.com'}},primary:{name:{position:"bottom",tooltip:"Please enter your full name as per the records"},designation:{position:"bottom",tooltip:"Please enter your designation in the company"},phone:{position:"bottom",tooltip:"Please enter a valid mobile number for all the future communications"},email:{position:"top",tooltip:"Please enter a valid email id for all the future communications"}},secondary:{name:{position:"bottom",tooltip:"Please enter your full name as per the records"},designation:{position:"bottom",tooltip:"Please enter your designation in the company"},phone:{position:"bottom",tooltip:"Please enter a valid mobile number for all the future communications"},email:{position:"top",tooltip:"Please enter a valid email id for all the future communications"}},banking:{acc:{position:"bottom",tooltip:"Please enter your bank account number"}},documents:{pan:{position:"top",tooltip:"Enter your PAN NUMBER and upload it"},tin:{position:"top",tooltip:"Enter your TIN NUMBER and upload it"},cst:{position:"top",tooltip:"Enter your CST NUMBER and upload it"},crc:{position:"top",tooltip:"Enter your Company Registration Code and upload it"}}};$scope.vtooltip=vtooltip}]),angular.module("user").controller("verifyemailCtrl",["$scope","$stateParams","$rootScope","ipCookie","$localStorage","userWSPublic","$uibModal","Notification","$stateParams","$state",function($scope,$stateParams,$rootScope,ipCookie,$localStorage,userWSPublic,$uibModal,Notification,$state){var _errorHandler=function(e){console.error("Error 10067	"+e)};$scope.verifyemail="",userWSPublic.verifyemail({token:$stateParams.token},function(res){if(200===res.status.statusCode){var message=res.data.trim();"success"===message?($scope.verifyemail="Your email has been confirmed",Notification.success($scope.verifyemail)):"timeover"===message?($scope.verifyemail="Your verification link has been expired",Notification.warning($scope.verifyemail)):"used"===message?($scope.verifyemail="Your have already confirmed your email address",Notification.error($scope.verifyemail)):(Notification.error("Invalid Access"),$state.go("home"))}},_errorHandler)}]),angular.module("user").controller("wishlistCtrl",["$scope","$rootScope","ipCookie","$localStorage","userWS","$uibModal","$state","title","Notification",function($scope,$rootScope,ipCookie,$localStorage,userWS,$uibModal,$state,title,Notification){$scope.init=function(){$scope.message="My Wish Lists",$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC")},title("My Account - Favourites : irontread.com"),$rootScope.$on("$locationChangeSuccess",function(){title("My Account - Favourites : irontread.com")}),$scope.wishlist=[],$scope.wishlistId=[];var _userId=$scope.userCId,_errorHandler=function(e){};$scope.init(),userWS.wishlist({userId:_userId},function(res){if(200===res.status.statusCode){var jsonData=res.data[0].eu_wishlist;$scope.wishlist=jsonData,angular.forEach($scope.wishlist,function(data){angular.forEach(data.euw_equipments,function(id){$scope.wishlistId.push(id.euwi_equipment_id)})})}},_errorHandler),$scope.selectWishItem=function(wishIndex){if($scope.wishlist[wishIndex].euw_equipments.length>0){var wishItems=[];angular.forEach($scope.wishlist[wishIndex].euw_equipments,function(value){wishItems.push(value.euwi_equipment_id)}),$state.go("search.dash.wishlistitem",{wishItems:wishItems,tab:$scope.wishlist[wishIndex]._id},{reload:!0})}else Notification.info("No favourites item for this folder.")}}]),angular.module("user").controller("wishlistitemCtrl",["$scope","$rootScope","$state","ipCookie","$localStorage","userWS","$uibModal","$stateParams","contextPathimageurl","rentRequest","Notification","title",function($scope,$rootScope,$state,ipCookie,$localStorage,userWS,$uibModal,$stateParams,contextPathimageurl,rentRequest,Notification,title){$scope.init=function(){$scope.message="My Wish Lists",$scope.userCId=ipCookie("userCId"),$scope.userCName=ipCookie("userCName"),$scope.authenticatedC=ipCookie("authenticatedC"),$scope.roleC=ipCookie("roleC"),$scope.wishItemsId=$stateParams.wishItems,$scope.contextPathimageurl=contextPathimageurl,$scope.refreshwishlist()},title("My Account - Favourites Items : irontread.com"),$scope.wishlistId=[],$scope.wishEquipmentList=[],$scope.max=5,$scope.isReadonly=!0;var _errorHandler=($scope.userCId,function(e){});$scope.refreshwishlist=function(){userWS.refreshwishlist({folderId:$state.params.tab},function(res){200===res.status.statusCode&&(angular.forEach(res.data,function(data){angular.forEach(data.euw_equipments,function(id){$scope.wishlistId.push(id.euwi_equipment_id)})}),$scope.getEquipData($scope.wishlistId))},_errorHandler)},$scope.getEquipData=function(idlist){angular.forEach(idlist,function(equipId){try{userWS.getEquipment({eqmtId:equipId},function(res){200===res.status.statusCode&&$scope.wishEquipmentList.push(res.data[0])},_errorHandler)}catch(e){}})},$scope.removeuserwishlist=function(_id){userWS.removeuserwishlist({eqmpId:_id},function(res){200===res.status.statusCode&&(Notification.success("This equipment has been sucessfully removed from your wishist."),$state.go($state.current,{tab:$state.params.tab},{reload:!0}))},_errorHandler)},$scope.init()}]),angular.module("user").factory("userWS",["$resource","contextPathprivate","multipartconverter",function($resource,contextPathprivate,multipartconverter){return $resource(contextPathprivate,{},{add:{method:"POST",url:contextPathprivate+"subUser/add"},edit:{method:"POST",url:contextPathprivate+"subUser/edit"},getUser:{method:"POST",url:contextPathprivate+"subUser/getuser"},all:{method:"POST",url:contextPathprivate+"subUser/all"},deactivate:{method:"POST",url:contextPathprivate+"subUser/deactivate"},activate:{method:"POST",url:contextPathprivate+"subUser/activate"},search:{method:"POST",url:contextPathprivate+"subUser/search"},changePassword:{method:"POST",url:contextPathprivate+"user/changepassword"},updateProfile:{method:"POST",url:contextPathprivate+"user/update"},findProfile:{method:"POST",url:contextPathprivate+"user/findprofile"},getRole:{method:"GET",url:contextPathprivate+"user/getrole"},getLiveRentEquipmentList:{method:"POST",url:contextPathprivate+"equipmentorder/allequipmentsorder"},getLostBidCount:{method:"POST",url:contextPathprivate+"equipmentorder/getcancelbidcount"},getLostBid:{method:"POST",url:contextPathprivate+"equipmentorder/getlostbid"},getCancelInviteBidCount:{method:"POST",url:contextPathprivate+"equipmentorder/getcancelinvitebidcount"},getCancelledBidLessee:{method:"POST",url:contextPathprivate+"equipmentorder/getcanceledbid"},getBidCancelCountLessee:{method:"POST",url:contextPathprivate+"equipmentorder/getbidcancelcountlessee"},getLiveBuyEquipmentList:{method:"POST",url:contextPathprivate+"equipmentorder/allequipmentsorder"},getLiveLessorEquipmentList:{method:"POST",url:contextPathprivate+"equipmentorder/allequipmentsorderlessor"},getLiveSellerEquipmentList:{method:"POST",url:contextPathprivate+"equipmentorder/allequipmentsorderlessor"},orderAction:{method:"POST",url:contextPathprivate+"equipmentorder/orderaction"},wishlist:{method:"POST",url:contextPathprivate+"user/getuserwishlist"},wishlistitems:{method:"POST",url:contextPathprivate+"equip/getuserwishlistitems"},bidReqAction:{method:"POST",url:contextPathprivate+"equipmentorder/bidReqAction"},bidAction:{method:"POST",url:contextPathprivate+"equipmentorder/bidAction"},bidWithDrawAction:{method:"POST",url:contextPathprivate+"equipmentorder/bidwithdraw"},bidValidater:{method:"POST",url:contextPathprivate+"equipmentorder/bidValidater"},closeBid:{method:"POST",url:contextPathprivate+"equipmentorder/closebid"},bidPrice:{method:"POST",url:contextPathprivate+"equipmentorder/checkAccept"},getCurrentRentals:{method:"POST",url:contextPathprivate+"equipmentorder/getcurrentrental"},getRejectQuestion:{method:"POST",url:contextPathprivate+"questionmaster/getquestion"},changeOrderRequest:{method:"POST",url:contextPathprivate+"equipmentorder/changerorderrequest"},verifyAssets:{method:"POST",url:contextPathprivate+"equipmentorder/verifyassets"},verifyAssetsBuy:{method:"POST",url:contextPathprivate+"equipmentorder/verifyassetsbuy"},getCreditAgency:{method:"GET",url:contextPathprivate+"ratingprivate/getrating"},getCancelRentals:{method:"POST",url:contextPathprivate+"equipmentorder/getcancelorder"},cancelBid:{method:"POST",url:contextPathprivate+"equipmentorder/getcancelbid"},getnotification:{method:"POST",url:contextPathprivate+"notification/getnotification"},getunreadcount:{method:"POST",url:contextPathprivate+"notification/getunreadcount"},updateNotificationRead:{method:"POST",url:contextPathprivate+"notification/updatenotificationread"},getCurrentLiveOrder:{method:"POST",url:contextPathprivate+"equipmentorder/getcurrentrentstatus"},getuserquery:{method:"POST",url:contextPathprivate+"finance/userquery"},getbankPayment:{method:"POST",url:contextPathprivate+"finance/payment"},misc:{method:"POST",url:contextPathprivate+"user/misc"},getfinance:{method:"POST",url:contextPathprivate+"finance/getfinance"},getuserfinance:{method:"POST",url:contextPathprivate+"finance/getuserfinance"},getFinanceEqmt:{method:"POST",url:contextPathprivate+"finance/getfinanceeqmt"},applyfinance:{method:"POST",url:contextPathprivate+"finance/applyfinance"},financebankapply:{method:"POST",url:contextPathprivate+"finance/financebankapply"},equipmentStatus:{method:"GET",url:contextPathprivate+"equip/equipmentStatus"},getOrderCount:{method:"POST",url:contextPathprivate+"equipmentorder/getOrderCount"},getCancelBidCount:{method:"POST",url:contextPathprivate+"equipmentorder/getcanceledbidcount"},getCancelledBid:{method:"POST",url:contextPathprivate+"equipmentorder/getcanceledlessor"},preference:{method:"POST",url:contextPathprivate+"user/preference"},auctionHallLessor:{method:"POST",url:contextPathprivate+"straightbidding/auctionHallPrivate"},auctionHallUser:{method:"POST",url:contextPathprivate+"straightbidding/auctionHall"},updateallnotificationread:{method:"POST",url:contextPathprivate+"notification/updateallnotificationread"},getordersummary:{method:"POST",url:contextPathprivate+"equipmentorder/getordersummary"},getUserDocument:{method:"POST",url:contextPathprivate+"user/getdocument",responseType:"blob"},getEquipOfParticipants:{method:"POST",url:contextPathprivate+"straightbidding/getEquipOfParticipants"},getbidactivecount:{method:"POST",url:contextPathprivate+"equipmentorder/getbidactivecount"},removeuserwishlist:{method:"POST",url:contextPathprivate+"user/removeuserwishlist"},refreshwishlist:{method:"POST",url:contextPathprivate+"user/refreshwishlist"},getSAEquipLessor:{method:"POST",url:contextPathprivate+"straightauction/getSAEquipLessor"},getBuyerPayment:{method:"POST",url:contextPathprivate+"straightbidding/getBuyerPayment"},dashboardPref:{method:"POST",url:contextPathprivate+"user/dashboardPref"},sendGauEmail:{method:"POST",url:contextPathprivate+"finance/sendgauemail"},getReturnBankInfo:{method:"POST",url:contextPathprivate+"finance/getreturnbankinfo"},getBidData:{method:"POST",url:contextPathprivate+"bankquery/getBidData"},acceptOffer:{method:"POST",url:contextPathprivate+"finance/acceptOffer"},sendUpdatedValue:{method:"POST",url:contextPathprivate+"bankquery/sendupdatedvalue",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},addfinance:{method:"POST",url:contextPathprivate+"finance/addfinance",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},userVerification:{method:"POST",url:contextPathprivate+"user/userVerification",transformRequest:multipartconverter,headers:{"Content-Type":void 0}},getEquipment:{method:"GET",url:contextPathprivate+"equip/details",params:{eqmtID:"@eqmtID"},interceptor:{response:function(data){return data.data}}},placeBid:{method:"POST",url:contextPathprivate+"equipmentorder/allequipmentsorderlessor",params:{orederId:"",newBidPrice:"",transportation:""}}})}]),angular.module("user").factory("userWSPublic",["$resource","contextPathpublic",function($resource,contextPathpublic){return $resource(contextPathpublic,{},{verifyemail:{url:contextPathpublic+"user/verifyemail",method:"POST"},getordersummary1:{method:"POST",url:contextPathpublic+"equipmentorder/getordersummary1"},equipmentDetails:{url:contextPathpublic+"equip/details",method:"GET",params:{eqmtID:"@eqmtID"},interceptor:{response:function(data){return data.data}}}})}]),angular.module("user").factory("SharedUserService",["$rootScope",function($rootScope){var SharedUserService={};return SharedUserService.prepforProfileUpdatebroadcast=function(){this.broadcastProfileUpdate()},SharedUserService.broadcastProfileUpdate=function(){$rootScope.$emit("ProfileUpdate")},SharedUserService}]);